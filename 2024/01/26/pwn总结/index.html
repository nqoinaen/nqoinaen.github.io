

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/logo.png">
  <link rel="icon" href="/img/logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="nq0inaen">
  <meta name="keywords" content="">
  
    <meta name="description" content="å®Œå–„ä¸­">
<meta property="og:type" content="article">
<meta property="og:title" content="pwnæ€»ç»“">
<meta property="og:url" content="https://nqoinaen.github.io/2024/01/26/pwn%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="nq0inaen&#39;s blog">
<meta property="og:description" content="å®Œå–„ä¸­">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-01-26T05:36:56.000Z">
<meta property="article:modified_time" content="2024-01-28T04:34:06.063Z">
<meta property="article:author" content="nq0inaen">
<meta property="article:tag" content="ALL">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>pwnæ€»ç»“ - nq0inaen&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"nqoinaen.github.io","root":"/","version":"1.9.3","typing":{"enable":false,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>nq0inaen&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                å‹é“¾
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/img8.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.1)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle">pwnæ€»ç»“</span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        nq0inaen
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-01-26 13:36" pubdate>
          2024å¹´1æœˆ26æ—¥ ä¸‹åˆ
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          17k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          36 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">pwnæ€»ç»“</h1>
            
              <p class="note note-info">
                
                  
                    æœ¬æ–‡æœ€åæ›´æ–°äºï¼š2024å¹´1æœˆ28æ—¥ ä¸‹åˆ
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <h2 id="å‰è¨€">å‰è¨€</h2>
<p>æ›´åƒæ˜¯å¤§çº²ï¼Œä½†ä¹Ÿå¾ˆä¸å…¨ï¼Œä»…ä¸¾å‡ºæˆ‘æ‰€äº†è§£çš„</p>
<h2 id="User-Mode">User Mode</h2>
<p>ä¸€èˆ¬éƒ½æ˜¯ç»™ä¸ªlinuxäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé¢˜ç›®é¢„å…ˆè®¾è®¡å¥½äº†æŸä¸ªæ¼æ´ï¼Œç„¶åä½ èƒ½åˆ©ç”¨æ¼æ´ï¼Œè¾¾æˆä»»æ„åœ°å€è¯»/å†™ï¼Œæ§åˆ¶ç¨‹åºæµï¼Œè¾¾æˆgetshellæˆ–orwè¯»flagä»€ä¹ˆçš„</p>
<p>ä¸€èˆ¬åšé¢˜æ­¥éª¤ï¼š</p>
<p>1.ä¸€èˆ¬æ‹¿åˆ°ç¨‹åºå…ˆchecksecçœ‹ä¸‹ä¿æŠ¤ï¼Œç„¶åè¿è¡Œä¸‹ç¨‹åºï¼Œçœ‹çœ‹åŠŸèƒ½ï¼Œç®€å•åšäº›äº¤äº’</p>
<p>2.ç„¶åç”¨idaåˆ†æé‚£ä¸ªäºŒè¿›åˆ¶ç¨‹åºçš„ä¼ªä»£ç ï¼Œè¯»æ‡‚ç¨‹åºï¼Œæ‰¾æ¼æ´</p>
<p>3.æ€è€ƒåˆ©ç”¨æ–¹æ³•ï¼Œé…åˆdbgè°ƒè¯•ï¼Œç¼–å†™å‡ºexp</p>
<h3 id="Defense">Defense</h3>
<h4 id="Canary">Canary</h4>
<p>canaryæ˜¯ä¸€ç§ç”¨æ¥é˜²æŠ¤æ ˆæº¢å‡ºçš„ä¿æŠ¤æœºåˆ¶ã€‚åŸç†æ˜¯åœ¨ä¸€ä¸ªå‡½æ•°çš„å…¥å£å¤„ï¼Œå…ˆä»fs/gså¯„å­˜å™¨ä¸­å–å‡ºä¸€ä¸ª4å­—èŠ‚(eax)æˆ–è€…8å­—èŠ‚(rax)çš„å€¼å­˜åˆ°æ ˆä¸Šï¼Œå½“å‡½æ•°ç»“æŸæ—¶ä¼šæ£€æŸ¥è¿™ä¸ªæ ˆä¸Šçš„å€¼æ˜¯å¦å’Œå­˜è¿›å»çš„å€¼ä¸€è‡´</p>
<p>è‹¥ä¸€è‡´åˆ™æ­£å¸¸é€€å‡ºï¼Œå¦‚æœæ˜¯æ ˆæº¢å‡ºæˆ–è€…å…¶ä»–åŸå› å¯¼è‡´canaryçš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç¨‹åºå°†æ‰§è¡Œ___stack_chk_failå‡½æ•°ï¼Œç»§è€Œç»ˆæ­¢ç¨‹åº</p>
<h5 id="trickï¼š">trickï¼š</h5>
<ul>
<li>å› ä¸ºcanaryæœ«å°¾æ˜¯/x00ï¼Œæœ¬èº«å¯ä»¥è¢«æˆªæ–­ï¼Œå¯ä»¥æ ˆæº¢å‡ºä¿®æ”¹æ‰æœ«å°¾çš„/x00ï¼Œé…åˆè¾“å‡ºå‡½æ•°ï¼Œæ³„éœ²canary</li>
<li>æŸäº›ç”¨forkå‡½æ•°çš„é¢˜ï¼Œçˆ¶å­è¿›ç¨‹çš„canaryæ˜¯ä¸€æ ·çš„ï¼Œé€ä½çˆ†ç ´canary</li>
<li>Stack Smashing Protect Leakï¼Œå°±æ˜¯ç”¨__stack_chk_fail()å‡½æ•°é‡Œçš„æŸä¸ªåŠŸèƒ½ï¼Œèƒ½ä»»æ„åœ°å€è¯»ï¼Œæˆ‘è®°å¾—æ—©å·²ç»ä¿®äº†è¿™ä¸ª</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">__libc_message (<span class="hljs-number">2</span>, <span class="hljs-string">&quot;*** %s ***: %s terminatedn&quot;</span>,<br>                   msg, __libc_argv[<span class="hljs-number">0</span>] ?: <span class="hljs-string">&quot;&lt;unknown&gt;&quot;</span>);<br></code></pre></td></tr></table></figure>
<ul>
<li>gotè¡¨åŠ«æŒ__stack_chk_fail</li>
</ul>
<h4 id="PIE">PIE</h4>
<p>PIEå…¨ç§°æ˜¯position-independent executableï¼Œä¸­æ–‡è§£é‡Šä¸ºåœ°å€æ— å…³å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¯¥æŠ€æœ¯æ˜¯ä¸€ä¸ªé’ˆå¯¹ä»£ç æ®µï¼ˆ.textï¼‰ã€æ•°æ®æ®µï¼ˆ.dataï¼‰ã€æœªåˆå§‹åŒ–å…¨å±€å˜é‡æ®µï¼ˆ.bssï¼‰ç­‰å›ºå®šåœ°å€çš„ä¸€ä¸ªé˜²æŠ¤æŠ€æœ¯ï¼Œå¦‚æœç¨‹åºå¼€å¯äº†PIEä¿æŠ¤çš„è¯ï¼Œåœ¨æ¯æ¬¡åŠ è½½ç¨‹åºæ—¶éƒ½å˜æ¢åŠ è½½åœ°å€</p>
<h5 id="trickï¼š-2">trickï¼š</h5>
<ul>
<li>partial writeï¼špartial write(éƒ¨åˆ†å†™å…¥)å°±æ˜¯ä¸€ç§åˆ©ç”¨äº†PIEæŠ€æœ¯ç¼ºé™·çš„bypassæŠ€æœ¯ã€‚ç”±äºå†…å­˜çš„é¡µè½½å…¥æœºåˆ¶ï¼ŒPIEçš„éšæœºåŒ–åªèƒ½å½±å“åˆ°å•ä¸ªå†…å­˜é¡µã€‚é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªå†…å­˜é¡µå¤§å°ä¸º0x1000ï¼Œè¿™å°±æ„å‘³ç€ä¸ç®¡åœ°å€æ€ä¹ˆå˜ï¼ŒæŸæ¡æŒ‡ä»¤çš„å12ä½ï¼Œ3ä¸ªåå…­è¿›åˆ¶æ•°çš„åœ°å€æ˜¯å§‹ç»ˆä¸å˜çš„ã€‚å› æ­¤é€šè¿‡è¦†ç›–EIPçš„å8æˆ–16ä½ (æŒ‰å­—èŠ‚å†™å…¥ï¼Œæ¯å­—èŠ‚8ä½)å°±å¯ä»¥å¿«é€Ÿçˆ†ç ´æˆ–è€…ç›´æ¥åŠ«æŒEIPã€‚</li>
</ul>
<h4 id="NX">NX</h4>
<p>NXå³No-eXecuteï¼ˆä¸å¯æ‰§è¡Œï¼‰çš„æ„æ€ï¼ŒNXï¼ˆDEPï¼‰çš„åŸºæœ¬åŸç†æ˜¯å°†æ•°æ®æ‰€åœ¨å†…å­˜é¡µæ ‡è¯†ä¸ºä¸å¯æ‰§è¡Œï¼Œå½“ç¨‹åºæº¢å‡ºæˆåŠŸè½¬å…¥shellcodeæ—¶ï¼Œç¨‹åºä¼šå°è¯•åœ¨æ•°æ®é¡µé¢ä¸Šæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ­¤æ—¶CPUå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯å»æ‰§è¡Œæ¶æ„æŒ‡ä»¤ã€‚</p>
<p>å³ä½¿æŸäº›å†…å­˜åŒºåŸŸä¸å¯æ‰§è¡Œï¼Œå¹¶ä½¿å¯æ‰§è¡ŒåŒºåŸŸä¸å¯å†™</p>
<p>ä¾‹ï¼šä½¿æ•°æ®ï¼Œå †æ ˆå’Œå †æ®µä¸å¯æ‰§è¡Œï¼Œè€Œä»£ç æ®µä¸å¯å†™</p>
<h5 id="trickï¼š-3">trickï¼š</h5>
<ul>
<li>ä¸€èˆ¬å°±æ˜¯åœ¨æ ˆè¿™å—åœ°å€æ²¡æ³•ç›´æ¥æ‰§è¡Œshellcodeï¼Œç”¨ROPæ‰§è¡Œç‰¹å®šçš„ä»£ç æ®µçš„ä»£ç ï¼Œä»¥è¾¾åˆ°æ§åˆ¶æ‰§è¡Œæµï¼Œgetshellç­‰ç›®çš„</li>
</ul>
<h4 id="RELRO">RELRO</h4>
<p>RELRO(RELocation Read-Only, é‡å®šä½åªè¯»), æ­¤æŠ€æœ¯ä¸»è¦é’ˆå¯¹ GOT æ”¹å†™çš„æ”»å‡»æ–¹å¼ã€‚åˆ†ä¸ºéƒ¨åˆ† <strong>RELRO(Partial RELRO)</strong> ä¸å®Œå…¨ <strong>RELRO(Full RELRO)</strong> ä¸¤ç§</p>
<ul>
<li><strong>éƒ¨åˆ† RELRO</strong>: åœ¨ç¨‹åºè£…å…¥åï¼Œå°†å…¶ä¸­ä¸€æ®µ (å¦‚<code>.dynamic</code>) æ ‡è®°ä¸ºåªè¯»ï¼Œé˜²æ­¢ç¨‹åºçš„ä¸€äº›é‡å®šä½ä¿¡æ¯è¢«ä¿®æ”¹</li>
<li><strong>å®Œå…¨ RELRO</strong>: åœ¨éƒ¨åˆ† RELRO çš„åŸºç¡€ä¸Šï¼Œåœ¨ ç¨‹åºè£…å…¥æ—¶ï¼Œç›´æ¥è§£æå®Œæ‰€æœ‰ç¬¦å·å¹¶å¡«å…¥å¯¹åº”çš„å€¼ï¼Œæ­¤æ—¶æ‰€æœ‰çš„ GOT è¡¨é¡¹éƒ½å·²åˆå§‹åŒ–ï¼Œä¸”ä¸è£…å…¥ <code>link_map</code> ä¸<code>_dl_runtime_resolve</code> çš„åœ°å€ (äºŒè€…éƒ½æ˜¯ç¨‹ åºåŠ¨æ€è£…è½½çš„é‡è¦ç»“æ„å’Œå‡½æ•°)ã€‚</li>
</ul>
<p>è®¾ç½®ç¬¦å·é‡å®šå‘è¡¨æ ¼ä¸ºåªè¯»æˆ–åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±è§£æå¹¶ç»‘å®šæ‰€æœ‰åŠ¨æ€ç¬¦å·ï¼Œä»è€Œå‡å°‘å¯¹ GOTï¼ˆGlobal Offset Tableï¼‰æ”»å‡»ã€‚RELRO ä¸ºâ€ Partial RELROâ€, è¯´æ˜æˆ‘ä»¬å¯¹ GOT è¡¨å…·æœ‰å†™æƒé™ã€‚</p>
<ul>
<li>å½“RELROä¿æŠ¤ä¸ºNO RELROçš„æ—¶å€™ï¼Œinit.arrayã€fini.arrayã€got.pltå‡å¯è¯»å¯å†™ï¼›</li>
<li>ä¸ºPARTIAL RELROçš„æ—¶å€™ï¼Œini.arrayã€fini.arrayå¯è¯»ä¸å¯å†™ï¼Œgot.pltå¯è¯»å¯å†™ï¼›</li>
<li>ä¸ºFULL RELROæ—¶ï¼Œinit.arrayã€fini.arrayã€got.pltå‡å¯è¯»ä¸å¯å†™ã€‚</li>
<li>ç¨‹åºåœ¨åŠ è½½çš„æ—¶å€™ï¼Œä¼šä¾æ¬¡è°ƒç”¨init.arrayæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œåœ¨ç»“æŸçš„æ—¶å€™ï¼Œä¾æ¬¡è°ƒç”¨fini.arrayä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆå½“ç¨‹åºå‡ºç°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä½†æ˜¯éœ€è¦å†™ä¸¤æ¬¡æ‰èƒ½å®Œæˆæ”»å‡»ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è€ƒè™‘æ”¹å†™fini.arrayä¸­çš„å‡½æ•°æŒ‡é’ˆä¸ºmainå‡½æ•°åœ°å€ï¼Œå¯ä»¥å†æ‰§è¡Œä¸€æ¬¡mainå‡½æ•°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªæ•°ç»„çš„é•¿åº¦ä¸º1ï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½å†™ä¸€ä¸ªåœ°å€ã€‚</li>
</ul>
<h5 id="trickï¼š-4">trickï¼š</h5>
<p><strong>GOT Hijackingï¼š</strong></p>
<p>NO RELROä¸PARTIAL RELROæ—¶é‡‡ç”¨Lazy Bindingï¼ˆå»¶è¿Ÿç»‘å®šï¼‰æœºåˆ¶æ—¶ï¼š</p>
<p>å› ä¸ºä¸ä¸€å®šæ¯ä¸ªåº“å‡½æ•°éƒ½ä¼šè¢«æ‰§è¡Œåˆ°ï¼Œæ‰€ä»¥é‡‡ç”¨lazy bindingçš„æœºåˆ¶ï¼Œå½“ç¬¬ä¸€æ¬¡æ‰§è¡Œåˆ°åº“å‡½æ•°çš„æŸä¸ªåŠŸèƒ½æ—¶æ‰ä¼šå»å¯»æ‰¾çœŸæ­£çš„åœ°å€å¹¶è¿›è¡Œç»‘å®š</p>
<p>Global Offset Tableï¼šï¼ˆGOTï¼‰------gotå¤§æ¦‚æ”¾åœ¨.dataæ®µ-----pltå¤§æ¦‚æ”¾åœ¨.codeæ®µçš„åœ°æ–¹</p>
<p>æ–¹æ³•ï¼šåˆ©ç”¨ç¨‹åºä¸­æŸä¸ªæ¼æ´ï¼Œåšåˆ°ä¾‹å¦‚ä»»æ„åœ°å€å†™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠé‚£ä¸ªgotä¸­çš„é‚£ä¸ªåœ°å€å†™æˆæˆ‘ä»¬è¦å»çš„åœ°å€</p>
<p>åœ¨call åŸæœ¬é‚£ä¸ªå‡½æ•°æ—¶ï¼Œå°±ä¼šè°ƒæˆ‘ä»¬æƒ³å»çš„åœ°å€ã€‚</p>
<h4 id="ALSR">ALSR</h4>
<p>ASLR (Address Space Layout Randomization), åœ°å€ç©ºé—´é…ç½®éšæœºåŠ è½½ï¼Œç®€ç§°åœ°å€éšæœºåŒ–</p>
<p>heapæ®µï¼Œlibcæ®µï¼Œstackæ®µç­‰å¼€å¯ALSRä¹‹ååœ°å€éƒ½æ˜¯ä¸å›ºå®šçš„</p>
<p>å€¼å¾—<strong>æ³¨æ„çš„æ˜¯ALSRæ˜¯ç³»ç»Ÿçº§çš„ï¼Œè€ŒPIEæ˜¯ç¨‹åºçº§çš„ï¼Œä¸€èˆ¬æ˜¯ç³»ç»Ÿé»˜è®¤å¼€å¯ASLRçš„</strong></p>
<h5 id="trickï¼š-5">trickï¼š</h5>
<ul>
<li><strong>æ³„éœ²ç¨‹åºåœ°å€æ¥ç»•è¿‡ALSR</strong>: ç›®å‰å¹¿æ³›åº”ç”¨åœ¨æ“ä½œç³»ç»Ÿçš„åœ°å€éšæœºåŒ–å¤šä¸ºç²—ç²’åº¦çš„å®ç°æ–¹å¼ï¼ŒåŒä¸€æ¨¡å—ä¸­çš„æ‰€æœ‰ä»£ç ä¸æ•°æ®çš„ç›¸å¯¹åç§»å›ºå®šã€‚åªéœ€è¦é€šè¿‡ä¿¡æ¯æ³„éœ²æ¼æ´å°†æŸä¸ªæ¨¡å—ä¸­çš„ä»»ä¸€ä»£ç æŒ‡é’ˆæˆ–è€…æ•°æ®æŒ‡é’ˆæ³„éœ²ï¼Œå³å¯é€šè¿‡è®¡ç®—å¾—åˆ°æ­¤æ¨¡å—ä¸­ä»»æ„ä»£ç æˆ–æ•°æ®çš„åœ°å€</li>
</ul>
<h4 id="FORTIFY">FORTIFY</h4>
<p>è¿™æ˜¯ä¸€ä¸ªç”±GCCå®ç°çš„æºç çº§åˆ«çš„ä¿æŠ¤æœºåˆ¶ï¼Œå…¶åŠŸèƒ½æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™æ£€æŸ¥æºç ä»¥é¿å…æ½œåœ¨çš„ç¼“å†²åŒºæº¢å‡ºç­‰é”™è¯¯ã€‚ç®€å•åœ°è¯´ï¼ŒåŠ äº†è¿™ä¸ªä¿æŠ¤ä¹‹åï¼ˆç¼–è¯‘æ—¶åŠ ä¸Šå‚æ•°-D_FORTIFY_SOURCE=2ï¼‰ä¸€äº›æ•æ„Ÿå‡½æ•°å¦‚read, fgets,memcpy, printfç­‰ç­‰å¯èƒ½å¯¼è‡´æ¼æ´å‡ºç°çš„å‡½æ•°éƒ½ä¼šè¢«æ›¿æ¢æˆ__read_chk,__fgets_chk, __memcpy_chk, __printf_chkç­‰ã€‚è¿™äº›å¸¦äº†chkçš„å‡½æ•°ä¼šæ£€æŸ¥è¯»å–/å¤åˆ¶çš„å­—èŠ‚é•¿åº¦æ˜¯å¦è¶…è¿‡ç¼“å†²åŒºé•¿åº¦ï¼Œé€šè¿‡æ£€æŸ¥è¯¸å¦‚%nä¹‹ç±»çš„å­—ç¬¦ä¸²ä½ç½®æ˜¯å¦ä½äºå¯èƒ½è¢«ç”¨æˆ·ä¿®æ”¹çš„å¯å†™åœ°å€ï¼Œé¿å…äº†æ ¼å¼åŒ–å­—ç¬¦ä¸²è·³è¿‡æŸäº›å‚æ•°ï¼ˆå¦‚ç›´æ¥%7$xï¼‰ç­‰æ–¹å¼æ¥é¿å…æ¼æ´å‡ºç°ã€‚å¼€å¯äº†FORTIFYä¿æŠ¤çš„ç¨‹åºä¼šè¢«checksecæ£€å‡ºï¼Œæ­¤å¤–ï¼Œåœ¨åæ±‡ç¼–æ—¶ç›´æ¥æŸ¥çœ‹gotè¡¨ä¹Ÿä¼šå‘ç°chkå‡½æ•°çš„å­˜åœ¨</p>
<h3 id="Types-of-vulnerabilities">Types of vulnerabilities</h3>
<h4 id="Stack-Overflow">Stack Overflow</h4>
<p>æ ˆæº¢å‡ºæŒ‡çš„æ˜¯ç¨‹åºå‘æ ˆä¸­æŸä¸ªå˜é‡ä¸­å†™å…¥çš„å­—èŠ‚æ•°è¶…è¿‡äº†è¿™ä¸ªå˜é‡æœ¬èº«æ‰€ç”³è¯·çš„å­—èŠ‚æ•°ï¼Œå› è€Œå¯¼è‡´ä¸å…¶ç›¸é‚»çš„æ ˆä¸­çš„å˜é‡çš„å€¼è¢«æ”¹å˜ã€‚è¿™ç§é—®é¢˜æ˜¯ä¸€ç§ç‰¹å®šçš„ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼Œç±»ä¼¼çš„è¿˜æœ‰å †æº¢å‡ºï¼Œbss æ®µæº¢å‡ºç­‰æº¢å‡ºæ–¹å¼ã€‚</p>
<h4 id="Heap-Overflow">Heap Overflow</h4>
<p>å †æº¢å‡ºæ˜¯æŒ‡ç¨‹åºå‘æŸä¸ªå †å—ä¸­å†™å…¥çš„å­—èŠ‚æ•°è¶…è¿‡äº†å †å—æœ¬èº«å¯ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå› è€Œå¯¼è‡´äº†æ•°æ®æº¢å‡ºï¼Œå¹¶è¦†ç›–åˆ°ç‰©ç†ç›¸é‚»çš„é«˜åœ°å€çš„ä¸‹ä¸€ä¸ªå †å—ã€‚</p>
<p>æˆ‘ä»¬åœ¨ç†Ÿæ‚‰å †æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œè¿ç”¨ä½ é«˜è¶…çš„å †é£æ°´æŠ€å·§ï¼Œä¼ªé€ å †ç»“æ„ä½“ï¼Œä¼ªé€ I/O Fileç»“æ„ä½“ç­‰ï¼Œè¾¾æˆä»»æ„åœ°å€è¯»å†™ï¼Œæˆ–è€…æ›´ä¸¥æ ¼ç‚¹ï¼Œåœ¨ç‰¹å®šä½ç½®å†™å…¥ç‰¹å®šå€¼ï¼Œå°±å¯ä»¥æ§åˆ¶ç¨‹åºgetshellç­‰</p>
<h4 id="Use-After-Free">Use After Free</h4>
<p>å­—é¢æ„æ€ï¼Œå³å½“ä¸€ä¸ªå†…å­˜å—è¢«é‡Šæ”¾ä¹‹åå†æ¬¡è¢«ä½¿ç”¨</p>
<h5 id="å‘ç”ŸUAFçš„æƒ…å†µï¼š">å‘ç”ŸUAFçš„æƒ…å†µï¼š</h5>
<ul>
<li>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è®¾ç½®ä¸º NULL</li>
</ul>
<h5 id="double-free">double free</h5>
<ul>
<li>åœ¨glibc2.27ä¹‹å‰ï¼Œä¸»è¦æ˜¯fastbin double freeï¼š<br>
fastbinåœ¨freeæ—¶åªä¼šæ£€æŸ¥ç°åœ¨é‡Šæ”¾çš„chunkï¼Œæ˜¯ä¸æ˜¯å¼€å¤´çš„chunkï¼Œå› æ­¤å¯ä»¥é€šè¿‡free(C1), free(C2), free(C1)çš„æ‰‹æ³•ç»•è¿‡<br>
å¹¶åœ¨åœ¨fastbinå–å‡ºæ—¶ï¼Œä¼šæ£€æŸ¥sizeå­—æ®µæ˜¯ä¸æ˜¯å±äºè¿™ä¸ªfastbinï¼Œå› æ­¤å¾€å¾€éœ€è¦ä¼ªé€ ä¸€ä¸ªsize</li>
<li>glibc2.27~glibc2.28ï¼Œä¸»è¦æ˜¯tcache double free<br>
ç›¸è¾ƒäºfastbin double freeï¼Œtcacheå®Œå…¨æ²¡æœ‰ä»»ä½•æ£€æŸ¥ï¼Œåªéœ€è¦free(C1), free(C1)å°±å¯ä»¥æ„é€ ä¸€ä¸ªç¯å‡ºæ¥</li>
<li>glibc2.29ï½glibc2.3Xï¼ŒtcacheåŠ å…¥äº†æ£€æŸ¥æœºåˆ¶</li>
</ul>
<h6 id="æ£€æµ‹ï¼š">æ£€æµ‹ï¼š</h6>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">size_t</span> tc_idx = csize2tidx(size);<br><span class="hljs-comment">//åªè¦tcacheä¸ä¸ºç©ºï¼Œå¹¶ä¸”è¿™ä¸ªchunkå±äºtcacheç®¡è¾–èŒƒå›´ï¼Œé‚£ä¹ˆè¿™ä¸ªchunkå°±æœ‰å¯èƒ½å·²ç»åœ¨tcacheä¸­äº†ï¼Œæ‰€ä»¥éœ€è¦double freeæ£€æŸ¥</span><br><span class="hljs-keyword">if</span> (tcache != <span class="hljs-literal">NULL</span> &amp;&amp; tc_idx &lt; mp_.tcache_bins)<br>&#123;<br>  <span class="hljs-comment">/* Check to see if it&#x27;s already in the tcache.  */</span><br>  tcache_entry *e = (tcache_entry *)chunk2mem(p);<br> <br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">    å¦‚æœæ˜¯double freeï¼Œé‚£ä¹ˆputæ—¶keyå­—æ®µè¢«è®¾ç½®äº†tcacheï¼Œå°±ä¼šè¿›å…¥å¾ªç¯è¢«æ£€æŸ¥å‡ºæ¥</span><br><span class="hljs-comment">    å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆkeyå­—æ®µå°±æ˜¯ç”¨æˆ·æ•°æ®åŒºåŸŸï¼Œå¯ä»¥è§†ä¸ºéšæœºçš„ï¼Œåªæœ‰1/(2^size_t)çš„å¯èƒ½è¡Œè¿›å…¥å¾ªç¯ï¼Œç„¶åå¾ªç¯å‘ç°å¹¶ä¸æ˜¯double free</span><br><span class="hljs-comment">  */</span><br>  <span class="hljs-keyword">if</span> (__glibc_unlikely(e-&gt;key == tcache))<span class="hljs-comment">//å‰ªæ</span><br>  &#123;<br>    tcache_entry *tmp;<br>    LIBC_PROBE(memory_tcache_double_free, <span class="hljs-number">2</span>, e, tc_idx);<br>    <span class="hljs-keyword">for</span> (tmp = tcache-&gt;entries[tc_idx]; tmp; tmp = tmp-&gt;next)<br>      <span class="hljs-keyword">if</span> (tmp == e)<br>        malloc_printerr(<span class="hljs-string">&quot;free(): double free detected in tcache 2&quot;</span>);<br>  &#125;<br> <br>  <span class="hljs-keyword">if</span> (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count)  <span class="hljs-comment">//é€šè¿‡æ£€æŸ¥ï¼Œæ”¾å…¥tcahceä¸­</span><br>  &#123;<br>    tcache_put(p, tc_idx);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä¸¤ç§æ–¹æ³•ç»•è¿‡</p>
<ol>
<li>æƒ³åŠæ³•ä¿®æ”¹keyå­—æ®µï¼Œèƒ½ç¼–è¾‘freeåçš„å †å°±å¯ä»¥ï¼ˆå¥½åƒğŸ¥ºï¼‰</li>
<li>ä½¿ç”¨fastbin double free</li>
</ol>
<h4 id="Format-String">Format String</h4>
<p>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„æˆå› åœ¨äºåƒprintf/sprintf/snprintfç­‰æ ¼å¼åŒ–æ‰“å°å‡½æ•°éƒ½æ˜¯æ¥å—å¯å˜å‚æ•°çš„ï¼Œè€Œä¸€æ—¦ç¨‹åºç¼–å†™ä¸è§„èŒƒï¼Œæ¯”å¦‚æ­£ç¡®çš„å†™æ³•æ˜¯ï¼š<code>printf(&quot;%s&quot;, pad)</code>ï¼Œå·æ‡’å†™æˆäº†ï¼š<code>printf(pad)</code>ï¼Œæ­¤æ—¶å°±å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p>
<p><strong>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æœ€ç»ˆå¯ä»¥åšåˆ°ä»»æ„åœ°å€è¯»/å†™</strong></p>
<p>æˆ‘ä»¬ä¸€èˆ¬ä¼šåˆ†ä¸¤å¤§æ­¥å®ç°æ¼æ´åˆ©ç”¨ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥æ„é€ ä¸€ä¸ªpayloadæ¥å¯»æ‰¾è¾“å…¥å­—ç¬¦ä¸²åˆ°æ ˆé¡¶æŒ‡é’ˆçš„åç§»ï¼›</li>
<li>ç¬¬äºŒæ­¥å°±æ˜¯æ”»å‡»äº†ï¼Œåˆ©ç”¨æ‰¾åˆ°çš„åç§»ï¼Œåœ¨åç§»å¤„å¡«å…¥ç›®çš„åœ°å€å¯ä»¥å®ç°ç›®çš„åœ°å€çš„å†…å®¹æ³„éœ²ä»¥åŠå†…å®¹æ”¹å†™ã€‚</li>
</ul>
<p><strong>å¸¸ç”¨åŸºæœ¬çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å‚æ•°ä»‹ç»ï¼š</strong></p>
<ul>
<li>
<p>%cï¼šè¾“å‡ºå­—ç¬¦ï¼Œé…ä¸Š%n å¯ç”¨äºå‘æŒ‡å®šåœ°å€å†™æ•°æ®ã€‚</p>
</li>
<li>
<p>%dï¼šè¾“å‡ºåè¿›åˆ¶æ•´æ•°ï¼Œé…ä¸Š%n å¯ç”¨äºå‘æŒ‡å®šåœ°å€å†™æ•°æ®ã€‚</p>
</li>
<li>
<p>%xï¼šè¾“å‡º 16 è¿›åˆ¶æ•°æ®ï¼Œå¦‚%i$x è¡¨ç¤ºè¦æ³„æ¼åç§» i å¤„ 4 å­—èŠ‚é•¿çš„ 16 è¿›åˆ¶æ•° æ®ï¼Œ</p>
</li>
<li>
<p>%i$lx è¡¨ç¤ºè¦æ³„æ¼åç§» i å¤„ 8 å­—èŠ‚é•¿çš„ 16 è¿›åˆ¶æ•°æ®ï¼Œ32bit å’Œ 64bit ç¯å¢ƒä¸‹ä¸€ æ ·ã€‚</p>
</li>
<li>
<p>%pï¼šè¾“å‡º 16 è¿›åˆ¶æ•°æ®ï¼Œä¸%x åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯é™„åŠ äº†å‰ç¼€ 0xï¼Œåœ¨ 32bit ä¸‹è¾“ å‡º 4 å­—èŠ‚ï¼Œåœ¨ 64bit ä¸‹è¾“å‡º 8 å­—èŠ‚ï¼Œå¯é€šè¿‡è¾“å‡ºå­—èŠ‚çš„é•¿åº¦æ¥åˆ¤æ–­ç›®æ ‡ç¯å¢ƒæ˜¯ 32bit è¿˜æ˜¯ 64bitã€‚</p>
</li>
<li>
<p>%sï¼šè¾“å‡ºçš„å†…å®¹æ˜¯å­—ç¬¦ä¸²ï¼Œå³å°†åç§»å¤„æŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦ä¸²è¾“å‡ºï¼Œå¦‚%i$s è¡¨ç¤º è¾“å‡ºåç§» i å¤„åœ°å€æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²ï¼Œåœ¨ 32bit å’Œ 64bit ç¯å¢ƒä¸‹ä¸€æ ·ï¼Œå¯ç”¨äºè¯»å– GOT è¡¨ç­‰ä¿¡æ¯ã€‚</p>
</li>
<li>
<p>%nï¼šå°†%n ä¹‹å‰ printf å·²ç»æ‰“å°çš„å­—ç¬¦ä¸ªæ•°èµ‹å€¼ç»™åç§»å¤„æŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€ ä½ç½®ï¼Œå¦‚%100Ã—10$n è¡¨ç¤ºå°† 0x64 å†™å…¥åç§» 10 å¤„ä¿å­˜çš„æŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€ï¼ˆ4 å­—èŠ‚ï¼‰ï¼Œè€Œ%$hn è¡¨ç¤ºå†™å…¥çš„åœ°å€ç©ºé—´ä¸º 2 å­—èŠ‚ï¼Œ%$hhn è¡¨ç¤ºå†™å…¥çš„åœ°å€ç©ºé—´ä¸º 1 å­—èŠ‚ï¼Œ%$lln è¡¨ç¤ºå†™å…¥çš„åœ°å€ç©ºé—´ä¸º 8 å­—èŠ‚ï¼Œåœ¨ 32bit å’Œ 64bit ç¯å¢ƒä¸‹ä¸€æ ·ã€‚æœ‰æ—¶ï¼Œ ç›´æ¥å†™ 4 å­—èŠ‚ä¼šå¯¼è‡´ç¨‹åºå´©æºƒæˆ–ç­‰å€™æ—¶é—´è¿‡é•¿ï¼Œå¯ä»¥é€šè¿‡%$hn æˆ–%$hhn æ¥é€‚æ—¶ è°ƒæ•´ã€‚</p>
</li>
<li>
<p>%n æ˜¯é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ”¹å˜ç¨‹åºæµç¨‹çš„å…³é”®æ–¹å¼ï¼Œè€Œå…¶ä»–æ ¼å¼åŒ–å­—ç¬¦ ä¸²å‚æ•°å¯ç”¨äºè¯»å–ä¿¡æ¯æˆ–é…åˆ%n å†™æ•°æ®ã€‚</p>
</li>
</ul>
<p>32ä½/64ä½ä¸‹ç•¥æœ‰å·®å¼‚</p>
<p>pwntoolsé‡Œfmtstræ¨¡å—èƒ½å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨</p>
<blockquote>
<p>fmtstr_payloadæ˜¯pwntoolsé‡Œé¢çš„ä¸€ä¸ªå·¥å…·ï¼Œç”¨æ¥ç®€åŒ–å¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„æ„é€ å·¥ä½œã€‚</p>
<p>fmtstr_payload(offset, writes, numbwritten=0, write_size=â€˜byteâ€™)</p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ï¼›</p>
<p>ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºéœ€è¦åˆ©ç”¨%nå†™å…¥çš„æ•°æ®ï¼Œé‡‡ç”¨å­—å…¸å½¢å¼ï¼Œæˆ‘ä»¬è¦å°†printfçš„GOTæ•°æ®æ”¹ä¸ºsystemå‡½æ•°åœ°å€ï¼Œå°±å†™æˆ{printfGOT: systemAddress}ï¼›æœ¬é¢˜æ˜¯å°†0804a048å¤„æ”¹ä¸º0x2223322</p>
<p>ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºå·²ç»è¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°ï¼Œè¿™é‡Œæ²¡æœ‰ï¼Œä¸º0ï¼Œé‡‡ç”¨é»˜è®¤å€¼å³å¯ï¼›</p>
<p>ç¬¬å››ä¸ªå‚æ•°è¡¨ç¤ºå†™å…¥æ–¹å¼ï¼Œæ˜¯æŒ‰å­—èŠ‚ï¼ˆbyteï¼‰ã€æŒ‰åŒå­—èŠ‚ï¼ˆshortï¼‰è¿˜æ˜¯æŒ‰å››å­—èŠ‚ï¼ˆintï¼‰ï¼Œå¯¹åº”ç€hhnã€hnå’Œnï¼Œé»˜è®¤å€¼æ˜¯byteï¼Œå³æŒ‰hhnå†™ã€‚ fmtstr_payloadå‡½æ•°è¿”å›çš„å°±æ˜¯payload</p>
<p>å®é™…ä¸Šæˆ‘ä»¬å¸¸ç”¨çš„å½¢å¼æ˜¯fmtstr_payload(offset,{address1:value1})</p>
</blockquote>
<p>è‡ªå·±æ‰‹å†™èµ·æ¥è¿˜æ˜¯æŒºéº»çƒ¦çš„ï¼Œå¯èƒ½éœ€è¦æŠŠè¦å†™çš„å€¼æ‹†æˆä¸¤éƒ¨åˆ†ï¼Œåˆ†ä¸¤æ¬¡å†™ï¼Œè¿˜è¦é˜²æ­¢æˆªæ–­ï¼ˆé‚£äº›è¾“å…¥å‡½æ•°ä¸€èˆ¬éƒ½æœ‰/x00æˆªæ–­ï¼‰</p>
<h4 id="Integer-Overflow">Integer Overflow</h4>
<h4 id="Type-Confusion">Type Confusion</h4>
<p>ç±»å‹æ··æ·†ï¼Œå¥½åƒæ˜¯C++æ‰æœ‰çš„æ¼æ´ç±»å‹ï¼Œæˆ‘ä¸æ‡‚</p>
<h4 id="Race-Condition">Race Condition</h4>
<h4 id="OOB">OOB</h4>
<p>(Out-of-Bounds)æ•°ç»„è¶Šç•Œ</p>
<h3 id="Stack-Exploitation">Stack Exploitation</h3>
<h4 id="ROP">ROP</h4>
<p>å³è¿”å›å¯¼å‘ç¼–ç¨‹ï¼ˆReturn Qriented Prorammingï¼‰</p>
<p>é€šè¿‡ä¸æ–­å»æ‰§è¡ŒåŒ…å«retçš„ç¨‹åºç‰‡æ®µæ¥è¾¾åˆ°æƒ³è¦çš„æ“ä½œ</p>
<p>è¿™äº›åŒ…å«retçš„ç¨‹å¼ç‰‡æ®µåˆè¢«ç§°ä½œgadget</p>
<p>ä¾‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">4004fa:48 83 c4 08       add    rsp,0x8<br>4004fe:5d                ret<br></code></pre></td></tr></table></figure>
<h4 id="SROP">SROP</h4>
<p>SROPçš„å…¨ç§°æ˜¯Sigreturn Oriented Programmingã€‚åœ¨è¿™é‡Œ<code>sigreturn</code>æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒåœ¨unixç³»ç»Ÿå‘ç”Ÿsignalçš„æ—¶å€™ä¼šè¢«é—´æ¥åœ°è°ƒç”¨ã€‚</p>
<p>pwntoolsæœ‰SigreturnFrame()å¯ä»¥å¿«é€Ÿç¼–å†™payload</p>
<p>ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">frame = SigreturnFrame()<br>frame.rax=constants.SYS_execve<br>frame.rdi=binsh_addr<br>frame.rsi=<span class="hljs-number">0</span><br>frame.rdx=<span class="hljs-number">0</span><br>frame.rip=system_call<br></code></pre></td></tr></table></figure>
<p>å½“å†…æ ¸å‘æŸä¸ªè¿›ç¨‹å‘é€ä¸€ä¸ªsignalï¼Œè¯¥è¿›ç¨‹ä¼šè¢«æš‚æ—¶æŒ‚èµ·ï¼Œè¿›å…¥å†…æ ¸æ€ï¼Œ</p>
<p>ç„¶åå†…æ ¸ä¸ºè¯¥è¿›ç¨‹ä¿å­˜ç›¸åº”çš„ä¸Šä¸‹æ–‡ï¼Œè·³è½¬åˆ°ä¹‹å‰æ³¨å†Œå¥½çš„signal handlerä¸­å¤„ç†ç›¸åº”signalã€‚å†…æ ¸ä¼šå¸®ç”¨æˆ·è¿›ç¨‹å°†å…¶ä¸Šä¸‹æ–‡ä¿å­˜åœ¨è¯¥è¿›ç¨‹çš„æ ˆä¸Šï¼Œç„¶ååœ¨æ ˆé¡¶å¡«ä¸Šä¸€ä¸ªåœ°å€<code>rt_sigreturn</code>ï¼Œè¿™ä¸ªåœ°å€æŒ‡å‘ä¸€æ®µä»£ç ï¼Œåœ¨è¿™æ®µä»£ç ä¸­ä¼šè°ƒç”¨<code>sigreturn</code>ç³»ç»Ÿè°ƒç”¨ã€‚å› æ­¤ï¼Œå½“signal handleræ‰§è¡Œå®Œä¹‹åï¼Œæ ˆæŒ‡é’ˆï¼ˆstack pointerï¼‰å°±æŒ‡å‘<code>rt_sigreturn</code>ï¼Œæ‰€ä»¥ï¼Œsignal handlerå‡½æ•°çš„æœ€åä¸€æ¡<code>ret</code>æŒ‡ä»¤ä¼šä½¿å¾—æ‰§è¡Œæµè·³è½¬åˆ°è¿™æ®µsigreturnä»£ç ï¼Œè¢«åŠ¨åœ°è¿›è¡Œ<code>sigreturn</code>ç³»ç»Ÿè°ƒç”¨ã€‚</p>
<p>å½“signal handlerè¿”å›ä¹‹åå†…æ ¸ä¸ºè¯¥è¿›ç¨‹æ¢å¤ä¹‹å‰ä¿å­˜çš„ä¸Šä¸‹æ–‡ï¼Œæœ€åæ¢å¤è¿›ç¨‹çš„æ‰§è¡Œ</p>
<p>ç¬¬ä¸€ã€è¿™ä¸ª<code>Signal Frame</code>æ˜¯è¢«ä¿å­˜åœ¨ç”¨æˆ·è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­çš„ï¼Œæ˜¯ç”¨æˆ·è¿›ç¨‹å¯è¯»å†™çš„ï¼›</p>
<p>ç¬¬äºŒã€å†…æ ¸å¹¶æ²¡æœ‰å°†ä¿å­˜çš„è¿‡ç¨‹å’Œæ¢å¤çš„è¿‡ç¨‹è¿›è¡Œä¸€ä¸ªæ¯”è¾ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨<code>sigreturn</code>è¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„å¤„ç†å‡½æ•°ä¸­ï¼Œå†…æ ¸å¹¶æ²¡æœ‰åˆ¤æ–­å½“å‰çš„è¿™ä¸ª<code>Signal Frame</code>å°±æ˜¯ä¹‹å‰å†…æ ¸ä¸ºç”¨æˆ·è¿›ç¨‹ä¿å­˜çš„é‚£ä¸ª<code>Signal Frame</code>ã€‚</p>
<p><strong>ä¾‹</strong>ï¼šå‡è®¾ä¸€ä¸ªæ”»å‡»è€…å¯ä»¥æ§åˆ¶ç”¨æˆ·è¿›ç¨‹çš„æ ˆï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥ä¼ªé€ ä¸€ä¸ª<code>Signal Frame</code></p>
<p>åœ¨è¿™ä¸ªä¼ªé€ çš„<code>Signal Frame</code>ä¸­ï¼Œå°†<code>rax</code>è®¾ç½®æˆ59ï¼ˆå³<code>execve</code>ç³»ç»Ÿè°ƒç”¨å·ï¼‰ï¼Œå°†<code>rdi</code>è®¾ç½®æˆå­—ç¬¦ä¸²<code>/bin/sh</code>çš„åœ°å€ï¼ˆè¯¥å­—ç¬¦ä¸²å¯ä»¥æ˜¯æ”»å‡»è€…å†™åœ¨æ ˆä¸Šçš„ï¼‰ï¼Œå°†<code>rip</code>è®¾ç½®æˆç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤<code>syscall</code>çš„å†…å­˜åœ°å€ï¼Œæœ€åï¼Œå°†<code>rt_sigreturn</code>æ‰‹åŠ¨è®¾ç½®æˆ<code>sigreturn</code>ç³»ç»Ÿè°ƒç”¨çš„å†…å­˜åœ°å€ã€‚é‚£ä¹ˆï¼Œå½“è¿™ä¸ªä¼ªé€ çš„<code>sigreturn</code>ç³»ç»Ÿè°ƒç”¨è¿”å›ä¹‹åï¼Œç›¸åº”çš„å¯„å­˜å™¨å°±è¢«è®¾ç½®æˆäº†æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„å€¼ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸€æ—¦<code>sigreturn</code>è¿”å›ï¼Œå°±ä¼šå»æ‰§è¡Œ<code>execve</code>ç³»ç»Ÿè°ƒç”¨ï¼Œæ‰“å¼€ä¸€ä¸ªshellã€‚</p>
<p><strong>æ€»ä½“æ¥è¯´ï¼š</strong></p>
<p>å°±æ˜¯åœ¨æ ˆä¸Šä¼ªé€ fake_SigreturnFrameï¼Œæˆ‘ä»¬åˆ©ç”¨sigreturnçš„æœºåˆ¶ï¼Œåœ¨è¿”å›æ—¶å¸¦å‚æ•°çš„æ‰§è¡ŒæŸä¸ªç³»ç»Ÿè°ƒç”¨</p>
<h4 id="Stack-migration">Stack migration</h4>
<p>æº¢å‡ºé•¿åº¦ä¸å¤Ÿæ—¶ï¼Œå°±è¦ç”¨åˆ°æ ˆè¿ç§»äº†ï¼Œå°†ebpè¿ç§»åˆ°bssæ®µæˆ–dataæ®µï¼Œæ„é€ gadgetç„¶ååœ¨è¿™é‡Œæ‰§è¡Œ</p>
<blockquote>
<p>leaveç›¸å½“äºæ±‡ç¼– mov rsp,rbp;pop rbp;<br>
retç›¸å½“äºæ±‡ç¼–pop eip;</p>
</blockquote>
<h4 id="ret2shellcode">ret2shellcode</h4>
<p>shellcodeè¦å†™åœ¨å¯ä»¥æ‰§è¡Œçš„æ®µï¼Œæ§åˆ¶ç¨‹åºæµæ‰§è¡Œå®ƒ</p>
<h4 id="ret2libc">ret2libc</h4>
<h4 id="ret2csu">ret2csu</h4>
<p>ç®€å•æ¥è¯´å°±æ˜¯åˆ©ç”¨libc_csu_initä¸­çš„ä¸¤æ®µä»£ç ç‰‡æ®µæ¥å®ç°(rdi,rsi,rdx)3ä¸ªå‚æ•°çš„ä¼ é€’ï¼ˆé—´æ¥æ€§çš„ä¼ é€’å‚æ•°ï¼‰</p>
<p>x64 ä¸‹çš„ __libc_csu_init è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥å¯¹ libc è¿›è¡Œåˆå§‹åŒ–æ“ä½œçš„ï¼Œè€Œä¸€èˆ¬çš„ç¨‹åºç”¨ libc å‡½æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°ä¸€å®šä¼šå­˜åœ¨ã€‚</p>
<p>(ä¸åŒç‰ˆæœ¬çš„è¿™ä¸ªå‡½æ•°æœ‰ä¸€å®šçš„åŒºåˆ«ï¼Œéœ€è¦å¯¹ä¸‹é¢çš„payloadç•¥ä½œä¿®æ”¹)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">csu</span>(<span class="hljs-params">rdi,rsi,rdx,function</span>):<br>    csu_front_addr=<span class="hljs-number">0x400740</span><br>    csu_end_addr=<span class="hljs-number">0x40075A</span><br>    payload = <span class="hljs-string">b&#x27;&#x27;</span><br>    payload += p64(csu_end_addr) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">1</span>) + p64(function) + p64(<br>        rdi) + p64(rsi) + p64(rdx)<br>    payload += p64(csu_front_addr)<br>    payload += <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x38</span><br>    <span class="hljs-keyword">return</span> payload<br></code></pre></td></tr></table></figure>
<h4 id="ret2dl-resolve">ret2dl_resolve</h4>
<p>ä¸€èˆ¬æ˜¯æ ˆè¿ç§»åˆ°bssæ®µä¼ªé€ fake_linkmapç»“æ„ä½“æ¬ºéª—ç¨‹åºæ‰§è¡Œsystem(â€œ/bin/shâ€)</p>
<ul>
<li>ç”¨äºåº”å¯¹åªèƒ½æº¢å‡º0x10å­—èŠ‚çš„æƒ…å†µ</li>
<li>ä¿æŠ¤ä¸èƒ½å¼€å¯FULL RELRO</li>
<li>ç†è§£è¾ƒéš¾ï¼Œåˆ©ç”¨ç›¸å¯¹æ¨¡æ¿åŒ–</li>
<li>pwntoolsæœ‰Ret2dlresolvePayloadæ¨¡å—</li>
</ul>
<h3 id="Heap-Exploitation">Heap Exploitation</h3>
<h4 id="realloc-malloc-callocåŒºåˆ«">realloc/malloc/callocåŒºåˆ«</h4>
<ul>
<li>
<p>malloc</p>
<blockquote>
<p>void* malloc (size_t size);</p>
</blockquote>
<p>æ ¹æ®sizeæ¥ç”³è¯·å†…å­˜ï¼Œä½¿ç”¨ptmallocè¿›è¡Œå†…å­˜ç®¡ç†</p>
</li>
<li>
<p>realloc</p>
<blockquote>
<p>void* realloc (void* realloc_ptr, size_t size);</p>
</blockquote>
<p>å¯ä»¥å¯¹å†…å­˜çš„å¤§å°åšçµæ´»çš„è°ƒæ•´ï¼Œå…·ä½“å‚æ•°è®¾ç½®ä¼šæœ‰å¦‚ä¸‹æ•ˆæœï¼š</p>
<blockquote>
<p>size == 0 ï¼Œè¿™ä¸ªæ—¶å€™ç­‰åŒäºfree()<br>
realloc_ptr == 0 &amp;&amp; size &gt; 0 ï¼Œ è¿™ä¸ªæ—¶å€™ç­‰åŒäºmalloc()<br>
malloc_usable_size(realloc_ptr) &gt;= sizeï¼Œ è¿™ä¸ªæ—¶å€™ç­‰åŒäºedit<br>
malloc_usable_size(realloc_ptr) &lt; sizeï¼Œ è¿™ä¸ªæ—¶å€™æ‰æ˜¯mallocä¸€å—æ›´å¤§çš„å†…å­˜ï¼Œå°†åŸæ¥çš„å†…å®¹å¤åˆ¶è¿‡å»ï¼Œå†å°†åŸæ¥çš„chunkç»™freeæ‰</p>
</blockquote>
</li>
<li>
<p>calloc</p>
<blockquote>
<p>void* calloc (size_t num, size_t size);</p>
</blockquote>
<p>callocå‡½æ•°æœ‰å°†ç”³è¯·åˆ°çš„ç©ºé—´åˆå§‹åŒ–ä¸º0çš„åŠŸèƒ½ï¼Œè€Œmallocå‡½æ•°æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ã€‚</p>
<p>ä½¿ç”¨callocç”³è¯·å†…å­˜æ—¶ä¸ä¼šåˆ†é… tcache chunk ä¸­çš„ chunk ã€‚</p>
</li>
</ul>
<h4 id="Chunk-Extend-and-Overlapping">Chunk Extend and Overlapping</h4>
<h4 id="Unlink">Unlink</h4>
<h4 id="Fastbin-Attack">Fastbin Attack</h4>
<h4 id="Unsorted-Bin-Attack">Unsorted Bin Attack</h4>
<h4 id="Large-Bin-Attack">Large Bin Attack</h4>
<h4 id="Tcache-attack">Tcache attack</h4>
<h4 id="Tcache-Stashing-Unlink-Attack">Tcache-Stashing-Unlink-Attack</h4>
<h4 id="House">House</h4>
<p><code>Glibc</code> çš„ <code>house of</code> ç³»åˆ—æ”»å‡»æ‰‹æ³•åŸºäºéƒ½æ˜¯å›´ç»•ç€å †åˆ©ç”¨å’Œ <code>IO FILE</code> åˆ©ç”¨ã€‚å¯ä»¥è·Ÿç€<a target="_blank" rel="noopener" href="https://github.com/shellphish/how2heap">how2heap</a>è¿›è¡Œå­¦ä¹ ï¼Œè¿™é‡Œåˆ—ä¸¾ä¸€äº›æˆ‘æ‰€çŸ¥é“çš„</p>
<p><strong>House Of Force</strong></p>
<p><strong>House of Orange</strong></p>
<p><strong>House of Roman</strong></p>
<p><strong>House of Pig</strong></p>
<p><strong>House of banana</strong></p>
<p><strong>House of Corrosion</strong></p>
<p><strong>House of emma</strong></p>
<p><strong>House of wiki</strong></p>
<p><strong>House of apple</strong></p>
<p><a target="_blank" rel="noopener" href="https://roderickchan.github.io/zh-cn/2023-02-27-house-of-all-about-glibc-heap-exploitation/#2-house-of%E7%B3%BB%E5%88%97">Glibcå †åˆ©ç”¨ä¹‹house ofç³»åˆ—æ€»ç»“ - roderick - record and learn! (roderickchan.github.io)</a></p>
<h3 id="shellcode">shellcode</h3>
<p>å¤ªå¼ºäº†ï¼Œè†œæ‹œ</p>
<p><a target="_blank" rel="noopener" href="https://roderickchan.github.io/zh-cn/2023-02-20-the-art-of-shellcode/">Linuxä¸‹çš„shellcodeæŠ€å·§æ€»ç»“ - roderick - record and learn! (roderickchan.github.io)</a></p>
<h3 id="ORW">ORW</h3>
<h3 id="Tools">Tools</h3>
<h4 id="IDA-Pro">IDA Pro</h4>
<p>idaåœ¨pwnä¸­ç”¨çš„ä¸æ·±ï¼Œä¼šä¸€äº›åŸºæœ¬çš„ï¼Œç„¶åä¼šIDA_Patchå³å¯</p>
<p>F5åæ±‡ç¼–</p>
<p>alt+T</p>
<p>shift+f12æŸ¥çœ‹ç¨‹åºé‡Œçš„å­—ç¬¦ä¸²</p>
<p>nï¼šæ›´æ”¹å˜é‡çš„åç§°</p>
<p>gï¼šç›´æ¥è·³è½¬åˆ°æŸä¸ªåœ°å€</p>
<p>/ ï¼šåœ¨åç¼–è¯‘åä¼ªä»£ç çš„ç•Œé¢ä¸­å†™ä¸‹æ³¨é‡Š</p>
<p>stripå»ç¬¦å·çš„é¢˜ï¼ŒåŠ ç­¾åæ–‡ä»¶ï¼Œå¯ä»¥æ˜¾ç¤ºéƒ¨åˆ†å‡½æ•°å</p>
<h4 id="pwndbg-peda-gef">pwndbg/peda/gef</h4>
<p>ä¸‰è€…æˆ‘è®¤ä¸ºpwndbgæœ€å¥½ç”¨ï¼Œæœ‰ä¸€äº›å¥½ç”¨çš„æŒ‡ä»¤ï¼Œä¹Ÿä¸å¤ªå¡</p>
<ul>
<li>
<p>åŸºæœ¬æŒ‡ä»¤</p>
<ul>
<li>si//å•æ­¥æ­¥å…¥ï¼Œé‡åˆ°è°ƒç”¨è·Ÿè¿›å‡½æ•°ä¸­</li>
<li>ni //å•æ­¥æ­¥è¿‡ï¼Œé‡åˆ°å‡½æ•°ä¸è·Ÿè¿›</li>
<li>b *åœ°å€//æ®µæŒ‡å®šåœ°å€ï¼Œb *main</li>
<li>b *$ rebase(0x123456) //$rebase åœ¨è°ƒè¯•å¼€PIEçš„ç¨‹åºçš„æ—¶å€™å¯ä»¥ç›´æ¥åŠ ä¸Šç¨‹åºçš„éšæœºåœ°å€</li>
<li>vmmap //å†…å­˜åˆ†é…æƒ…å†µ</li>
<li>r//è¿è¡Œ</li>
<li>c//ç»§ç»­</li>
</ul>
</li>
<li>
<p>æŸ¥çœ‹å†…å­˜æŒ‡ä»¤x</p>
<ul>
<li>x/32gx åœ°å€  //æˆ‘å–œæ¬¢ç”¨è¿™ä¸ªï¼Œæ‰“å°åœ°å€çš„å†…å®¹ä»¥16è¿›åˆ¶</li>
<li>x /10i 0x123456 //ä»0x123456å¤„å‘åæ˜¾ç¤ºåæ¡æ±‡ç¼–æŒ‡ä»¤</li>
</ul>
</li>
<li>
<p>æ‰“å°æŒ‡ä»¤p</p>
</li>
<li>
<p>ä¿®æ”¹æŒ‡ä»¤set</p>
<ul>
<li><code>set $rdi=0x10</code> //æŠŠrdiå¯„å­˜å™¨çš„å€¼å˜ä¸º0x10</li>
<li><code>set *(0x123456)=0x10</code> //0x123456åœ°å€çš„å€¼å˜ä¸º0x10ï¼Œ<strong>æ³¨æ„å¸¦æ˜Ÿå·</strong></li>
</ul>
</li>
<li>
<p>å †æ“ä½œæŒ‡ä»¤</p>
<ul>
<li>
<p><code>arena</code> //æ˜¾ç¤ºarenaçš„è¯¦ç»†ä¿¡æ¯</p>
<ul>
<li><code>arenas</code> //æ˜¾ç¤ºæ‰€æœ‰arenaçš„åŸºæœ¬ä¿¡æ¯</li>
<li><code>arenainfo</code> //<strong>å¥½çœ‹çš„æ˜¾ç¤º</strong>æ‰€æœ‰arenaçš„ä¿¡æ¯</li>
</ul>
</li>
<li>
<p><code>bins</code> //</p>
<p>å¸¸ç”¨ï¼ŒæŸ¥çœ‹æ‰€æœ‰ç§ç±»çš„å †å—çš„é“¾è¡¨æƒ…å†µ</p>
<ul>
<li><code>fastbins</code> //å•ç‹¬æŸ¥çœ‹fastbinsçš„é“¾è¡¨æƒ…å†µ</li>
<li><code>largebins</code> //åŒä¸Šï¼Œå•ç‹¬æŸ¥çœ‹largebinsçš„é“¾è¡¨æƒ…å†µ</li>
<li><code>smallbins</code> //åŒä¸Šï¼Œå•ç‹¬æŸ¥çœ‹smallbinsçš„é“¾è¡¨æƒ…å†µ</li>
<li><code>unsortedbin</code> //åŒä¸Šï¼Œå•ç‹¬æŸ¥çœ‹unsortedbiné“¾è¡¨æƒ…å†µ</li>
<li><code>tcachebins</code> //åŒä¸Šï¼Œå•ç‹¬æŸ¥çœ‹tcachebinsçš„é“¾è¡¨æƒ…å†µ</li>
<li><code>tcache</code> //æŸ¥çœ‹tcacheè¯¦ç»†ä¿¡æ¯</li>
</ul>
</li>
<li>
<p><code>heap</code> //</p>
<p>æ•°æ®ç»“æ„çš„å½¢å¼æ˜¾ç¤ºæ‰€æœ‰å †å—ï¼Œä¼šæ˜¾ç¤ºä¸€å¤§å †</p>
<ul>
<li><code>heapbase</code> //<strong>æŸ¥çœ‹å †èµ·å§‹åœ°å€</strong></li>
<li><code>heapinfo</code>ã€<code>heapinfoall</code> //æ˜¾ç¤ºå †å¾—ä¿¡æ¯ï¼Œå’Œbinsçš„æŒºåƒçš„ï¼Œ<strong>æ²¡binså¥½ç”¨</strong></li>
<li><code>parseheap</code> //æ˜¾ç¤ºå †ç»“æ„ï¼Œ<strong>å¾ˆå¥½ç”¨</strong></li>
</ul>
</li>
<li>
<p><code>tracemalloc</code> //<strong>å¥½ç”¨</strong>ï¼Œä¼šè·Ÿæç¤ºæ‰€æœ‰æ“ä½œå †çš„åœ°æ–¹</p>
</li>
</ul>
</li>
<li>
<p>å…¶ä»–pwndbgæ’ä»¶ç‹¬æœ‰æŒ‡ä»¤</p>
<ul>
<li><code>cyclic 50</code> //ç”Ÿæˆ50ä¸ªç”¨æ¥æº¢å‡ºçš„å­—ç¬¦ï¼Œå¦‚ï¼šaaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama</li>
<li><code>$reabse</code> //<strong>å¼€å¯PIEçš„æƒ…å†µçš„åœ°å€åç§»</strong>
<ul>
<li><code>b *$reabse(0x123456)</code> //æ–­ä½PIEçŠ¶æ€ä¸‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­0x123456çš„åœ°æ–¹</li>
<li><code>codebase</code> //æ‰“å°PIEåç§»ï¼Œ<strong>ä¸rebaseä¸åŒï¼Œè¿™æ˜¯æ‰“å°ï¼Œrebaseæ˜¯ä½¿ç”¨</strong></li>
</ul>
</li>
<li><code>stack</code> //<strong>æŸ¥çœ‹æ ˆ</strong></li>
<li><code>retaddr</code> //æ‰“å°åŒ…å«è¿”å›åœ°å€çš„æ ˆåœ°å€</li>
<li><code>canary</code> //ç›´æ¥çœ‹canaryçš„å€¼</li>
<li><code>plt</code> //æŸ¥çœ‹pltè¡¨</li>
<li><code>got</code> //æŸ¥çœ‹gotè¡¨</li>
<li><code>hexdump</code> //åƒIDAé‚£æ ·æ˜¾ç¤ºæ•°æ®ï¼Œ<strong>å¸¦å­—ç¬¦ä¸²</strong></li>
</ul>
</li>
</ul>
<h4 id="pwntools">pwntools</h4>
<p>å¿…å¤‡çš„åº“ï¼Œä¼šç”¨å®ƒå¯ä»¥å¤§å¤§åŠ å¿«ç¼–å†™expçš„é€Ÿåº¦</p>
<p>è¦å……åˆ†äº†è§£å®ƒçš„è®¸å¤šæœ‰ç”¨æ¨¡å—å¯ä»<a target="_blank" rel="noopener" href="http://docs.pwntools.com/">å®˜æ–¹æ–‡æ¡£</a>ç€æ‰‹</p>
<h4 id="seccomp-tools">seccomp-tools</h4>
<p>Secommp (SECure COMPuting) æ˜¯ Linux å†…æ ¸ 2.6.12 ç‰ˆæœ¬å¼•å…¥çš„å®‰å…¨æ¨¡å—ï¼Œä¸»è¦æ˜¯ç”¨æ¥é™åˆ¶æŸä¸€è¿›ç¨‹å¯ç”¨çš„ç³»ç»Ÿè°ƒç”¨ (system call)ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªå·¥å…·æ¥å¯ä»¥åˆ†æç¨‹åºçš„seccompçŠ¶æ€ï¼Œçœ‹ç¦ç”¨äº†å“ªäº›ç³»ç»Ÿè°ƒç”¨</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">seccomp-tools dump ./pwn<br></code></pre></td></tr></table></figure>
<h4 id="patchelf">patchelf</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">patchelf --replace-needed libc.so.6 ä½ è¦æ¢çš„libcçš„ç¡¬è·¯å¾„ ./pwn<br>patchelf --set-interpreter ldçš„ç¡¬è·¯å¾„ ./pwn<br></code></pre></td></tr></table></figure>
<h4 id="one-gadget">one_gadget</h4>
<p>å¯ä»¥ç”¨æ¥å¯»æ‰¾ä¸‡èƒ½çš„gadgetå»getshell</p>
<p>å¯ä»¥è®¾ç½®å‚æ•°æŸ¥æ‰¾ç­‰çº§ï¼Œæ‰¾åˆ°æ›´å¤šå¯ç”¨çš„gadget</p>
<p>ä¾‹ï¼š<code>one_gadget ./libc-2.27.so -l 1</code> è®¾ç½®ç­‰çº§level1</p>
<h4 id="glibc-all-in-one">glibc-all-in-one</h4>
<h2 id="Kernel-Mode">Kernel Mode</h2>
<h3 id="å¸¸ç”¨ç»“æ„ä½“">å¸¸ç”¨ç»“æ„ä½“</h3>
<h4 id="TTY">TTY</h4>
<h5 id="åˆ›å»ºç»“æ„">åˆ›å»ºç»“æ„</h5>
<p>æ‰“å¼€è®¾å¤‡/dev/ptmxæ—¶</p>
<p><strong>open(â€œ/dev/ptmxâ€,O_RDWR)</strong></p>
<h6 id="tty-struct">tty_struct</h6>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> TTY_STRUCT_SIZE 0x2e0</span><br><span class="hljs-comment">//magic =0x5401</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_struct</span> &#123;</span>  <br>    <span class="hljs-type">int</span> magic;  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kref</span> <span class="hljs-title">kref</span>;</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">device</span> *<span class="hljs-title">dev</span>;</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_driver</span> *<span class="hljs-title">driver</span>;</span>  <br>    <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_operations</span> *<span class="hljs-title">ops</span>;</span>  <br>    <span class="hljs-type">int</span> index;  <br>    <span class="hljs-comment">/* Protects ldisc changes: Lock tty not pty */</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ld_semaphore</span> <span class="hljs-title">ldisc_sem</span>;</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_ldisc</span> *<span class="hljs-title">ldisc</span>;</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mutex</span> <span class="hljs-title">atomic_write_lock</span>;</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mutex</span> <span class="hljs-title">legacy_mutex</span>;</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mutex</span> <span class="hljs-title">throttle_mutex</span>;</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">rw_semaphore</span> <span class="hljs-title">termios_rwsem</span>;</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mutex</span> <span class="hljs-title">winsize_mutex</span>;</span>  <br>    <span class="hljs-type">spinlock_t</span> ctrl_lock;  <br>    <span class="hljs-type">spinlock_t</span> flow_lock;  <br>    <span class="hljs-comment">/* Termios values are protected by the termios rwsem */</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ktermios</span> <span class="hljs-title">termios</span>, <span class="hljs-title">termios_locked</span>;</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">termiox</span> *<span class="hljs-title">termiox</span>;</span>    <span class="hljs-comment">/* May be NULL for unsupported */</span>  <br>    <span class="hljs-type">char</span> name[<span class="hljs-number">64</span>];  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pid</span> *<span class="hljs-title">pgrp</span>;</span>       <span class="hljs-comment">/* Protected by ctrl lock */</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pid</span> *<span class="hljs-title">session</span>;</span>  <br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;  <br>    <span class="hljs-type">int</span> count;  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">winsize</span> <span class="hljs-title">winsize</span>;</span>     <span class="hljs-comment">/* winsize_mutex */</span>  <br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> stopped:<span class="hljs-number">1</span>,    <span class="hljs-comment">/* flow_lock */</span>  <br>              flow_stopped:<span class="hljs-number">1</span>,  <br>              unused:BITS_PER_LONG - <span class="hljs-number">2</span>;  <br>    <span class="hljs-type">int</span> hw_stopped;  <br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> ctrl_status:<span class="hljs-number">8</span>,    <span class="hljs-comment">/* ctrl_lock */</span>  <br>              packet:<span class="hljs-number">1</span>,  <br>              unused_ctrl:BITS_PER_LONG - <span class="hljs-number">9</span>;  <br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> receive_room;  <span class="hljs-comment">/* Bytes free for queue */</span>  <br>    <span class="hljs-type">int</span> flow_change;  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_struct</span> *<span class="hljs-title">link</span>;</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">fasync_struct</span> *<span class="hljs-title">fasync</span>;</span>  <br>    <span class="hljs-type">wait_queue_head_t</span> write_wait;  <br>    <span class="hljs-type">wait_queue_head_t</span> read_wait;  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">work_struct</span> <span class="hljs-title">hangup_work</span>;</span>  <br>    <span class="hljs-type">void</span> *disc_data;  <br>    <span class="hljs-type">void</span> *driver_data;  <br>    <span class="hljs-type">spinlock_t</span> files_lock;      <span class="hljs-comment">/* protects tty_files list */</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">tty_files</span>;</span>  <br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N_TTY_BUF_SIZE 4096  </span><br>    <span class="hljs-type">int</span> closing;  <br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *write_buf;  <br>    <span class="hljs-type">int</span> write_cnt;  <br>    <span class="hljs-comment">/* If the tty has a pending do_SAK, queue it here - akpm */</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">work_struct</span> <span class="hljs-title">SAK_work</span>;</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_port</span> *<span class="hljs-title">port</span>;</span>  <br>&#125; __randomize_layout;  <br></code></pre></td></tr></table></figure>
<h6 id="tty-ops">tty_ops</h6>
<p><code>tty_struct</code>ä¸­çš„<code>const struct tty_operations *ops;</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_operations</span> &#123;</span>  <br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_struct</span> * (*<span class="hljs-title">lookup</span>)(<span class="hljs-keyword">struct</span> <span class="hljs-title">tty_driver</span> *<span class="hljs-title">driver</span>,  </span><br><span class="hljs-class">            <span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">filp</span>, <span class="hljs-title">int</span> <span class="hljs-title">idx</span>);</span>  <br>    <span class="hljs-type">int</span>  (*install)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-keyword">struct</span> tty_struct *tty);  <br>    <span class="hljs-type">void</span> (*remove)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-keyword">struct</span> tty_struct *tty);  <br>    <span class="hljs-type">int</span>  (*open)(<span class="hljs-keyword">struct</span> tty_struct * tty, <span class="hljs-keyword">struct</span> file * filp);  <br>    <span class="hljs-type">void</span> (*close)(<span class="hljs-keyword">struct</span> tty_struct * tty, <span class="hljs-keyword">struct</span> file * filp);  <br>    <span class="hljs-type">void</span> (*shutdown)(<span class="hljs-keyword">struct</span> tty_struct *tty);  <br>    <span class="hljs-type">void</span> (*cleanup)(<span class="hljs-keyword">struct</span> tty_struct *tty);  <br>    <span class="hljs-type">int</span>  (*write)(<span class="hljs-keyword">struct</span> tty_struct * tty,  <br>              <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *buf, <span class="hljs-type">int</span> count);  <br>    <span class="hljs-type">int</span>  (*put_char)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> ch);  <br>    <span class="hljs-type">void</span> (*flush_chars)(<span class="hljs-keyword">struct</span> tty_struct *tty);  <br>    <span class="hljs-type">int</span>  (*write_room)(<span class="hljs-keyword">struct</span> tty_struct *tty);  <br>    <span class="hljs-type">int</span>  (*chars_in_buffer)(<span class="hljs-keyword">struct</span> tty_struct *tty);  <br>    <span class="hljs-type">int</span>  (*ioctl)(<span class="hljs-keyword">struct</span> tty_struct *tty,  <br>            <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg);  <br>    <span class="hljs-type">long</span> (*compat_ioctl)(<span class="hljs-keyword">struct</span> tty_struct *tty,  <br>                 <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg);  <br>    <span class="hljs-type">void</span> (*set_termios)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> ktermios * old);  <br>    <span class="hljs-type">void</span> (*throttle)(<span class="hljs-keyword">struct</span> tty_struct * tty);  <br>    <span class="hljs-type">void</span> (*unthrottle)(<span class="hljs-keyword">struct</span> tty_struct * tty);  <br>    <span class="hljs-type">void</span> (*stop)(<span class="hljs-keyword">struct</span> tty_struct *tty);  <br>    <span class="hljs-type">void</span> (*start)(<span class="hljs-keyword">struct</span> tty_struct *tty);  <br>    <span class="hljs-type">void</span> (*hangup)(<span class="hljs-keyword">struct</span> tty_struct *tty);  <br>    <span class="hljs-type">int</span> (*break_ctl)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">int</span> state);  <br>    <span class="hljs-type">void</span> (*flush_buffer)(<span class="hljs-keyword">struct</span> tty_struct *tty);  <br>    <span class="hljs-type">void</span> (*set_ldisc)(<span class="hljs-keyword">struct</span> tty_struct *tty);  <br>    <span class="hljs-type">void</span> (*wait_until_sent)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">int</span> timeout);  <br>    <span class="hljs-type">void</span> (*send_xchar)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">char</span> ch);  <br>    <span class="hljs-type">int</span> (*tiocmget)(<span class="hljs-keyword">struct</span> tty_struct *tty);  <br>    <span class="hljs-type">int</span> (*tiocmset)(<span class="hljs-keyword">struct</span> tty_struct *tty,  <br>            <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-built_in">set</span>, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> clear);  <br>    <span class="hljs-type">int</span> (*resize)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> winsize *ws);  <br>    <span class="hljs-type">int</span> (*set_termiox)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> termiox *tnew);  <br>    <span class="hljs-type">int</span> (*get_icount)(<span class="hljs-keyword">struct</span> tty_struct *tty,  <br>                <span class="hljs-keyword">struct</span> serial_icounter_struct *icount);  <br>    <span class="hljs-type">void</span> (*show_fdinfo)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> seq_file *m);  <br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_CONSOLE_POLL  </span><br>    <span class="hljs-type">int</span> (*poll_init)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-type">int</span> line, <span class="hljs-type">char</span> *options);  <br>    <span class="hljs-type">int</span> (*poll_get_char)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-type">int</span> line);  <br>    <span class="hljs-type">void</span> (*poll_put_char)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-type">int</span> line, <span class="hljs-type">char</span> ch);  <br><span class="hljs-meta">#<span class="hljs-keyword">endif</span>  </span><br>    <span class="hljs-type">int</span> (*proc_show)(<span class="hljs-keyword">struct</span> seq_file *, <span class="hljs-type">void</span> *);  <br>&#125; __randomize_layout;  <br></code></pre></td></tr></table></figure>
<h5 id="leak-kernel-base">leak kernel_base</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//no kalsr---&gt;kernel_base = 0xffffffff81000000;</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PTM_UNIX98_OPS 0xffffffff81e8e440</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PTY_UNIX98_OPS 0xffffffff81e8e320</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> COMMIT_CREDS 0xffffffff810a9b40</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PREPARE_KERNEL_CRED 0xffffffff810a9ef0</span><br><br><br>tty_ops = *(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span>*)(tty_data + <span class="hljs-number">3</span>);<br>kernel_offset = ((tty_ops &amp; <span class="hljs-number">0xfff</span>) == (PTY_UNIX98_OPS &amp; <span class="hljs-number">0xfff</span>) ? (tty_ops - PTY_UNIX98_OPS) : tty_ops - PTM_UNIX98_OPS);<br>kernel_base = (<span class="hljs-type">void</span>*) ((<span class="hljs-type">size_t</span>)kernel_base + kernel_offset);<br>prepare_kernel_cred = PREPARE_KERNEL_CRED + kernel_offset;<br>commit_creds = COMMIT_CREDS + kernel_offset;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[34m\033[1m*\033[0m] Kernel offset: 0x%llx\n&quot;</span>, kernel_offset);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[32m\033[1m+\033[0m] Kernel base: %p\n&quot;</span>, kernel_base);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[34m\033[1m*\033[0m] prepare_kernel_cred: 0x%llx\n&quot;</span>, prepare_kernel_cred);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[32m\033[1m+\033[0m] commit_creds: %p\n&quot;</span>, commit_creds);<br></code></pre></td></tr></table></figure>
<h4 id="msg">msg</h4>
<blockquote>
<p>æˆ‘ä»¬éƒ½å­¦è¿‡æ“ä½œç³»ç»Ÿï¼Œé‚£å°±ç»•ä¸å¼€é€šä¿¡çš„é—®é¢˜ï¼Œæ— è®ºæ˜¯è¿›ç¨‹é—´é€šä¿¡ï¼Œè¿˜æ˜¯ç½‘ç»œç¼–ç¨‹ï¼Œlinux éƒ½ç»™äº†æˆ‘ä»¬å¾ˆå¤šå‡½æ•°ï¼Œæ¯”å¦‚è¯´æ¶ˆæ¯é˜Ÿåˆ— msg_queueï¼Œå¥—æ¥å­— socketï¼Œç®¡é“ pipe ç­‰ç­‰ï¼Œé‚£ä¹ˆæ—¢ç„¶æ˜¯è¿›ç¨‹é—´é€šä¿¡ï¼Œå¿…é¡»ä¼šä½¿ç”¨åˆ°å†…æ ¸ç©ºé—´ï¼Œå› æ­¤ä¹Ÿä¸€å®šç”³è¯·å†…æ ¸å †å—ï¼Œåˆ›å»ºç»“æ„ä½“ï¼Œå› æ­¤éœ€è¦ä»è¿™äº›ç»“æ„ä½“ï¼Œå®Œæˆå¯¹ double free çš„åˆ©ç”¨ã€‚</p>
</blockquote>
<p>æ¶ˆæ¯é˜Ÿåˆ— msg_queueï¼Œæœ‰å¦‚ä¸‹å‡½æ•°ï¼šmsgget(å¾—åˆ°æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦æˆ–åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å¯¹è±¡)ã€msgctl (è·å–å’Œè®¾ç½®æ¶ˆæ¯é˜Ÿåˆ—çš„å±æ€§)ã€msgsnd(å°†æ¶ˆæ¯å†™å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—)ã€msgrcv(ä»æ¶ˆæ¯é˜Ÿåˆ—è¯»å–æ¶ˆæ¯)</p>
<h5 id="åˆ›å»ºç»“æ„-2">åˆ›å»ºç»“æ„</h5>
<h6 id="msgget">msgget</h6>
<p>åœ¨ä½¿ç”¨å‡½æ•° msgget åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª msg_queue ç»“æ„ä½“ï¼Œå¦‚ä¸‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg_queue</span> &#123;</span><span class="hljs-comment">//msgé˜Ÿåˆ—ç»“æ„ä½“</span><br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kern_ipc_perm</span> <span class="hljs-title">q_perm</span>;</span> <span class="hljs-comment">//æ¯ä¸ªipc ç›¸å…³ç»“æ„ä½“éƒ½è¦æœ‰q_perm</span><br>	<span class="hljs-type">time64_t</span> q_stime;		<span class="hljs-comment">/* last msgsnd time */</span><br>	<span class="hljs-type">time64_t</span> q_rtime;		<span class="hljs-comment">/* last msgrcv time */</span><br>	<span class="hljs-type">time64_t</span> q_ctime;		<span class="hljs-comment">/* last change time */</span><br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> q_cbytes;		<span class="hljs-comment">/* å½“å‰æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„å­—èŠ‚æ•° */</span><br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> q_qnum;		<span class="hljs-comment">/* å½“å‰æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ•° */</span><br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> q_qbytes;		<span class="hljs-comment">/* æ¶ˆæ¯é˜Ÿåˆ—ä¸­å…è®¸çš„æœ€å¤§å­—èŠ‚æ•° */</span><br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pid</span> *<span class="hljs-title">q_lspid</span>;</span>		<span class="hljs-comment">/* pid of last msgsnd */</span><br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pid</span> *<span class="hljs-title">q_lrpid</span>;</span>		<span class="hljs-comment">/* last receive pid */</span><br><br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">q_messages</span>;</span><span class="hljs-comment">/* æ¶ˆæ¯é˜Ÿåˆ— */</span><br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">q_receivers</span>;</span><br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">q_senders</span>;</span><br>&#125; __randomize_layout;<br></code></pre></td></tr></table></figure>
<h6 id="msgsnd">msgsnd</h6>
<p>ä½¿ç”¨ msgsnd å‘è¯¥æ¶ˆæ¯å‘é€ä¸€æ®µæ¶ˆæ¯æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª msg_msg ç»“æ„ä½“ï¼Œå¦‚ä¸‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg_msg</span> &#123;</span><span class="hljs-comment">//ä¸»æ¶ˆæ¯æ®µå¤´éƒ¨</span><br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">m_list</span>;</span> <span class="hljs-comment">//æ¶ˆæ¯åŒå‘é“¾è¡¨æŒ‡é’ˆ</span><br>	<span class="hljs-type">long</span> m_type;<br>	<span class="hljs-type">size_t</span> m_ts;		<span class="hljs-comment">/* æ¶ˆæ¯å¤§å° */</span><br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg_msgseg</span> *<span class="hljs-title">next</span>;</span> <span class="hljs-comment">//æŒ‡å‘æ¶ˆæ¯ç¬¬äºŒæ®µ</span><br>	<span class="hljs-type">void</span> *security;<br>	<span class="hljs-comment">/* åé¢æ¥ç€æ¶ˆæ¯çš„æ–‡æœ¬ */</span><br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg_msgseg</span> &#123;</span><span class="hljs-comment">//å­æ¶ˆæ¯æ®µå¤´éƒ¨</span><br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg_msgseg</span> *<span class="hljs-title">next</span>;</span> <span class="hljs-comment">//æŒ‡å‘ä¸‹ä¸€æ®µçš„æŒ‡é’ˆï¼Œæœ€å¤šä¸‰æ®µ</span><br>	<span class="hljs-comment">/* åé¢æ¥ç€æ¶ˆæ¯ç¬¬äºŒ/ä¸‰æ®µçš„æ–‡æœ¬ */</span><br>&#125;;<br></code></pre></td></tr></table></figure>
<h4 id="seq">seq</h4>
<h5 id="åˆ›å»ºç»“æ„-3">åˆ›å»ºç»“æ„</h5>
<p>å½“æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ª stat æ–‡ä»¶æ—¶ï¼ˆå¦‚ <code>/proc/self/stat</code> ï¼‰ä¾¿ä¼šåœ¨å†…æ ¸ç©ºé—´ä¸­åˆ†é…ä¸€ä¸ª seq_operations ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“å®šä¹‰äº <code>/include/linux/seq_file.h</code> å½“ä¸­ï¼Œåªå®šä¹‰äº†å››ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_operations</span> &#123;</span><br>    <span class="hljs-type">void</span> * (*start) (<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">loff_t</span> *pos);<br>    <span class="hljs-type">void</span> (*stop) (<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v);<br>    <span class="hljs-type">void</span> * (*next) (<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v, <span class="hljs-type">loff_t</span> *pos);<br>    <span class="hljs-type">int</span> (*show) (<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v);<br>&#125;;<br></code></pre></td></tr></table></figure>
<h5 id="leak">leak</h5>
<p>æ³„éœ²å†…æ ¸ä»£ç æ®µåœ°å€</p>
<h5 id="æ§åˆ¶æ‰§è¡Œæµ">æ§åˆ¶æ‰§è¡Œæµ</h5>
<p>å½“æˆ‘ä»¬ read ä¸€ä¸ª stat æ–‡ä»¶æ—¶ï¼Œå†…æ ¸ä¼šè°ƒç”¨å…¶ proc_ops çš„ <code>proc_read_iter</code> æŒ‡é’ˆï¼Œå…¶é»˜è®¤å€¼ä¸º <code>seq_read_iter()</code> å‡½æ•°ï¼Œå®šä¹‰äº <code>fs/seq_file.c</code> ä¸­ï¼Œæ³¨æ„åˆ°æœ‰å¦‚ä¸‹é€»è¾‘ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">ssize_t</span> <span class="hljs-title function_">seq_read_iter</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> kiocb *iocb, <span class="hljs-keyword">struct</span> iov_iter *iter)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_file</span> *<span class="hljs-title">m</span> =</span> iocb-&gt;ki_filp-&gt;private_data;<br>    <span class="hljs-comment">//...</span><br>    p = m-&gt;op-&gt;start(m, &amp;m-&gt;index);<br>    <span class="hljs-comment">//...</span><br></code></pre></td></tr></table></figure>
<p>å³å…¶ä¼šè°ƒç”¨ seq_operations ä¸­çš„ start å‡½æ•°æŒ‡é’ˆï¼Œé‚£ä¹ˆ<strong>æˆ‘ä»¬åªéœ€è¦æ§åˆ¶ seq_operations-&gt;start åå†è¯»å–å¯¹åº” stat æ–‡ä»¶ä¾¿èƒ½æ§åˆ¶å†…æ ¸æ‰§è¡Œæµ</strong></p>
<h3 id="kernel-rop">kernel rop</h3>
<h3 id="ret2usr">ret2usr</h3>
<h3 id="Race-Condition-2">Race Condition</h3>
<h4 id="userfaultfd">userfaultfd</h4>
<h4 id="double-fetch">double fetch</h4>
<h3 id="modprobe-path">modprobe_path</h3>
<h3 id="heap-overflow">heap overflow</h3>
<h3 id="ret2dir">ret2dir</h3>
<h3 id="uaf">uaf</h3>
<h2 id="çŸ¥è¯†å‚¨å¤‡">çŸ¥è¯†å‚¨å¤‡</h2>
<h3 id="ELFæ–‡ä»¶æ ¼å¼">ELFæ–‡ä»¶æ ¼å¼</h3>
<h3 id="å‡½æ•°è°ƒç”¨çº¦å®š">å‡½æ•°è°ƒç”¨çº¦å®š</h3>
<h3 id="å¸¸ç”¨çš„ç³»ç»Ÿè°ƒç”¨">å¸¸ç”¨çš„ç³»ç»Ÿè°ƒç”¨</h3>
<h4 id="system">system</h4>
<p>è¦ropå‡º<code>system(â€œ/bin/sh\x00â€)</code></p>
<p>å‚æ•°</p>
<blockquote>
<p>rdi=â€œ/bin/sh\x00â€å­—ç¬¦ä¸²çš„åœ°å€</p>
</blockquote>
<h4 id="execve">execve</h4>
<blockquote>
<p>int execve(const char *filename, char *const argv[], char *const envp[]);</p>
</blockquote>
<p>è¦ropå‡º<code>execve('/bin/sh\x00',0,0)</code></p>
<p>å‚æ•°:</p>
<blockquote>
<p>rdi='/bin/sh\x00â€™å­—ç¬¦ä¸²çš„åœ°å€<br>
rsi=0 or åœ°å€-&gt;0<br>
rdx=0 or åœ°å€-&gt;0</p>
</blockquote>
<h4 id="open-read-write">open/read/write</h4>
<p>å¼€å¯æ²™ç›’æ—¶banäº†æŸäº›ç³»ç»Ÿè°ƒç”¨ï¼Œæ— æ³•è¾¾æˆgetshellæ—¶é€€è€Œæ±‚å…¶æ¬¡ï¼Œè¦ä½ é‡‡å–orwçš„æ–¹å¼cat flag</p>
<p>æœ‰æ—¶pwné¢˜ä¼šç»™æ›´ä¸¥æ ¼é™åˆ¶ä»…ç»™ä½ ä½¿ç”¨è¿™ä¸‰è€…ä¸­çš„ä¸¤ä¸ªæ¥cat flag</p>
<h4 id="mprotect">mprotect</h4>
<p>int mprotect(const void *start, size_t len, int prot)</p>
<p>å¯ä»¥ç”¨äºç»™æŸæ®µåœ°å€æå‡æƒé™ä¸ºå¯è¯»å¯å†™å¯æ‰§è¡Œï¼ˆrwxï¼‰</p>
<p>åªéœ€è¦protå‚æ•°ç­‰äº7(111B)</p>
<p>startå¿…é¡»æ˜¯ä¸€ä¸ªå†…å­˜é¡µçš„èµ·å§‹åœ°å€ï¼Œå¹¶ä¸”åŒºé—´é•¿åº¦lenå¿…é¡»æ˜¯é¡µå¤§å°çš„æ•´æ•°å€ã€‚</p>
<p>ä¸ç„¶ä¼šè°ƒç”¨å¤±è´¥</p>
<h3 id="å¸¸è§åæ±‡ç¼–æŒ‡ä»¤">å¸¸è§åæ±‡ç¼–æŒ‡ä»¤</h3>
<h3 id="ptmallocå †æ•°æ®ç»“æ„">ptmallocå †æ•°æ®ç»“æ„</h3>
<h3 id="ptmallocå †ç®¡ç†æœºåˆ¶">ptmallocå †ç®¡ç†æœºåˆ¶</h3>
<p>æœ€å¥½å­¦è¿™ä¸ªæœºåˆ¶å°±æ˜¯å»çœ‹å®ƒçš„æºç </p>
<h3 id="More">More</h3>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a target="_blank" rel="noopener" href="https://ctf-wiki.org/pwn/linux/user-mode/environment/">Environment - CTF Wiki (ctf-wiki.org)</a></p>
<p><a target="_blank" rel="noopener" href="https://lantern.cool/note-pwn-linux-protect/">Linux å¸¸ç”¨ä¿æŠ¤æœºåˆ¶ | Lanternâ€™s å°ç«™</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/murkuo/p/15965270.html">pwndbg åŸºæœ¬æ“ä½œæŒ‡ä»¤ - MuRKuo - åšå®¢å›­ (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/chennbnbnb/article/details/109284780">glibc2.31ä¸‹çš„æ–°double freeæ‰‹æ³•/å­—èŠ‚è·³åŠ¨pwné¢˜guné¢˜è§£_glibc 2.31ä¸‹å­˜åœ¨doublefreeå—-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_54218833/article/details/130426404">CTF-pwn pwntoolsç”¨æ³•æ¢ç´¢</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTF/" class="category-chain-item">CTF</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/ALL/">#ALL</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>pwnæ€»ç»“</div>
      <div>https://nqoinaen.github.io/2024/01/26/pwnæ€»ç»“/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>nq0inaen</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2024å¹´1æœˆ26æ—¥</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>æ›´æ–°äº</div>
          <div>2024å¹´1æœˆ28æ—¥</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/01/21/%E8%AF%BB%E8%AE%BA%E6%96%87/" title="A Deep Learning Based Energy-Efficient  Computational Offloading Method in Internet of  Vehicles">
                        <span class="hidden-mobile">A Deep Learning Based Energy-Efficient  Computational Offloading Method in Internet of  Vehicles</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"HQkzhCx71cjxSdXQfz0GrQxn-9Nh9j0Va","appKey":"vsNZcbA7YhzyMPIzfOM68B3I","path":"window.location.pathname","placeholder":"æ¬¢è¿è¯„è®º","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":true},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div style="font-size: 0.85rem">æ—¶é—´æ…¢ç‚¹èµ°å•Š</div> <div style="font-size: 0.85rem"> <span id="timeDate">è½½å…¥å¤©æ•°...</span> <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>





  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
